This repository is a first step to help the Couchbase community develop a standard, cross-platform (iOS, Android, and future platforms!) way of managing a CouchDB when using PhoneGap.

I started a thread explain this: https://groups.google.com/group/mobile-couchbase/browse_thread/thread/f4e9bc30e1dd3818

The goals are:
1) Allow for offline CouchApp loading since you cannot assume there will be a connection to download a CouchApp.
2) Provide a standard way for users to to authorized locally and to create an account on a remote server. 
3) Provide best practice samples for organizing and syncing local and remote databases. For example: using local databases like "appdata_db" with server databases like "myusername/appdata_db" and making sure authentication and authorization is secure.
4) Allow for users to trigger synchronizations from their mobile device while handling 2) and 3).
5) Cross-platform project creation in as simple and trouble free way as possible.

Current Progress
**************
1) Offline CouchApp loading on iOS - YES
2) Offline CouchApp loading on Android - NOT YET..volunteers? 


iOS Overview
**************

Goal 1) Allow for offline CouchApp loading

There is an objective-C class called CouchAppManager which handles: 
- CouchApp version checking either using the _rev field (version check requires CouchApp JSON loading/parsing) or a client supplied version string (version check can be performed without CouchApp JSON loading/parsing)
- creating the CouchApp database if it doesn't exist, creating and updating the CouchApp (with the correct _rev and _id fields)
- loading of any CouchApp page URL

Sample Code:

1) See AppDelegate.h and AppDelegate.m for integration tips. All Couchbase code that is integrated into PhoneGap is labeled with:

// Couchbase changes START
// Couchbase changes END

2) See AppDelegate.m couchbaseDidStart for a sample usage with _rev field based versioning. If you want to a avoid parsing the CouchApp to determine the version (for example, for release build), just pass a version string instead of nil to loadNewAppVersion:nil.

3) The workflow to update the CouchApp is currently as follows:

  a) Load the CouchApp into a desktop/laptop/cloud CouchDB. For example: 
     couchapp autopush http://127.0.0.1:5984/mycouchapp_db

  Note: don't forget the first time to run plain old 'push' like:
     couchapp push http://127.0.0.1:5984/mycouchapp_db

  b) When you are happy with the CouchApp, serialize it and don't forget to put it in the Resources XCode project directory. 

  Note: you must remove the "_id" and "_rev" fields from the exported file - you can do it by hand or use the couchpack gem.

  By hand (the hard way!):

     cd phonegap-couchbase-xplatform/phonegap-couchbase-ios/phonegap-couchbase-ios/Resources
     curl -X GET http://127.0.0.1:5984/mycouchapp_db/_design/mycouchapp?attachments=true > mycouchapp.json
     Then edit mycouchapp.json to remove the "_id" and "_rev" fields.

  By using couchpack (install):

     gem install couchpack

  By using couchpack (run):

     cd phonegap-couchbase-xplatform/phonegap-couchbase-ios/phonegap-couchbase-ios/Resources
     couchpack -d mycouchapp -a "_design/mycouchapp" -o mycouchapp 

For example: 

  c) Make sure the file is added to the resource directory in your project. Then build and run in XCode. 

Notes:
- doesn't use Trundle to try to keep it minimal.
- currently bundled with minimal Vendor Source (Couchbase, TouchFoundation).
- currently the library is written to use synchronous HTTP calls to keep the program flow simple. You can use Grand Central Dispatch (GCD) to put it on a background thread.

Troubleshooting:
1) If you want to run it on a physical device:
-> You need to apply for an appID and configure it using these instructions: http://wiki.phonegap.com/w/page/39991939/Getting-Started-with-PhoneGap-iOS-using-Xcode-4-(Template-Version)

2) If you are having problems with your app switching from PhoneGap to the local Safari app when you call [webView stringByEvaluatingJavaScriptFromString:couchappApgeURL], you need to 
add localhost to the ExternalHosts key in your PhoneGap.plist:
-> Select your PhoneGap.plist in the "Supporting Files" directory, and 
add the following 2 items as separate entries: 127.0.0.1 and 0.0.0.0.

3) If you get this warning: "Sending 'AppDelegate *' to parameter of incompatible type 'id<CouchbaseDelegate>'" 
-> This is because you need to set up your app delegate to also be a 
CouchbaseDelegate like this: 
    @interface AppDelegate : PhoneGapDelegate<CouchbaseDelegate>

4) If you get this warning: "Warning: The Copy Bundle Resources build phase contains this target's Info.plist file 'YourApp-Info.plist'. " 
-> You need to go into the "Copy Bundle Resources" and delete your App 
plist...Select your project in the left side panel, then select your 
TARGET, then choose the "Build Phases" tab, open "Copy Bundle 
Resources", select your App plist, press '-' to delete. 

5) If you app doesn't load, make sure you removed the "_id" and "_rev" fields, and that you added it as a resource in your XCode project.

6) If you are having build issues, make sure you have included in your project what you need from the Vendor directory.

Good luck!

Kevin