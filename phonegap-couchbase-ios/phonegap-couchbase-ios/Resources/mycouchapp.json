{"shows":{},"updates":{},"lists":{},"language":"javascript","README":"## Generated by CouchApp\n\nCouchApps are web applications which can be served directly from [CouchDB](http://couchdb.apache.org). This gives them the nice property of replicating just like any other data stored in CouchDB. They are also simple to write as they can use the built-in jQuery libraries and plugins that ship with CouchDB.\n\n[More info about CouchApps here.](http://couchapp.org)\n\n## Deploying this app\n\nAssuming you just cloned this app from git, and you have changed into the app directory in your terminal, you want to push it to your CouchDB with the CouchApp command line tool, like this:\n\n    couchapp push . http://name:password@hostname:5984/mydatabase\n\nIf you don't have a password on your CouchDB (admin party) you can do it like this (but it's a bad, idea, set a password):\n\n    couchapp push . http://hostname:5984/mydatabase\n\nIf you get sick of typing the URL, you should setup a `.couchapprc` file in the root of your directory. Remember not to check this into version control as it will have passwords in it.\n\nThe `.couchapprc` file should have contents like this:\n\n    {\n      \"env\" : {\n        \"public\" : {\n          \"db\" : \"http://name:pass@mycouch.couchone.com/mydatabase\"\n        },\n        \"default\" : {\n          \"db\" : \"http://name:pass@localhost:5984/mydatabase\"\n        }\n      }\n    }\n\nNow that you have the `.couchapprc` file set up, you can push your app to the CouchDB as simply as:\n\n    couchapp push\n\nThis pushes to the `default` as specified. To push to the `public` you'd run:\n\n    couchapp push public\n\nOf course you can continue to add more deployment targets as you see fit, and give them whatever names you like.","views":{"recent-items":{"map":"function(doc) {\n  if (doc.created_at) {\n    emit(doc.created_at, doc);\n  }\n};"}},"vendor":{"couchapp":{"metadata":{"name":"couchapp","fetch_uri":"git://github.com/couchapp/vendor.git","description":"official couchapp vendor"},"lib":{"mustache":"/*\n * CommonJS-compatible mustache.js module\n *\n * See http://github.com/janl/mustache.js for more info.\n */\n\n/*\n  mustache.js â€” Logic-less templates in JavaScript\n\n  See http://mustache.github.com/ for more info.\n*/\n\nvar Mustache = function() {\n  var Renderer = function() {};\n\n  Renderer.prototype = {\n    otag: \"{{\",\n    ctag: \"}}\",\n    pragmas: {},\n    buffer: [],\n    pragmas_implemented: {\n      \"IMPLICIT-ITERATOR\": true\n    },\n    context: {},\n\n    render: function(template, context, partials, in_recursion) {\n      // reset buffer & set context\n      if(!in_recursion) {\n        this.context = context;\n        this.buffer = []; // TODO: make this non-lazy\n      }\n\n      // fail fast\n      if(!this.includes(\"\", template)) {\n        if(in_recursion) {\n          return template;\n        } else {\n          this.send(template);\n          return;\n        }\n      }\n\n      template = this.render_pragmas(template);\n      var html = this.render_section(template, context, partials);\n      if(in_recursion) {\n        return this.render_tags(html, context, partials, in_recursion);\n      }\n\n      this.render_tags(html, context, partials, in_recursion);\n    },\n\n    /*\n      Sends parsed lines\n    */\n    send: function(line) {\n      if(line != \"\") {\n        this.buffer.push(line);\n      }\n    },\n\n    /*\n      Looks for %PRAGMAS\n    */\n    render_pragmas: function(template) {\n      // no pragmas\n      if(!this.includes(\"%\", template)) {\n        return template;\n      }\n\n      var that = this;\n      var regex = new RegExp(this.otag + \"%([\\\\w-]+) ?([\\\\w]+=[\\\\w]+)?\" +\n            this.ctag);\n      return template.replace(regex, function(match, pragma, options) {\n        if(!that.pragmas_implemented[pragma]) {\n          throw({message: \n            \"This implementation of mustache doesn't understand the '\" +\n            pragma + \"' pragma\"});\n        }\n        that.pragmas[pragma] = {};\n        if(options) {\n          var opts = options.split(\"=\");\n          that.pragmas[pragma][opts[0]] = opts[1];\n        }\n        return \"\";\n        // ignore unknown pragmas silently\n      });\n    },\n\n    /*\n      Tries to find a partial in the curent scope and render it\n    */\n    render_partial: function(name, context, partials) {\n      name = this.trim(name);\n      if(!partials || partials[name] === undefined) {\n        throw({message: \"unknown_partial '\" + name + \"'\"});\n      }\n      if(typeof(context[name]) != \"object\") {\n        return this.render(partials[name], context, partials, true);\n      }\n      return this.render(partials[name], context[name], partials, true);\n    },\n\n    /*\n      Renders inverted (^) and normal (#) sections\n    */\n    render_section: function(template, context, partials) {\n      if(!this.includes(\"#\", template) && !this.includes(\"^\", template)) {\n        return template;\n      }\n\n      var that = this;\n      // CSW - Added \"+?\" so it finds the tighest bound, not the widest\n      var regex = new RegExp(this.otag + \"(\\\\^|\\\\#)\\\\s*(.+)\\\\s*\" + this.ctag +\n              \"\\n*([\\\\s\\\\S]+?)\" + this.otag + \"\\\\/\\\\s*\\\\2\\\\s*\" + this.ctag +\n              \"\\\\s*\", \"mg\");\n\n      // for each {{#foo}}{{/foo}} section do...\n      return template.replace(regex, function(match, type, name, content) {\n        var value = that.find(name, context);\n        if(type == \"^\") { // inverted section\n          if(!value || that.is_array(value) && value.length === 0) {\n            // false or empty list, render it\n            return that.render(content, context, partials, true);\n          } else {\n            return \"\";\n          }\n        } else if(type == \"#\") { // normal section\n          if(that.is_array(value)) { // Enumerable, Let's loop!\n            return that.map(value, function(row) {\n              return that.render(content, that.create_context(row),\n                partials, true);\n            }).join(\"\");\n          } else if(that.is_object(value)) { // Object, Use it as subcontext!\n            return that.render(content, that.create_context(value),\n              partials, true);\n          } else if(typeof value === \"function\") {\n            // higher order section\n            return value.call(context, content, function(text) {\n              return that.render(text, context, partials, true);\n            });\n          } else if(value) { // boolean section\n            return that.render(content, context, partials, true);\n          } else {\n            return \"\";\n          }\n        }\n      });\n    },\n\n    /*\n      Replace {{foo}} and friends with values from our view\n    */\n    render_tags: function(template, context, partials, in_recursion) {\n      // tit for tat\n      var that = this;\n\n      var new_regex = function() {\n        return new RegExp(that.otag + \"(=|!|>|\\\\{|%)?([^\\\\/#\\\\^]+?)\\\\1?\" +\n          that.ctag + \"+\", \"g\");\n      };\n\n      var regex = new_regex();\n      var tag_replace_callback = function(match, operator, name) {\n        switch(operator) {\n        case \"!\": // ignore comments\n          return \"\";\n        case \"=\": // set new delimiters, rebuild the replace regexp\n          that.set_delimiters(name);\n          regex = new_regex();\n          return \"\";\n        case \">\": // render partial\n          return that.render_partial(name, context, partials);\n        case \"{\": // the triple mustache is unescaped\n          return that.find(name, context);\n        default: // escape the value\n          return that.escape(that.find(name, context));\n        }\n      };\n      var lines = template.split(\"\\n\");\n      for(var i = 0; i < lines.length; i++) {\n        lines[i] = lines[i].replace(regex, tag_replace_callback, this);\n        if(!in_recursion) {\n          this.send(lines[i]);\n        }\n      }\n\n      if(in_recursion) {\n        return lines.join(\"\\n\");\n      }\n    },\n\n    set_delimiters: function(delimiters) {\n      var dels = delimiters.split(\" \");\n      this.otag = this.escape_regex(dels[0]);\n      this.ctag = this.escape_regex(dels[1]);\n    },\n\n    escape_regex: function(text) {\n      // thank you Simon Willison\n      if(!arguments.callee.sRE) {\n        var specials = [\n          '/', '.', '*', '+', '?', '|',\n          '(', ')', '[', ']', '{', '}', '\\\\'\n        ];\n        arguments.callee.sRE = new RegExp(\n          '(\\\\' + specials.join('|\\\\') + ')', 'g'\n        );\n      }\n      return text.replace(arguments.callee.sRE, '\\\\$1');\n    },\n\n    /*\n      find `name` in current `context`. That is find me a value\n      from the view object\n    */\n    find: function(name, context) {\n      name = this.trim(name);\n\n      // Checks whether a value is thruthy or false or 0\n      function is_kinda_truthy(bool) {\n        return bool === false || bool === 0 || bool;\n      }\n\n      var value;\n      if(is_kinda_truthy(context[name])) {\n        value = context[name];\n      } else if(is_kinda_truthy(this.context[name])) {\n        value = this.context[name];\n      }\n\n      if(typeof value === \"function\") {\n        return value.apply(context);\n      }\n      if(value !== undefined) {\n        return value;\n      }\n      // silently ignore unkown variables\n      return \"\";\n    },\n\n    // Utility methods\n\n    /* includes tag */\n    includes: function(needle, haystack) {\n      return haystack.indexOf(this.otag + needle) != -1;\n    },\n\n    /*\n      Does away with nasty characters\n    */\n    escape: function(s) {\n      s = String(s === null ? \"\" : s);\n      return s.replace(/&(?!\\w+;)|[\"<>\\\\]/g, function(s) {\n        switch(s) {\n        case \"&\": return \"&amp;\";\n        case \"\\\\\": return \"\\\\\\\\\";\n        case '\"': return '\\\"';\n        case \"<\": return \"&lt;\";\n        case \">\": return \"&gt;\";\n        default: return s;\n        }\n      });\n    },\n\n    // by @langalex, support for arrays of strings\n    create_context: function(_context) {\n      if(this.is_object(_context)) {\n        return _context;\n      } else {\n        var iterator = \".\";\n        if(this.pragmas[\"IMPLICIT-ITERATOR\"]) {\n          iterator = this.pragmas[\"IMPLICIT-ITERATOR\"].iterator;\n        }\n        var ctx = {};\n        ctx[iterator] = _context;\n        return ctx;\n      }\n    },\n\n    is_object: function(a) {\n      return a && typeof a == \"object\";\n    },\n\n    is_array: function(a) {\n      return Object.prototype.toString.call(a) === '[object Array]';\n    },\n\n    /*\n      Gets rid of leading and trailing whitespace\n    */\n    trim: function(s) {\n      return s.replace(/^\\s*|\\s*$/g, \"\");\n    },\n\n    /*\n      Why, why, why? Because IE. Cry, cry cry.\n    */\n    map: function(array, fn) {\n      if (typeof array.map == \"function\") {\n        return array.map(fn);\n      } else {\n        var r = [];\n        var l = array.length;\n        for(var i = 0; i < l; i++) {\n          r.push(fn(array[i]));\n        }\n        return r;\n      }\n    }\n  };\n\n  return({\n    name: \"mustache.js\",\n    version: \"0.3.1-dev\",\n\n    /*\n      Turns a template and view into HTML\n    */\n    to_html: function(template, view, partials, send_fun) {\n      var renderer = new Renderer();\n      if(send_fun) {\n        renderer.send = send_fun;\n      }\n      renderer.render(template, view, partials);\n      if(!send_fun) {\n        return renderer.buffer.join(\"\\n\");\n      }\n    },\n    escape : function(text) {\n      return new Renderer().escape(text);\n    }\n  });\n}();\n\nexports.name = Mustache.name;\nexports.version = Mustache.version;\n\nexports.to_html = Mustache.to_html;\nexports.escape = Mustache.escape;","linkup":"// this code makes http://example.com into a link, \n// and also handles @name and #hashtag\n\n// todo add [[wiki_links]]\n\nvar mustache = require(\"vendor/couchapp/lib/mustache\");\nexports.encode = function(body, person_prefix, tag_prefix) {\n  body = mustache.escape(body);\n  person_prefix = person_prefix || \"http://twitter.com/\";\n  tag_prefix = tag_prefix || \"http://delicious.com/tag/\";\n  return body.replace(/((ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?)/gi,function(a) {\n    return '<a target=\"_blank\" href=\"'+a+'\">'+a+'</a>';\n  }).replace(/\\@([\\w\\-]+)/g,function(user,name) {\n    return '<a href=\"'+person_prefix+encodeURIComponent(name)+'\">'+user+'</a>';\n  }).replace(/\\#([\\w\\-\\.]+)/g,function(word,tag) {\n    return '<a href=\"'+tag_prefix+encodeURIComponent(tag)+'\">'+word+'</a>';\n  });\n};","list":"// Helpers for writing server-side _list functions in CouchDB\nexports.withRows = function(fun) {\n var f = function() {\n    var row = getRow();\n    return row && fun(row);\n  };\n  f.iterator = true;\n  return f;\n}\n\nexports.send = function(chunk) {\n  send(chunk + \"\\n\")\n}","cache":"exports.get = function(db, docid, setFun, getFun) {\n  db.openDoc(docid, {\n    success : function(doc) {\n      getFun(doc.cache);\n    },\n    error : function() {\n      setFun(function(cache) {\n        db.saveDoc({\n          _id : docid,\n          cache : cache\n        });\n        getFun(cache);\n      });\n    }\n  });\n};\n\nexports.clear = function(db, docid) {\n  db.openDoc(docid, {\n    success : function(doc) {\n      db.removeDoc(doc);\n    },\n    error : function() {}\n  });\n};","code":"exports.ddoc = function(ddoc) {\n  // only return the parts of the app that we use\n  var i, j, path, key, obj, ref, out = {},\n    resources = ddoc.couchapp && ddoc.couchapp.load && ddoc.couchapp.load.app || [];\n  for (i=0; i < resources.length; i++) {\n    path = resources[i].split('/');\n    obj = ddoc;\n    ref = out;\n    for (j=0; j < path.length; j++) {\n      key = path[j];\n      ref[key] = ref[key] || {};\n      if (j < path.length - 1) {\n        obj = obj[key];\n        ref = ref[key];\n      }\n    };\n    ref[key] = obj[key];\n  };\n  return out;\n};","validate":"// a library for validations\n// over time we expect to extract more helpers and move them here.\nexports.init = function(newDoc, oldDoc, userCtx, secObj) {\n  var v = {};\n  \n  v.forbidden = function(message) {    \n    throw({forbidden : message});\n  };\n\n  v.unauthorized = function(message) {\n    throw({unauthorized : message});\n  };\n\n  v.assert = function(should, message) {\n    if (!should) v.forbidden(message);\n  }\n  \n  v.isAdmin = function() {\n    return userCtx.roles.indexOf('_admin') != -1\n  };\n  \n  v.isRole = function(role) {\n    return userCtx.roles.indexOf(role) != -1\n  };\n\n  v.require = function() {\n    for (var i=0; i < arguments.length; i++) {\n      var field = arguments[i];\n      message = \"The '\"+field+\"' field is required.\";\n      if (typeof newDoc[field] == \"undefined\") v.forbidden(message);\n    };\n  };\n\n  v.unchanged = function(field) {\n    if (oldDoc && oldDoc[field] != newDoc[field]) \n      v.forbidden(\"You may not change the '\"+field+\"' field.\");\n  };\n\n  v.matches = function(field, regex, message) {\n    if (!newDoc[field].match(regex)) {\n      message = message || \"Format of '\"+field+\"' field is invalid.\";\n      v.forbidden(message);    \n    }\n  };\n\n  // this ensures that the date will be UTC, parseable, and collate correctly\n  v.dateFormat = function(field) {\n    message = \"Sorry, '\"+field+\"' is not a valid date format. Try: 2010-02-24T17:00:03.432Z\";\n    v.matches(field, /\\d{4}\\-\\d{2}\\-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d*)?Z/, message);\n  }\n  \n  return v;\n};","markdown":"//\n// showdown.js -- A javascript port of Markdown.\n//\n// Copyright (c) 2007 John Fraser.\n//\n// Original Markdown Copyright (c) 2004-2005 John Gruber\n//   <http://daringfireball.net/projects/markdown/>\n//\n// Redistributable under a BSD-style open source license.\n// See license.txt for more information.\n//\n// The full source distribution is at:\n//\n//\t\t\t\tA A L\n//\t\t\t\tT C A\n//\t\t\t\tT K B\n//\n//   <http://www.attacklab.net/>\n//\n\n//\n// Wherever possible, Showdown is a straight, line-by-line port\n// of the Perl version of Markdown.\n//\n// This is not a normal parser design; it's basically just a\n// series of string substitutions.  It's hard to read and\n// maintain this way,  but keeping Showdown close to the original\n// design makes it easier to port new features.\n//\n// More importantly, Showdown behaves like markdown.pl in most\n// edge cases.  So web applications can do client-side preview\n// in Javascript, and then build identical HTML on the server.\n//\n// This port needs the new RegExp functionality of ECMA 262,\n// 3rd Edition (i.e. Javascript 1.5).  Most modern web browsers\n// should do fine.  Even with the new regular expression features,\n// We do a lot of work to emulate Perl's regex functionality.\n// The tricky changes in this file mostly have the \"attacklab:\"\n// label.  Major or self-explanatory changes don't.\n//\n// Smart diff tools like Araxis Merge will be able to match up\n// this file with markdown.pl in a useful way.  A little tweaking\n// helps: in a copy of markdown.pl, replace \"#\" with \"//\" and\n// replace \"$text\" with \"text\".  Be sure to ignore whitespace\n// and line endings.\n//\n\n\n//\n// Showdown usage:\n//\n//   var text = \"Markdown *rocks*.\";\n//\n//   var markdown = require(\"markdown\");\n//   var html = markdown.encode(text);\n//\n//   print(html);\n//\n// Note: move the sample code to the bottom of this\n// file before uncommenting it.\n//\n\n\n//\n// Globals:\n//\n\n// Global hashes, used by various utility routines\nvar g_urls;\nvar g_titles;\nvar g_html_blocks;\n\n// Used to track when we're inside an ordered or unordered list\n// (see _ProcessListItems() for details):\nvar g_list_level = 0;\n\n\nexports.makeHtml = function(text) {\n//\n// Main function. The order in which other subs are called here is\n// essential. Link and image substitutions need to happen before\n// _EscapeSpecialCharsWithinTagAttributes(), so that any *'s or _'s in the <a>\n// and <img> tags get encoded.\n//\n\n\t// Clear the global hashes. If we don't clear these, you get conflicts\n\t// from other articles when generating a page which contains more than\n\t// one article (e.g. an index page that shows the N most recent\n\t// articles):\n\tg_urls = new Array();\n\tg_titles = new Array();\n\tg_html_blocks = new Array();\n\n\t// attacklab: Replace ~ with ~T\n\t// This lets us use tilde as an escape char to avoid md5 hashes\n\t// The choice of character is arbitray; anything that isn't\n    // magic in Markdown will work.\n\ttext = text.replace(/~/g,\"~T\");\n\n\t// attacklab: Replace $ with ~D\n\t// RegExp interprets $ as a special character\n\t// when it's in a replacement string\n\ttext = text.replace(/\\$/g,\"~D\");\n\n\t// Standardize line endings\n\ttext = text.replace(/\\r\\n/g,\"\\n\"); // DOS to Unix\n\ttext = text.replace(/\\r/g,\"\\n\"); // Mac to Unix\n\n\t// Make sure text begins and ends with a couple of newlines:\n\ttext = \"\\n\\n\" + text + \"\\n\\n\";\n\n\t// Convert all tabs to spaces.\n\ttext = _Detab(text);\n\n\t// Strip any lines consisting only of spaces and tabs.\n\t// This makes subsequent regexen easier to write, because we can\n\t// match consecutive blank lines with /\\n+/ instead of something\n\t// contorted like /[ \\t]*\\n+/ .\n\ttext = text.replace(/^[ \\t]+$/mg,\"\");\n\n\t// Turn block-level HTML blocks into hash entries\n\ttext = _HashHTMLBlocks(text);\n\n\t// Strip link definitions, store in hashes.\n\ttext = _StripLinkDefinitions(text);\n\n\ttext = _RunBlockGamut(text);\n\n\ttext = _UnescapeSpecialChars(text);\n\n\t// attacklab: Restore dollar signs\n\ttext = text.replace(/~D/g,\"$$\");\n\n\t// attacklab: Restore tildes\n\ttext = text.replace(/~T/g,\"~\");\n\treturn text;\n}\n\n\nvar _StripLinkDefinitions = function(text) {\n//\n// Strips link definitions from text, stores the URLs and titles in\n// hash references.\n//\n\n\t// Link defs are in the form: ^[id]: url \"optional title\"\n\n\t/*\n\t\tvar text = text.replace(/\n\t\t\t\t^[ ]{0,3}\\[(.+)\\]:  // id = $1  attacklab: g_tab_width - 1\n\t\t\t\t  [ \\t]*\n\t\t\t\t  \\n?\t\t\t\t// maybe *one* newline\n\t\t\t\t  [ \\t]*\n\t\t\t\t<?(\\S+?)>?\t\t\t// url = $2\n\t\t\t\t  [ \\t]*\n\t\t\t\t  \\n?\t\t\t\t// maybe one newline\n\t\t\t\t  [ \\t]*\n\t\t\t\t(?:\n\t\t\t\t  (\\n*)\t\t\t\t// any lines skipped = $3 attacklab: lookbehind removed\n\t\t\t\t  [\"(]\n\t\t\t\t  (.+?)\t\t\t\t// title = $4\n\t\t\t\t  [\")]\n\t\t\t\t  [ \\t]*\n\t\t\t\t)?\t\t\t\t\t// title is optional\n\t\t\t\t(?:\\n+|$)\n\t\t\t  /gm,\n\t\t\t  function(){...});\n\t*/\n\tvar text = text.replace(/^[ ]{0,3}\\[(.+)\\]:[ \\t]*\\n?[ \\t]*<?(\\S+?)>?[ \\t]*\\n?[ \\t]*(?:(\\n*)[\"(](.+?)[\")][ \\t]*)?(?:\\n+|\\Z)/gm,\n\t\tfunction (wholeMatch,m1,m2,m3,m4) {\n\t\t\tm1 = m1.toLowerCase();\n\t\t\tg_urls[m1] = _EncodeAmpsAndAngles(m2);  // Link IDs are case-insensitive\n\t\t\tif (m3) {\n\t\t\t\t// Oops, found blank lines, so it's not a title.\n\t\t\t\t// Put back the parenthetical statement we stole.\n\t\t\t\treturn m3+m4;\n\t\t\t} else if (m4) {\n\t\t\t\tg_titles[m1] = m4.replace(/\"/g,\"&quot;\");\n\t\t\t}\n\t\t\t\n\t\t\t// Completely remove the definition from the text\n\t\t\treturn \"\";\n\t\t}\n\t);\n\n\treturn text;\n}\n\n\nvar _HashHTMLBlocks = function(text) {\n\t// attacklab: Double up blank lines to reduce lookaround\n\ttext = text.replace(/\\n/g,\"\\n\\n\");\n\n\t// Hashify HTML blocks:\n\t// We only want to do this for block-level HTML tags, such as headers,\n\t// lists, and tables. That's because we still want to wrap <p>s around\n\t// \"paragraphs\" that are wrapped in non-block-level tags, such as anchors,\n\t// phrase emphasis, and spans. The list of tags we're looking for is\n\t// hard-coded:\n\tvar block_tags_a = \"p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del\"\n\tvar block_tags_b = \"p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math\"\n\n\t// First, look for nested blocks, e.g.:\n\t//   <div>\n\t//     <div>\n\t//     tags for inner block must be indented.\n\t//     </div>\n\t//   </div>\n\t//\n\t// The outermost tags must start at the left margin for this to match, and\n\t// the inner nested divs must be indented.\n\t// We need to do this before the next, more liberal match, because the next\n\t// match will start at the first `<div>` and stop at the first `</div>`.\n\n\t// attacklab: This regex can be expensive when it fails.\n\t/*\n\t\tvar text = text.replace(/\n\t\t(\t\t\t\t\t\t// save in $1\n\t\t\t^\t\t\t\t\t// start of line  (with /m)\n\t\t\t<($block_tags_a)\t// start tag = $2\n\t\t\t\\b\t\t\t\t\t// word break\n\t\t\t\t\t\t\t\t// attacklab: hack around khtml/pcre bug...\n\t\t\t[^\\r]*?\\n\t\t\t// any number of lines, minimally matching\n\t\t\t</\\2>\t\t\t\t// the matching end tag\n\t\t\t[ \\t]*\t\t\t\t// trailing spaces/tabs\n\t\t\t(?=\\n+)\t\t\t\t// followed by a newline\n\t\t)\t\t\t\t\t\t// attacklab: there are sentinel newlines at end of document\n\t\t/gm,function(){...}};\n\t*/\n\ttext = text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\\b[^\\r]*?\\n<\\/\\2>[ \\t]*(?=\\n+))/gm,hashElement);\n\n\t//\n\t// Now match more liberally, simply from `\\n<tag>` to `</tag>\\n`\n\t//\n\n\t/*\n\t\tvar text = text.replace(/\n\t\t(\t\t\t\t\t\t// save in $1\n\t\t\t^\t\t\t\t\t// start of line  (with /m)\n\t\t\t<($block_tags_b)\t// start tag = $2\n\t\t\t\\b\t\t\t\t\t// word break\n\t\t\t\t\t\t\t\t// attacklab: hack around khtml/pcre bug...\n\t\t\t[^\\r]*?\t\t\t\t// any number of lines, minimally matching\n\t\t\t.*</\\2>\t\t\t\t// the matching end tag\n\t\t\t[ \\t]*\t\t\t\t// trailing spaces/tabs\n\t\t\t(?=\\n+)\t\t\t\t// followed by a newline\n\t\t)\t\t\t\t\t\t// attacklab: there are sentinel newlines at end of document\n\t\t/gm,function(){...}};\n\t*/\n\ttext = text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\\b[^\\r]*?.*<\\/\\2>[ \\t]*(?=\\n+)\\n)/gm,hashElement);\n\n\t// Special case just for <hr />. It was easier to make a special case than\n\t// to make the other regex more complicated.  \n\n\t/*\n\t\ttext = text.replace(/\n\t\t(\t\t\t\t\t\t// save in $1\n\t\t\t\\n\\n\t\t\t\t// Starting after a blank line\n\t\t\t[ ]{0,3}\n\t\t\t(<(hr)\t\t\t\t// start tag = $2\n\t\t\t\\b\t\t\t\t\t// word break\n\t\t\t([^<>])*?\t\t\t// \n\t\t\t\\/?>)\t\t\t\t// the matching end tag\n\t\t\t[ \\t]*\n\t\t\t(?=\\n{2,})\t\t\t// followed by a blank line\n\t\t)\n\t\t/g,hashElement);\n\t*/\n\ttext = text.replace(/(\\n[ ]{0,3}(<(hr)\\b([^<>])*?\\/?>)[ \\t]*(?=\\n{2,}))/g,hashElement);\n\n\t// Special case for standalone HTML comments:\n\n\t/*\n\t\ttext = text.replace(/\n\t\t(\t\t\t\t\t\t// save in $1\n\t\t\t\\n\\n\t\t\t\t// Starting after a blank line\n\t\t\t[ ]{0,3}\t\t\t// attacklab: g_tab_width - 1\n\t\t\t<!\n\t\t\t(--[^\\r]*?--\\s*)+\n\t\t\t>\n\t\t\t[ \\t]*\n\t\t\t(?=\\n{2,})\t\t\t// followed by a blank line\n\t\t)\n\t\t/g,hashElement);\n\t*/\n\ttext = text.replace(/(\\n\\n[ ]{0,3}<!(--[^\\r]*?--\\s*)+>[ \\t]*(?=\\n{2,}))/g,hashElement);\n\n\t// PHP and ASP-style processor instructions (<?...?> and <%...%>)\n\n\t/*\n\t\ttext = text.replace(/\n\t\t(?:\n\t\t\t\\n\\n\t\t\t\t// Starting after a blank line\n\t\t)\n\t\t(\t\t\t\t\t\t// save in $1\n\t\t\t[ ]{0,3}\t\t\t// attacklab: g_tab_width - 1\n\t\t\t(?:\n\t\t\t\t<([?%])\t\t\t// $2\n\t\t\t\t[^\\r]*?\n\t\t\t\t\\2>\n\t\t\t)\n\t\t\t[ \\t]*\n\t\t\t(?=\\n{2,})\t\t\t// followed by a blank line\n\t\t)\n\t\t/g,hashElement);\n\t*/\n\ttext = text.replace(/(?:\\n\\n)([ ]{0,3}(?:<([?%])[^\\r]*?\\2>)[ \\t]*(?=\\n{2,}))/g,hashElement);\n\n\t// attacklab: Undo double lines (see comment at top of this function)\n\ttext = text.replace(/\\n\\n/g,\"\\n\");\n\treturn text;\n}\n\nvar hashElement = function(wholeMatch,m1) {\n\tvar blockText = m1;\n\n\t// Undo double lines\n\tblockText = blockText.replace(/\\n\\n/g,\"\\n\");\n\tblockText = blockText.replace(/^\\n/,\"\");\n\t\n\t// strip trailing blank lines\n\tblockText = blockText.replace(/\\n+$/g,\"\");\n\t\n\t// Replace the element text with a marker (\"~KxK\" where x is its key)\n\tblockText = \"\\n\\n~K\" + (g_html_blocks.push(blockText)-1) + \"K\\n\\n\";\n\t\n\treturn blockText;\n};\n\nvar _RunBlockGamut = function(text) {\n//\n// These are all the transformations that form block-level\n// tags like paragraphs, headers, and list items.\n//\n\ttext = _DoHeaders(text);\n\n\t// Do Horizontal Rules:\n\tvar key = hashBlock(\"<hr />\");\n\ttext = text.replace(/^[ ]{0,2}([ ]?\\*[ ]?){3,}[ \\t]*$/gm,key);\n\ttext = text.replace(/^[ ]{0,2}([ ]?\\-[ ]?){3,}[ \\t]*$/gm,key);\n\ttext = text.replace(/^[ ]{0,2}([ ]?\\_[ ]?){3,}[ \\t]*$/gm,key);\n\n\ttext = _DoLists(text);\n\ttext = _DoCodeBlocks(text);\n\ttext = _DoBlockQuotes(text);\n\n\t// We already ran _HashHTMLBlocks() before, in Markdown(), but that\n\t// was to escape raw HTML in the original Markdown source. This time,\n\t// we're escaping the markup we've just created, so that we don't wrap\n\t// <p> tags around block-level tags.\n\ttext = _HashHTMLBlocks(text);\n\ttext = _FormParagraphs(text);\n\n\treturn text;\n}\n\n\nvar _RunSpanGamut = function(text) {\n//\n// These are all the transformations that occur *within* block-level\n// tags like paragraphs, headers, and list items.\n//\n\n\ttext = _DoCodeSpans(text);\n\ttext = _EscapeSpecialCharsWithinTagAttributes(text);\n\ttext = _EncodeBackslashEscapes(text);\n\n\t// Process anchor and image tags. Images must come first,\n\t// because ![foo][f] looks like an anchor.\n\ttext = _DoImages(text);\n\ttext = _DoAnchors(text);\n\n\t// Make links out of things like `<http://example.com/>`\n\t// Must come after _DoAnchors(), because you can use < and >\n\t// delimiters in inline links like [this](<url>).\n\ttext = _DoAutoLinks(text);\n\ttext = _EncodeAmpsAndAngles(text);\n\ttext = _DoItalicsAndBold(text);\n\n\t// Do hard breaks:\n\ttext = text.replace(/  +\\n/g,\" <br />\\n\");\n\n\treturn text;\n}\n\nvar _EscapeSpecialCharsWithinTagAttributes = function(text) {\n//\n// Within tags -- meaning between < and > -- encode [\\ ` * _] so they\n// don't conflict with their use in Markdown for code, italics and strong.\n//\n\n\t// Build a regex to find HTML tags and comments.  See Friedl's \n\t// \"Mastering Regular Expressions\", 2nd Ed., pp. 200-201.\n\tvar regex = /(<[a-z\\/!$](\"[^\"]*\"|'[^']*'|[^'\">])*>|<!(--.*?--\\s*)+>)/gi;\n\n\ttext = text.replace(regex, function(wholeMatch) {\n\t\tvar tag = wholeMatch.replace(/(.)<\\/?code>(?=.)/g,\"$1`\");\n\t\ttag = escapeCharacters(tag,\"\\\\`*_\");\n\t\treturn tag;\n\t});\n\n\treturn text;\n}\n\nvar _DoAnchors = function(text) {\n//\n// Turn Markdown link shortcuts into XHTML <a> tags.\n//\n\t//\n\t// First, handle reference-style links: [link text] [id]\n\t//\n\n\t/*\n\t\ttext = text.replace(/\n\t\t(\t\t\t\t\t\t\t// wrap whole match in $1\n\t\t\t\\[\n\t\t\t(\n\t\t\t\t(?:\n\t\t\t\t\t\\[[^\\]]*\\]\t\t// allow brackets nested one level\n\t\t\t\t\t|\n\t\t\t\t\t[^\\[]\t\t\t// or anything else\n\t\t\t\t)*\n\t\t\t)\n\t\t\t\\]\n\n\t\t\t[ ]?\t\t\t\t\t// one optional space\n\t\t\t(?:\\n[ ]*)?\t\t\t\t// one optional newline followed by spaces\n\n\t\t\t\\[\n\t\t\t(.*?)\t\t\t\t\t// id = $3\n\t\t\t\\]\n\t\t)()()()()\t\t\t\t\t// pad remaining backreferences\n\t\t/g,_DoAnchors_callback);\n\t*/\n\ttext = text.replace(/(\\[((?:\\[[^\\]]*\\]|[^\\[\\]])*)\\][ ]?(?:\\n[ ]*)?\\[(.*?)\\])()()()()/g,writeAnchorTag);\n\n\t//\n\t// Next, inline-style links: [link text](url \"optional title\")\n\t//\n\n\t/*\n\t\ttext = text.replace(/\n\t\t\t(\t\t\t\t\t\t// wrap whole match in $1\n\t\t\t\t\\[\n\t\t\t\t(\n\t\t\t\t\t(?:\n\t\t\t\t\t\t\\[[^\\]]*\\]\t// allow brackets nested one level\n\t\t\t\t\t|\n\t\t\t\t\t[^\\[\\]]\t\t\t// or anything else\n\t\t\t\t)\n\t\t\t)\n\t\t\t\\]\n\t\t\t\\(\t\t\t\t\t\t// literal paren\n\t\t\t[ \\t]*\n\t\t\t()\t\t\t\t\t\t// no id, so leave $3 empty\n\t\t\t<?(.*?)>?\t\t\t\t// href = $4\n\t\t\t[ \\t]*\n\t\t\t(\t\t\t\t\t\t// $5\n\t\t\t\t(['\"])\t\t\t\t// quote char = $6\n\t\t\t\t(.*?)\t\t\t\t// Title = $7\n\t\t\t\t\\6\t\t\t\t\t// matching quote\n\t\t\t\t[ \\t]*\t\t\t\t// ignore any spaces/tabs between closing quote and )\n\t\t\t)?\t\t\t\t\t\t// title is optional\n\t\t\t\\)\n\t\t)\n\t\t/g,writeAnchorTag);\n\t*/\n\ttext = text.replace(/(\\[((?:\\[[^\\]]*\\]|[^\\[\\]])*)\\]\\([ \\t]*()<?(.*?)>?[ \\t]*((['\"])(.*?)\\6[ \\t]*)?\\))/g,writeAnchorTag);\n\n\t//\n\t// Last, handle reference-style shortcuts: [link text]\n\t// These must come last in case you've also got [link test][1]\n\t// or [link test](/foo)\n\t//\n\n\t/*\n\t\ttext = text.replace(/\n\t\t(\t\t \t\t\t\t\t// wrap whole match in $1\n\t\t\t\\[\n\t\t\t([^\\[\\]]+)\t\t\t\t// link text = $2; can't contain '[' or ']'\n\t\t\t\\]\n\t\t)()()()()()\t\t\t\t\t// pad rest of backreferences\n\t\t/g, writeAnchorTag);\n\t*/\n\ttext = text.replace(/(\\[([^\\[\\]]+)\\])()()()()()/g, writeAnchorTag);\n\n\treturn text;\n}\n\nvar writeAnchorTag = function(wholeMatch,m1,m2,m3,m4,m5,m6,m7) {\n\tif (m7 == undefined) m7 = \"\";\n\tvar whole_match = m1;\n\tvar link_text   = m2;\n\tvar link_id\t = m3.toLowerCase();\n\tvar url\t\t= m4;\n\tvar title\t= m7;\n\t\n\tif (url == \"\") {\n\t\tif (link_id == \"\") {\n\t\t\t// lower-case and turn embedded newlines into spaces\n\t\t\tlink_id = link_text.toLowerCase().replace(/ ?\\n/g,\" \");\n\t\t}\n\t\turl = \"#\"+link_id;\n\t\t\n\t\tif (g_urls[link_id] != undefined) {\n\t\t\turl = g_urls[link_id];\n\t\t\tif (g_titles[link_id] != undefined) {\n\t\t\t\ttitle = g_titles[link_id];\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (whole_match.search(/\\(\\s*\\)$/m)>-1) {\n\t\t\t\t// Special case for explicit empty url\n\t\t\t\turl = \"\";\n\t\t\t} else {\n\t\t\t\treturn whole_match;\n\t\t\t}\n\t\t}\n\t}\t\n\t\n\turl = escapeCharacters(url,\"*_\");\n\tvar result = \"<a href=\\\"\" + url + \"\\\"\";\n\t\n\tif (title != \"\") {\n\t\ttitle = title.replace(/\"/g,\"&quot;\");\n\t\ttitle = escapeCharacters(title,\"*_\");\n\t\tresult +=  \" title=\\\"\" + title + \"\\\"\";\n\t}\n\t\n\tresult += \">\" + link_text + \"</a>\";\n\t\n\treturn result;\n}\n\n\nvar _DoImages = function(text) {\n//\n// Turn Markdown image shortcuts into <img> tags.\n//\n\n\t//\n\t// First, handle reference-style labeled images: ![alt text][id]\n\t//\n\n\t/*\n\t\ttext = text.replace(/\n\t\t(\t\t\t\t\t\t// wrap whole match in $1\n\t\t\t!\\[\n\t\t\t(.*?)\t\t\t\t// alt text = $2\n\t\t\t\\]\n\n\t\t\t[ ]?\t\t\t\t// one optional space\n\t\t\t(?:\\n[ ]*)?\t\t\t// one optional newline followed by spaces\n\n\t\t\t\\[\n\t\t\t(.*?)\t\t\t\t// id = $3\n\t\t\t\\]\n\t\t)()()()()\t\t\t\t// pad rest of backreferences\n\t\t/g,writeImageTag);\n\t*/\n\ttext = text.replace(/(!\\[(.*?)\\][ ]?(?:\\n[ ]*)?\\[(.*?)\\])()()()()/g,writeImageTag);\n\n\t//\n\t// Next, handle inline images:  ![alt text](url \"optional title\")\n\t// Don't forget: encode * and _\n\n\t/*\n\t\ttext = text.replace(/\n\t\t(\t\t\t\t\t\t// wrap whole match in $1\n\t\t\t!\\[\n\t\t\t(.*?)\t\t\t\t// alt text = $2\n\t\t\t\\]\n\t\t\t\\s?\t\t\t\t\t// One optional whitespace character\n\t\t\t\\(\t\t\t\t\t// literal paren\n\t\t\t[ \\t]*\n\t\t\t()\t\t\t\t\t// no id, so leave $3 empty\n\t\t\t<?(\\S+?)>?\t\t\t// src url = $4\n\t\t\t[ \\t]*\n\t\t\t(\t\t\t\t\t// $5\n\t\t\t\t(['\"])\t\t\t// quote char = $6\n\t\t\t\t(.*?)\t\t\t// title = $7\n\t\t\t\t\\6\t\t\t\t// matching quote\n\t\t\t\t[ \\t]*\n\t\t\t)?\t\t\t\t\t// title is optional\n\t\t\\)\n\t\t)\n\t\t/g,writeImageTag);\n\t*/\n\ttext = text.replace(/(!\\[(.*?)\\]\\s?\\([ \\t]*()<?(\\S+?)>?[ \\t]*((['\"])(.*?)\\6[ \\t]*)?\\))/g,writeImageTag);\n\n\treturn text;\n}\n\nvar writeImageTag = function(wholeMatch,m1,m2,m3,m4,m5,m6,m7) {\n\tvar whole_match = m1;\n\tvar alt_text   = m2;\n\tvar link_id\t = m3.toLowerCase();\n\tvar url\t\t= m4;\n\tvar title\t= m7;\n\n\tif (!title) title = \"\";\n\t\n\tif (url == \"\") {\n\t\tif (link_id == \"\") {\n\t\t\t// lower-case and turn embedded newlines into spaces\n\t\t\tlink_id = alt_text.toLowerCase().replace(/ ?\\n/g,\" \");\n\t\t}\n\t\turl = \"#\"+link_id;\n\t\t\n\t\tif (g_urls[link_id] != undefined) {\n\t\t\turl = g_urls[link_id];\n\t\t\tif (g_titles[link_id] != undefined) {\n\t\t\t\ttitle = g_titles[link_id];\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\treturn whole_match;\n\t\t}\n\t}\t\n\t\n\talt_text = alt_text.replace(/\"/g,\"&quot;\");\n\turl = escapeCharacters(url,\"*_\");\n\tvar result = \"<img src=\\\"\" + url + \"\\\" alt=\\\"\" + alt_text + \"\\\"\";\n\n\t// attacklab: Markdown.pl adds empty title attributes to images.\n\t// Replicate this bug.\n\n\t//if (title != \"\") {\n\t\ttitle = title.replace(/\"/g,\"&quot;\");\n\t\ttitle = escapeCharacters(title,\"*_\");\n\t\tresult +=  \" title=\\\"\" + title + \"\\\"\";\n\t//}\n\t\n\tresult += \" />\";\n\t\n\treturn result;\n}\n\n\nvar _DoHeaders = function(text) {\n\n\t// Setext-style headers:\n\t//\tHeader 1\n\t//\t========\n\t//  \n\t//\tHeader 2\n\t//\t--------\n\t//\n\ttext = text.replace(/^(.+)[ \\t]*\\n=+[ \\t]*\\n+/gm,\n\t\tfunction(wholeMatch,m1){return hashBlock(\"<h1>\" + _RunSpanGamut(m1) + \"</h1>\");});\n\n\ttext = text.replace(/^(.+)[ \\t]*\\n-+[ \\t]*\\n+/gm,\n\t\tfunction(matchFound,m1){return hashBlock(\"<h2>\" + _RunSpanGamut(m1) + \"</h2>\");});\n\n\t// atx-style headers:\n\t//  # Header 1\n\t//  ## Header 2\n\t//  ## Header 2 with closing hashes ##\n\t//  ...\n\t//  ###### Header 6\n\t//\n\n\t/*\n\t\ttext = text.replace(/\n\t\t\t^(\\#{1,6})\t\t\t\t// $1 = string of #'s\n\t\t\t[ \\t]*\n\t\t\t(.+?)\t\t\t\t\t// $2 = Header text\n\t\t\t[ \\t]*\n\t\t\t\\#*\t\t\t\t\t\t// optional closing #'s (not counted)\n\t\t\t\\n+\n\t\t/gm, function() {...});\n\t*/\n\n\ttext = text.replace(/^(\\#{1,6})[ \\t]*(.+?)[ \\t]*\\#*\\n+/gm,\n\t\tfunction(wholeMatch,m1,m2) {\n\t\t\tvar h_level = m1.length;\n\t\t\treturn hashBlock(\"<h\" + h_level + \">\" + _RunSpanGamut(m2) + \"</h\" + h_level + \">\");\n\t\t});\n\n\treturn text;\n}\n\n// This declaration keeps Dojo compressor from outputting garbage:\nvar _ProcessListItems;\n\nvar _DoLists = function(text) {\n//\n// Form HTML ordered (numbered) and unordered (bulleted) lists.\n//\n\n\t// attacklab: add sentinel to hack around khtml/safari bug:\n\t// http://bugs.webkit.org/show_bug.cgi?id=11231\n\ttext += \"~0\";\n\n\t// Re-usable pattern to match any entirel ul or ol list:\n\n\t/*\n\t\tvar whole_list = /\n\t\t(\t\t\t\t\t\t\t\t\t// $1 = whole list\n\t\t\t(\t\t\t\t\t\t\t\t// $2\n\t\t\t\t[ ]{0,3}\t\t\t\t\t// attacklab: g_tab_width - 1\n\t\t\t\t([*+-]|\\d+[.])\t\t\t\t// $3 = first list item marker\n\t\t\t\t[ \\t]+\n\t\t\t)\n\t\t\t[^\\r]+?\n\t\t\t(\t\t\t\t\t\t\t\t// $4\n\t\t\t\t~0\t\t\t\t\t\t\t// sentinel for workaround; should be $\n\t\t\t|\n\t\t\t\t\\n{2,}\n\t\t\t\t(?=\\S)\n\t\t\t\t(?!\t\t\t\t\t\t\t// Negative lookahead for another list item marker\n\t\t\t\t\t[ \\t]*\n\t\t\t\t\t(?:[*+-]|\\d+[.])[ \\t]+\n\t\t\t\t)\n\t\t\t)\n\t\t)/g\n\t*/\n\tvar whole_list = /^(([ ]{0,3}([*+-]|\\d+[.])[ \\t]+)[^\\r]+?(~0|\\n{2,}(?=\\S)(?![ \\t]*(?:[*+-]|\\d+[.])[ \\t]+)))/gm;\n\n\tif (g_list_level) {\n\t\ttext = text.replace(whole_list,function(wholeMatch,m1,m2) {\n\t\t\tvar list = m1;\n\t\t\tvar list_type = (m2.search(/[*+-]/g)>-1) ? \"ul\" : \"ol\";\n\n\t\t\t// Turn double returns into triple returns, so that we can make a\n\t\t\t// paragraph for the last item in a list, if necessary:\n\t\t\tlist = list.replace(/\\n{2,}/g,\"\\n\\n\\n\");;\n\t\t\tvar result = _ProcessListItems(list);\n\t\n\t\t\t// Trim any trailing whitespace, to put the closing `</$list_type>`\n\t\t\t// up on the preceding line, to get it past the current stupid\n\t\t\t// HTML block parser. This is a hack to work around the terrible\n\t\t\t// hack that is the HTML block parser.\n\t\t\tresult = result.replace(/\\s+$/,\"\");\n\t\t\tresult = \"<\"+list_type+\">\" + result + \"</\"+list_type+\">\\n\";\n\t\t\treturn result;\n\t\t});\n\t} else {\n\t\twhole_list = /(\\n\\n|^\\n?)(([ ]{0,3}([*+-]|\\d+[.])[ \\t]+)[^\\r]+?(~0|\\n{2,}(?=\\S)(?![ \\t]*(?:[*+-]|\\d+[.])[ \\t]+)))/g;\n\t\ttext = text.replace(whole_list,function(wholeMatch,m1,m2,m3) {\n\t\t\tvar runup = m1;\n\t\t\tvar list = m2;\n\n\t\t\tvar list_type = (m3.search(/[*+-]/g)>-1) ? \"ul\" : \"ol\";\n\t\t\t// Turn double returns into triple returns, so that we can make a\n\t\t\t// paragraph for the last item in a list, if necessary:\n\t\t\tvar list = list.replace(/\\n{2,}/g,\"\\n\\n\\n\");;\n\t\t\tvar result = _ProcessListItems(list);\n\t\t\tresult = runup + \"<\"+list_type+\">\\n\" + result + \"</\"+list_type+\">\\n\";\t\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t// attacklab: strip sentinel\n\ttext = text.replace(/~0/,\"\");\n\n\treturn text;\n}\n\n_ProcessListItems = function(list_str) {\n//\n//  Process the contents of a single ordered or unordered list, splitting it\n//  into individual list items.\n//\n\t// The $g_list_level global keeps track of when we're inside a list.\n\t// Each time we enter a list, we increment it; when we leave a list,\n\t// we decrement. If it's zero, we're not in a list anymore.\n\t//\n\t// We do this because when we're not inside a list, we want to treat\n\t// something like this:\n\t//\n\t//    I recommend upgrading to version\n\t//    8. Oops, now this line is treated\n\t//    as a sub-list.\n\t//\n\t// As a single paragraph, despite the fact that the second line starts\n\t// with a digit-period-space sequence.\n\t//\n\t// Whereas when we're inside a list (or sub-list), that line will be\n\t// treated as the start of a sub-list. What a kludge, huh? This is\n\t// an aspect of Markdown's syntax that's hard to parse perfectly\n\t// without resorting to mind-reading. Perhaps the solution is to\n\t// change the syntax rules such that sub-lists must start with a\n\t// starting cardinal number; e.g. \"1.\" or \"a.\".\n\n\tg_list_level++;\n\n\t// trim trailing blank lines:\n\tlist_str = list_str.replace(/\\n{2,}$/,\"\\n\");\n\n\t// attacklab: add sentinel to emulate \\z\n\tlist_str += \"~0\";\n\n\t/*\n\t\tlist_str = list_str.replace(/\n\t\t\t(\\n)?\t\t\t\t\t\t\t// leading line = $1\n\t\t\t(^[ \\t]*)\t\t\t\t\t\t// leading whitespace = $2\n\t\t\t([*+-]|\\d+[.]) [ \\t]+\t\t\t// list marker = $3\n\t\t\t([^\\r]+?\t\t\t\t\t\t// list item text   = $4\n\t\t\t(\\n{1,2}))\n\t\t\t(?= \\n* (~0 | \\2 ([*+-]|\\d+[.]) [ \\t]+))\n\t\t/gm, function(){...});\n\t*/\n\tlist_str = list_str.replace(/(\\n)?(^[ \\t]*)([*+-]|\\d+[.])[ \\t]+([^\\r]+?(\\n{1,2}))(?=\\n*(~0|\\2([*+-]|\\d+[.])[ \\t]+))/gm,\n\t\tfunction(wholeMatch,m1,m2,m3,m4){\n\t\t\tvar item = m4;\n\t\t\tvar leading_line = m1;\n\t\t\tvar leading_space = m2;\n\n\t\t\tif (leading_line || (item.search(/\\n{2,}/)>-1)) {\n\t\t\t\titem = _RunBlockGamut(_Outdent(item));\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Recursion for sub-lists:\n\t\t\t\titem = _DoLists(_Outdent(item));\n\t\t\t\titem = item.replace(/\\n$/,\"\"); // chomp(item)\n\t\t\t\titem = _RunSpanGamut(item);\n\t\t\t}\n\n\t\t\treturn  \"<li>\" + item + \"</li>\\n\";\n\t\t}\n\t);\n\n\t// attacklab: strip sentinel\n\tlist_str = list_str.replace(/~0/g,\"\");\n\n\tg_list_level--;\n\treturn list_str;\n}\n\n\nvar _DoCodeBlocks = function(text) {\n//\n//  Process Markdown `<pre><code>` blocks.\n//  \n\n\t/*\n\t\ttext = text.replace(text,\n\t\t\t/(?:\\n\\n|^)\n\t\t\t(\t\t\t\t\t\t\t\t// $1 = the code block -- one or more lines, starting with a space/tab\n\t\t\t\t(?:\n\t\t\t\t\t(?:[ ]{4}|\\t)\t\t\t// Lines must start with a tab or a tab-width of spaces - attacklab: g_tab_width\n\t\t\t\t\t.*\\n+\n\t\t\t\t)+\n\t\t\t)\n\t\t\t(\\n*[ ]{0,3}[^ \\t\\n]|(?=~0))\t// attacklab: g_tab_width\n\t\t/g,function(){...});\n\t*/\n\n\t// attacklab: sentinel workarounds for lack of \\A and \\Z, safari\\khtml bug\n\ttext += \"~0\";\n\t\n\ttext = text.replace(/(?:\\n\\n|^)((?:(?:[ ]{4}|\\t).*\\n+)+)(\\n*[ ]{0,3}[^ \\t\\n]|(?=~0))/g,\n\t\tfunction(wholeMatch,m1,m2) {\n\t\t\tvar codeblock = m1;\n\t\t\tvar nextChar = m2;\n\t\t\n\t\t\tcodeblock = _EncodeCode( _Outdent(codeblock));\n\t\t\tcodeblock = _Detab(codeblock);\n\t\t\tcodeblock = codeblock.replace(/^\\n+/g,\"\"); // trim leading newlines\n\t\t\tcodeblock = codeblock.replace(/\\n+$/g,\"\"); // trim trailing whitespace\n\n\t\t\tcodeblock = \"<pre><code>\" + codeblock + \"\\n</code></pre>\";\n\n\t\t\treturn hashBlock(codeblock) + nextChar;\n\t\t}\n\t);\n\n\t// attacklab: strip sentinel\n\ttext = text.replace(/~0/,\"\");\n\n\treturn text;\n}\n\nvar hashBlock = function(text) {\n\ttext = text.replace(/(^\\n+|\\n+$)/g,\"\");\n\treturn \"\\n\\n~K\" + (g_html_blocks.push(text)-1) + \"K\\n\\n\";\n}\n\n\nvar _DoCodeSpans = function(text) {\n//\n//   *  Backtick quotes are used for <code></code> spans.\n// \n//   *  You can use multiple backticks as the delimiters if you want to\n//\t include literal backticks in the code span. So, this input:\n//\t \n//\t\t Just type ``foo `bar` baz`` at the prompt.\n//\t \n//\t   Will translate to:\n//\t \n//\t\t <p>Just type <code>foo `bar` baz</code> at the prompt.</p>\n//\t \n//\tThere's no arbitrary limit to the number of backticks you\n//\tcan use as delimters. If you need three consecutive backticks\n//\tin your code, use four for delimiters, etc.\n//\n//  *  You can use spaces to get literal backticks at the edges:\n//\t \n//\t\t ... type `` `bar` `` ...\n//\t \n//\t   Turns to:\n//\t \n//\t\t ... type <code>`bar`</code> ...\n//\n\n\t/*\n\t\ttext = text.replace(/\n\t\t\t(^|[^\\\\])\t\t\t\t\t// Character before opening ` can't be a backslash\n\t\t\t(`+)\t\t\t\t\t\t// $2 = Opening run of `\n\t\t\t(\t\t\t\t\t\t\t// $3 = The code block\n\t\t\t\t[^\\r]*?\n\t\t\t\t[^`]\t\t\t\t\t// attacklab: work around lack of lookbehind\n\t\t\t)\n\t\t\t\\2\t\t\t\t\t\t\t// Matching closer\n\t\t\t(?!`)\n\t\t/gm, function(){...});\n\t*/\n\n\ttext = text.replace(/(^|[^\\\\])(`+)([^\\r]*?[^`])\\2(?!`)/gm,\n\t\tfunction(wholeMatch,m1,m2,m3,m4) {\n\t\t\tvar c = m3;\n\t\t\tc = c.replace(/^([ \\t]*)/g,\"\");\t// leading whitespace\n\t\t\tc = c.replace(/[ \\t]*$/g,\"\");\t// trailing whitespace\n\t\t\tc = _EncodeCode(c);\n\t\t\treturn m1+\"<code>\"+c+\"</code>\";\n\t\t});\n\n\treturn text;\n}\n\n\nvar _EncodeCode = function(text) {\n//\n// Encode/escape certain characters inside Markdown code runs.\n// The point is that in code, these characters are literals,\n// and lose their special Markdown meanings.\n//\n\t// Encode all ampersands; HTML entities are not\n\t// entities within a Markdown code span.\n\ttext = text.replace(/&/g,\"&amp;\");\n\n\t// Do the angle bracket song and dance:\n\ttext = text.replace(/</g,\"&lt;\");\n\ttext = text.replace(/>/g,\"&gt;\");\n\n\t// Now, escape characters that are magic in Markdown:\n\ttext = escapeCharacters(text,\"\\*_{}[]\\\\\",false);\n\n// jj the line above breaks this:\n//---\n\n//* Item\n\n//   1. Subitem\n\n//            special char: *\n//---\n\n\treturn text;\n}\n\n\nvar _DoItalicsAndBold = function(text) {\n\n\t// <strong> must go first:\n\ttext = text.replace(/(\\*\\*|__)(?=\\S)([^\\r]*?\\S[*_]*)\\1/g,\n\t\t\"<strong>$2</strong>\");\n\n\ttext = text.replace(/(\\*|_)(?=\\S)([^\\r]*?\\S)\\1/g,\n\t\t\"<em>$2</em>\");\n\n\treturn text;\n}\n\n\nvar _DoBlockQuotes = function(text) {\n\n\t/*\n\t\ttext = text.replace(/\n\t\t(\t\t\t\t\t\t\t\t// Wrap whole match in $1\n\t\t\t(\n\t\t\t\t^[ \\t]*>[ \\t]?\t\t\t// '>' at the start of a line\n\t\t\t\t.+\\n\t\t\t\t\t// rest of the first line\n\t\t\t\t(.+\\n)*\t\t\t\t\t// subsequent consecutive lines\n\t\t\t\t\\n*\t\t\t\t\t\t// blanks\n\t\t\t)+\n\t\t)\n\t\t/gm, function(){...});\n\t*/\n\n\ttext = text.replace(/((^[ \\t]*>[ \\t]?.+\\n(.+\\n)*\\n*)+)/gm,\n\t\tfunction(wholeMatch,m1) {\n\t\t\tvar bq = m1;\n\n\t\t\t// attacklab: hack around Konqueror 3.5.4 bug:\n\t\t\t// \"----------bug\".replace(/^-/g,\"\") == \"bug\"\n\n\t\t\tbq = bq.replace(/^[ \\t]*>[ \\t]?/gm,\"~0\");\t// trim one level of quoting\n\n\t\t\t// attacklab: clean up hack\n\t\t\tbq = bq.replace(/~0/g,\"\");\n\n\t\t\tbq = bq.replace(/^[ \\t]+$/gm,\"\");\t\t// trim whitespace-only lines\n\t\t\tbq = _RunBlockGamut(bq);\t\t\t\t// recurse\n\t\t\t\n\t\t\tbq = bq.replace(/(^|\\n)/g,\"$1  \");\n\t\t\t// These leading spaces screw with <pre> content, so we need to fix that:\n\t\t\tbq = bq.replace(\n\t\t\t\t\t/(\\s*<pre>[^\\r]+?<\\/pre>)/gm,\n\t\t\t\tfunction(wholeMatch,m1) {\n\t\t\t\t\tvar pre = m1;\n\t\t\t\t\t// attacklab: hack around Konqueror 3.5.4 bug:\n\t\t\t\t\tpre = pre.replace(/^  /mg,\"~0\");\n\t\t\t\t\tpre = pre.replace(/~0/g,\"\");\n\t\t\t\t\treturn pre;\n\t\t\t\t});\n\t\t\t\n\t\t\treturn hashBlock(\"<blockquote>\\n\" + bq + \"\\n</blockquote>\");\n\t\t});\n\treturn text;\n}\n\n\nvar _FormParagraphs = function(text) {\n//\n//  Params:\n//    $text - string to process with html <p> tags\n//\n\n\t// Strip leading and trailing lines:\n\ttext = text.replace(/^\\n+/g,\"\");\n\ttext = text.replace(/\\n+$/g,\"\");\n\n\tvar grafs = text.split(/\\n{2,}/g);\n\tvar grafsOut = new Array();\n\n\t//\n\t// Wrap <p> tags.\n\t//\n\tvar end = grafs.length;\n\tfor (var i=0; i<end; i++) {\n\t\tvar str = grafs[i];\n\n\t\t// if this is an HTML marker, copy it\n\t\tif (str.search(/~K(\\d+)K/g) >= 0) {\n\t\t\tgrafsOut.push(str);\n\t\t}\n\t\telse if (str.search(/\\S/) >= 0) {\n\t\t\tstr = _RunSpanGamut(str);\n\t\t\tstr = str.replace(/^([ \\t]*)/g,\"<p>\");\n\t\t\tstr += \"</p>\"\n\t\t\tgrafsOut.push(str);\n\t\t}\n\n\t}\n\n\t//\n\t// Unhashify HTML blocks\n\t//\n\tend = grafsOut.length;\n\tfor (var i=0; i<end; i++) {\n\t\t// if this is a marker for an html block...\n\t\twhile (grafsOut[i].search(/~K(\\d+)K/) >= 0) {\n\t\t\tvar blockText = g_html_blocks[RegExp.$1];\n\t\t\tblockText = blockText.replace(/\\$/g,\"$$$$\"); // Escape any dollar signs\n\t\t\tgrafsOut[i] = grafsOut[i].replace(/~K\\d+K/,blockText);\n\t\t}\n\t}\n\n\treturn grafsOut.join(\"\\n\\n\");\n}\n\n\nvar _EncodeAmpsAndAngles = function(text) {\n// Smart processing for ampersands and angle brackets that need to be encoded.\n\t\n\t// Ampersand-encoding based entirely on Nat Irons's Amputator MT plugin:\n\t//   http://bumppo.net/projects/amputator/\n\ttext = text.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\\w+);)/g,\"&amp;\");\n\t\n\t// Encode naked <'s\n\ttext = text.replace(/<(?![a-z\\/?\\$!])/gi,\"&lt;\");\n\t\n\treturn text;\n}\n\n\nvar _EncodeBackslashEscapes = function(text) {\n//\n//   Parameter:  String.\n//   Returns:\tThe string, with after processing the following backslash\n//\t\t\t   escape sequences.\n//\n\n\t// attacklab: The polite way to do this is with the new\n\t// escapeCharacters() function:\n\t//\n\t// \ttext = escapeCharacters(text,\"\\\\\",true);\n\t// \ttext = escapeCharacters(text,\"`*_{}[]()>#+-.!\",true);\n\t//\n\t// ...but we're sidestepping its use of the (slow) RegExp constructor\n\t// as an optimization for Firefox.  This function gets called a LOT.\n\n\ttext = text.replace(/\\\\(\\\\)/g,escapeCharacters_callback);\n\ttext = text.replace(/\\\\([`*_{}\\[\\]()>#+-.!])/g,escapeCharacters_callback);\n\treturn text;\n}\n\n\nvar _DoAutoLinks = function(text) {\n\n\ttext = text.replace(/<((https?|ftp|dict):[^'\">\\s]+)>/gi,\"<a href=\\\"$1\\\">$1</a>\");\n\n\t// Email addresses: <address@domain.foo>\n\n\t/*\n\t\ttext = text.replace(/\n\t\t\t<\n\t\t\t(?:mailto:)?\n\t\t\t(\n\t\t\t\t[-.\\w]+\n\t\t\t\t\\@\n\t\t\t\t[-a-z0-9]+(\\.[-a-z0-9]+)*\\.[a-z]+\n\t\t\t)\n\t\t\t>\n\t\t/gi, _DoAutoLinks_callback());\n\t*/\n\ttext = text.replace(/<(?:mailto:)?([-.\\w]+\\@[-a-z0-9]+(\\.[-a-z0-9]+)*\\.[a-z]+)>/gi,\n\t\tfunction(wholeMatch,m1) {\n\t\t\treturn _EncodeEmailAddress( _UnescapeSpecialChars(m1) );\n\t\t}\n\t);\n\n\treturn text;\n}\n\n\nvar _EncodeEmailAddress = function(addr) {\n//\n//  Input: an email address, e.g. \"foo@example.com\"\n//\n//  Output: the email address as a mailto link, with each character\n//\tof the address encoded as either a decimal or hex entity, in\n//\tthe hopes of foiling most address harvesting spam bots. E.g.:\n//\n//\t<a href=\"&#x6D;&#97;&#105;&#108;&#x74;&#111;:&#102;&#111;&#111;&#64;&#101;\n//\t   x&#x61;&#109;&#x70;&#108;&#x65;&#x2E;&#99;&#111;&#109;\">&#102;&#111;&#111;\n//\t   &#64;&#101;x&#x61;&#109;&#x70;&#108;&#x65;&#x2E;&#99;&#111;&#109;</a>\n//\n//  Based on a filter by Matthew Wickline, posted to the BBEdit-Talk\n//  mailing list: <http://tinyurl.com/yu7ue>\n//\n\n\t// attacklab: why can't javascript speak hex?\n\tfunction char2hex(ch) {\n\t\tvar hexDigits = '0123456789ABCDEF';\n\t\tvar dec = ch.charCodeAt(0);\n\t\treturn(hexDigits.charAt(dec>>4) + hexDigits.charAt(dec&15));\n\t}\n\n\tvar encode = [\n\t\tfunction(ch){return \"&#\"+ch.charCodeAt(0)+\";\";},\n\t\tfunction(ch){return \"&#x\"+char2hex(ch)+\";\";},\n\t\tfunction(ch){return ch;}\n\t];\n\n\taddr = \"mailto:\" + addr;\n\n\taddr = addr.replace(/./g, function(ch) {\n\t\tif (ch == \"@\") {\n\t\t   \t// this *must* be encoded. I insist.\n\t\t\tch = encode[Math.floor(Math.random()*2)](ch);\n\t\t} else if (ch !=\":\") {\n\t\t\t// leave ':' alone (to spot mailto: later)\n\t\t\tvar r = Math.random();\n\t\t\t// roughly 10% raw, 45% hex, 45% dec\n\t\t\tch =  (\n\t\t\t\t\tr > .9  ?\tencode[2](ch)   :\n\t\t\t\t\tr > .45 ?\tencode[1](ch)   :\n\t\t\t\t\t\t\t\tencode[0](ch)\n\t\t\t\t);\n\t\t}\n\t\treturn ch;\n\t});\n\n\taddr = \"<a href=\\\"\" + addr + \"\\\">\" + addr + \"</a>\";\n\taddr = addr.replace(/\">.+:/g,\"\\\">\"); // strip the mailto: from the visible part\n\n\treturn addr;\n}\n\n\nvar _UnescapeSpecialChars = function(text) {\n//\n// Swap back in all the special characters we've hidden.\n//\n\ttext = text.replace(/~E(\\d+)E/g,\n\t\tfunction(wholeMatch,m1) {\n\t\t\tvar charCodeToReplace = parseInt(m1);\n\t\t\treturn String.fromCharCode(charCodeToReplace);\n\t\t}\n\t);\n\treturn text;\n}\n\n\nvar _Outdent = function(text) {\n//\n// Remove one level of line-leading tabs or spaces\n//\n\n\t// attacklab: hack around Konqueror 3.5.4 bug:\n\t// \"----------bug\".replace(/^-/g,\"\") == \"bug\"\n\n\ttext = text.replace(/^(\\t|[ ]{1,4})/gm,\"~0\"); // attacklab: g_tab_width\n\n\t// attacklab: clean up hack\n\ttext = text.replace(/~0/g,\"\")\n\n\treturn text;\n}\n\nvar _Detab = function(text) {\n// attacklab: Detab's completely rewritten for speed.\n// In perl we could fix it by anchoring the regexp with \\G.\n// In javascript we're less fortunate.\n\n\t// expand first n-1 tabs\n\ttext = text.replace(/\\t(?=\\t)/g,\"    \"); // attacklab: g_tab_width\n\n\t// replace the nth with two sentinels\n\ttext = text.replace(/\\t/g,\"~A~B\");\n\n\t// use the sentinel to anchor our regex so it doesn't explode\n\ttext = text.replace(/~B(.+?)~A/g,\n\t\tfunction(wholeMatch,m1,m2) {\n\t\t\tvar leadingText = m1;\n\t\t\tvar numSpaces = 4 - leadingText.length % 4;  // attacklab: g_tab_width\n\n\t\t\t// there *must* be a better way to do this:\n\t\t\tfor (var i=0; i<numSpaces; i++) leadingText+=\" \";\n\n\t\t\treturn leadingText;\n\t\t}\n\t);\n\n\t// clean up sentinels\n\ttext = text.replace(/~A/g,\"    \");  // attacklab: g_tab_width\n\ttext = text.replace(/~B/g,\"\");\n\n\treturn text;\n}\n\n\n//\n//  attacklab: Utility functions\n//\n\n\nvar escapeCharacters = function(text, charsToEscape, afterBackslash) {\n\t// First we have to escape the escape characters so that\n\t// we can build a character class out of them\n\tvar regexString = \"([\" + charsToEscape.replace(/([\\[\\]\\\\])/g,\"\\\\$1\") + \"])\";\n\n\tif (afterBackslash) {\n\t\tregexString = \"\\\\\\\\\" + regexString;\n\t}\n\n\tvar regex = new RegExp(regexString,\"g\");\n\ttext = text.replace(regex,escapeCharacters_callback);\n\n\treturn text;\n}\n\n\nvar escapeCharacters_callback = function(wholeMatch,m1) {\n\tvar charCodeToEscape = m1.charCodeAt(0);\n\treturn \"~E\"+charCodeToEscape+\"E\";\n}\n\nexports.encode = exports.markdown = function (src) {\n   return exports.makeHtml(src);\n};\n\nexports.main = function (system) {\n    var command = system.args.shift();\n    if (!system.args.length) {\n        system.stdout.write(exports.markdown(system.stdin.read())).flush();\n    } else {\n        var arg;\n        while (arg = system.args.shift()) {\n            var out = system.fs.basename(arg, '.md') + '.html';\n            print(out);\n            system.fs.write(out, exports.markdown(system.fs.read(arg)));\n        }\n    }\n};","path":"// from couch.js\nfunction encodeOptions(options) {\n  var buf = [];\n  if (typeof(options) == \"object\" && options !== null) {\n    for (var name in options) {\n      if (!options.hasOwnProperty(name)) {continue;}\n      var value = options[name];\n      if (name == \"key\" || name == \"startkey\" || name == \"endkey\") {\n        value = JSON.stringify(value);\n      }\n      buf.push(encodeURIComponent(name) + \"=\" + encodeURIComponent(value));\n    }\n  }\n  if (!buf.length) {\n    return \"\";\n  }\n  return \"?\" + buf.join(\"&\");\n}\n\nfunction concatArgs(array, args) {\n  for (var i=0; i < args.length; i++) {\n    array.push(args[i]);\n  };\n  return array;\n};\n\nfunction makePath(array) {\n  var options, path;\n  \n  if (typeof array[array.length - 1] != \"string\") {\n    // it's a params hash\n    options = array.pop();\n  }\n  path = array.map(function(item) {return encodeURIComponent(item)}).join('/');\n  if (options) {\n    return path + encodeOptions(options);\n  } else {\n    return path;    \n  }\n};\n\nexports.init = function(req) {\n  return {\n    asset : function() {\n      var p = req.path, parts = ['', p[0], p[1] , p[2]];\n      return makePath(concatArgs(parts, arguments));\n    },\n    attachment : function() {\n      var p = req.path, parts = ['', p[0]];\n      return makePath(concatArgs(parts, arguments));\n    },\n    show : function() {\n      var p = req.path, parts = ['', p[0], p[1] , p[2], '_show'];\n      return makePath(concatArgs(parts, arguments));\n    },\n    list : function() {\n      var p = req.path, parts = ['', p[0], p[1] , p[2], '_list'];\n      return makePath(concatArgs(parts, arguments));\n    },\n    update : function() {\n      var p = req.path, parts = ['', p[0], p[1] , p[2], '_update'];\n      return makePath(concatArgs(parts, arguments));\n    },\n    limit : function(limit) {\n      var query = req.query;\n      var l = query.limit;\n      query.limit = limit;\n      var view = req.path[req.path.length - 1];\n      var list = req.path[req.path.length - 2];\n      var link = this.list(list, view, query);\n      query.limit = l;\n      return link;\n    },\n    older : function(key) {\n      if (!typeof key == \"undefined\") return null;\n      var query = req.query;\n      query.startkey = key;\n      query.skip=1;\n      var view = req.path[req.path.length - 1];\n      var list = req.path[req.path.length - 2];\n      return this.list(list, view, query);\n    },\n    absolute : function(path) {\n      return 'http://' + req.headers.Host + path;\n    }\n  }\n};","docform":"// Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n// use this file except in compliance with the License.  You may obtain a copy\n// of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n// WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n// License for the specific language governing permissions and limitations under\n// the License.\n\n// turn the form into deep json\n// field names like 'author-email' get turned into json like\n// {\"author\":{\"email\":\"quentin@example.com\"}}\n// acts on doc by reference, so you can safely pass non-form fields through\n\nfunction docForm(formSelector, opts) {\n  var localFormDoc = {};\n  opts = opts || {};\n  opts.fields = opts.fields || [];\n\n  // turn the form into deep json\n  // field names like 'author-email' get turned into json like\n  // {\"author\":{\"email\":\"quentin@example.com\"}}\n  function formToDeepJSON(form, fields, doc) {\n    form = $(form);\n    fields.forEach(function(field) {\n      var element = form.find(\"[name=\"+field+\"]\"),\n          parts = field.split('-'),\n          frontObj = doc, frontName = parts.shift();\n\n      if (element.attr('type') === 'checkbox') {\n          var val = element.attr('checked');\n      } else {\n          var val = element.val();\n          if (!val) {\n            if (frontObj[field]) {\n                delete frontObj[field];\n            }\n            return;\n          }\n      }\n      \n      while (parts.length > 0) {\n        frontObj[frontName] = frontObj[frontName] || {};\n        frontObj = frontObj[frontName];\n        frontName = parts.shift();\n      }\n      frontObj[frontName] = val;\n    });\n  }\n  \n  // Apply the behavior\n  $(formSelector).submit(function(e) {\n    e.preventDefault();\n    if (opts.validate && opts.validate() == false) { return false;}\n    // formToDeepJSON acts on localFormDoc by reference\n    formToDeepJSON(this, opts.fields, localFormDoc);\n    if (opts.beforeSave) {opts.beforeSave(localFormDoc);}\n    db.saveDoc(localFormDoc, {\n      success : function(resp) {\n        if (opts.success) {opts.success(resp, localFormDoc);}\n      }\n    });\n    \n    return false;\n  });\n\n  // populate form from an existing doc\n  function docToForm(doc) {\n    var form = $(formSelector);\n    // fills in forms\n    opts.fields.forEach(function(field) {\n      var parts = field.split('-');\n      var run = true, frontObj = doc, frontName = parts.shift();\n      while (frontObj && parts.length > 0) {                \n        frontObj = frontObj[frontName];\n        frontName = parts.shift();\n      }\n      if (frontObj && frontObj[frontName]) {\n        var element = form.find(\"[name=\"+field+\"]\");\n        if (element.attr('type') === 'checkbox') {\n          element.attr('checked', frontObj[frontName]);\n        } else {\n          element.val(frontObj[frontName]);\n        }\n      }\n    });\n  }\n  \n  if (opts.id) {\n    db.openDoc(opts.id, {\n      attachPrevRev : opts.attachPrevRev,\n      error: function() {\n        if (opts.error) {opts.error.apply(opts, arguments);}\n      },\n      success: function(doc) {\n        if (opts.load || opts.onLoad) {(opts.load || opts.onLoad)(doc);}\n        localFormDoc = doc;\n        docToForm(doc);\n    }});\n  } else if (opts.template) {\n    if (opts.load || opts.onLoad) {(opts.load || opts.onLoad)(opts.template);}\n    localFormDoc = opts.template;\n    docToForm(localFormDoc);\n  }\n  var instance = {\n    deleteDoc : function(opts) {\n      opts = opts || {};\n      if (confirm(\"Really delete this document?\")) {                \n        db.removeDoc(localFormDoc, opts);\n      }\n    },\n    localDoc : function() {\n      formToDeepJSON(formSelector, opts.fields, localFormDoc);\n      return localFormDoc;\n    }\n  };\n  return instance;\n}","md5":"/*\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.1 Copyright (C) Paul Johnston 1999 - 2002.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\n\n/*\n * Configurable variables. You may need to tweak these to be compatible with\n * the server-side, but the defaults work in most cases.\n */\nvar hexcase = 0;  /* hex output format. 0 - lowercase; 1 - uppercase        */\nvar b64pad  = \"\"; /* base-64 pad character. \"=\" for strict RFC compliance   */\nvar chrsz   = 8;  /* bits per input character. 8 - ASCII; 16 - Unicode      */\n\n/*\n * These are the functions you'll usually want to call\n * They take string arguments and return either hex or base-64 encoded strings\n */\nfunction hex_md5(s){ return binl2hex(core_md5(str2binl(s), s.length * chrsz));}\nfunction b64_md5(s){ return binl2b64(core_md5(str2binl(s), s.length * chrsz));}\nfunction str_md5(s){ return binl2str(core_md5(str2binl(s), s.length * chrsz));}\nfunction hex_hmac_md5(key, data) { return binl2hex(core_hmac_md5(key, data)); }\nfunction b64_hmac_md5(key, data) { return binl2b64(core_hmac_md5(key, data)); }\nfunction str_hmac_md5(key, data) { return binl2str(core_hmac_md5(key, data)); }\n\n/*\n * Perform a simple self-test to see if the VM is working\n */\nfunction md5_vm_test()\n{\n  return hex_md5(\"abc\") == \"900150983cd24fb0d6963f7d28e17f72\";\n}\n\n/*\n * Calculate the MD5 of an array of little-endian words, and a bit length\n keep\n */\nfunction core_md5(x, len)\n{\n  /* append padding */\n  x[len >> 5] |= 0x80 << ((len) % 32);\n  x[(((len + 64) >>> 9) << 4) + 14] = len;\n\n  var a =  1732584193;\n  var b = -271733879;\n  var c = -1732584194;\n  var d =  271733878;\n\n  for(var i = 0; i < x.length; i += 16)\n  {\n    var olda = a;\n    var oldb = b;\n    var oldc = c;\n    var oldd = d;\n\n    a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);\n    d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);\n    c = md5_ff(c, d, a, b, x[i+ 2], 17,  606105819);\n    b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);\n    a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);\n    d = md5_ff(d, a, b, c, x[i+ 5], 12,  1200080426);\n    c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);\n    b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);\n    a = md5_ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);\n    d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);\n    c = md5_ff(c, d, a, b, x[i+10], 17, -42063);\n    b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);\n    a = md5_ff(a, b, c, d, x[i+12], 7 ,  1804603682);\n    d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);\n    c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);\n    b = md5_ff(b, c, d, a, x[i+15], 22,  1236535329);\n\n    a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);\n    d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);\n    c = md5_gg(c, d, a, b, x[i+11], 14,  643717713);\n    b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);\n    a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);\n    d = md5_gg(d, a, b, c, x[i+10], 9 ,  38016083);\n    c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);\n    b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);\n    a = md5_gg(a, b, c, d, x[i+ 9], 5 ,  568446438);\n    d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);\n    c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);\n    b = md5_gg(b, c, d, a, x[i+ 8], 20,  1163531501);\n    a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);\n    d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);\n    c = md5_gg(c, d, a, b, x[i+ 7], 14,  1735328473);\n    b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);\n\n    a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);\n    d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);\n    c = md5_hh(c, d, a, b, x[i+11], 16,  1839030562);\n    b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);\n    a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);\n    d = md5_hh(d, a, b, c, x[i+ 4], 11,  1272893353);\n    c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);\n    b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);\n    a = md5_hh(a, b, c, d, x[i+13], 4 ,  681279174);\n    d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);\n    c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);\n    b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);\n    a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);\n    d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);\n    c = md5_hh(c, d, a, b, x[i+15], 16,  530742520);\n    b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);\n\n    a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);\n    d = md5_ii(d, a, b, c, x[i+ 7], 10,  1126891415);\n    c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);\n    b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);\n    a = md5_ii(a, b, c, d, x[i+12], 6 ,  1700485571);\n    d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);\n    c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);\n    b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);\n    a = md5_ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);\n    d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);\n    c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);\n    b = md5_ii(b, c, d, a, x[i+13], 21,  1309151649);\n    a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);\n    d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);\n    c = md5_ii(c, d, a, b, x[i+ 2], 15,  718787259);\n    b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);\n\n    a = safe_add(a, olda);\n    b = safe_add(b, oldb);\n    c = safe_add(c, oldc);\n    d = safe_add(d, oldd);\n  }\n  return Array(a, b, c, d);\n\n}\n\n/*\n * These functions implement the four basic operations the algorithm uses.\n */\nfunction md5_cmn(q, a, b, x, s, t)\n{\n  return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);\n}\nfunction md5_ff(a, b, c, d, x, s, t)\n{\n  return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);\n}\nfunction md5_gg(a, b, c, d, x, s, t)\n{\n  return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);\n}\nfunction md5_hh(a, b, c, d, x, s, t)\n{\n  return md5_cmn(b ^ c ^ d, a, b, x, s, t);\n}\nfunction md5_ii(a, b, c, d, x, s, t)\n{\n  return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);\n}\n\n/*\n * Calculate the HMAC-MD5, of a key and some data\n */\nfunction core_hmac_md5(key, data)\n{\n  var bkey = str2binl(key);\n  if(bkey.length > 16) bkey = core_md5(bkey, key.length * chrsz);\n\n  var ipad = Array(16), opad = Array(16);\n  for(var i = 0; i < 16; i++)\n  {\n    ipad[i] = bkey[i] ^ 0x36363636;\n    opad[i] = bkey[i] ^ 0x5C5C5C5C;\n  }\n\n  var hash = core_md5(ipad.concat(str2binl(data)), 512 + data.length * chrsz);\n  return core_md5(opad.concat(hash), 512 + 128);\n}\n\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\nfunction safe_add(x, y)\n{\n  var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n  return (msw << 16) | (lsw & 0xFFFF);\n}\n\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\nfunction bit_rol(num, cnt)\n{\n  return (num << cnt) | (num >>> (32 - cnt));\n}\n\n/*\n * Convert a string to an array of little-endian words\n * If chrsz is ASCII, characters >255 have their hi-byte silently ignored.\n keep\n */\nfunction str2binl(str)\n{\n  var bin = Array();\n  var mask = (1 << chrsz) - 1;\n  for(var i = 0; i < str.length * chrsz; i += chrsz)\n    bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (i%32);\n  return bin;\n}\n\n/*\n * Convert an array of little-endian words to a string\n */\nfunction binl2str(bin)\n{\n  var str = \"\";\n  var mask = (1 << chrsz) - 1;\n  for(var i = 0; i < bin.length * 32; i += chrsz)\n    str += String.fromCharCode((bin[i>>5] >>> (i % 32)) & mask);\n  return str;\n}\n\n/*\n * Convert an array of little-endian words to a hex string.\n keep\n */\nfunction binl2hex(binarray)\n{\n  var hex_tab = hexcase ? \"0123456789ABCDEF\" : \"0123456789abcdef\";\n  var str = \"\";\n  for(var i = 0; i < binarray.length * 4; i++)\n  {\n    str += hex_tab.charAt((binarray[i>>2] >> ((i%4)*8+4)) & 0xF) +\n           hex_tab.charAt((binarray[i>>2] >> ((i%4)*8  )) & 0xF);\n  }\n  return str;\n}\n\n/*\n * Convert an array of little-endian words to a base-64 string\n */\nfunction binl2b64(binarray)\n{\n  var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n  var str = \"\";\n  for(var i = 0; i < binarray.length * 4; i += 3)\n  {\n    var triplet = (((binarray[i   >> 2] >> 8 * ( i   %4)) & 0xFF) << 16)\n                | (((binarray[i+1 >> 2] >> 8 * ((i+1)%4)) & 0xFF) << 8 )\n                |  ((binarray[i+2 >> 2] >> 8 * ((i+2)%4)) & 0xFF);\n    for(var j = 0; j < 4; j++)\n    {\n      if(i * 8 + j * 6 > binarray.length * 32) str += b64pad;\n      else str += tab.charAt((triplet >> 6*(3-j)) & 0x3F);\n    }\n  }\n  return str;\n}\n\nexports.hex = hex_md5;","utils":"exports.prettyDate = function(time){\n  \n\tvar date = new Date(time.replace(/-/g,\"/\").replace(\"T\", \" \").replace(\"Z\", \" +0000\").replace(/(\\d*\\:\\d*:\\d*)\\.\\d*/g,\"$1\")),\n\t\tdiff = (((new Date()).getTime() - date.getTime()) / 1000),\n\t\tday_diff = Math.floor(diff / 86400);\n\n  if (isNaN(day_diff)) return time;\n\n\treturn day_diff < 1 && (\n\t\t\tdiff < 60 && \"just now\" ||\n\t\t\tdiff < 120 && \"1 minute ago\" ||\n\t\t\tdiff < 3600 && Math.floor( diff / 60 ) + \" minutes ago\" ||\n\t\t\tdiff < 7200 && \"1 hour ago\" ||\n\t\t\tdiff < 86400 && Math.floor( diff / 3600 ) + \" hours ago\") ||\n\t\tday_diff == 1 && \"yesterday\" ||\n\t\tday_diff < 21 && day_diff + \" days ago\" ||\n\t\tday_diff < 45 && Math.ceil( day_diff / 7 ) + \" weeks ago\" ||\n    time;\n    // day_diff < 730 && Math.ceil( day_diff / 31 ) + \" months ago\" ||\n    // Math.ceil( day_diff / 365 ) + \" years ago\";\n};","redirect":"exports.permanent = function(redirect) {\n  return {\n    code : 301,\n    headers : {\n      \"Location\" : redirect\n    }\n  };\n};","atom":"// atom feed generator\n// requries E4X support.\n\nfunction f(n) {    // Format integers to have at least two digits.\n    return n < 10 ? '0' + n : n;\n}\n\nfunction rfc3339(date) {\n  return date.getUTCFullYear()   + '-' +\n    f(date.getUTCMonth() + 1) + '-' +\n    f(date.getUTCDate())      + 'T' +\n    f(date.getUTCHours())     + ':' +\n    f(date.getUTCMinutes())   + ':' +\n    f(date.getUTCSeconds())   + 'Z';\n};\n\nexports.header = function(data) {\n  var f = <feed xmlns=\"http://www.w3.org/2005/Atom\"/>;\n  f.title = data.title;\n  f.id = data.feed_id;\n  f.link.@href = data.feed_link;\n  f.link.@rel = \"self\";\n  f.generator = \"CouchApp on CouchDB\";\n  f.updated = rfc3339(data.updated);\n  return f.toXMLString().replace(/\\<\\/feed\\>/,'');\n};\n\nexports.entry = function(data) {\n  var entry = <entry/>;\n  entry.id = data.entry_id;\n  entry.title = data.title;\n  entry.content = data.content;\n  entry.content.@type = (data.content_type || 'html');\n  entry.updated = rfc3339(data.updated);\n  entry.author = <author><name>{data.author}</name></author>;\n  entry.link.@href = data.alternate;\n  entry.link.@rel = \"alternate\";\n  return entry;\n}"},"evently":{"profile":{"loggedOut":{"mustache":"<p>Please log in to see your profile.</p>","after":"function() {\n  $$(this).profile = null;\n};"},"profileReady":{"mustache":"<div class=\"avatar\">\n  {{#gravatar_url}}<img src=\"{{gravatar_url}}\"/>{{/gravatar_url}}\n  <div class=\"name\">\n    {{nickname}}\n  </div>\n</div>\n<p>Hello {{nickname}}!</p>\n<div style=\"clear:left;\"></div>","data":"function(e, p) {\n  return p\n}","after":"function(e, p) {\n  $$(this).profile = p;\n};"},"loggedIn":"function(e, r) {\n  var userCtx = r.userCtx;\n  var widget = $(this);\n  // load the profile from the user doc\n  var db = $.couch.db(r.info.authentication_db);\n  var userDocId = \"org.couchdb.user:\"+userCtx.name;\n  db.openDoc(userDocId, {\n    success : function(userDoc) {\n      var profile = userDoc[\"couch.app.profile\"];\n      if (profile) {\n        // we copy the name to the profile so it can be used later\n        // without publishing the entire userdoc (roles, pass, etc)\n        profile.name = userDoc.name;\n        $$(widget).profile = profile;\n        widget.trigger(\"profileReady\", [profile]);\n      } else {\n        widget.trigger(\"noProfile\", [userCtx]);\n      }\n    }\n  });\n}","noProfile":{"mustache":"<form>\n  <p>Hello {{name}}, Please setup your user profile.</p>\n  <label for=\"nickname\">Nickname \n    <input type=\"text\" name=\"nickname\" value=\"\"></label>\n  <label for=\"email\">Email (<em>for <a href=\"http://gravatar.com\">Gravatar</a></em>)\n    <input type=\"text\" name=\"email\" value=\"\"></label>\n  <label for=\"url\">URL \n    <input type=\"text\" name=\"url\" value=\"\"></label>\n  <input type=\"submit\" value=\"Go &rarr;\">\n  <input type=\"hidden\" name=\"userCtxName\" value=\"{{name}}\" id=\"userCtxName\">\n</form>","data":"function(e, userCtx) {\n  return userCtx;\n}","selectors":{"form":{"submit":"function() {\n  var md5 = $$(this).app.require(\"vendor/couchapp/lib/md5\");\n  \n  // TODO this can be cleaned up with docForm?\n  // it still needs the workflow to edit an existing profile\n  var name = $(\"input[name=userCtxName]\",this).val();\n  var newProfile = {\n    rand : Math.random().toString(), \n    nickname : $(\"input[name=nickname]\",this).val(),\n    email : $(\"input[name=email]\",this).val(),\n    url : $(\"input[name=url]\",this).val()\n  }, widget = $(this);\n\n  // setup gravatar_url\n  if (md5) {\n    newProfile.gravatar_url = 'http://www.gravatar.com/avatar/'+md5.hex(newProfile.email || newProfile.rand)+'.jpg?s=40&d=identicon';    \n  }\n\n  // store the user profile on the user account document\n  $.couch.userDb(function(db) {\n    var userDocId = \"org.couchdb.user:\"+name;\n    db.openDoc(userDocId, {\n      success : function(userDoc) {\n        userDoc[\"couch.app.profile\"] = newProfile;\n        db.saveDoc(userDoc, {\n          success : function() {\n            newProfile.name = userDoc.name;\n            $$(widget).profile = newProfile;\n            widget.trigger(\"profileReady\", [newProfile]);\n          }\n        });\n      }\n    });\n  });\n  return false;\n}"}}}},"account":{"doLogin":"function(e, name, pass) {\n  var elem = $(this);\n  $.couch.login({\n    name : name,\n    password : pass,\n    success : function(r) {\n      elem.trigger(\"_init\")\n    }\n  });      \n}","doLogout":"function() {\n  var elem = $(this);\n  $.couch.logout({\n    success : function() {\n      elem.trigger(\"_init\");\n    }\n  });\n}","loginForm":{"mustache":"<form>\n  <label for=\"name\">Name</label> <input type=\"text\" name=\"name\" value=\"\" autocapitalize=\"off\" autocorrect=\"off\">\n  <label for=\"password\">Password</label> <input type=\"password\" name=\"password\" value=\"\">\n  <input type=\"submit\" value=\"Login\">\n  <a href=\"#signup\">or Signup</a>\n</form>","selectors":{"form":{"submit":"function(e) {\n  var name = $('input[name=name]', this).val(),\n    pass = $('input[name=password]', this).val();              \n  $(this).trigger('doLogin', [name, pass]);\n  return false;\n}"}},"after":"function() {\n  $(\"input[name=name]\", this).focus();\n}"},"adminParty":{"mustache":"<p><strong>Admin party, everyone is admin!</strong> Fix this in <a href=\"/_utils/index.html\">Futon</a> before proceeding.</p>"},"loggedOut":{"mustache":"<a href=\"#signup\">Signup</a> or <a href=\"#login\">Login</a>","selectors":{"a[href=#signup]":{"click":["signupForm"]},"a[href=#login]":{"click":["loginForm"]}}},"doSignup":"function(e, name, pass) {\n  var elem = $(this);\n  $.couch.signup({\n    name : name\n  }, pass, {\n    success : function() {\n      elem.trigger(\"doLogin\", [name, pass]);\n    }\n  });\n}","signupForm":{"mustache":"<form>\n  <label for=\"name\">Name</label> <input type=\"text\" name=\"name\" value=\"\" autocapitalize=\"off\" autocorrect=\"off\">\n  <label for=\"password\">Password</label> <input type=\"password\" name=\"password\" value=\"\">\n  <input type=\"submit\" value=\"Signup\">\n  <a href=\"#login\">or Login</a>\n</form>","selectors":{"form":{"submit":"function(e) {\n  var name = $('input[name=name]', this).val(),\n    pass = $('input[name=password]', this).val();              \n  $(this).trigger('doSignup', [name, pass]);\n  return false;\n}"}},"after":"function() {\n  $(\"input[name=name]\", this).focus();\n}"},"loggedIn":{"mustache":"<span>Welcome \n<a target=\"_new\" href=\"/_utils/document.html?{{auth_db}}/org.couchdb.user%3A{{uri_name}}\">{{name}}</a>! \n<a href=\"#logout\">Logout?</a>\n</span>","data":"function(e, r) {\n  return {\n    name : r.userCtx.name,\n    uri_name : encodeURIComponent(r.userCtx.name),\n    auth_db : encodeURIComponent(r.info.authentication_db)\n  };\n}","selectors":{"a[href=#logout]":{"click":["doLogout"]}},"after":"function(e, r) {\n  $$(this).userCtx = r.userCtx;\n  $$(this).info = r.info;\n};"},"_init":"function() {\n  var elem = $(this);\n  $$(this).userCtx = null;\n  $.couch.session({\n    success : function(r) {\n      var userCtx = r.userCtx;\n      if (userCtx.name) {\n        elem.trigger(\"loggedIn\", [r]);\n      } else if (userCtx.roles.indexOf(\"_admin\") != -1) {\n        elem.trigger(\"adminParty\");\n      } else {\n        elem.trigger(\"loggedOut\");\n      };\n    }\n  });\n}"},"README":"## Starting the Document this code challenge\n\nI need help on this code. I only have so many hours in the day. Please be liberal about patching and hacking (and sharing code!) so we can all benefit. \n\nDocs patches are deeply appreciated. For now you can just stick Markdown files in the Docs directory.\n\n# Evently\n\nThese are some vendor Evently widgets that are running on the CouchApp system.\n\n## Account\n  This is how you signup, login and logout without worry about the code.\n  Todo, we could have this work against remote APIs like that Facebook stuff or whatever.\n\n\n## Profile\n  Use this to load the local users profile for the logged in user. Useful if you're going to be posting new messages. Most applications end up customizing `profile.profileReady` to render the primary data-entry form. This gets you benefits like refreshing on login / logout, etc, automatically.\n\n\n## Docs\n  This needs to be moved to it's own app.\n  I have this vision of a docs app designed for offline editing, that involves each Markdown paragraph being it's own document, with automatic use of Bespin for code samples. Any help on this would be thanked much."}}},"evently":{"items":{"_changes":{"mustache":"<p>Customize this format here: <tt>ddoc.evently.items._changes.mustache</tt></p>\n<h3>Recent Messages</h3>\n<ul>\n  {{#items}}\n    <li>\n      <div class=\"avatar\">\n        {{#gravatar_url}}<img src=\"{{gravatar_url}}\" alt=\"{{name}}\"/>{{/gravatar_url}}\n        <div class=\"name\">\n          {{nickname}}\n        </div>\n      </div>\n      <p>{{message}}</p>\n      <div style=\"clear:left;\"></div>\n    </li>\n  {{/items}}\n</ul>\n<p><em>Protip:</em> If you setup continuous replication between this database and a remote one, this list will reflect remote changes in near real-time.</p>\n<p>This would be a good place to add pagination.</p>","data":"function(data) {\n  // $.log(data)\n  var p;\n  return {\n    items : data.rows.map(function(r) {\n      p = (r.value && r.value.profile) || {};\n      p.message = r.value && r.value.message;\n      return p;\n    })\n  }\n};","query":{"descending":"true","view":"recent-items","limit":50}}},"profile":{"profileReady":{"mustache":"<p>Most applications will customize this template (<tt>ddoc.evently.profile.profileReady.mustache</tt>) for user input.</p>\n\n<div class=\"avatar\">\n  {{#gravatar_url}}<img src=\"{{gravatar_url}}\"/>{{/gravatar_url}}\n  <div class=\"name\">\n    {{name}}\n  </div>\n</div>\n\n<form>\n  <label>New message from {{nickname}}: <input type=\"text\" name=\"message\" size=60 value=\"\"></label>\n</form>\n\n<div style=\"clear:left;\"></div>","selectors":{"form":{"submit":"function() {\n  var form = $(this);\n  var fdoc = form.serializeObject();\n  fdoc.created_at = new Date();\n  fdoc.profile = $$(\"#profile\").profile;\n  $$(this).app.db.saveDoc(fdoc, {\n    success : function() {\n      form[0].reset();\n    }\n  });\n  return false;\n};"}}}}},"_attachments":{"phonegap.0.9.5.1.min.js":{"data":"dmFyIF9hbm9tRnVua01hcD17fTt2YXIgX2Fub21GdW5rTWFwTmV4dElkPTA7ZnVuY3Rpb24gYW5vbVRvTmFtZUZ1bmsoZnVuKXt2YXIgZnVua0lkPSJmIitfYW5vbUZ1bmtNYXBOZXh0SWQrKzt2YXIgZnVuaz1mdW5jdGlvbigpe2Z1bi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7X2Fub21GdW5rTWFwW2Z1bmtJZF09bnVsbDtkZWxldGUgX2Fub21GdW5rTWFwW2Z1bmtJZF19O19hbm9tRnVua01hcFtmdW5rSWRdPWZ1bms7cmV0dXJuIl9hbm9tRnVua01hcC4iK2Z1bmtJZH1mdW5jdGlvbiBHZXRGdW5jdGlvbk5hbWUoZm4pe2lmKHR5cGVvZiBmbj09PSJmdW5jdGlvbiIpe3ZhciBuYW1lPWZuLm5hbWU7aWYoIW5hbWUpe3ZhciBtPWZuLnRvU3RyaW5nKCkubWF0Y2goL15ccypmdW5jdGlvblxzKyhbXlxzXChdKykvKTtuYW1lPW0mJm1bMV19aWYobmFtZSYmKHdpbmRvd1tuYW1lXT09PWZuKSl7cmV0dXJuIG5hbWV9ZWxzZXtyZXR1cm4gYW5vbVRvTmFtZUZ1bmsoZm4pfX1lbHNle3JldHVybiBudWxsfX1pZih0eXBlb2YgUGhvbmVHYXA9PT0idW5kZWZpbmVkIil7aWYodHlwZW9mKERldmljZUluZm8pIT09Im9iamVjdCIpe0RldmljZUluZm89e319UGhvbmVHYXA9e3F1ZXVlOntyZWFkeTp0cnVlLGNvbW1hbmRzOltdLHRpbWVyOm51bGx9LF9jb25zdHJ1Y3RvcnM6W119O1Bob25lR2FwLnJlc291cmNlcz17YmFzZTp0cnVlfTtQaG9uZUdhcC5oYXNSZXNvdXJjZT1mdW5jdGlvbihuYW1lKXtyZXR1cm4gUGhvbmVHYXAucmVzb3VyY2VzW25hbWVdfTtQaG9uZUdhcC5hZGRSZXNvdXJjZT1mdW5jdGlvbihuYW1lKXtQaG9uZUdhcC5yZXNvdXJjZXNbbmFtZV09dHJ1ZX07UGhvbmVHYXAuYXZhaWxhYmxlPURldmljZUluZm8udXVpZCE9dW5kZWZpbmVkO1Bob25lR2FwLmFkZENvbnN0cnVjdG9yPWZ1bmN0aW9uKGZ1bmMpe3ZhciBzdGF0ZT1kb2N1bWVudC5yZWFkeVN0YXRlO2lmKChzdGF0ZT09ImxvYWRlZCJ8fHN0YXRlPT0iY29tcGxldGUiKSYmRGV2aWNlSW5mby51dWlkIT1udWxsKXtmdW5jKCl9ZWxzZXtQaG9uZUdhcC5fY29uc3RydWN0b3JzLnB1c2goZnVuYyl9fTsoZnVuY3Rpb24oKXt2YXIgdGltZXI9c2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXt2YXIgc3RhdGU9ZG9jdW1lbnQucmVhZHlTdGF0ZTtpZigoc3RhdGU9PSJsb2FkZWQifHxzdGF0ZT09ImNvbXBsZXRlIikmJkRldmljZUluZm8udXVpZCE9bnVsbCl7Y2xlYXJJbnRlcnZhbCh0aW1lcik7d2hpbGUoUGhvbmVHYXAuX2NvbnN0cnVjdG9ycy5sZW5ndGg+MCl7dmFyIGNvbnN0cnVjdG9yPVBob25lR2FwLl9jb25zdHJ1Y3RvcnMuc2hpZnQoKTt0cnl7Y29uc3RydWN0b3IoKX1jYXRjaChlKXtpZih0eXBlb2YoZGVidWcubG9nKT09ImZ1bmN0aW9uIil7ZGVidWcubG9nKCJGYWlsZWQgdG8gcnVuIGNvbnN0cnVjdG9yOiAiK2RlYnVnLnByb2Nlc3NNZXNzYWdlKGUpKX1lbHNle2FsZXJ0KCJGYWlsZWQgdG8gcnVuIGNvbnN0cnVjdG9yOiAiK2UubWVzc2FnZSl9fX12YXIgZT1kb2N1bWVudC5jcmVhdGVFdmVudCgiRXZlbnRzIik7ZS5pbml0RXZlbnQoImRldmljZXJlYWR5Iik7ZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChlKX19LDEpfSkoKTtQaG9uZUdhcC5jYWxsYmFja0lkPTA7UGhvbmVHYXAuY2FsbGJhY2tzPXt9O1Bob25lR2FwLmNhbGxiYWNrU3RhdHVzPXtOT19SRVNVTFQ6MCxPSzoxLENMQVNTX05PVF9GT1VORF9FWENFUFRJT046MixJTExFR0FMX0FDQ0VTU19FWENFUFRJT046MyxJTlNUQU5USUFUSU9OX0VYQ0VQVElPTjo0LE1BTEZPUk1FRF9VUkxfRVhDRVBUSU9OOjUsSU9fRVhDRVBUSU9OOjYsSU5WQUxJRF9BQ1RJT046NyxKU09OX0VYQ0VQVElPTjo4LEVSUk9SOjl9O1Bob25lR2FwLmV4ZWM9ZnVuY3Rpb24oKXtQaG9uZUdhcC5xdWV1ZS5jb21tYW5kcy5wdXNoKGFyZ3VtZW50cyk7aWYoUGhvbmVHYXAucXVldWUudGltZXI9PW51bGwpe1Bob25lR2FwLnF1ZXVlLnRpbWVyPXNldEludGVydmFsKFBob25lR2FwLnJ1bl9jb21tYW5kLDEwKX19O1Bob25lR2FwLnJ1bl9jb21tYW5kPWZ1bmN0aW9uKCl7aWYoIVBob25lR2FwLmF2YWlsYWJsZXx8IVBob25lR2FwLnF1ZXVlLnJlYWR5KXtyZXR1cm59UGhvbmVHYXAucXVldWUucmVhZHk9ZmFsc2U7aWYoIXRoaXMuZ2FwQnJpZGdlKXt0aGlzLmdhcEJyaWRnZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJJRlJBTUUiKTt0aGlzLmdhcEJyaWRnZS5zZXRBdHRyaWJ1dGUoImhlaWdodCIsIjBweCIpO3RoaXMuZ2FwQnJpZGdlLnNldEF0dHJpYnV0ZSgid2lkdGgiLCIwcHgiKTt0aGlzLmdhcEJyaWRnZS5zZXRBdHRyaWJ1dGUoImZyYW1lYm9yZGVyIiwiMCIpO2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmdhcEJyaWRnZSl9dmFyIGFyZ3M9UGhvbmVHYXAucXVldWUuY29tbWFuZHMuc2hpZnQoKTtpZihQaG9uZUdhcC5xdWV1ZS5jb21tYW5kcy5sZW5ndGg9PTApe2NsZWFySW50ZXJ2YWwoUGhvbmVHYXAucXVldWUudGltZXIpO1Bob25lR2FwLnF1ZXVlLnRpbWVyPW51bGx9dmFyIHNlcnZpY2U7dmFyIGNhbGxiYWNrSWQ9bnVsbDt2YXIgc3RhcnQ9MDt0cnl7aWYoYXJnc1swXT09bnVsbHx8dHlwZW9mIGFyZ3NbMF09PT0iZnVuY3Rpb24iKXt2YXIgc3VjY2Vzcz1hcmdzWzBdO3ZhciBmYWlsPWFyZ3NbMV07c2VydmljZT1hcmdzWzJdKyIuIithcmdzWzNdO2FyZ3M9YXJnc1s0XTtjYWxsYmFja0lkPXNlcnZpY2UrUGhvbmVHYXAuY2FsbGJhY2tJZCsrO2lmKHN1Y2Nlc3N8fGZhaWwpe1Bob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXT17c3VjY2VzczpzdWNjZXNzLGZhaWw6ZmFpbH19fWVsc2V7c2VydmljZT1hcmdzWzBdO3N0YXJ0PTF9dmFyIHVyaT1bXTt2YXIgZGljdD1udWxsO2Zvcih2YXIgaT1zdGFydDtpPGFyZ3MubGVuZ3RoO2krKyl7dmFyIGFyZz1hcmdzW2ldO2lmKGFyZz09dW5kZWZpbmVkfHxhcmc9PW51bGwpe2NvbnRpbnVlfWlmKHR5cGVvZihhcmcpPT0ib2JqZWN0Iil7ZGljdD1hcmd9ZWxzZXt1cmkucHVzaChlbmNvZGVVUklDb21wb25lbnQoYXJnKSl9fXZhciBuZXh0PWNhbGxiYWNrSWQhPW51bGw/KCIvIitjYWxsYmFja0lkKyIvIik6Ii8iO3ZhciB1cmw9ImdhcDovLyIrc2VydmljZStuZXh0K3VyaS5qb2luKCIvIik7aWYoZGljdCE9bnVsbCl7dXJsKz0iPyIrZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGRpY3QpKX10aGlzLmdhcEJyaWRnZS5zcmM9dXJsfWNhdGNoKGUpe2NvbnNvbGUubG9nKCJQaG9uZUdhcEV4ZWMgRXJyb3I6ICIrZSl9fTtQaG9uZUdhcC5jYWxsYmFja1N1Y2Nlc3M9ZnVuY3Rpb24oY2FsbGJhY2tJZCxhcmdzKXtpZihQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF0pe2lmKGFyZ3Muc3RhdHVzPT1QaG9uZUdhcC5jYWxsYmFja1N0YXR1cy5PSyl7dHJ5e2lmKFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXS5zdWNjZXNzKXtQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF0uc3VjY2VzcyhhcmdzLm1lc3NhZ2UpfX1jYXRjaChlKXtjb25zb2xlLmxvZygiRXJyb3IgaW4gc3VjY2VzcyBjYWxsYmFjazogIitjYWxsYmFja0lkKyIgPSAiK2UpfX1pZighYXJncy5rZWVwQ2FsbGJhY2spe2RlbGV0ZSBQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF19fX07UGhvbmVHYXAuY2FsbGJhY2tFcnJvcj1mdW5jdGlvbihjYWxsYmFja0lkLGFyZ3Mpe2lmKFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXSl7dHJ5e2lmKFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXS5mYWlsKXtQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF0uZmFpbChhcmdzLm1lc3NhZ2UpfX1jYXRjaChlKXtjb25zb2xlLmxvZygiRXJyb3IgaW4gZXJyb3IgY2FsbGJhY2s6ICIrY2FsbGJhY2tJZCsiID0gIitlKX1pZighYXJncy5rZWVwQ2FsbGJhY2spe2RlbGV0ZSBQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF19fX07UGhvbmVHYXAuY2xvbmU9ZnVuY3Rpb24ob2JqKXtpZighb2JqKXtyZXR1cm4gb2JqfWlmKG9iaiBpbnN0YW5jZW9mIEFycmF5KXt2YXIgcmV0VmFsPW5ldyBBcnJheSgpO2Zvcih2YXIgaT0wO2k8b2JqLmxlbmd0aDsrK2kpe3JldFZhbC5wdXNoKFBob25lR2FwLmNsb25lKG9ialtpXSkpfXJldHVybiByZXRWYWx9aWYob2JqIGluc3RhbmNlb2YgRnVuY3Rpb24pe3JldHVybiBvYmp9aWYoIShvYmogaW5zdGFuY2VvZiBPYmplY3QpKXtyZXR1cm4gb2JqfWlmKG9iaiBpbnN0YW5jZW9mIERhdGUpe3JldHVybiBvYmp9cmV0VmFsPW5ldyBPYmplY3QoKTtmb3IoaSBpbiBvYmope2lmKCEoaSBpbiByZXRWYWwpfHxyZXRWYWxbaV0hPW9ialtpXSl7cmV0VmFsW2ldPVBob25lR2FwLmNsb25lKG9ialtpXSl9fXJldHVybiByZXRWYWx9O1Bob25lR2FwLm1fZG9jdW1lbnRfYWRkRXZlbnRMaXN0ZW5lcj1kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyO2RvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXI9ZnVuY3Rpb24oZXZ0LGhhbmRsZXIsY2FwdHVyZSl7dmFyIGU9ZXZ0LnRvTG93ZXJDYXNlKCk7aWYoZT09PSJ1bmxvYWQiKXtQaG9uZUdhcC5vblVubG9hZD1mdW5jdGlvbihlKXtyZXR1cm4gaGFuZGxlcihlKX19ZWxzZXtQaG9uZUdhcC5tX2RvY3VtZW50X2FkZEV2ZW50TGlzdGVuZXIuY2FsbChkb2N1bWVudCxldnQsaGFuZGxlcixjYXB0dXJlKX19O1Bob25lR2FwLm1fZG9jdW1lbnRfcmVtb3ZlRXZlbnRMaXN0ZW5lcj1kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyO2RvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXI9ZnVuY3Rpb24oZXZ0LGhhbmRsZXIsY2FwdHVyZSl7dmFyIGU9ZXZ0LnRvTG93ZXJDYXNlKCk7aWYoZT09PSJ1bmxvYWQiKXtQaG9uZUdhcC5vblVubG9hZD1udWxsfVBob25lR2FwLm1fZG9jdW1lbnRfcmVtb3ZlRXZlbnRMaXN0ZW5lci5jYWxsKGRvY3VtZW50LGV2dCxoYW5kbGVyLGNhcHR1cmUpfTtQaG9uZUdhcC5maXJlRXZlbnQ9ZnVuY3Rpb24odHlwZSl7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRXZlbnQoIkV2ZW50cyIpO2UuaW5pdEV2ZW50KHR5cGUpO2RvY3VtZW50LmRpc3BhdGNoRXZlbnQoZSl9fWlmKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiZGVidWdjb25zb2xlIikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJkZWJ1Z2NvbnNvbGUiKTtEZWJ1Z0NvbnNvbGU9ZnVuY3Rpb24oaXNEZXByZWNhdGVkKXt0aGlzLmxvZ0xldmVsPURlYnVnQ29uc29sZS5JTkZPX0xFVkVMO3RoaXMuaXNEZXByZWNhdGVkPWlzRGVwcmVjYXRlZD90cnVlOmZhbHNlfTtEZWJ1Z0NvbnNvbGUuQUxMX0xFVkVMPTE7RGVidWdDb25zb2xlLklORk9fTEVWRUw9MTtEZWJ1Z0NvbnNvbGUuV0FSTl9MRVZFTD0yO0RlYnVnQ29uc29sZS5FUlJPUl9MRVZFTD00O0RlYnVnQ29uc29sZS5OT05FX0xFVkVMPTg7RGVidWdDb25zb2xlLnByb3RvdHlwZS5zZXRMZXZlbD1mdW5jdGlvbihsZXZlbCl7dGhpcy5sb2dMZXZlbD1sZXZlbH07RGVidWdDb25zb2xlLnByb3RvdHlwZS5wcm9jZXNzTWVzc2FnZT1mdW5jdGlvbihtZXNzYWdlLG1heERlcHRoKXtpZihtYXhEZXB0aD09PXVuZGVmaW5lZCl7bWF4RGVwdGg9MH1pZih0eXBlb2YobWVzc2FnZSkhPSJvYmplY3QiKXtyZXR1cm4odGhpcy5pc0RlcHJlY2F0ZWQ/IldBUk5JTkc6IGRlYnVnIG9iamVjdCBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIGNvbnNvbGUgb2JqZWN0IFxuIittZXNzYWdlOm1lc3NhZ2UpfWVsc2V7ZnVuY3Rpb24gaW5kZW50KHN0cil7cmV0dXJuIHN0ci5yZXBsYWNlKC9eL21nLCIgICAgIil9ZnVuY3Rpb24gbWFrZVN0cnVjdHVyZWQob2JqLGRlcHRoKXt2YXIgc3RyPSIiO2Zvcih2YXIgaSBpbiBvYmope3RyeXtpZih0eXBlb2Yob2JqW2ldKT09Im9iamVjdCImJmRlcHRoPG1heERlcHRoKXtzdHIrPWkrIjpcbiIraW5kZW50KG1ha2VTdHJ1Y3R1cmVkKG9ialtpXSkpKyJcbiJ9ZWxzZXtzdHIrPWkrIiA9ICIraW5kZW50KFN0cmluZyhvYmpbaV0pKS5yZXBsYWNlKC9eICAgIC8sIiIpKyJcbiJ9fWNhdGNoKGUpe3N0cis9aSsiID0gRVhDRVBUSU9OOiAiK2UubWVzc2FnZSsiXG4ifX1yZXR1cm4gc3RyfXJldHVybigodGhpcy5pc0RlcHJlY2F0ZWQ/IldBUk5JTkc6IGRlYnVnIG9iamVjdCBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIGNvbnNvbGUgb2JqZWN0XG4iOiIiKSsiT2JqZWN0OlxuIittYWtlU3RydWN0dXJlZChtZXNzYWdlLG1heERlcHRoKSl9fTtEZWJ1Z0NvbnNvbGUucHJvdG90eXBlLmxvZz1mdW5jdGlvbihtZXNzYWdlLG1heERlcHRoKXtpZihQaG9uZUdhcC5hdmFpbGFibGUmJnRoaXMubG9nTGV2ZWw8PURlYnVnQ29uc29sZS5JTkZPX0xFVkVMKXtQaG9uZUdhcC5leGVjKCJEZWJ1Z0NvbnNvbGUubG9nIix0aGlzLnByb2Nlc3NNZXNzYWdlKG1lc3NhZ2UsbWF4RGVwdGgpLHtsb2dMZXZlbDoiSU5GTyJ9KX1lbHNle2NvbnNvbGUubG9nKG1lc3NhZ2UpfX07RGVidWdDb25zb2xlLnByb3RvdHlwZS53YXJuPWZ1bmN0aW9uKG1lc3NhZ2UsbWF4RGVwdGgpe2lmKFBob25lR2FwLmF2YWlsYWJsZSYmdGhpcy5sb2dMZXZlbDw9RGVidWdDb25zb2xlLldBUk5fTEVWRUwpe1Bob25lR2FwLmV4ZWMoIkRlYnVnQ29uc29sZS5sb2ciLHRoaXMucHJvY2Vzc01lc3NhZ2UobWVzc2FnZSxtYXhEZXB0aCkse2xvZ0xldmVsOiJXQVJOIn0pfWVsc2V7Y29uc29sZS5lcnJvcihtZXNzYWdlKX19O0RlYnVnQ29uc29sZS5wcm90b3R5cGUuZXJyb3I9ZnVuY3Rpb24obWVzc2FnZSxtYXhEZXB0aCl7aWYoUGhvbmVHYXAuYXZhaWxhYmxlJiZ0aGlzLmxvZ0xldmVsPD1EZWJ1Z0NvbnNvbGUuRVJST1JfTEVWRUwpe1Bob25lR2FwLmV4ZWMoIkRlYnVnQ29uc29sZS5sb2ciLHRoaXMucHJvY2Vzc01lc3NhZ2UobWVzc2FnZSxtYXhEZXB0aCkse2xvZ0xldmVsOiJFUlJPUiJ9KX1lbHNle2NvbnNvbGUuZXJyb3IobWVzc2FnZSl9fTtQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpe3dpbmRvdy5jb25zb2xlPW5ldyBEZWJ1Z0NvbnNvbGUoKTt3aW5kb3cuZGVidWc9bmV3IERlYnVnQ29uc29sZSh0cnVlKX0pfWlmKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgicG9zaXRpb24iKSl7UGhvbmVHYXAuYWRkUmVzb3VyY2UoInBvc2l0aW9uIik7UG9zaXRpb249ZnVuY3Rpb24oY29vcmRzLHRpbWVzdGFtcCl7dGhpcy5jb29yZHM9Q29vcmRpbmF0ZXMuY2xvbmVGcm9tKGNvb3Jkcyk7dGhpcy50aW1lc3RhbXA9dGltZXN0YW1wfHxuZXcgRGF0ZSgpLmdldFRpbWUoKX07UG9zaXRpb24ucHJvdG90eXBlLmVxdWFscz1mdW5jdGlvbihvdGhlcil7cmV0dXJuKHRoaXMuY29vcmRzJiZvdGhlciYmb3RoZXIuY29vcmRzJiZ0aGlzLmNvb3Jkcy5sYXRpdHVkZT09b3RoZXIuY29vcmRzLmxhdGl0dWRlJiZ0aGlzLmNvb3Jkcy5sb25naXR1ZGU9PW90aGVyLmNvb3Jkcy5sb25naXR1ZGUpfTtQb3NpdGlvbi5wcm90b3R5cGUuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IFBvc2l0aW9uKHRoaXMuY29vcmRzP3RoaXMuY29vcmRzLmNsb25lKCk6bnVsbCx0aGlzLnRpbWVzdGFtcD90aGlzLnRpbWVzdGFtcDpuZXcgRGF0ZSgpLmdldFRpbWUoKSl9O0Nvb3JkaW5hdGVzPWZ1bmN0aW9uKGxhdCxsbmcsYWx0LGFjYyxoZWFkLHZlbCxhbHRBY2Mpe3RoaXMubGF0aXR1ZGU9bGF0O3RoaXMubG9uZ2l0dWRlPWxuZzt0aGlzLmFsdGl0dWRlPWFsdDt0aGlzLmFjY3VyYWN5PWFjYzt0aGlzLmhlYWRpbmc9aGVhZDt0aGlzLnNwZWVkPXZlbDt0aGlzLmFsdGl0dWRlQWNjdXJhY3k9KGFsdEFjYyE9InVuZGVmaW5lZCIpP2FsdEFjYzpudWxsfTtDb29yZGluYXRlcy5wcm90b3R5cGUuY2xvbmU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IENvb3JkaW5hdGVzKHRoaXMubGF0aXR1ZGUsdGhpcy5sb25naXR1ZGUsdGhpcy5hbHRpdHVkZSx0aGlzLmFjY3VyYWN5LHRoaXMuaGVhZGluZyx0aGlzLnNwZWVkLHRoaXMuYWx0aXR1ZGVBY2N1cmFjeSl9O0Nvb3JkaW5hdGVzLmNsb25lRnJvbT1mdW5jdGlvbihvYmope3JldHVybiBuZXcgQ29vcmRpbmF0ZXMob2JqLmxhdGl0dWRlLG9iai5sb25naXR1ZGUsb2JqLmFsdGl0dWRlLG9iai5hY2N1cmFjeSxvYmouaGVhZGluZyxvYmouc3BlZWQsb2JqLmFsdGl0dWRlQWNjdXJhY3kpfTtQb3NpdGlvbk9wdGlvbnM9ZnVuY3Rpb24oZW5hYmxlSGlnaEFjY3VyYWN5LHRpbWVvdXQsbWF4aW11bUFnZSl7dGhpcy5lbmFibGVIaWdoQWNjdXJhY3k9ZW5hYmxlSGlnaEFjY3VyYWN5fHxmYWxzZTt0aGlzLnRpbWVvdXQ9dGltZW91dHx8MTAwMDA7dGhpcy5tYXhpbXVtQWdlPW1heGltdW1BZ2V8fDB9O1Bvc2l0aW9uRXJyb3I9ZnVuY3Rpb24oY29kZSxtZXNzYWdlKXt0aGlzLmNvZGU9Y29kZXx8MDt0aGlzLm1lc3NhZ2U9bWVzc2FnZXx8IiJ9O1Bvc2l0aW9uRXJyb3IuVU5LTk9XTl9FUlJPUj0wO1Bvc2l0aW9uRXJyb3IuUEVSTUlTU0lPTl9ERU5JRUQ9MTtQb3NpdGlvbkVycm9yLlBPU0lUSU9OX1VOQVZBSUxBQkxFPTI7UG9zaXRpb25FcnJvci5USU1FT1VUPTN9aWYoIVBob25lR2FwLmhhc1Jlc291cmNlKCJhY2NlbGVyYXRpb24iKSl7UGhvbmVHYXAuYWRkUmVzb3VyY2UoImFjY2VsZXJhdGlvbiIpO0FjY2VsZXJhdGlvbj1mdW5jdGlvbih4LHkseil7dGhpcy54PXg7dGhpcy55PXk7dGhpcy56PXo7dGhpcy50aW1lc3RhbXA9bmV3IERhdGUoKS5nZXRUaW1lKCl9O0FjY2VsZXJhdGlvbk9wdGlvbnM9ZnVuY3Rpb24oKXt0aGlzLnRpbWVvdXQ9MTAwMDB9fWlmKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiYWNjZWxlcm9tZXRlciIpKXtQaG9uZUdhcC5hZGRSZXNvdXJjZSgiYWNjZWxlcm9tZXRlciIpO0FjY2VsZXJvbWV0ZXI9ZnVuY3Rpb24oKXt0aGlzLmxhc3RBY2NlbGVyYXRpb249bmV3IEFjY2VsZXJhdGlvbigwLDAsMCl9O0FjY2VsZXJvbWV0ZXIucHJvdG90eXBlLmdldEN1cnJlbnRBY2NlbGVyYXRpb249ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssb3B0aW9ucyl7aWYodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjaz09ImZ1bmN0aW9uIil7c3VjY2Vzc0NhbGxiYWNrKHRoaXMubGFzdEFjY2VsZXJhdGlvbil9fTtBY2NlbGVyb21ldGVyLnByb3RvdHlwZS5fb25BY2NlbFVwZGF0ZT1mdW5jdGlvbih4LHkseil7dGhpcy5sYXN0QWNjZWxlcmF0aW9uPW5ldyBBY2NlbGVyYXRpb24oeCx5LHopfTtBY2NlbGVyb21ldGVyLnByb3RvdHlwZS53YXRjaEFjY2VsZXJhdGlvbj1mdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayxvcHRpb25zKXt2YXIgZnJlcXVlbmN5PShvcHRpb25zIT11bmRlZmluZWQmJm9wdGlvbnMuZnJlcXVlbmN5IT11bmRlZmluZWQpP29wdGlvbnMuZnJlcXVlbmN5OjEwMDAwO3ZhciB1cGRhdGVkT3B0aW9ucz17ZGVzaXJlZEZyZXF1ZW5jeTpmcmVxdWVuY3l9O1Bob25lR2FwLmV4ZWMoIkFjY2VsZXJvbWV0ZXIuc3RhcnQiLG9wdGlvbnMpO3JldHVybiBzZXRJbnRlcnZhbChmdW5jdGlvbigpe25hdmlnYXRvci5hY2NlbGVyb21ldGVyLmdldEN1cnJlbnRBY2NlbGVyYXRpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssb3B0aW9ucyl9LGZyZXF1ZW5jeSl9O0FjY2VsZXJvbWV0ZXIucHJvdG90eXBlLmNsZWFyV2F0Y2g9ZnVuY3Rpb24od2F0Y2hJZCl7UGhvbmVHYXAuZXhlYygiQWNjZWxlcm9tZXRlci5zdG9wIik7Y2xlYXJJbnRlcnZhbCh3YXRjaElkKX07UGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKXtpZih0eXBlb2YgbmF2aWdhdG9yLmFjY2VsZXJvbWV0ZXI9PSJ1bmRlZmluZWQiKXtuYXZpZ2F0b3IuYWNjZWxlcm9tZXRlcj1uZXcgQWNjZWxlcm9tZXRlcigpfX0pfWlmKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiY2FtZXJhIikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJjYW1lcmEiKTtDYXB0dXJlRXJyb3I9ZnVuY3Rpb24oKXt0aGlzLmNvZGU9bnVsbH07Q2FwdHVyZUVycm9yLkNBUFRVUkVfSU5URVJOQUxfRVJSPTA7Q2FwdHVyZUVycm9yLkNBUFRVUkVfQVBQTElDQVRJT05fQlVTWT0xO0NhcHR1cmVFcnJvci5DQVBUVVJFX0lOVkFMSURfQVJHVU1FTlQ9MjtDYXB0dXJlRXJyb3IuQ0FQVFVSRV9OT19NRURJQV9GSUxFUz0zO0NhbWVyYT1mdW5jdGlvbigpe307Q2FtZXJhLkRlc3RpbmF0aW9uVHlwZT17REFUQV9VUkw6MCxGSUxFX1VSSToxfTtDYW1lcmEucHJvdG90eXBlLkRlc3RpbmF0aW9uVHlwZT1DYW1lcmEuRGVzdGluYXRpb25UeXBlO0NhbWVyYS5QaWN0dXJlU291cmNlVHlwZT17UEhPVE9MSUJSQVJZOjAsQ0FNRVJBOjEsU0FWRURQSE9UT0FMQlVNOjJ9O0NhbWVyYS5wcm90b3R5cGUuUGljdHVyZVNvdXJjZVR5cGU9Q2FtZXJhLlBpY3R1cmVTb3VyY2VUeXBlO0NhbWVyYS5wcm90b3R5cGUuZ2V0UGljdHVyZT1mdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayxvcHRpb25zKXtpZih0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrIT0iZnVuY3Rpb24iKXtjb25zb2xlLmxvZygiQ2FtZXJhIEVycm9yOiBzdWNjZXNzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTtyZXR1cm59aWYoZXJyb3JDYWxsYmFjayYmKHR5cGVvZiBlcnJvckNhbGxiYWNrIT0iZnVuY3Rpb24iKSl7Y29uc29sZS5sb2coIkNhbWVyYSBFcnJvcjogZXJyb3JDYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiIpO3JldHVybn1QaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJDYW1lcmEiLCJnZXRQaWN0dXJlIixbb3B0aW9uc10pfTtQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpe2lmKHR5cGVvZiBuYXZpZ2F0b3IuY2FtZXJhPT0idW5kZWZpbmVkIil7bmF2aWdhdG9yLmNhbWVyYT1uZXcgQ2FtZXJhKCl9fSl9aWYoIVBob25lR2FwLmhhc1Jlc291cmNlKCJjb250YWN0Iikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJjb250YWN0Iik7dmFyIENvbnRhY3Q9ZnVuY3Rpb24oaWQsZGlzcGxheU5hbWUsbmFtZSxuaWNrbmFtZSxwaG9uZU51bWJlcnMsZW1haWxzLGFkZHJlc3NlcyxpbXMsb3JnYW5pemF0aW9ucyxyZXZpc2lvbixiaXJ0aGRheSxnZW5kZXIsbm90ZSxwaG90b3MsY2F0ZWdvcmllcyx1cmxzLHRpbWV6b25lKXt0aGlzLmlkPWlkfHxudWxsO3RoaXMuZGlzcGxheU5hbWU9ZGlzcGxheU5hbWV8fG51bGw7dGhpcy5uYW1lPW5hbWV8fG51bGw7dGhpcy5uaWNrbmFtZT1uaWNrbmFtZXx8bnVsbDt0aGlzLnBob25lTnVtYmVycz1waG9uZU51bWJlcnN8fG51bGw7dGhpcy5lbWFpbHM9ZW1haWxzfHxudWxsO3RoaXMuYWRkcmVzc2VzPWFkZHJlc3Nlc3x8bnVsbDt0aGlzLmltcz1pbXN8fG51bGw7dGhpcy5vcmdhbml6YXRpb25zPW9yZ2FuaXphdGlvbnN8fG51bGw7dGhpcy5yZXZpc2lvbj1yZXZpc2lvbnx8bnVsbDt0aGlzLmJpcnRoZGF5PWJpcnRoZGF5fHxudWxsO3RoaXMuZ2VuZGVyPWdlbmRlcnx8bnVsbDt0aGlzLm5vdGU9bm90ZXx8bnVsbDt0aGlzLnBob3Rvcz1waG90b3N8fG51bGw7dGhpcy5jYXRlZ29yaWVzPWNhdGVnb3JpZXN8fG51bGw7dGhpcy51cmxzPXVybHN8fG51bGw7dGhpcy50aW1lem9uZT10aW1lem9uZXx8bnVsbH07Q29udGFjdC5wcm90b3R5cGUuY29udmVydERhdGVzT3V0PWZ1bmN0aW9uKCl7dmFyIGRhdGVzPW5ldyBBcnJheSgicmV2aXNpb24iLCJiaXJ0aGRheSIpO2Zvcih2YXIgaT0wO2k8ZGF0ZXMubGVuZ3RoO2krKyl7dmFyIHZhbHVlPXRoaXNbZGF0ZXNbaV1dO2lmKHZhbHVlKXtpZighdmFsdWUgaW5zdGFuY2VvZiBEYXRlKXt0cnl7dmFsdWU9bmV3IERhdGUodmFsdWUpfWNhdGNoKGV4Y2VwdGlvbil7dmFsdWU9bnVsbH19aWYodmFsdWUgaW5zdGFuY2VvZiBEYXRlKXt2YWx1ZT12YWx1ZS52YWx1ZU9mKCl9dGhpc1tkYXRlc1tpXV09dmFsdWV9fX07Q29udGFjdC5wcm90b3R5cGUuY29udmVydERhdGVzSW49ZnVuY3Rpb24oKXt2YXIgZGF0ZXM9bmV3IEFycmF5KCJyZXZpc2lvbiIsImJpcnRoZGF5Iik7Zm9yKHZhciBpPTA7aTxkYXRlcy5sZW5ndGg7aSsrKXt2YXIgdmFsdWU9dGhpc1tkYXRlc1tpXV07aWYodmFsdWUpe3RyeXt0aGlzW2RhdGVzW2ldXT1uZXcgRGF0ZShwYXJzZUZsb2F0KHZhbHVlKSl9Y2F0Y2goZXhjZXB0aW9uKXtjb25zb2xlLmxvZygiZXhjZXB0aW9uIGNyZWF0aW5nIGRhdGUiKX19fX07Q29udGFjdC5wcm90b3R5cGUucmVtb3ZlPWZ1bmN0aW9uKHN1Y2Nlc3NDQixlcnJvckNCKXtpZih0aGlzLmlkPT1udWxsKXt2YXIgZXJyb3JPYmo9bmV3IENvbnRhY3RFcnJvcigpO2Vycm9yT2JqLmNvZGU9Q29udGFjdEVycm9yLk5PVF9GT1VORF9FUlJPUjtlcnJvckNCKGVycm9yT2JqKX1lbHNle1Bob25lR2FwLmV4ZWMoc3VjY2Vzc0NCLGVycm9yQ0IsIkNvbnRhY3RzIiwicmVtb3ZlIixbe2NvbnRhY3Q6dGhpc31dKX19O0NvbnRhY3QucHJvdG90eXBlLmRpc3BsYXk9ZnVuY3Rpb24oc3VjY2Vzc0NCLGVycm9yQ0Isb3B0aW9ucyl7aWYodGhpcy5pZD09bnVsbCl7dmFyIGVycm9yT2JqPW5ldyBDb250YWN0RXJyb3IoKTtlcnJvck9iai5jb2RlPUNvbnRhY3RFcnJvci5OT1RfRk9VTkRfRVJST1I7ZXJyb3JDQihlcnJvck9iail9ZWxzZXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDQixlcnJvckNCLCJDb250YWN0cyIsImRpc3BsYXlDb250YWN0IixbdGhpcy5pZCxvcHRpb25zXSl9fTtDb250YWN0LnByb3RvdHlwZS5jbG9uZT1mdW5jdGlvbigpe3ZhciBjbG9uZWRDb250YWN0PVBob25lR2FwLmNsb25lKHRoaXMpO2Nsb25lZENvbnRhY3QuaWQ9bnVsbDtpZihjbG9uZWRDb250YWN0LnBob25lTnVtYmVycyl7Zm9yKGk9MDtpPGNsb25lZENvbnRhY3QucGhvbmVOdW1iZXJzLmxlbmd0aDtpKyspe2Nsb25lZENvbnRhY3QucGhvbmVOdW1iZXJzW2ldLmlkPW51bGx9fWlmKGNsb25lZENvbnRhY3QuZW1haWxzKXtmb3IoaT0wO2k8Y2xvbmVkQ29udGFjdC5lbWFpbHMubGVuZ3RoO2krKyl7Y2xvbmVkQ29udGFjdC5lbWFpbHNbaV0uaWQ9bnVsbH19aWYoY2xvbmVkQ29udGFjdC5hZGRyZXNzZXMpe2ZvcihpPTA7aTxjbG9uZWRDb250YWN0LmFkZHJlc3Nlcy5sZW5ndGg7aSsrKXtjbG9uZWRDb250YWN0LmFkZHJlc3Nlc1tpXS5pZD1udWxsfX1pZihjbG9uZWRDb250YWN0Lmltcyl7Zm9yKGk9MDtpPGNsb25lZENvbnRhY3QuaW1zLmxlbmd0aDtpKyspe2Nsb25lZENvbnRhY3QuaW1zW2ldLmlkPW51bGx9fWlmKGNsb25lZENvbnRhY3Qub3JnYW5pemF0aW9ucyl7Zm9yKGk9MDtpPGNsb25lZENvbnRhY3Qub3JnYW5pemF0aW9ucy5sZW5ndGg7aSsrKXtjbG9uZWRDb250YWN0Lm9yZ2FuaXphdGlvbnNbaV0uaWQ9bnVsbH19aWYoY2xvbmVkQ29udGFjdC5waG90b3Mpe2ZvcihpPTA7aTxjbG9uZWRDb250YWN0LnBob3Rvcy5sZW5ndGg7aSsrKXtjbG9uZWRDb250YWN0LnBob3Rvc1tpXS5pZD1udWxsfX1pZihjbG9uZWRDb250YWN0LnVybHMpe2ZvcihpPTA7aTxjbG9uZWRDb250YWN0LnVybHMubGVuZ3RoO2krKyl7Y2xvbmVkQ29udGFjdC51cmxzW2ldLmlkPW51bGx9fXJldHVybiBjbG9uZWRDb250YWN0fTtDb250YWN0LnByb3RvdHlwZS5zYXZlPWZ1bmN0aW9uKHN1Y2Nlc3NDQixlcnJvckNCKXt2YXIgY2xvbmVkPVBob25lR2FwLmNsb25lKHRoaXMpO2Nsb25lZC5jb252ZXJ0RGF0ZXNPdXQoKTtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDQixlcnJvckNCLCJDb250YWN0cyIsInNhdmUiLFt7Y29udGFjdDpjbG9uZWR9XSl9O3ZhciBDb250YWN0TmFtZT1mdW5jdGlvbihmb3JtYXR0ZWQsZmFtaWx5TmFtZSxnaXZlbk5hbWUsbWlkZGxlLHByZWZpeCxzdWZmaXgpe3RoaXMuZm9ybWF0dGVkPWZvcm1hdHRlZCE9InVuZGVmaW5lZCI/Zm9ybWF0dGVkOm51bGw7dGhpcy5mYW1pbHlOYW1lPWZhbWlseU5hbWUhPSJ1bmRlZmluZWQiP2ZhbWlseU5hbWU6bnVsbDt0aGlzLmdpdmVuTmFtZT1naXZlbk5hbWUhPSJ1bmRlZmluZWQiP2dpdmVuTmFtZTpudWxsO3RoaXMubWlkZGxlTmFtZT1taWRkbGUhPSJ1bmRlZmluZWQiP21pZGRsZTpudWxsO3RoaXMuaG9ub3JpZmljUHJlZml4PXByZWZpeCE9InVuZGVmaW5lZCI/cHJlZml4Om51bGw7dGhpcy5ob25vcmlmaWNTdWZmaXg9c3VmZml4IT0idW5kZWZpbmVkIj9zdWZmaXg6bnVsbH07dmFyIENvbnRhY3RGaWVsZD1mdW5jdGlvbih0eXBlLHZhbHVlLHByZWYsaWQpe3RoaXMudHlwZT10eXBlIT0idW5kZWZpbmVkIj90eXBlOm51bGw7dGhpcy52YWx1ZT12YWx1ZSE9InVuZGVmaW5lZCI/dmFsdWU6bnVsbDt0aGlzLnByZWY9cHJlZiE9InVuZGVmaW5lZCI/cHJlZjpudWxsO3RoaXMuaWQ9aWQhPSJ1bmRlZmluZWQiP2lkOm51bGx9O3ZhciBDb250YWN0QWRkcmVzcz1mdW5jdGlvbihmb3JtYXR0ZWQsc3RyZWV0QWRkcmVzcyxsb2NhbGl0eSxyZWdpb24scG9zdGFsQ29kZSxjb3VudHJ5LGlkKXt0aGlzLmZvcm1hdHRlZD1mb3JtYXR0ZWQhPSJ1bmRlZmluZWQiP2Zvcm1hdHRlZDpudWxsO3RoaXMuc3RyZWV0QWRkcmVzcz1zdHJlZXRBZGRyZXNzIT0idW5kZWZpbmVkIj9zdHJlZXRBZGRyZXNzOm51bGw7dGhpcy5sb2NhbGl0eT1sb2NhbGl0eSE9InVuZGVmaW5lZCI/bG9jYWxpdHk6bnVsbDt0aGlzLnJlZ2lvbj1yZWdpb24hPSJ1bmRlZmluZWQiP3JlZ2lvbjpudWxsO3RoaXMucG9zdGFsQ29kZT1wb3N0YWxDb2RlIT0idW5kZWZpbmVkIj9wb3N0YWxDb2RlOm51bGw7dGhpcy5jb3VudHJ5PWNvdW50cnkhPSJ1bmRlZmluZWQiP2NvdW50cnk6bnVsbDt0aGlzLmlkPWlkIT0idW5kZWZpbmVkIj9pZDpudWxsfTt2YXIgQ29udGFjdE9yZ2FuaXphdGlvbj1mdW5jdGlvbihuYW1lLGRlcHQsdGl0bGUsc3RhcnREYXRlLGVuZERhdGUsbG9jYXRpb24sZGVzYyl7dGhpcy5uYW1lPW5hbWUhPSJ1bmRlZmluZWQiP25hbWU6bnVsbDt0aGlzLmRlcGFydG1lbnQ9ZGVwdCE9InVuZGVmaW5lZCI/ZGVwdDpudWxsO3RoaXMudGl0bGU9dGl0bGUhPSJ1bmRlZmluZWQiP3RpdGxlOm51bGw7dGhpcy5zdGFydERhdGU9c3RhcnREYXRlIT0idW5kZWZpbmVkIj9zdGFydERhdGU6bnVsbDt0aGlzLmVuZERhdGU9ZW5kRGF0ZSE9InVuZGVmaW5lZCI/ZW5kRGF0ZTpudWxsO3RoaXMubG9jYXRpb249bG9jYXRpb24hPSJ1bmRlZmluZWQiP2xvY2F0aW9uOm51bGw7dGhpcy5kZXNjcmlwdGlvbj1kZXNjIT0idW5kZWZpbmVkIj9kZXNjOm51bGx9O3ZhciBDb250YWN0QWNjb3VudD1mdW5jdGlvbihkb21haW4sdXNlcm5hbWUsdXNlcmlkKXt0aGlzLmRvbWFpbj1kb21haW4hPSJ1bmRlZmluZWQiP2RvbWFpbjpudWxsO3RoaXMudXNlcm5hbWU9dXNlcm5hbWUhPSJ1bmRlZmluZWQiP3VzZXJuYW1lOm51bGw7dGhpcy51c2VyaWQ9dXNlcmlkIT0idW5kZWZpbmVkIj91c2VyaWQ6bnVsbH07dmFyIENvbnRhY3RzPWZ1bmN0aW9uKCl7dGhpcy5pblByb2dyZXNzPWZhbHNlO3RoaXMucmVjb3Jkcz1uZXcgQXJyYXkoKTt0aGlzLnJlc3VsdHNDYWxsYmFjaz1udWxsO3RoaXMuZXJyb3JDYWxsYmFjaz1udWxsfTtDb250YWN0cy5wcm90b3R5cGUuZmluZD1mdW5jdGlvbihmaWVsZHMsc3VjY2Vzc0NCLGVycm9yQ0Isb3B0aW9ucyl7dmFyIHRoZU9wdGlvbnM9b3B0aW9uc3x8bnVsbDtpZih0aGVPcHRpb25zIT1udWxsKXt2YXIgdmFsdWU9dGhlT3B0aW9ucy51cGRhdGVkU2luY2U7aWYodmFsdWUhPSIiKXtpZighdmFsdWUgaW5zdGFuY2VvZiBEYXRlKXt0cnl7dmFsdWU9bmV3IERhdGUodmFsdWUpfWNhdGNoKGV4Y2VwdGlvbil7dmFsdWU9bnVsbH19aWYodmFsdWUgaW5zdGFuY2VvZiBEYXRlKXt0aGVPcHRpb25zLnVwZGF0ZWRTaW5jZT12YWx1ZS52YWx1ZU9mKCl9fX1QaG9uZUdhcC5leGVjKHN1Y2Nlc3NDQixlcnJvckNCLCJDb250YWN0cyIsInNlYXJjaCIsW3tmaWVsZHM6ZmllbGRzLGZpbmRPcHRpb25zOnRoZU9wdGlvbnN9XSl9O0NvbnRhY3RzLnByb3RvdHlwZS5fZmluZENhbGxiYWNrPWZ1bmN0aW9uKHBsdWdpblJlc3VsdCl7dmFyIGNvbnRhY3RzPW5ldyBBcnJheSgpO3RyeXtmb3IodmFyIGk9MDtpPHBsdWdpblJlc3VsdC5tZXNzYWdlLmxlbmd0aDtpKyspe3ZhciBuZXdDb250YWN0PW5hdmlnYXRvci5zZXJ2aWNlLmNvbnRhY3RzLmNyZWF0ZShwbHVnaW5SZXN1bHQubWVzc2FnZVtpXSk7bmV3Q29udGFjdC5jb252ZXJ0RGF0ZXNJbigpO2NvbnRhY3RzLnB1c2gobmV3Q29udGFjdCl9cGx1Z2luUmVzdWx0Lm1lc3NhZ2U9Y29udGFjdHN9Y2F0Y2goZSl7Y29uc29sZS5sb2coIkVycm9yIHBhcnNpbmcgY29udGFjdHM6ICIrZSl9cmV0dXJuIHBsdWdpblJlc3VsdH07Q29udGFjdHMucHJvdG90eXBlLl9jb250YWN0Q2FsbGJhY2s9ZnVuY3Rpb24ocGx1Z2luUmVzdWx0KXt2YXIgbmV3Q29udGFjdD1udWxsO2lmKHBsdWdpblJlc3VsdC5tZXNzYWdlKXt0cnl7bmV3Q29udGFjdD1uYXZpZ2F0b3Iuc2VydmljZS5jb250YWN0cy5jcmVhdGUocGx1Z2luUmVzdWx0Lm1lc3NhZ2UpO25ld0NvbnRhY3QuY29udmVydERhdGVzSW4oKX1jYXRjaChlKXtjb25zb2xlLmxvZygiRXJyb3IgcGFyc2luZyBjb250YWN0Iil9fXBsdWdpblJlc3VsdC5tZXNzYWdlPW5ld0NvbnRhY3Q7cmV0dXJuIHBsdWdpblJlc3VsdH07Q29udGFjdHMucHJvdG90eXBlLl9lcnJDYWxsYmFjaz1mdW5jdGlvbihwbHVnaW5SZXN1bHQpe3ZhciBlcnJvck9iaj1uZXcgQ29udGFjdEVycm9yKCk7ZXJyb3JPYmouY29kZT1wbHVnaW5SZXN1bHQubWVzc2FnZTtwbHVnaW5SZXN1bHQubWVzc2FnZT1lcnJvck9iajtyZXR1cm4gcGx1Z2luUmVzdWx0fTtDb250YWN0cy5wcm90b3R5cGUubmV3Q29udGFjdFVJPWZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssbnVsbCwiQ29udGFjdHMiLCJuZXdDb250YWN0IixbXSl9O0NvbnRhY3RzLnByb3RvdHlwZS5jaG9vc2VDb250YWN0PWZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjayxvcHRpb25zKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxudWxsLCJDb250YWN0cyIsImNob29zZUNvbnRhY3QiLG9wdGlvbnMpfTtDb250YWN0cy5wcm90b3R5cGUuY3JlYXRlPWZ1bmN0aW9uKHByb3BlcnRpZXMpe3ZhciBjb250YWN0PW5ldyBDb250YWN0KCk7Zm9yKGkgaW4gcHJvcGVydGllcyl7aWYoY29udGFjdFtpXSE9InVuZGVmaW5lZCIpe2NvbnRhY3RbaV09cHJvcGVydGllc1tpXX19cmV0dXJuIGNvbnRhY3R9O3ZhciBDb250YWN0RmluZE9wdGlvbnM9ZnVuY3Rpb24oZmlsdGVyLG11bHRpcGxlLHVwZGF0ZWRTaW5jZSl7dGhpcy5maWx0ZXI9ZmlsdGVyfHwiIjt0aGlzLm11bHRpcGxlPW11bHRpcGxlfHx0cnVlO3RoaXMudXBkYXRlZFNpbmNlPXVwZGF0ZWRTaW5jZXx8IiJ9O3ZhciBDb250YWN0RXJyb3I9ZnVuY3Rpb24oKXt0aGlzLmNvZGU9bnVsbH07Q29udGFjdEVycm9yLlVOS05PV05fRVJST1I9MDtDb250YWN0RXJyb3IuSU5WQUxJRF9BUkdVTUVOVF9FUlJPUj0xO0NvbnRhY3RFcnJvci5OT1RfRk9VTkRfRVJST1I9MjtDb250YWN0RXJyb3IuVElNRU9VVF9FUlJPUj0zO0NvbnRhY3RFcnJvci5QRU5ESU5HX09QRVJBVElPTl9FUlJPUj00O0NvbnRhY3RFcnJvci5JT19FUlJPUj01O0NvbnRhY3RFcnJvci5OT1RfU1VQUE9SVEVEX0VSUk9SPTY7Q29udGFjdEVycm9yLlBFUk1JU1NJT05fREVOSUVEX0VSUk9SPTIwO1Bob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCl7aWYodHlwZW9mIG5hdmlnYXRvci5zZXJ2aWNlPT0idW5kZWZpbmVkIil7bmF2aWdhdG9yLnNlcnZpY2U9bmV3IE9iamVjdCgpfWlmKHR5cGVvZiBuYXZpZ2F0b3Iuc2VydmljZS5jb250YWN0cz09InVuZGVmaW5lZCIpe25hdmlnYXRvci5zZXJ2aWNlLmNvbnRhY3RzPW5ldyBDb250YWN0cygpfX0pfWlmKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiZGV2aWNlIikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJkZXZpY2UiKTtEZXZpY2U9ZnVuY3Rpb24oKXt0aGlzLnBsYXRmb3JtPW51bGw7dGhpcy52ZXJzaW9uPW51bGw7dGhpcy5uYW1lPW51bGw7dGhpcy5waG9uZWdhcD1udWxsO3RoaXMudXVpZD1udWxsO3RyeXt0aGlzLnBsYXRmb3JtPURldmljZUluZm8ucGxhdGZvcm07dGhpcy52ZXJzaW9uPURldmljZUluZm8udmVyc2lvbjt0aGlzLm5hbWU9RGV2aWNlSW5mby5uYW1lO3RoaXMucGhvbmVnYXA9RGV2aWNlSW5mby5nYXA7dGhpcy51dWlkPURldmljZUluZm8udXVpZH1jYXRjaChlKXt9dGhpcy5hdmFpbGFibGU9UGhvbmVHYXAuYXZhaWxhYmxlPXRoaXMudXVpZCE9bnVsbH07UGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKXtuYXZpZ2F0b3IuZGV2aWNlPXdpbmRvdy5kZXZpY2U9bmV3IERldmljZSgpfSl9aWYoIVBob25lR2FwLmhhc1Jlc291cmNlKCJmaWxlIikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJmaWxlIik7RmlsZVByb3BlcnRpZXM9ZnVuY3Rpb24oZmlsZVBhdGgpe3RoaXMuZmlsZVBhdGg9ZmlsZVBhdGg7dGhpcy5zaXplPTA7dGhpcy5sYXN0TW9kaWZpZWREYXRlPW51bGx9O0ZpbGU9ZnVuY3Rpb24obmFtZSxmdWxsUGF0aCx0eXBlLGxhc3RNb2RpZmllZERhdGUsc2l6ZSl7dGhpcy5uYW1lPW5hbWV8fG51bGw7dGhpcy5mdWxsUGF0aD1mdWxsUGF0aHx8bnVsbDt0aGlzLnR5cGU9dHlwZXx8bnVsbDt0aGlzLmxhc3RNb2RpZmllZERhdGU9bGFzdE1vZGlmaWVkRGF0ZXx8bnVsbDt0aGlzLnNpemU9c2l6ZXx8MH07RmlsZS5fY3JlYXRlRXZlbnQ9ZnVuY3Rpb24odHlwZSx0YXJnZXQpe3ZhciBldnQ9e3R5cGU6dHlwZX07ZXZ0LnRhcmdldD10YXJnZXQ7cmV0dXJuIGV2dH07RmlsZUVycm9yPWZ1bmN0aW9uKCl7dGhpcy5jb2RlPW51bGx9O0ZpbGVFcnJvci5OT1RfRk9VTkRfRVJSPTE7RmlsZUVycm9yLlNFQ1VSSVRZX0VSUj0yO0ZpbGVFcnJvci5BQk9SVF9FUlI9MztGaWxlRXJyb3IuTk9UX1JFQURBQkxFX0VSUj00O0ZpbGVFcnJvci5FTkNPRElOR19FUlI9NTtGaWxlRXJyb3IuTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSPTY7RmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSPTc7RmlsZUVycm9yLlNZTlRBWF9FUlI9ODtGaWxlRXJyb3IuSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSPTk7RmlsZUVycm9yLlFVT1RBX0VYQ0VFREVEX0VSUj0xMDtGaWxlRXJyb3IuVFlQRV9NSVNNQVRDSF9FUlI9MTE7RmlsZUVycm9yLlBBVEhfRVhJU1RTX0VSUj0xMjtGaWxlTWdyPWZ1bmN0aW9uKCl7fTtGaWxlTWdyLnByb3RvdHlwZS50ZXN0RmlsZUV4aXN0cz1mdW5jdGlvbihmaWxlTmFtZSxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsInRlc3RGaWxlRXhpc3RzIixbZmlsZU5hbWVdKX07RmlsZU1nci5wcm90b3R5cGUudGVzdERpcmVjdG9yeUV4aXN0cz1mdW5jdGlvbihkaXJOYW1lLHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJGaWxlIiwidGVzdERpcmVjdG9yeUV4aXN0cyIsW2Rpck5hbWVdKX07RmlsZU1nci5wcm90b3R5cGUuZ2V0RnJlZURpc2tTcGFjZT1mdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsImdldEZyZWVEaXNrU3BhY2UiLFtdKX07RmlsZU1nci5wcm90b3R5cGUud3JpdGVBc1RleHQ9ZnVuY3Rpb24oZmlsZU5hbWUsZGF0YSxiQXBwZW5kLHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJGaWxlIiwid3JpdGUiLFtmaWxlTmFtZSxkYXRhLGJBcHBlbmQ/MTowXSl9O0ZpbGVNZ3IucHJvdG90eXBlLndyaXRlPWZ1bmN0aW9uKGZpbGVOYW1lLGRhdGEscG9zaXRpb24sc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe1Bob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssIkZpbGUiLCJ3cml0ZSIsW2ZpbGVOYW1lLGRhdGEscG9zaXRpb25dKX07RmlsZU1nci5wcm90b3R5cGUudHJ1bmNhdGU9ZnVuY3Rpb24oZmlsZU5hbWUsc2l6ZSxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsInRydW5jYXRlRmlsZSIsW2ZpbGVOYW1lLHNpemVdKX07RmlsZU1nci5wcm90b3R5cGUucmVhZEFzVGV4dD1mdW5jdGlvbihmaWxlTmFtZSxlbmNvZGluZyxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsInJlYWRGaWxlIixbZmlsZU5hbWUsZW5jb2RpbmddKX07RmlsZU1nci5wcm90b3R5cGUucmVhZEFzRGF0YVVSTD1mdW5jdGlvbihmaWxlTmFtZSxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsInJlYWRBc0RhdGFVUkwiLFtmaWxlTmFtZV0pfTtQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpe2lmKHR5cGVvZiBuYXZpZ2F0b3IuZmlsZU1ncj09PSJ1bmRlZmluZWQiKXtuYXZpZ2F0b3IuZmlsZU1ncj1uZXcgRmlsZU1ncigpfX0pO0ZpbGVSZWFkZXI9ZnVuY3Rpb24oKXt0aGlzLmZpbGVOYW1lPSIiO3RoaXMucmVhZHlTdGF0ZT0wO3RoaXMucmVzdWx0PW51bGw7dGhpcy5lcnJvcj1udWxsO3RoaXMub25sb2Fkc3RhcnQ9bnVsbDt0aGlzLm9ucHJvZ3Jlc3M9bnVsbDt0aGlzLm9ubG9hZD1udWxsO3RoaXMub25lcnJvcj1udWxsO3RoaXMub25sb2FkZW5kPW51bGw7dGhpcy5vbmFib3J0PW51bGx9O0ZpbGVSZWFkZXIuRU1QVFk9MDtGaWxlUmVhZGVyLkxPQURJTkc9MTtGaWxlUmVhZGVyLkRPTkU9MjtGaWxlUmVhZGVyLnByb3RvdHlwZS5hYm9ydD1mdW5jdGlvbigpe3ZhciBldnQ7dGhpcy5yZWFkeVN0YXRlPUZpbGVSZWFkZXIuRE9ORTt0aGlzLnJlc3VsdD1udWxsO3ZhciBlcnJvcj1uZXcgRmlsZUVycm9yKCk7ZXJyb3IuY29kZT1lcnJvci5BQk9SVF9FUlI7dGhpcy5lcnJvcj1lcnJvcjtpZih0eXBlb2YgdGhpcy5vbmVycm9yPT09ImZ1bmN0aW9uIil7ZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJlcnJvciIsdGhpcyk7dGhpcy5vbmVycm9yKGV2dCl9aWYodHlwZW9mIHRoaXMub25hYm9ydD09PSJmdW5jdGlvbiIpe2V2dD1GaWxlLl9jcmVhdGVFdmVudCgiYWJvcnQiLHRoaXMpO3RoaXMub25hYm9ydChldnQpfWlmKHR5cGVvZiB0aGlzLm9ubG9hZGVuZD09PSJmdW5jdGlvbiIpe2V2dD1GaWxlLl9jcmVhdGVFdmVudCgibG9hZGVuZCIsdGhpcyk7dGhpcy5vbmxvYWRlbmQoZXZ0KX19O0ZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc1RleHQ9ZnVuY3Rpb24oZmlsZSxlbmNvZGluZyl7dGhpcy5maWxlTmFtZT0iIjtpZih0eXBlb2YgZmlsZS5mdWxsUGF0aD09PSJ1bmRlZmluZWQiKXt0aGlzLmZpbGVOYW1lPWZpbGV9ZWxzZXt0aGlzLmZpbGVOYW1lPWZpbGUuZnVsbFBhdGh9dGhpcy5yZWFkeVN0YXRlPUZpbGVSZWFkZXIuTE9BRElORztpZih0eXBlb2YgdGhpcy5vbmxvYWRzdGFydD09PSJmdW5jdGlvbiIpe3ZhciBldnQ9RmlsZS5fY3JlYXRlRXZlbnQoImxvYWRzdGFydCIsdGhpcyk7dGhpcy5vbmxvYWRzdGFydChldnQpfXZhciBlbmM9ZW5jb2Rpbmc/ZW5jb2Rpbmc6IlVURi04Ijt2YXIgbWU9dGhpcztuYXZpZ2F0b3IuZmlsZU1nci5yZWFkQXNUZXh0KHRoaXMuZmlsZU5hbWUsZW5jLGZ1bmN0aW9uKHIpe3ZhciBldnQ7aWYobWUucmVhZHlTdGF0ZT09PUZpbGVSZWFkZXIuRE9ORSl7cmV0dXJufW1lLnJlc3VsdD1kZWNvZGVVUklDb21wb25lbnQocik7aWYodHlwZW9mIG1lLm9ubG9hZD09PSJmdW5jdGlvbiIpe2V2dD1GaWxlLl9jcmVhdGVFdmVudCgibG9hZCIsbWUpO21lLm9ubG9hZChldnQpfW1lLnJlYWR5U3RhdGU9RmlsZVJlYWRlci5ET05FO2lmKHR5cGVvZiBtZS5vbmxvYWRlbmQ9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoImxvYWRlbmQiLG1lKTttZS5vbmxvYWRlbmQoZXZ0KX19LGZ1bmN0aW9uKGUpe3ZhciBldnQ7aWYobWUucmVhZHlTdGF0ZT09PUZpbGVSZWFkZXIuRE9ORSl7cmV0dXJufW1lLmVycm9yPWU7aWYodHlwZW9mIG1lLm9uZXJyb3I9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoImVycm9yIixtZSk7bWUub25lcnJvcihldnQpfW1lLnJlYWR5U3RhdGU9RmlsZVJlYWRlci5ET05FO2lmKHR5cGVvZiBtZS5vbmxvYWRlbmQ9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoImxvYWRlbmQiLG1lKTttZS5vbmxvYWRlbmQoZXZ0KX19KX07RmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzRGF0YVVSTD1mdW5jdGlvbihmaWxlKXt0aGlzLmZpbGVOYW1lPSIiO2lmKHR5cGVvZiBmaWxlLmZ1bGxQYXRoPT09InVuZGVmaW5lZCIpe3RoaXMuZmlsZU5hbWU9ZmlsZX1lbHNle3RoaXMuZmlsZU5hbWU9ZmlsZS5mdWxsUGF0aH10aGlzLnJlYWR5U3RhdGU9RmlsZVJlYWRlci5MT0FESU5HO2lmKHR5cGVvZiB0aGlzLm9ubG9hZHN0YXJ0PT09ImZ1bmN0aW9uIil7dmFyIGV2dD1GaWxlLl9jcmVhdGVFdmVudCgibG9hZHN0YXJ0Iix0aGlzKTt0aGlzLm9ubG9hZHN0YXJ0KGV2dCl9dmFyIG1lPXRoaXM7bmF2aWdhdG9yLmZpbGVNZ3IucmVhZEFzRGF0YVVSTCh0aGlzLmZpbGVOYW1lLGZ1bmN0aW9uKHIpe3ZhciBldnQ7aWYobWUucmVhZHlTdGF0ZT09PUZpbGVSZWFkZXIuRE9ORSl7cmV0dXJufW1lLnJlc3VsdD1yO2lmKHR5cGVvZiBtZS5vbmxvYWQ9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoImxvYWQiLG1lKTttZS5vbmxvYWQoZXZ0KX1tZS5yZWFkeVN0YXRlPUZpbGVSZWFkZXIuRE9ORTtpZih0eXBlb2YgbWUub25sb2FkZW5kPT09ImZ1bmN0aW9uIil7ZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJsb2FkZW5kIixtZSk7bWUub25sb2FkZW5kKGV2dCl9fSxmdW5jdGlvbihlKXt2YXIgZXZ0O2lmKG1lLnJlYWR5U3RhdGU9PT1GaWxlUmVhZGVyLkRPTkUpe3JldHVybn1tZS5lcnJvcj1lO2lmKHR5cGVvZiBtZS5vbmVycm9yPT09ImZ1bmN0aW9uIil7ZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJlcnJvciIsbWUpO21lLm9uZXJyb3IoZXZ0KX1tZS5yZWFkeVN0YXRlPUZpbGVSZWFkZXIuRE9ORTtpZih0eXBlb2YgbWUub25sb2FkZW5kPT09ImZ1bmN0aW9uIil7ZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJsb2FkZW5kIixtZSk7bWUub25sb2FkZW5kKGV2dCl9fSl9O0ZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0JpbmFyeVN0cmluZz1mdW5jdGlvbihmaWxlKXt0aGlzLmZpbGVOYW1lPWZpbGV9O0ZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0FycmF5QnVmZmVyPWZ1bmN0aW9uKGZpbGUpe3RoaXMuZmlsZU5hbWU9ZmlsZX07RmlsZVdyaXRlcj1mdW5jdGlvbihmaWxlKXt0aGlzLmZpbGVOYW1lPSIiO3RoaXMubGVuZ3RoPTA7aWYoZmlsZSl7dGhpcy5maWxlTmFtZT1maWxlLmZ1bGxQYXRofHxmaWxlO3RoaXMubGVuZ3RoPWZpbGUuc2l6ZXx8MH10aGlzLnBvc2l0aW9uPTA7dGhpcy5yZWFkeVN0YXRlPTA7dGhpcy5yZXN1bHQ9bnVsbDt0aGlzLmVycm9yPW51bGw7dGhpcy5vbndyaXRlc3RhcnQ9bnVsbDt0aGlzLm9ucHJvZ3Jlc3M9bnVsbDt0aGlzLm9ud3JpdGU9bnVsbDt0aGlzLm9ud3JpdGVlbmQ9bnVsbDt0aGlzLm9uYWJvcnQ9bnVsbDt0aGlzLm9uZXJyb3I9bnVsbH07RmlsZVdyaXRlci5JTklUPTA7RmlsZVdyaXRlci5XUklUSU5HPTE7RmlsZVdyaXRlci5ET05FPTI7RmlsZVdyaXRlci5wcm90b3R5cGUuYWJvcnQ9ZnVuY3Rpb24oKXtpZih0aGlzLnJlYWR5U3RhdGU9PT1GaWxlV3JpdGVyLkRPTkV8fHRoaXMucmVhZHlTdGF0ZT09PUZpbGVXcml0ZXIuSU5JVCl7dGhyb3cgRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSfXZhciBlcnJvcj1uZXcgRmlsZUVycm9yKCksZXZ0O2Vycm9yLmNvZGU9ZXJyb3IuQUJPUlRfRVJSO3RoaXMuZXJyb3I9ZXJyb3I7aWYodHlwZW9mIHRoaXMub25lcnJvcj09PSJmdW5jdGlvbiIpe2V2dD1GaWxlLl9jcmVhdGVFdmVudCgiZXJyb3IiLHRoaXMpO3RoaXMub25lcnJvcihldnQpfWlmKHR5cGVvZiB0aGlzLm9uYWJvcnQ9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoImFib3J0Iix0aGlzKTt0aGlzLm9uYWJvcnQoZXZ0KX10aGlzLnJlYWR5U3RhdGU9RmlsZVdyaXRlci5ET05FO2lmKHR5cGVvZiB0aGlzLm9ud3JpdGVlbmQ9PSJmdW5jdGlvbiIpe2V2dD1GaWxlLl9jcmVhdGVFdmVudCgid3JpdGVlbmQiLHRoaXMpO3RoaXMub253cml0ZWVuZChldnQpfX07RmlsZVdyaXRlci5wcm90b3R5cGUud3JpdGVBc1RleHQ9ZnVuY3Rpb24oZmlsZSx0ZXh0LGJBcHBlbmQpe2lmKHRoaXMucmVhZHlTdGF0ZT09PUZpbGVXcml0ZXIuV1JJVElORyl7dGhyb3cgRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSfWlmKGJBcHBlbmQhPT10cnVlKXtiQXBwZW5kPWZhbHNlfXRoaXMuZmlsZU5hbWU9ZmlsZTt0aGlzLnJlYWR5U3RhdGU9RmlsZVdyaXRlci5XUklUSU5HO3ZhciBtZT10aGlzO2lmKHR5cGVvZiBtZS5vbndyaXRlc3RhcnQ9PT0iZnVuY3Rpb24iKXt2YXIgZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZXN0YXJ0IixtZSk7bWUub253cml0ZXN0YXJ0KGV2dCl9bmF2aWdhdG9yLmZpbGVNZ3Iud3JpdGVBc1RleHQoZmlsZSx0ZXh0LGJBcHBlbmQsZnVuY3Rpb24ocil7dmFyIGV2dDtpZihtZS5yZWFkeVN0YXRlPT09RmlsZVdyaXRlci5ET05FKXtyZXR1cm59bWUucmVzdWx0PXI7aWYodHlwZW9mIG1lLm9ud3JpdGU9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlIixtZSk7bWUub253cml0ZShldnQpfW1lLnJlYWR5U3RhdGU9RmlsZVdyaXRlci5ET05FO2lmKHR5cGVvZiBtZS5vbndyaXRlZW5kPT09ImZ1bmN0aW9uIil7ZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsbWUpO21lLm9ud3JpdGVlbmQoZXZ0KX19LGZ1bmN0aW9uKGUpe3ZhciBldnQ7aWYobWUucmVhZHlTdGF0ZT09PUZpbGVXcml0ZXIuRE9ORSl7cmV0dXJufW1lLmVycm9yPWU7aWYodHlwZW9mIG1lLm9uZXJyb3I9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoImVycm9yIixtZSk7bWUub25lcnJvcihldnQpfW1lLnJlYWR5U3RhdGU9RmlsZVdyaXRlci5ET05FO2lmKHR5cGVvZiBtZS5vbndyaXRlZW5kPT09ImZ1bmN0aW9uIil7ZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsbWUpO21lLm9ud3JpdGVlbmQoZXZ0KX19KX07RmlsZVdyaXRlci5wcm90b3R5cGUud3JpdGU9ZnVuY3Rpb24odGV4dCl7aWYodGhpcy5yZWFkeVN0YXRlPT09RmlsZVdyaXRlci5XUklUSU5HKXt0aHJvdyBGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlJ9dGhpcy5yZWFkeVN0YXRlPUZpbGVXcml0ZXIuV1JJVElORzt2YXIgbWU9dGhpcztpZih0eXBlb2YgbWUub253cml0ZXN0YXJ0PT09ImZ1bmN0aW9uIil7dmFyIGV2dD1GaWxlLl9jcmVhdGVFdmVudCgid3JpdGVzdGFydCIsbWUpO21lLm9ud3JpdGVzdGFydChldnQpfW5hdmlnYXRvci5maWxlTWdyLndyaXRlKHRoaXMuZmlsZU5hbWUsdGV4dCx0aGlzLnBvc2l0aW9uLGZ1bmN0aW9uKHIpe3ZhciBldnQ7aWYobWUucmVhZHlTdGF0ZT09PUZpbGVXcml0ZXIuRE9ORSl7cmV0dXJufW1lLnBvc2l0aW9uKz1yO21lLmxlbmd0aD1tZS5wb3NpdGlvbjtpZih0eXBlb2YgbWUub253cml0ZT09PSJmdW5jdGlvbiIpe2V2dD1GaWxlLl9jcmVhdGVFdmVudCgid3JpdGUiLG1lKTttZS5vbndyaXRlKGV2dCl9bWUucmVhZHlTdGF0ZT1GaWxlV3JpdGVyLkRPTkU7aWYodHlwZW9mIG1lLm9ud3JpdGVlbmQ9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlZW5kIixtZSk7bWUub253cml0ZWVuZChldnQpfX0sZnVuY3Rpb24oZSl7dmFyIGV2dDtpZihtZS5yZWFkeVN0YXRlPT09RmlsZVdyaXRlci5ET05FKXtyZXR1cm59bWUuZXJyb3I9ZTtpZih0eXBlb2YgbWUub25lcnJvcj09PSJmdW5jdGlvbiIpe2V2dD1GaWxlLl9jcmVhdGVFdmVudCgiZXJyb3IiLG1lKTttZS5vbmVycm9yKGV2dCl9bWUucmVhZHlTdGF0ZT1GaWxlV3JpdGVyLkRPTkU7aWYodHlwZW9mIG1lLm9ud3JpdGVlbmQ9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlZW5kIixtZSk7bWUub253cml0ZWVuZChldnQpfX0pfTtGaWxlV3JpdGVyLnByb3RvdHlwZS5zZWVrPWZ1bmN0aW9uKG9mZnNldCl7aWYodGhpcy5yZWFkeVN0YXRlPT09RmlsZVdyaXRlci5XUklUSU5HKXt0aHJvdyBGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlJ9aWYoIW9mZnNldCl7cmV0dXJufWlmKG9mZnNldDwwKXt0aGlzLnBvc2l0aW9uPU1hdGgubWF4KG9mZnNldCt0aGlzLmxlbmd0aCwwKX1lbHNle2lmKG9mZnNldD50aGlzLmxlbmd0aCl7dGhpcy5wb3NpdGlvbj10aGlzLmxlbmd0aH1lbHNle3RoaXMucG9zaXRpb249b2Zmc2V0fX19O0ZpbGVXcml0ZXIucHJvdG90eXBlLnRydW5jYXRlPWZ1bmN0aW9uKHNpemUpe2lmKHRoaXMucmVhZHlTdGF0ZT09PUZpbGVXcml0ZXIuV1JJVElORyl7dGhyb3cgRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSfXRoaXMucmVhZHlTdGF0ZT1GaWxlV3JpdGVyLldSSVRJTkc7dmFyIG1lPXRoaXM7aWYodHlwZW9mIG1lLm9ud3JpdGVzdGFydD09PSJmdW5jdGlvbiIpe3ZhciBldnQ9RmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlc3RhcnQiLG1lKTttZS5vbndyaXRlc3RhcnQoZXZ0KX1uYXZpZ2F0b3IuZmlsZU1nci50cnVuY2F0ZSh0aGlzLmZpbGVOYW1lLHNpemUsZnVuY3Rpb24ocil7dmFyIGV2dDtpZihtZS5yZWFkeVN0YXRlPT09RmlsZVdyaXRlci5ET05FKXtyZXR1cm59bWUubGVuZ3RoPXI7bWUucG9zaXRpb249TWF0aC5taW4obWUucG9zaXRpb24scik7aWYodHlwZW9mIG1lLm9ud3JpdGU9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlIixtZSk7bWUub253cml0ZShldnQpfW1lLnJlYWR5U3RhdGU9RmlsZVdyaXRlci5ET05FO2lmKHR5cGVvZiBtZS5vbndyaXRlZW5kPT09ImZ1bmN0aW9uIil7ZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsbWUpO21lLm9ud3JpdGVlbmQoZXZ0KX19LGZ1bmN0aW9uKGUpe3ZhciBldnQ7aWYobWUucmVhZHlTdGF0ZT09PUZpbGVXcml0ZXIuRE9ORSl7cmV0dXJufW1lLmVycm9yPWU7aWYodHlwZW9mIG1lLm9uZXJyb3I9PT0iZnVuY3Rpb24iKXtldnQ9RmlsZS5fY3JlYXRlRXZlbnQoImVycm9yIixtZSk7bWUub25lcnJvcihldnQpfW1lLnJlYWR5U3RhdGU9RmlsZVdyaXRlci5ET05FO2lmKHR5cGVvZiBtZS5vbndyaXRlZW5kPT09ImZ1bmN0aW9uIil7ZXZ0PUZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsbWUpO21lLm9ud3JpdGVlbmQoZXZ0KX19KX07TG9jYWxGaWxlU3lzdGVtPWZ1bmN0aW9uKCl7fTtMb2NhbEZpbGVTeXN0ZW0uVEVNUE9SQVJZPTA7TG9jYWxGaWxlU3lzdGVtLlBFUlNJU1RFTlQ9MTtMb2NhbEZpbGVTeXN0ZW0uUkVTT1VSQ0U9MjtMb2NhbEZpbGVTeXN0ZW0uQVBQTElDQVRJT049MztMb2NhbEZpbGVTeXN0ZW0ucHJvdG90eXBlLnJlcXVlc3RGaWxlU3lzdGVtPWZ1bmN0aW9uKHR5cGUsc2l6ZSxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7aWYodHlwZTwwfHx0eXBlPjMpe2lmKHR5cGVvZiBlcnJvckNhbGxiYWNrPT0iZnVuY3Rpb24iKXtlcnJvckNhbGxiYWNrKHtjb2RlOkZpbGVFcnJvci5TWU5UQVhfRVJSfSl9fWVsc2V7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsInJlcXVlc3RGaWxlU3lzdGVtIixbdHlwZSxzaXplXSl9fTtMb2NhbEZpbGVTeXN0ZW0ucHJvdG90eXBlLnJlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkk9ZnVuY3Rpb24odXJpLHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJGaWxlIiwicmVzb2x2ZUxvY2FsRmlsZVN5c3RlbVVSSSIsW3VyaV0pfTtMb2NhbEZpbGVTeXN0ZW0ucHJvdG90eXBlLl9jYXN0RlM9ZnVuY3Rpb24ocGx1Z2luUmVzdWx0KXt2YXIgZW50cnk9bnVsbDtlbnRyeT1uZXcgRGlyZWN0b3J5RW50cnkoKTtlbnRyeS5pc0RpcmVjdG9yeT1wbHVnaW5SZXN1bHQubWVzc2FnZS5yb290LmlzRGlyZWN0b3J5O2VudHJ5LmlzRmlsZT1wbHVnaW5SZXN1bHQubWVzc2FnZS5yb290LmlzRmlsZTtlbnRyeS5uYW1lPXBsdWdpblJlc3VsdC5tZXNzYWdlLnJvb3QubmFtZTtlbnRyeS5mdWxsUGF0aD1wbHVnaW5SZXN1bHQubWVzc2FnZS5yb290LmZ1bGxQYXRoO3BsdWdpblJlc3VsdC5tZXNzYWdlLnJvb3Q9ZW50cnk7cmV0dXJuIHBsdWdpblJlc3VsdH07TG9jYWxGaWxlU3lzdGVtLnByb3RvdHlwZS5fY2FzdEVudHJ5PWZ1bmN0aW9uKHBsdWdpblJlc3VsdCl7dmFyIGVudHJ5PW51bGw7aWYocGx1Z2luUmVzdWx0Lm1lc3NhZ2UuaXNEaXJlY3Rvcnkpe2VudHJ5PW5ldyBEaXJlY3RvcnlFbnRyeSgpfWVsc2V7aWYocGx1Z2luUmVzdWx0Lm1lc3NhZ2UuaXNGaWxlKXtlbnRyeT1uZXcgRmlsZUVudHJ5KCl9fWVudHJ5LmlzRGlyZWN0b3J5PXBsdWdpblJlc3VsdC5tZXNzYWdlLmlzRGlyZWN0b3J5O2VudHJ5LmlzRmlsZT1wbHVnaW5SZXN1bHQubWVzc2FnZS5pc0ZpbGU7ZW50cnkubmFtZT1wbHVnaW5SZXN1bHQubWVzc2FnZS5uYW1lO2VudHJ5LmZ1bGxQYXRoPXBsdWdpblJlc3VsdC5tZXNzYWdlLmZ1bGxQYXRoO3BsdWdpblJlc3VsdC5tZXNzYWdlPWVudHJ5O3JldHVybiBwbHVnaW5SZXN1bHR9O0xvY2FsRmlsZVN5c3RlbS5wcm90b3R5cGUuX2Nhc3RFbnRyaWVzPWZ1bmN0aW9uKHBsdWdpblJlc3VsdCl7dmFyIGVudHJpZXM9cGx1Z2luUmVzdWx0Lm1lc3NhZ2U7dmFyIHJldFZhbD1bXTtmb3IoaT0wO2k8ZW50cmllcy5sZW5ndGg7aSsrKXtyZXRWYWwucHVzaCh3aW5kb3cubG9jYWxGaWxlU3lzdGVtLl9jcmVhdGVFbnRyeShlbnRyaWVzW2ldKSl9cGx1Z2luUmVzdWx0Lm1lc3NhZ2U9cmV0VmFsO3JldHVybiBwbHVnaW5SZXN1bHR9O0xvY2FsRmlsZVN5c3RlbS5wcm90b3R5cGUuX2NyZWF0ZUVudHJ5PWZ1bmN0aW9uKGNhc3RNZSl7dmFyIGVudHJ5PW51bGw7aWYoY2FzdE1lLmlzRGlyZWN0b3J5KXtlbnRyeT1uZXcgRGlyZWN0b3J5RW50cnkoKX1lbHNle2lmKGNhc3RNZS5pc0ZpbGUpe2VudHJ5PW5ldyBGaWxlRW50cnkoKX19ZW50cnkuaXNEaXJlY3Rvcnk9Y2FzdE1lLmlzRGlyZWN0b3J5O2VudHJ5LmlzRmlsZT1jYXN0TWUuaXNGaWxlO2VudHJ5Lm5hbWU9Y2FzdE1lLm5hbWU7ZW50cnkuZnVsbFBhdGg9Y2FzdE1lLmZ1bGxQYXRoO3JldHVybiBlbnRyeX07TG9jYWxGaWxlU3lzdGVtLnByb3RvdHlwZS5fY2FzdERhdGU9ZnVuY3Rpb24ocGx1Z2luUmVzdWx0KXtpZihwbHVnaW5SZXN1bHQubWVzc2FnZS5tb2RpZmljYXRpb25UaW1lKXt2YXIgbWV0YWRhdGFPYmo9bmV3IE1ldGFkYXRhKCk7bWV0YWRhdGFPYmoubW9kaWZpY2F0aW9uVGltZT1uZXcgRGF0ZShwbHVnaW5SZXN1bHQubWVzc2FnZS5tb2RpZmljYXRpb25UaW1lKTtwbHVnaW5SZXN1bHQubWVzc2FnZT1tZXRhZGF0YU9ian1lbHNle2lmKHBsdWdpblJlc3VsdC5tZXNzYWdlLmxhc3RNb2RpZmllZERhdGUpe3ZhciBmaWxlPW5ldyBGaWxlKCk7ZmlsZS5zaXplPXBsdWdpblJlc3VsdC5tZXNzYWdlLnNpemU7ZmlsZS50eXBlPXBsdWdpblJlc3VsdC5tZXNzYWdlLnR5cGU7ZmlsZS5uYW1lPXBsdWdpblJlc3VsdC5tZXNzYWdlLm5hbWU7ZmlsZS5mdWxsUGF0aD1wbHVnaW5SZXN1bHQubWVzc2FnZS5mdWxsUGF0aDtmaWxlLmxhc3RNb2RpZmVkRGF0ZT1uZXcgRGF0ZShwbHVnaW5SZXN1bHQubWVzc2FnZS5sYXN0TW9kaWZpZWREYXRlKTtwbHVnaW5SZXN1bHQubWVzc2FnZT1maWxlfX1yZXR1cm4gcGx1Z2luUmVzdWx0fTtMb2NhbEZpbGVTeXN0ZW0ucHJvdG90eXBlLl9jYXN0RXJyb3I9ZnVuY3Rpb24ocGx1Z2luUmVzdWx0KXt2YXIgZmlsZUVycm9yPW5ldyBGaWxlRXJyb3IoKTtmaWxlRXJyb3IuY29kZT1wbHVnaW5SZXN1bHQubWVzc2FnZTtwbHVnaW5SZXN1bHQubWVzc2FnZT1maWxlRXJyb3I7cmV0dXJuIHBsdWdpblJlc3VsdH07TWV0YWRhdGE9ZnVuY3Rpb24oKXt0aGlzLm1vZGlmaWNhdGlvblRpbWU9bnVsbH07RmxhZ3M9ZnVuY3Rpb24oY3JlYXRlLGV4Y2x1c2l2ZSl7dGhpcy5jcmVhdGU9Y3JlYXRlfHxmYWxzZTt0aGlzLmV4Y2x1c2l2ZT1leGNsdXNpdmV8fGZhbHNlfTtGaWxlU3lzdGVtPWZ1bmN0aW9uKCl7dGhpcy5uYW1lPW51bGw7dGhpcy5yb290PW51bGx9O0RpcmVjdG9yeUVudHJ5PWZ1bmN0aW9uKCl7dGhpcy5pc0ZpbGU9ZmFsc2U7dGhpcy5pc0RpcmVjdG9yeT10cnVlO3RoaXMubmFtZT1udWxsO3RoaXMuZnVsbFBhdGg9bnVsbDt0aGlzLmZpbGVzeXN0ZW09bnVsbH07RGlyZWN0b3J5RW50cnkucHJvdG90eXBlLmNvcHlUbz1mdW5jdGlvbihwYXJlbnQsbmV3TmFtZSxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsImNvcHlUbyIsW3RoaXMuZnVsbFBhdGgscGFyZW50LG5ld05hbWVdKX07RGlyZWN0b3J5RW50cnkucHJvdG90eXBlLmdldE1ldGFkYXRhPWZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJGaWxlIiwiZ2V0TWV0YWRhdGEiLFt0aGlzLmZ1bGxQYXRoXSl9O0RpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5nZXRQYXJlbnQ9ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe1Bob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssIkZpbGUiLCJnZXRQYXJlbnQiLFt0aGlzLmZ1bGxQYXRoXSl9O0RpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5tb3ZlVG89ZnVuY3Rpb24ocGFyZW50LG5ld05hbWUsc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe1Bob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssIkZpbGUiLCJtb3ZlVG8iLFt0aGlzLmZ1bGxQYXRoLHBhcmVudCxuZXdOYW1lXSl9O0RpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5yZW1vdmU9ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe1Bob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssIkZpbGUiLCJyZW1vdmUiLFt0aGlzLmZ1bGxQYXRoXSl9O0RpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS50b1VSST1mdW5jdGlvbihtaW1lVHlwZSxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7cmV0dXJuImZpbGU6Ly9sb2NhbGhvc3QiK3RoaXMuZnVsbFBhdGh9O0RpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5jcmVhdGVSZWFkZXI9ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe3JldHVybiBuZXcgRGlyZWN0b3J5UmVhZGVyKHRoaXMuZnVsbFBhdGgpfTtEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUuZ2V0RGlyZWN0b3J5PWZ1bmN0aW9uKHBhdGgsb3B0aW9ucyxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsImdldERpcmVjdG9yeSIsW3RoaXMuZnVsbFBhdGgscGF0aCxvcHRpb25zXSl9O0RpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5nZXRGaWxlPWZ1bmN0aW9uKHBhdGgsb3B0aW9ucyxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsImdldEZpbGUiLFt0aGlzLmZ1bGxQYXRoLHBhdGgsb3B0aW9uc10pfTtEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUucmVtb3ZlUmVjdXJzaXZlbHk9ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe1Bob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssIkZpbGUiLCJyZW1vdmVSZWN1cnNpdmVseSIsW3RoaXMuZnVsbFBhdGhdKX07RGlyZWN0b3J5UmVhZGVyPWZ1bmN0aW9uKGZ1bGxQYXRoKXt0aGlzLmZ1bGxQYXRoPWZ1bGxQYXRofHxudWxsfTtEaXJlY3RvcnlSZWFkZXIucHJvdG90eXBlLnJlYWRFbnRyaWVzPWZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJGaWxlIiwicmVhZEVudHJpZXMiLFt0aGlzLmZ1bGxQYXRoXSl9O0ZpbGVFbnRyeT1mdW5jdGlvbigpe3RoaXMuaXNGaWxlPXRydWU7dGhpcy5pc0RpcmVjdG9yeT1mYWxzZTt0aGlzLm5hbWU9bnVsbDt0aGlzLmZ1bGxQYXRoPW51bGw7dGhpcy5maWxlc3lzdGVtPW51bGx9O0ZpbGVFbnRyeS5wcm90b3R5cGUuY29weVRvPWZ1bmN0aW9uKHBhcmVudCxuZXdOYW1lLHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJGaWxlIiwiY29weVRvIixbdGhpcy5mdWxsUGF0aCxwYXJlbnQsbmV3TmFtZV0pfTtGaWxlRW50cnkucHJvdG90eXBlLmdldE1ldGFkYXRhPWZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJGaWxlIiwiZ2V0TWV0YWRhdGEiLFt0aGlzLmZ1bGxQYXRoXSl9O0ZpbGVFbnRyeS5wcm90b3R5cGUuZ2V0UGFyZW50PWZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrKXtQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLCJGaWxlIiwiZ2V0UGFyZW50IixbdGhpcy5mdWxsUGF0aF0pfTtGaWxlRW50cnkucHJvdG90eXBlLm1vdmVUbz1mdW5jdGlvbihwYXJlbnQsbmV3TmFtZSxzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZSIsIm1vdmVUbyIsW3RoaXMuZnVsbFBhdGgscGFyZW50LG5ld05hbWVdKX07RmlsZUVudHJ5LnByb3RvdHlwZS5yZW1vdmU9ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe1Bob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssIkZpbGUiLCJyZW1vdmUiLFt0aGlzLmZ1bGxQYXRoXSl9O0ZpbGVFbnRyeS5wcm90b3R5cGUudG9VUkk9ZnVuY3Rpb24obWltZVR5cGUsc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe3JldHVybiJmaWxlOi8vbG9jYWxob3N0Iit0aGlzLmZ1bGxQYXRofTtGaWxlRW50cnkucHJvdG90eXBlLmNyZWF0ZVdyaXRlcj1mdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7dGhpcy5maWxlKGZ1bmN0aW9uKGZpbGVQb2ludGVyKXt2YXIgd3JpdGVyPW5ldyBGaWxlV3JpdGVyKGZpbGVQb2ludGVyKTtpZih3cml0ZXIuZmlsZU5hbWU9PW51bGx8fHdyaXRlci5maWxlTmFtZT09IiIpe2lmKHR5cGVvZiBlcnJvckNhbGxiYWNrPT0iZnVuY3Rpb24iKXtlcnJvckNhbGxiYWNrKHtjb2RlOkZpbGVFcnJvci5JTlZBTElEX1NUQVRFX0VSUn0pfX1pZih0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrPT0iZnVuY3Rpb24iKXtzdWNjZXNzQ2FsbGJhY2sod3JpdGVyKX19LGVycm9yQ2FsbGJhY2spfTtGaWxlRW50cnkucHJvdG90eXBlLmZpbGU9ZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spe1Bob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssIkZpbGUiLCJnZXRGaWxlTWV0YWRhdGEiLFt0aGlzLmZ1bGxQYXRoXSl9O1Bob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCl7dmFyIHBnTG9jYWxGaWxlU3lzdGVtPW5ldyBMb2NhbEZpbGVTeXN0ZW0oKTtpZih0eXBlb2Ygd2luZG93LmxvY2FsRmlsZVN5c3RlbT09InVuZGVmaW5lZCIpe3dpbmRvdy5sb2NhbEZpbGVTeXN0ZW09cGdMb2NhbEZpbGVTeXN0ZW19aWYodHlwZW9mIHdpbmRvdy5yZXF1ZXN0RmlsZVN5c3RlbT09InVuZGVmaW5lZCIpe3dpbmRvdy5yZXF1ZXN0RmlsZVN5c3RlbT1wZ0xvY2FsRmlsZVN5c3RlbS5yZXF1ZXN0RmlsZVN5c3RlbX1pZih0eXBlb2Ygd2luZG93LnJlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkk9PSJ1bmRlZmluZWQiKXt3aW5kb3cucmVzb2x2ZUxvY2FsRmlsZVN5c3RlbVVSST1wZ0xvY2FsRmlsZVN5c3RlbS5yZXNvbHZlTG9jYWxGaWxlU3lzdGVtVVJJfX0pfWlmKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiZmlsZXRyYW5zZmVyIikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJmaWxldHJhbnNmZXIiKTtGaWxlVHJhbnNmZXI9ZnVuY3Rpb24oKXt9O0ZpbGVVcGxvYWRSZXN1bHQ9ZnVuY3Rpb24oKXt0aGlzLmJ5dGVzU2VudD0wO3RoaXMucmVzcG9uc2VDb2RlPW51bGw7dGhpcy5yZXNwb25zZT1udWxsfTtGaWxlVHJhbnNmZXJFcnJvcj1mdW5jdGlvbihlcnJvckNvZGUpe3RoaXMuY29kZT1lcnJvckNvZGV8fG51bGx9O0ZpbGVUcmFuc2ZlckVycm9yLkZJTEVfTk9UX0ZPVU5EX0VSUj0xO0ZpbGVUcmFuc2ZlckVycm9yLklOVkFMSURfVVJMX0VSUj0yO0ZpbGVUcmFuc2ZlckVycm9yLkNPTk5FQ1RJT05fRVJSPTM7RmlsZVRyYW5zZmVyLnByb3RvdHlwZS51cGxvYWQ9ZnVuY3Rpb24oZmlsZVBhdGgsc2VydmVyLHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLG9wdGlvbnMpe2lmKCFvcHRpb25zLnBhcmFtcyl7b3B0aW9ucy5wYXJhbXM9e319b3B0aW9ucy5maWxlUGF0aD1maWxlUGF0aDtvcHRpb25zLnNlcnZlcj1zZXJ2ZXI7aWYoIW9wdGlvbnMuZmlsZUtleSl7b3B0aW9ucy5maWxlS2V5PSJmaWxlIn1pZighb3B0aW9ucy5maWxlTmFtZSl7b3B0aW9ucy5maWxlTmFtZT0iaW1hZ2UuanBnIn1pZighb3B0aW9ucy5taW1lVHlwZSl7b3B0aW9ucy5taW1lVHlwZT0iaW1hZ2UvanBlZyJ9aWYodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayE9ImZ1bmN0aW9uIil7Y29uc29sZS5sb2coIkZpbGVUcmFuc2ZlciBFcnJvcjogc3VjY2Vzc0NhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7cmV0dXJufWlmKGVycm9yQ2FsbGJhY2smJih0eXBlb2YgZXJyb3JDYWxsYmFjayE9ImZ1bmN0aW9uIikpe2NvbnNvbGUubG9nKCJGaWxlVHJhbnNmZXIgRXJyb3I6IGVycm9yQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTtyZXR1cm59UGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjaywiRmlsZVRyYW5zZmVyIiwidXBsb2FkIixbb3B0aW9uc10pfTtGaWxlVHJhbnNmZXIucHJvdG90eXBlLl9jYXN0VHJhbnNmZXJFcnJvcj1mdW5jdGlvbihwbHVnaW5SZXN1bHQpe3ZhciBmaWxlRXJyb3I9bmV3IEZpbGVUcmFuc2ZlckVycm9yKHBsdWdpblJlc3VsdC5tZXNzYWdlKTtwbHVnaW5SZXN1bHQubWVzc2FnZT1maWxlRXJyb3I7cmV0dXJuIHBsdWdpblJlc3VsdH07RmlsZVRyYW5zZmVyLnByb3RvdHlwZS5fY2FzdFVwbG9hZFJlc3VsdD1mdW5jdGlvbihwbHVnaW5SZXN1bHQpe3ZhciByZXN1bHQ9bmV3IEZpbGVVcGxvYWRSZXN1bHQoKTtyZXN1bHQuYnl0ZXNTZW50PXBsdWdpblJlc3VsdC5tZXNzYWdlLmJ5dGVzU2VudDtyZXN1bHQucmVzcG9uc2VDb2RlPXBsdWdpblJlc3VsdC5tZXNzYWdlLnJlc3BvbnNlQ29kZTtyZXN1bHQucmVzcG9uc2U9ZGVjb2RlVVJJQ29tcG9uZW50KHBsdWdpblJlc3VsdC5tZXNzYWdlLnJlc3BvbnNlKTtwbHVnaW5SZXN1bHQubWVzc2FnZT1yZXN1bHQ7cmV0dXJuIHBsdWdpblJlc3VsdH07RmlsZVVwbG9hZE9wdGlvbnM9ZnVuY3Rpb24oZmlsZUtleSxmaWxlTmFtZSxtaW1lVHlwZSxwYXJhbXMpe3RoaXMuZmlsZUtleT1maWxlS2V5fHxudWxsO3RoaXMuZmlsZU5hbWU9ZmlsZU5hbWV8fG51bGw7dGhpcy5taW1lVHlwZT1taW1lVHlwZXx8bnVsbDt0aGlzLnBhcmFtcz1wYXJhbXN8fG51bGx9O1Bob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCl7aWYodHlwZW9mIG5hdmlnYXRvci5maWxlVHJhbnNmZXI9PSJ1bmRlZmluZWQiKXtuYXZpZ2F0b3IuZmlsZVRyYW5zZmVyPW5ldyBGaWxlVHJhbnNmZXIoKX19KX1pZighUGhvbmVHYXAuaGFzUmVzb3VyY2UoImdlb2xvY2F0aW9uIikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJnZW9sb2NhdGlvbiIpO0dlb2xvY2F0aW9uPWZ1bmN0aW9uKCl7dGhpcy5sYXN0UG9zaXRpb249bnVsbDt0aGlzLmxpc3RlbmVyPW51bGw7dGhpcy50aW1lb3V0VGltZXJJZD0wfTtHZW9sb2NhdGlvbi5wcm90b3R5cGUuZ2V0Q3VycmVudFBvc2l0aW9uPWZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLG9wdGlvbnMpe3ZhciB3aW49c3VjY2Vzc0NhbGxiYWNrO2lmKCF3aW58fHR5cGVvZih3aW4pIT0iZnVuY3Rpb24iKXt3aW49ZnVuY3Rpb24ocG9zaXRpb24pe319dmFyIGZhaWw9ZXJyb3JDYWxsYmFjaztpZighZmFpbHx8dHlwZW9mKGZhaWwpIT0iZnVuY3Rpb24iKXtmYWlsPWZ1bmN0aW9uKHBvc2l0aW9uRXJyb3Ipe319dmFyIHNlbGY9dGhpczt2YXIgdG90YWxUaW1lPTA7dmFyIHRpbWVvdXRUaW1lcklkO3ZhciBwYXJhbXM9bmV3IFBvc2l0aW9uT3B0aW9ucygpO2lmKG9wdGlvbnMpe2lmKG9wdGlvbnMubWF4aW11bUFnZSl7aWYodGhpcy5sYXN0UG9zaXRpb24pe3ZhciBub3c9bmV3IERhdGUoKS5nZXRUaW1lKCk7aWYobm93LXRoaXMubGFzdFBvc2l0aW9uLnRpbWVzdGFtcDxvcHRpb25zLm1heGltdW1BZ2Upe3dpbih0aGlzLmxhc3RQb3NpdGlvbik7cmV0dXJufX1wYXJhbXMubWF4aW11bUFnZT1vcHRpb25zLm1heGltdW1BZ2V9aWYob3B0aW9ucy5lbmFibGVIaWdoQWNjdXJhY3kpe3BhcmFtcy5lbmFibGVIaWdoQWNjdXJhY3k9KG9wdGlvbnMuZW5hYmxlSGlnaEFjY3VyYWN5PT10cnVlKX1pZihvcHRpb25zLnRpbWVvdXQpe3BhcmFtcy50aW1lb3V0PW9wdGlvbnMudGltZW91dH19dGhpcy5saXN0ZW5lcj17c3VjY2Vzczp3aW4sZmFpbDpmYWlsfTt0aGlzLnN0YXJ0KHBhcmFtcyk7dmFyIG9uVGltZW91dD1mdW5jdGlvbigpe3NlbGYuc2V0RXJyb3IobmV3IFBvc2l0aW9uRXJyb3IoUG9zaXRpb25FcnJvci5USU1FT1VULCJHZW9sb2NhdGlvbiBFcnJvcjogVGltZW91dC4iKSl9O3RoaXMudGltZW91dFRpbWVySWQ9c2V0VGltZW91dChvblRpbWVvdXQscGFyYW1zLnRpbWVvdXQpfTtHZW9sb2NhdGlvbi5wcm90b3R5cGUud2F0Y2hQb3NpdGlvbj1mdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayxvcHRpb25zKXt2YXIgc2VsZj10aGlzO3ZhciBwYXJhbXM9bmV3IFBvc2l0aW9uT3B0aW9ucygpO2lmKG9wdGlvbnMpe2lmKG9wdGlvbnMubWF4aW11bUFnZSl7cGFyYW1zLm1heGltdW1BZ2U9b3B0aW9ucy5tYXhpbXVtQWdlfWlmKG9wdGlvbnMuZW5hYmxlSGlnaEFjY3VyYWN5KXtwYXJhbXMuZW5hYmxlSGlnaEFjY3VyYWN5PW9wdGlvbnMuZW5hYmxlSGlnaEFjY3VyYWN5fWlmKG9wdGlvbnMudGltZW91dCl7cGFyYW1zLnRpbWVvdXQ9b3B0aW9ucy50aW1lb3V0fX12YXIgdGhhdD10aGlzO3ZhciBsYXN0UG9zPXRoYXQubGFzdFBvc2l0aW9uP3RoYXQubGFzdFBvc2l0aW9uLmNsb25lKCk6bnVsbDtyZXR1cm4gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXt2YXIgZmlsdGVyRnVuPWZ1bmN0aW9uKHBvc2l0aW9uKXtpZihsYXN0UG9zPT1udWxsfHwhcG9zaXRpb24uZXF1YWxzKGxhc3RQb3MpKXtzdWNjZXNzQ2FsbGJhY2socG9zaXRpb24pfWxhc3RQb3M9cG9zaXRpb24uY2xvbmUoKX07dGhhdC5nZXRDdXJyZW50UG9zaXRpb24oZmlsdGVyRnVuLGVycm9yQ2FsbGJhY2sscGFyYW1zKX0scGFyYW1zLnRpbWVvdXQpfTtHZW9sb2NhdGlvbi5wcm90b3R5cGUuY2xlYXJXYXRjaD1mdW5jdGlvbih3YXRjaElkKXtjbGVhckludGVydmFsKHdhdGNoSWQpfTtHZW9sb2NhdGlvbi5wcm90b3R5cGUuc2V0TG9jYXRpb249ZnVuY3Rpb24ocG9zaXRpb24pe3ZhciBfcG9zaXRpb249bmV3IFBvc2l0aW9uKHBvc2l0aW9uLmNvb3Jkcyxwb3NpdGlvbi50aW1lc3RhbXApO2lmKHRoaXMudGltZW91dFRpbWVySWQpe2NsZWFyVGltZW91dCh0aGlzLnRpbWVvdXRUaW1lcklkKTt0aGlzLnRpbWVvdXRUaW1lcklkPTB9dGhpcy5sYXN0RXJyb3I9bnVsbDt0aGlzLmxhc3RQb3NpdGlvbj1fcG9zaXRpb247aWYodGhpcy5saXN0ZW5lciYmdHlwZW9mKHRoaXMubGlzdGVuZXIuc3VjY2Vzcyk9PSJmdW5jdGlvbiIpe3RoaXMubGlzdGVuZXIuc3VjY2VzcyhfcG9zaXRpb24pfXRoaXMubGlzdGVuZXI9bnVsbH07R2VvbG9jYXRpb24ucHJvdG90eXBlLnNldEVycm9yPWZ1bmN0aW9uKGVycm9yKXt2YXIgX2Vycm9yPW5ldyBQb3NpdGlvbkVycm9yKGVycm9yLmNvZGUsZXJyb3IubWVzc2FnZSk7aWYodGhpcy50aW1lb3V0VGltZXJJZCl7Y2xlYXJUaW1lb3V0KHRoaXMudGltZW91dFRpbWVySWQpO3RoaXMudGltZW91dFRpbWVySWQ9MH10aGlzLmxhc3RFcnJvcj1fZXJyb3I7aWYodGhpcy5saXN0ZW5lciYmdHlwZW9mKHRoaXMubGlzdGVuZXIuZmFpbCk9PSJmdW5jdGlvbiIpe3RoaXMubGlzdGVuZXIuZmFpbChfZXJyb3IpfXRoaXMubGlzdGVuZXI9bnVsbH07R2VvbG9jYXRpb24ucHJvdG90eXBlLnN0YXJ0PWZ1bmN0aW9uKGFyZ3Mpe1Bob25lR2FwLmV4ZWMoIkxvY2F0aW9uLnN0YXJ0TG9jYXRpb24iLGFyZ3MpfTtHZW9sb2NhdGlvbi5wcm90b3R5cGUuc3RvcD1mdW5jdGlvbigpe1Bob25lR2FwLmV4ZWMoIkxvY2F0aW9uLnN0b3BMb2NhdGlvbiIpfTtQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpe2lmKHR5cGVvZiBuYXZpZ2F0b3IuX2dlbz09InVuZGVmaW5lZCIpe3ZhciBfX3Byb3h5T2JqPWZ1bmN0aW9uKG9yaWdPYmoscHJveHlPYmosZnVua0xpc3Qpe3ZhciByZXBsYWNlRnVuaz1mdW5jdGlvbihvcmcscHJveHksZk5hbWUpe29yZ1tmTmFtZV09ZnVuY3Rpb24oKXtyZXR1cm4gcHJveHlbZk5hbWVdLmFwcGx5KHByb3h5LGFyZ3VtZW50cyl9fTtmb3IodmFyIHYgaW4gZnVua0xpc3Qpe3JlcGxhY2VGdW5rKG9yaWdPYmoscHJveHlPYmosZnVua0xpc3Rbdl0pfX07bmF2aWdhdG9yLl9nZW89bmV3IEdlb2xvY2F0aW9uKCk7X19wcm94eU9iaihuYXZpZ2F0b3IuZ2VvbG9jYXRpb24sbmF2aWdhdG9yLl9nZW8sWyJzZXRMb2NhdGlvbiIsImdldEN1cnJlbnRQb3NpdGlvbiIsIndhdGNoUG9zaXRpb24iLCJjbGVhcldhdGNoIiwic2V0RXJyb3IiLCJzdGFydCIsInN0b3AiXSl9fSl9aWYoIVBob25lR2FwLmhhc1Jlc291cmNlKCJjb21wYXNzIikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJjb21wYXNzIik7Q29tcGFzcz1mdW5jdGlvbigpe3RoaXMubGFzdEhlYWRpbmc9bnVsbDt0aGlzLmxhc3RFcnJvcj1udWxsO3RoaXMuY2FsbGJhY2tzPXtvbkhlYWRpbmdDaGFuZ2VkOltdLG9uRXJyb3I6W119fTtDb21wYXNzLnByb3RvdHlwZS5nZXRDdXJyZW50SGVhZGluZz1mdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayxvcHRpb25zKXtpZih0aGlzLmxhc3RIZWFkaW5nPT1udWxsKXt0aGlzLmNhbGxiYWNrcy5vbkhlYWRpbmdDaGFuZ2VkLnB1c2goc3VjY2Vzc0NhbGxiYWNrKTt0aGlzLmNhbGxiYWNrcy5vbkVycm9yLnB1c2goZXJyb3JDYWxsYmFjayk7dGhpcy5zdGFydChvcHRpb25zKX1lbHNle2lmKG9wdGlvbnMubWF4aW11bUFnZSl7dmFyIG5vdz1uZXcgRGF0ZSgpLmdldFRpbWUoKTtpZihub3ctdGhpcy5sYXN0SGVhZGluZy50aW1lc3RhbXA+b3B0aW9ucy5tYXhpbXVtQWdlKXt0aGlzLmNhbGxiYWNrcy5vbkhlYWRpbmdDaGFuZ2VkLnB1c2goc3VjY2Vzc0NhbGxiYWNrKTt0aGlzLmNhbGxiYWNrcy5vbkVycm9yLnB1c2goZXJyb3JDYWxsYmFjayk7dGhpcy5zdGFydChvcHRpb25zKTtyZXR1cm59fWlmKHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2s9PSJmdW5jdGlvbiIpe3ZhciByZXR1cm5IZWFkaW5nPS0xO2lmKHRoaXMubGFzdEhlYWRpbmcudHJ1ZUhlYWRpbmc+LTEpe3JldHVybkhlYWRpbmc9dGhpcy5sYXN0SGVhZGluZy50cnVlSGVhZGluZ31lbHNle2lmKHRoaXMubGFzdEhlYWRpbmcubWFnbmV0aWNIZWFkaW5nKXtyZXR1cm5IZWFkaW5nPXRoaXMubGFzdEhlYWRpbmcubWFnbmV0aWNIZWFkaW5nfX1zdWNjZXNzQ2FsbGJhY2socmV0dXJuSGVhZGluZyl9fX07Q29tcGFzcy5wcm90b3R5cGUud2F0Y2hIZWFkaW5nPWZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLG9wdGlvbnMpe3ZhciBmcmVxdWVuY3k9KG9wdGlvbnMmJm9wdGlvbnMuZnJlcXVlbmN5KT9vcHRpb25zLmZyZXF1ZW5jeToxMDAwO3ZhciBzZWxmPXRoaXM7dmFyIGZ1bms9ZnVuY3Rpb24oKXtzZWxmLmdldEN1cnJlbnRIZWFkaW5nKHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLG9wdGlvbnMpfTtmdW5rKCk7cmV0dXJuIHNldEludGVydmFsKGZ1bmssZnJlcXVlbmN5KX07Q29tcGFzcy5wcm90b3R5cGUuY2xlYXJXYXRjaD1mdW5jdGlvbih3YXRjaElkKXtjbGVhckludGVydmFsKHdhdGNoSWQpfTtDb21wYXNzLnByb3RvdHlwZS5zZXRIZWFkaW5nPWZ1bmN0aW9uKGhlYWRpbmcpe3RoaXMubGFzdEhlYWRpbmc9aGVhZGluZzt2YXIgcmV0dXJuSGVhZGluZz0tMTtpZih0aGlzLmxhc3RIZWFkaW5nLnRydWVIZWFkaW5nPi0xKXtyZXR1cm5IZWFkaW5nPXRoaXMubGFzdEhlYWRpbmcudHJ1ZUhlYWRpbmd9ZWxzZXtpZih0aGlzLmxhc3RIZWFkaW5nLm1hZ25ldGljSGVhZGluZyl7cmV0dXJuSGVhZGluZz10aGlzLmxhc3RIZWFkaW5nLm1hZ25ldGljSGVhZGluZ319dmFyIGFycj10aGlzLmNhbGxiYWNrcy5vbkhlYWRpbmdDaGFuZ2VkO2Zvcih2YXIgaT0wLGxlbj1hcnIubGVuZ3RoO2k8bGVuO2krKyl7YXJyW2ldKHJldHVybkhlYWRpbmcpfXRoaXMuY2FsbGJhY2tzLm9uSGVhZGluZ0NoYW5nZWQ9W107dGhpcy5jYWxsYmFja3Mub25FcnJvcj1bXX07Q29tcGFzcy5wcm90b3R5cGUuc2V0RXJyb3I9ZnVuY3Rpb24obWVzc2FnZSl7dGhpcy5sYXN0RXJyb3I9bWVzc2FnZTt2YXIgYXJyPXRoaXMuY2FsbGJhY2tzLm9uRXJyb3I7Zm9yKHZhciBpPTAsbGVuPWFyci5sZW5ndGg7aTxsZW47aSsrKXthcnJbaV0obWVzc2FnZSl9dGhpcy5jYWxsYmFja3Mub25IZWFkaW5nQ2hhbmdlZD1bXTt0aGlzLmNhbGxiYWNrcy5vbkVycm9yPVtdO3RoaXMuc3RvcCgpfTtDb21wYXNzLnByb3RvdHlwZS5zdGFydD1mdW5jdGlvbihhcmdzKXtQaG9uZUdhcC5leGVjKCJMb2NhdGlvbi5zdGFydEhlYWRpbmciLGFyZ3MpfTtDb21wYXNzLnByb3RvdHlwZS5zdG9wPWZ1bmN0aW9uKCl7UGhvbmVHYXAuZXhlYygiTG9jYXRpb24uc3RvcEhlYWRpbmciKX07UGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKXtpZih0eXBlb2YgbmF2aWdhdG9yLmNvbXBhc3M9PSJ1bmRlZmluZWQiKXtuYXZpZ2F0b3IuY29tcGFzcz1uZXcgQ29tcGFzcygpfX0pfWlmKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgibWVkaWEiKSl7UGhvbmVHYXAuYWRkUmVzb3VyY2UoIm1lZGlhIik7TWVkaWE9ZnVuY3Rpb24oc3JjLHN1Y2Nlc3NDYWxsYmFjayxlcnJvckNhbGxiYWNrLGRvd25sb2FkQ29tcGxldGVDYWxsYmFjayl7aWYoIXNyYyl7c3JjPSJkb2N1bWVudHM6Ly8iK1N0cmluZygobmV3IERhdGUoKSkuZ2V0VGltZSgpKS5yZXBsYWNlKC9cRC9naSwiIil9dGhpcy5zcmM9c3JjO3ZhciBzdWNjZXNzQ0I9KHN1Y2Nlc3NDYWxsYmFjaz09dW5kZWZpbmVkfHxzdWNjZXNzQ2FsbGJhY2s9PW51bGwpP251bGw6R2V0RnVuY3Rpb25OYW1lKHN1Y2Nlc3NDYWxsYmFjayk7dmFyIGVycm9yQ0I9KGVycm9yQ2FsbGJhY2s9PXVuZGVmaW5lZHx8ZXJyb3JDYWxsYmFjaz09bnVsbCk/bnVsbDpHZXRGdW5jdGlvbk5hbWUoZXJyb3JDYWxsYmFjayk7dmFyIGRvd25sb2FkQ0I9KGRvd25sb2FkQ29tcGxldGVDYWxsYmFjaz09dW5kZWZpbmVkfHxkb3dubG9hZENvbXBsZXRlQ2FsbGJhY2s9PW51bGwpP251bGw6R2V0RnVuY3Rpb25OYW1lKGRvd25sb2FkQ29tcGxldGVDYWxsYmFjayk7dGhpcy5zdWNjZXNzQ2FsbGJhY2s9c3VjY2Vzc0NhbGxiYWNrfHxudWxsO3RoaXMuZXJyb3JDYWxsYmFjaz1lcnJvckNhbGxiYWNrfHxudWxsO3RoaXMuZG93bmxvYWRDb21wbGV0ZUNhbGxiYWNrPWRvd25sb2FkQ29tcGxldGVDYWxsYmFja3x8bnVsbDtpZih0aGlzLnNyYyE9bnVsbCl7UGhvbmVHYXAuZXhlYygiU291bmQucHJlcGFyZSIsdGhpcy5zcmMsc3VjY2Vzc0NCLGVycm9yQ0IsZG93bmxvYWRDQil9fTtNZWRpYS5wcm90b3R5cGUucGxheT1mdW5jdGlvbihvcHRpb25zKXtpZih0aGlzLnNyYyE9bnVsbCl7UGhvbmVHYXAuZXhlYygiU291bmQucGxheSIsdGhpcy5zcmMsb3B0aW9ucyl9fTtNZWRpYS5wcm90b3R5cGUucGF1c2U9ZnVuY3Rpb24oKXtpZih0aGlzLnNyYyE9bnVsbCl7UGhvbmVHYXAuZXhlYygiU291bmQucGF1c2UiLHRoaXMuc3JjKX19O01lZGlhLnByb3RvdHlwZS5zdG9wPWZ1bmN0aW9uKCl7aWYodGhpcy5zcmMhPW51bGwpe1Bob25lR2FwLmV4ZWMoIlNvdW5kLnN0b3AiLHRoaXMuc3JjKX19O01lZGlhLnByb3RvdHlwZS5zdGFydEF1ZGlvUmVjb3JkPWZ1bmN0aW9uKG9wdGlvbnMpe2lmKHRoaXMuc3JjIT1udWxsKXtQaG9uZUdhcC5leGVjKCJTb3VuZC5zdGFydEF1ZGlvUmVjb3JkIix0aGlzLnNyYyxvcHRpb25zKX19O01lZGlhLnByb3RvdHlwZS5zdG9wQXVkaW9SZWNvcmQ9ZnVuY3Rpb24oKXtpZih0aGlzLnNyYyE9bnVsbCl7UGhvbmVHYXAuZXhlYygiU291bmQuc3RvcEF1ZGlvUmVjb3JkIix0aGlzLnNyYyl9fTtNZWRpYUVycm9yPWZ1bmN0aW9uKCl7dGhpcy5jb2RlPW51bGwsdGhpcy5tZXNzYWdlPSIifTtNZWRpYUVycm9yLk1FRElBX0VSUl9BQk9SVEVEPTE7TWVkaWFFcnJvci5NRURJQV9FUlJfTkVUV09SSz0yO01lZGlhRXJyb3IuTUVESUFfRVJSX0RFQ09ERT0zO01lZGlhRXJyb3IuTUVESUFfRVJSX05PTkVfU1VQUE9SVEVEPTR9aWYoIVBob25lR2FwLmhhc1Jlc291cmNlKCJub3RpZmljYXRpb24iKSl7UGhvbmVHYXAuYWRkUmVzb3VyY2UoIm5vdGlmaWNhdGlvbiIpO05vdGlmaWNhdGlvbj1mdW5jdGlvbigpe307Tm90aWZpY2F0aW9uLnByb3RvdHlwZS5hbGVydD1mdW5jdGlvbihtZXNzYWdlLGNvbXBsZXRlQ2FsbGJhY2ssdGl0bGUsYnV0dG9uTGFiZWwpe3ZhciBfdGl0bGU9KHRpdGxlfHwiQWxlcnQiKTt2YXIgX2J1dHRvbkxhYmVsPShidXR0b25MYWJlbHx8Ik9LIik7UGhvbmVHYXAuZXhlYyhjb21wbGV0ZUNhbGxiYWNrLG51bGwsIk5vdGlmaWNhdGlvbiIsImFsZXJ0IixbbWVzc2FnZSx7dGl0bGU6X3RpdGxlLGJ1dHRvbkxhYmVsOl9idXR0b25MYWJlbH1dKX07Tm90aWZpY2F0aW9uLnByb3RvdHlwZS5jb25maXJtPWZ1bmN0aW9uKG1lc3NhZ2UscmVzdWx0Q2FsbGJhY2ssdGl0bGUsYnV0dG9uTGFiZWxzKXt2YXIgX3RpdGxlPSh0aXRsZXx8IkNvbmZpcm0iKTt2YXIgX2J1dHRvbkxhYmVscz0oYnV0dG9uTGFiZWxzfHwiT0ssQ2FuY2VsIik7dGhpcy5hbGVydChtZXNzYWdlLHJlc3VsdENhbGxiYWNrLF90aXRsZSxfYnV0dG9uTGFiZWxzKX07Tm90aWZpY2F0aW9uLnByb3RvdHlwZS5hY3Rpdml0eVN0YXJ0PWZ1bmN0aW9uKCl7UGhvbmVHYXAuZXhlYyhudWxsLG51bGwsIk5vdGlmaWNhdGlvbiIsImFjdGl2aXR5U3RhcnQiLFtdKX07Tm90aWZpY2F0aW9uLnByb3RvdHlwZS5hY3Rpdml0eVN0b3A9ZnVuY3Rpb24oKXtQaG9uZUdhcC5leGVjKG51bGwsbnVsbCwiTm90aWZpY2F0aW9uIiwiYWN0aXZpdHlTdG9wIixbXSl9O05vdGlmaWNhdGlvbi5wcm90b3R5cGUubG9hZGluZ1N0YXJ0PWZ1bmN0aW9uKG9wdGlvbnMpe1Bob25lR2FwLmV4ZWMobnVsbCxudWxsLCJOb3RpZmljYXRpb24iLCJsb2FkaW5nU3RhcnQiLFtvcHRpb25zXSl9O05vdGlmaWNhdGlvbi5wcm90b3R5cGUubG9hZGluZ1N0b3A9ZnVuY3Rpb24oKXtQaG9uZUdhcC5leGVjKG51bGwsbnVsbCwiTm90aWZpY2F0aW9uIiwibG9hZGluZ1N0b3AiLFtdKX07Tm90aWZpY2F0aW9uLnByb3RvdHlwZS5ibGluaz1mdW5jdGlvbihjb3VudCxjb2xvdXIpe307Tm90aWZpY2F0aW9uLnByb3RvdHlwZS52aWJyYXRlPWZ1bmN0aW9uKG1pbGxzKXtQaG9uZUdhcC5leGVjKG51bGwsbnVsbCwiTm90aWZpY2F0aW9uIiwidmlicmF0ZSIsW10pfTtOb3RpZmljYXRpb24ucHJvdG90eXBlLmJlZXA9ZnVuY3Rpb24oY291bnQsdm9sdW1lKXtuZXcgTWVkaWEoImJlZXAud2F2IikucGxheSgpfTtQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpe2lmKHR5cGVvZiBuYXZpZ2F0b3Iubm90aWZpY2F0aW9uPT0idW5kZWZpbmVkIil7bmF2aWdhdG9yLm5vdGlmaWNhdGlvbj1uZXcgTm90aWZpY2F0aW9uKCl9fSl9aWYoIVBob25lR2FwLmhhc1Jlc291cmNlKCJvcmllbnRhdGlvbiIpKXtQaG9uZUdhcC5hZGRSZXNvdXJjZSgib3JpZW50YXRpb24iKTtPcmllbnRhdGlvbj1mdW5jdGlvbigpe3RoaXMuY3VycmVudE9yaWVudGF0aW9uPW51bGx9O09yaWVudGF0aW9uLnByb3RvdHlwZS5zZXRPcmllbnRhdGlvbj1mdW5jdGlvbihvcmllbnRhdGlvbil7T3JpZW50YXRpb24uY3VycmVudE9yaWVudGF0aW9uPW9yaWVudGF0aW9uO3ZhciBlPWRvY3VtZW50LmNyZWF0ZUV2ZW50KCJFdmVudHMiKTtlLmluaXRFdmVudCgib3JpZW50YXRpb25DaGFuZ2VkIiwiZmFsc2UiLCJmYWxzZSIpO2Uub3JpZW50YXRpb249b3JpZW50YXRpb247ZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChlKX07T3JpZW50YXRpb24ucHJvdG90eXBlLmdldEN1cnJlbnRPcmllbnRhdGlvbj1mdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7fTtPcmllbnRhdGlvbi5wcm90b3R5cGUud2F0Y2hPcmllbnRhdGlvbj1mdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssZXJyb3JDYWxsYmFjayl7dGhpcy5nZXRDdXJyZW50UG9zaXRpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spO3JldHVybiBzZXRJbnRlcnZhbChmdW5jdGlvbigpe25hdmlnYXRvci5vcmllbnRhdGlvbi5nZXRDdXJyZW50T3JpZW50YXRpb24oc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2spfSwxMDAwMCl9O09yaWVudGF0aW9uLnByb3RvdHlwZS5jbGVhcldhdGNoPWZ1bmN0aW9uKHdhdGNoSWQpe2NsZWFySW50ZXJ2YWwod2F0Y2hJZCl9O1Bob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCl7aWYodHlwZW9mIG5hdmlnYXRvci5vcmllbnRhdGlvbj09InVuZGVmaW5lZCIpe25hdmlnYXRvci5vcmllbnRhdGlvbj1uZXcgT3JpZW50YXRpb24oKX19KX1pZighUGhvbmVHYXAuaGFzUmVzb3VyY2UoInNtcyIpKXtQaG9uZUdhcC5hZGRSZXNvdXJjZSgic21zIik7U21zPWZ1bmN0aW9uKCl7fTtTbXMucHJvdG90eXBlLnNlbmQ9ZnVuY3Rpb24obnVtYmVyLG1lc3NhZ2Usc3VjY2Vzc0NhbGxiYWNrLGVycm9yQ2FsbGJhY2ssb3B0aW9ucyl7fTtQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpe2lmKHR5cGVvZiBuYXZpZ2F0b3Iuc21zPT0idW5kZWZpbmVkIil7bmF2aWdhdG9yLnNtcz1uZXcgU21zKCl9fSl9aWYoIVBob25lR2FwLmhhc1Jlc291cmNlKCJ0ZWxlcGhvbnkiKSl7UGhvbmVHYXAuYWRkUmVzb3VyY2UoInRlbGVwaG9ueSIpO1RlbGVwaG9ueT1mdW5jdGlvbigpe307VGVsZXBob255LnByb3RvdHlwZS5jYWxsPWZ1bmN0aW9uKG51bWJlcil7fTtQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpe2lmKHR5cGVvZiBuYXZpZ2F0b3IudGVsZXBob255PT0idW5kZWZpbmVkIil7bmF2aWdhdG9yLnRlbGVwaG9ueT1uZXcgVGVsZXBob255KCl9fSl9aWYoIVBob25lR2FwLmhhc1Jlc291cmNlKCJuZXR3b3JrIikpe1Bob25lR2FwLmFkZFJlc291cmNlKCJuZXR3b3JrIik7Q29ubmVjdGlvbj1mdW5jdGlvbih0eXBlLGhvbWVOVyxjdXJyZW50Tlcpe3RoaXMudHlwZT10eXBlfHwwO3RoaXMuaG9tZU5XPWhvbWVOV3x8bnVsbDt0aGlzLmN1cnJlbnROVz1jdXJyZW50Tld8fG51bGx9O0Nvbm5lY3Rpb24uVU5LTk9XTj0wO0Nvbm5lY3Rpb24uRVRIRVJORVQ9MTtDb25uZWN0aW9uLldJRkk9MjtDb25uZWN0aW9uLkNFTExfMkc9MztDb25uZWN0aW9uLkNFTExfM0c9NDtDb25uZWN0aW9uLkNFTExfNEc9NTtDb25uZWN0aW9uLk5PTkU9MjA7TmV0d29ya1N0YXR1cz1mdW5jdGlvbigpe3RoaXMuY29kZT1udWxsO3RoaXMubWVzc2FnZT0iIn07TmV0d29ya1N0YXR1cy5OT1RfUkVBQ0hBQkxFPTA7TmV0d29ya1N0YXR1cy5SRUFDSEFCTEVfVklBX0NBUlJJRVJfREFUQV9ORVRXT1JLPTE7TmV0d29ya1N0YXR1cy5SRUFDSEFCTEVfVklBX1dJRklfTkVUV09SSz0yO05ldHdvcms9ZnVuY3Rpb24oKXt9O05ldHdvcmsucHJvdG90eXBlLmlzUmVhY2hhYmxlPWZ1bmN0aW9uKGhvc3ROYW1lLHN1Y2Nlc3NDYWxsYmFjayxvcHRpb25zKXtQaG9uZUdhcC5leGVjKCJOZXR3b3JrLmlzUmVhY2hhYmxlIixob3N0TmFtZSxHZXRGdW5jdGlvbk5hbWUoc3VjY2Vzc0NhbGxiYWNrKSxvcHRpb25zKX07UGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKXtpZih0eXBlb2YgbmF2aWdhdG9yLm5ldHdvcms9PSJ1bmRlZmluZWQiKXtuYXZpZ2F0b3IubmV0d29yaz1uZXcgTmV0d29yaygpfWlmKHR5cGVvZiBuYXZpZ2F0b3IuY29ubmVjdGlvbj09InVuZGVmaW5lZCIpe25hdmlnYXRvci5jb25uZWN0aW9uPW5ldyBDb25uZWN0aW9uKCl9fSl9Ow==","content_type":"application/javascript","revpos":1},"vendor/couchapp/jquery.evently.js":{"data":"Ly8gJCQgaW5zcGlyZWQgYnkgQHd5Y2F0czogaHR0cDovL3llaHVkYWthdHouY29tLzIwMDkvMDQvMjAvZXZlbnRlZC1wcm9ncmFtbWluZy13aXRoLWpxdWVyeS8KZnVuY3Rpb24gJCQobm9kZSkgewogIHZhciBkYXRhID0gJChub2RlKS5kYXRhKCIkJCIpOwogIGlmIChkYXRhKSB7CiAgICByZXR1cm4gZGF0YTsKICB9IGVsc2UgewogICAgZGF0YSA9IHt9OwogICAgJChub2RlKS5kYXRhKCIkJCIsIGRhdGEpOwogICAgcmV0dXJuIGRhdGE7CiAgfQp9OwoKKGZ1bmN0aW9uKCQpIHsKICAvLyB1dGlsaXR5IGZ1bmN0aW9ucyB1c2VkIGluIHRoZSBpbXBsZW1lbnRhdGlvbgogIAogIGZ1bmN0aW9uIGZvckluKG9iaiwgZnVuKSB7CiAgICB2YXIgbmFtZTsKICAgIGZvciAobmFtZSBpbiBvYmopIHsKICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgIGZ1bihuYW1lLCBvYmpbbmFtZV0pOwogICAgICB9CiAgICB9CiAgfTsKICAkLmZvckluID0gZm9ySW47CiAgZnVuY3Rpb24gZnVuVmlhU3RyaW5nKGZ1biwgaGludCkgewogICAgaWYgKGZ1biAmJiBmdW4ubWF0Y2ggJiYgZnVuLm1hdGNoKC9eZnVuY3Rpb24vKSkgewogICAgICBldmFsKCJ2YXIgZiA9ICIrZnVuKTsKICAgICAgaWYgKHR5cGVvZiBmID09ICJmdW5jdGlvbiIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgIC8vIElGIFlPVSBTRUUgQU4gRVJST1IgSEVSRSBJVCBIQVBQRU5FRCBXSEVOIFdFIFRSSUVEIFRPIFJVTiBZT1VSIEZVTkNUSU9OCiAgICAgICAgICAgICQubG9nKHsibWVzc2FnZSI6ICJFcnJvciBpbiBldmVudGx5IGZ1bmN0aW9uLiIsICJlcnJvciI6IGUsIAogICAgICAgICAgICAgICJzcmMiIDogZnVuLCAiaGludCI6aGludH0pOwogICAgICAgICAgICB0aHJvdyhlKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZnVuOwogIH07CiAgCiAgZnVuY3Rpb24gcnVuSWZGdW4obWUsIGZ1biwgYXJncykgewogICAgLy8gaWYgdGhlIGZpZWxkIGlzIGEgZnVuY3Rpb24sIGNhbGwgaXQsIGJvdW5kIHRvIHRoZSB3aWRnZXQKICAgIHZhciBmID0gZnVuVmlhU3RyaW5nKGZ1biwgbWUpOwogICAgaWYgKHR5cGVvZiBmID09ICJmdW5jdGlvbiIpIHsKICAgICAgcmV0dXJuIGYuYXBwbHkobWUsIGFyZ3MpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZ1bjsKICAgIH0KICB9CgogICQuZXZlbnRseSA9IHsKICAgIGNvbm5lY3QgOiBmdW5jdGlvbihzb3VyY2UsIHRhcmdldCwgZXZlbnRzKSB7CiAgICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGV2KSB7CiAgICAgICAgJChzb3VyY2UpLmJpbmQoZXYsIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGFyZ3MgPSAkLm1ha2VBcnJheShhcmd1bWVudHMpOwogICAgICAgICAgLy8gcmVtb3ZlIHRoZSBvcmlnaW5hbCBldmVudCB0byBrZWVwIGZyb20gc3RhY2tpbmcgYXJncyBleHRyYSBkZWVwCiAgICAgICAgICAvLyBpdCB3b3VsZCBiZSBuaWNlIGlmIGpxdWVyeSBoYWQgYSB3YXkgdG8gcGFzcyB0aGUgb3JpZ2luYWwKICAgICAgICAgIC8vIGV2ZW50IHRvIHRoZSB0cmlnZ2VyIG1ldGhvZC4KICAgICAgICAgIGFyZ3Muc2hpZnQoKTsKICAgICAgICAgICQodGFyZ2V0KS50cmlnZ2VyKGV2LCBhcmdzKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgcGF0aHMgOiBbXSwKICAgIGNoYW5nZXNEQnMgOiB7fSwKICAgIGNoYW5nZXNPcHRzIDoge30KICB9OwogIAogIGZ1bmN0aW9uIGV4dHJhY3RGcm9tKG5hbWUsIGV2cykgewogICAgcmV0dXJuIGV2c1tuYW1lXTsKICB9OwoKICBmdW5jdGlvbiBleHRyYWN0RXZlbnRzKG5hbWUsIGRkb2MpIHsKICAgIC8vIGV4dHJhY3QgZXZlbnRzIGZyb20gZGRvYy5ldmVudGx5IGFuZCBkZG9jLnZlbmRvci4qLmV2ZW50bHkKICAgIHZhciBldmVudHMgPSBbdHJ1ZSwge31dCiAgICAgICwgdmVuZG9yID0gZGRvYy52ZW5kb3IgfHwge30KICAgICAgLCBldmVudGx5ID0gZGRvYy5ldmVudGx5IHx8IHt9CiAgICAgIDsKICAgICQuZm9ySW4odmVuZG9yLCBmdW5jdGlvbihrLCB2KSB7CiAgICAgIGlmICh2LmV2ZW50bHkgJiYgdi5ldmVudGx5W25hbWVdKSB7CiAgICAgICAgZXZlbnRzLnB1c2godi5ldmVudGx5W25hbWVdKTsKICAgICAgfQogICAgfSk7CiAgICBpZiAoZXZlbnRseVtuYW1lXSkge2V2ZW50cy5wdXNoKGV2ZW50bHlbbmFtZV0pO30KICAgIHJldHVybiAkLmV4dGVuZC5hcHBseShudWxsLCBldmVudHMpOwogIH0KCiAgZnVuY3Rpb24gZXh0cmFjdFBhcnRpYWxzKGRkb2MpIHsKICAgIHZhciBwYXJ0aWFscyA9IFt0cnVlLCB7fV0KICAgICAgLCB2ZW5kb3IgPSBkZG9jLnZlbmRvciB8fCB7fQogICAgICAsIGV2ZW50bHkgPSBkZG9jLmV2ZW50bHkgfHwge30KICAgICAgOwogICAgJC5mb3JJbih2ZW5kb3IsIGZ1bmN0aW9uKGssIHYpIHsKICAgICAgaWYgKHYuZXZlbnRseSAmJiB2LmV2ZW50bHkuX3BhcnRpYWxzKSB7CiAgICAgICAgcGFydGlhbHMucHVzaCh2LmV2ZW50bHkuX3BhcnRpYWxzKTsKICAgICAgfQogICAgfSk7CiAgICBpZiAoZXZlbnRseS5fcGFydGlhbHMpIHtwYXJ0aWFscy5wdXNoKGV2ZW50bHkuX3BhcnRpYWxzKTt9CiAgICByZXR1cm4gJC5leHRlbmQuYXBwbHkobnVsbCwgcGFydGlhbHMpOwogIH07CgogIGZ1bmN0aW9uIGFwcGx5Q29tbW9uKGV2ZW50cykgewogICAgaWYgKGV2ZW50cy5fY29tbW9uKSB7CiAgICAgICQuZm9ySW4oZXZlbnRzLCBmdW5jdGlvbihrLCB2KSB7CiAgICAgICAgZXZlbnRzW2tdID0gJC5leHRlbmQodHJ1ZSwge30sIGV2ZW50cy5fY29tbW9uLCB2KTsKICAgICAgfSk7CiAgICAgIGRlbGV0ZSBldmVudHMuX2NvbW1vbjsKICAgICAgcmV0dXJuIGV2ZW50czsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBldmVudHM7CiAgICB9CiAgfQoKICAkLmZuLmV2ZW50bHkgPSBmdW5jdGlvbihldmVudHMsIGFwcCwgYXJncykgewogICAgdmFyIGVsZW0gPSAkKHRoaXMpOwogICAgLy8gc3RvcmUgdGhlIGFwcCBvbiB0aGUgZWxlbWVudCBmb3IgbGF0ZXIgdXNlCiAgICBpZiAoYXBwKSB7CiAgICAgICQkKGVsZW0pLmFwcCA9IGFwcDsKICAgIH0KCiAgICBpZiAodHlwZW9mIGV2ZW50cyA9PSAic3RyaW5nIikgewogICAgICBldmVudHMgPSBleHRyYWN0RXZlbnRzKGV2ZW50cywgYXBwLmRkb2MpOwogICAgfQogICAgZXZlbnRzID0gYXBwbHlDb21tb24oZXZlbnRzKTsKICAgICQkKGVsZW0pLmV2ZW50bHkgPSBldmVudHM7CiAgICBpZiAoYXBwICYmIGFwcC5kZG9jKSB7CiAgICAgICQkKGVsZW0pLnBhcnRpYWxzID0gZXh0cmFjdFBhcnRpYWxzKGFwcC5kZG9jKTsKICAgIH0KICAgIC8vIHNldHVwIHRoZSBoYW5kbGVycyBvbnRvIGVsZW0KICAgIGZvckluKGV2ZW50cywgZnVuY3Rpb24obmFtZSwgaCkgewogICAgICBldmVudGx5SGFuZGxlcihlbGVtLCBuYW1lLCBoLCBhcmdzKTsKICAgIH0pOwogICAgCiAgICBpZiAoZXZlbnRzLl9pbml0KSB7CiAgICAgIGVsZW0udHJpZ2dlcigiX2luaXQiLCBhcmdzKTsKICAgIH0KICAgIAogICAgaWYgKGFwcCAmJiBldmVudHMuX2NoYW5nZXMpIHsKICAgICAgJCgiYm9keSIpLmJpbmQoImV2ZW50bHktY2hhbmdlcy0iK2FwcC5kYi5uYW1lLCBmdW5jdGlvbigpIHsKICAgICAgICBlbGVtLnRyaWdnZXIoIl9jaGFuZ2VzIik7ICAgICAgICAKICAgICAgfSk7CiAgICAgIGZvbGxvd0NoYW5nZXMoYXBwKTsKICAgICAgZWxlbS50cmlnZ2VyKCJfY2hhbmdlcyIpOwogICAgfQogIH07CiAgCiAgLy8gZXZlbnRseUhhbmRsZXIgYXBwbGllcyB0aGUgdXNlcidzIGhhbmRsZXIgKGgpIHRvIHRoZSAKICAvLyBlbGVtLCBib3VuZCB0byB0cmlnZ2VyIGJhc2VkIG9uIG5hbWUuCiAgZnVuY3Rpb24gZXZlbnRseUhhbmRsZXIoZWxlbSwgbmFtZSwgaCwgYXJncykgewogICAgaWYgKCQuZXZlbnRseS5sb2cpIHsKICAgICAgZWxlbS5iaW5kKG5hbWUsIGZ1bmN0aW9uKCkgewogICAgICAgICQubG9nKGVsZW0sIG5hbWUpOwogICAgICB9KTsKICAgIH0KICAgIGlmIChoLnBhdGgpIHsKICAgICAgZWxlbS5wYXRoYmluZGVyKG5hbWUsIGgucGF0aCk7CiAgICB9CiAgICB2YXIgZiA9IGZ1blZpYVN0cmluZyhoLCBuYW1lKTsKICAgIGlmICh0eXBlb2YgZiA9PSAiZnVuY3Rpb24iKSB7CiAgICAgIGVsZW0uYmluZChuYW1lLCB7YXJnczphcmdzfSwgZik7IAogICAgfSBlbHNlIGlmICh0eXBlb2YgZiA9PSAic3RyaW5nIikgewogICAgICBlbGVtLmJpbmQobmFtZSwge2FyZ3M6YXJnc30sIGZ1bmN0aW9uKCkgewogICAgICAgICQodGhpcykudHJpZ2dlcihmLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKCQuaXNBcnJheShoKSkgeyAKICAgICAgLy8gaGFuZGxlIGFycmF5cyByZWN1cnNpdmVseQogICAgICBmb3IgKHZhciBpPTA7IGkgPCBoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZXZlbnRseUhhbmRsZXIoZWxlbSwgbmFtZSwgaFtpXSwgYXJncyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIGFuIG9iamVjdCBpcyB1c2luZyB0aGUgZXZlbnRseSAvIG11c3RhY2hlIHRlbXBsYXRlIHN5c3RlbQogICAgICBpZiAoaC5mdW4pIHsKICAgICAgICB0aHJvdygiZS5mdW4gaGFzIGJlZW4gcmVtb3ZlZCwgcGxlYXNlIHJlbmFtZSB0byBlLmJlZm9yZSIpCiAgICAgIH0KICAgICAgLy8gdGVtcGxhdGVzLCBzZWxlY3RvcnMsIGV0YyBhcmUgaW50ZXByZXRlZAogICAgICAvLyB3aGVuIG91ciBuYW1lZCBldmVudCBpcyB0cmlnZ2VyZWQuCiAgICAgIGVsZW0uYmluZChuYW1lLCB7YXJnczphcmdzfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgcmVuZGVyRWxlbWVudCgkKHRoaXMpLCBoLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSk7CiAgICB9CiAgfTsKICAKICAkLmZuLnJlcGxhY2UgPSBmdW5jdGlvbihlbGVtKSB7CiAgICAvLyAkLmxvZygiUmVwbGFjZSIsIHRoaXMpCiAgICAkKHRoaXMpLmVtcHR5KCkuYXBwZW5kKGVsZW0pOwogIH07CiAgCiAgLy8gdG9kbzogYWJpbGl0eSB0byBjYWxsIHRoaXMKICAvLyB0byByZW5kZXIgYW5kICJwcmVwZW5kL2FwcGVuZC9ldGMiIGEgbmV3IGVsZW1lbnQgdG8gdGhlIGhvc3QgZWxlbWVudCAobWUpCiAgLy8gYXMgd2VsbCBhcyBjYWxsIHRoaXMgaW4gYSB3YXkgdGhhdCByZXBsYWNlcyB0aGUgaG9zdCBlbGVtZW50cyBjb250ZW50CiAgLy8gdGhpcyB3b3VsZCBiZSBlYXN5IGlmIHRoZXJlIGlzIGEgc2ltcGxlIHdheSB0byBnZXQgYXQgdGhlIGVsZW1lbnQgd2UganVzdCBhcHBlbmRlZAogIC8vIChhcyBodG1sKSBzbyB0aGF0IHdlIGNhbiBhdHRhY2hlIHRoZSBzZWxlY3RvcnMKICBmdW5jdGlvbiByZW5kZXJFbGVtZW50KG1lLCBoLCBhcmdzLCBxcnVuLCBhcnVuKSB7CiAgICAvLyBpZiB0aGVyZSdzIGEgcXVlcnkgb2JqZWN0IHdlIHJ1biB0aGUgcXVlcnksCiAgICAvLyBhbmQgdGhlbiBjYWxsIHRoZSBkYXRhIGZ1bmN0aW9uIHdpdGggdGhlIHJlc3BvbnNlLgogICAgaWYgKGguYmVmb3JlICYmICghcXJ1biB8fCAhYXJ1bikpIHsKICAgICAgZnVuVmlhU3RyaW5nKGguYmVmb3JlLCBtZSkuYXBwbHkobWUsIGFyZ3MpOwogICAgfQogICAgaWYgKGguYXN5bmMgJiYgIWFydW4pIHsKICAgICAgcnVuQXN5bmMobWUsIGgsIGFyZ3MpCiAgICB9IGVsc2UgaWYgKGgucXVlcnkgJiYgIXFydW4pIHsKICAgICAgLy8gJC5sb2coInF1ZXJ5IGJlZm9yZSByZW5kZXJFbGVtZW50IiwgYXJndW1lbnRzKQogICAgICBydW5RdWVyeShtZSwgaCwgYXJncykKICAgIH0gZWxzZSB7CiAgICAgIC8vICQubG9nKCJyZW5kZXJFbGVtZW50IikKICAgICAgLy8gJC5sb2cobWUsIGgsIGFyZ3MsIHFydW4pCiAgICAgIC8vIG90aGVyd2lzZSB3ZSBqdXN0IHJlbmRlciB0aGUgdGVtcGxhdGUgd2l0aCB0aGUgY3VycmVudCBhcmdzCiAgICAgIHZhciBzZWxlY3RvcnMgPSBydW5JZkZ1bihtZSwgaC5zZWxlY3RvcnMsIGFyZ3MpOwogICAgICB2YXIgYWN0ID0gKGgucmVuZGVyIHx8ICJyZXBsYWNlIikucmVwbGFjZSgvXHMvZywiIik7CiAgICAgIHZhciBhcHAgPSAkJChtZSkuYXBwOwogICAgICBpZiAoaC5tdXN0YWNoZSkgewogICAgICAgIC8vICQubG9nKCJyZW5kZXJpbmciLCBoLm11c3RhY2hlKQogICAgICAgIHZhciBuZXdFbGVtID0gbXVzdGFjaGlvZWQobWUsIGgsIGFyZ3MpOwogICAgICAgIG1lW2FjdF0obmV3RWxlbSk7CiAgICAgIH0KICAgICAgaWYgKHNlbGVjdG9ycykgewogICAgICAgIGlmIChhY3QgPT0gInJlcGxhY2UiKSB7CiAgICAgICAgICB2YXIgcyA9IG1lOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgcyA9IG5ld0VsZW07CiAgICAgICAgfQogICAgICAgIGZvckluKHNlbGVjdG9ycywgZnVuY3Rpb24oc2VsZWN0b3IsIGhhbmRsZXJzKSB7CiAgICAgICAgICAvLyAkLmxvZygic2VsZWN0b3IiLCBzZWxlY3Rvcik7CiAgICAgICAgICAvLyAkLmxvZygic2VsZWN0ZWQiLCAkKHNlbGVjdG9yLCBzKSk7CiAgICAgICAgICAkKHNlbGVjdG9yLCBzKS5ldmVudGx5KGhhbmRsZXJzLCBhcHAsIGFyZ3MpOwogICAgICAgICAgLy8gJC5sb2coImFwcGxpZWQiLCBzZWxlY3Rvcik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKGguYWZ0ZXIpIHsKICAgICAgICBydW5JZkZ1bihtZSwgaC5hZnRlciwgYXJncyk7CiAgICAgIH0KICAgIH0gICAgCiAgfTsKICAKICAvLyB0b2RvIHRoaXMgc2hvdWxkIHJldHVybiB0aGUgbmV3IGVsZW1lbnQKICBmdW5jdGlvbiBtdXN0YWNoaW9lZChtZSwgaCwgYXJncykgewogICAgdmFyIHBhcnRpYWxzID0gJCQobWUpLnBhcnRpYWxzOwogICAgcmV0dXJuICQoJC5tdXN0YWNoZSgKICAgICAgcnVuSWZGdW4obWUsIGgubXVzdGFjaGUsIGFyZ3MpLAogICAgICBydW5JZkZ1bihtZSwgaC5kYXRhLCBhcmdzKSwgCiAgICAgIHJ1bklmRnVuKG1lLCAkLmV4dGVuZCh0cnVlLCBwYXJ0aWFscywgaC5wYXJ0aWFscyksIGFyZ3MpKSk7CiAgfTsKICAKICBmdW5jdGlvbiBydW5Bc3luYyhtZSwgaCwgYXJncykgeyAgCiAgICAvLyB0aGUgY2FsbGJhY2sgaXMgdGhlIGZpcnN0IGFyZ3VtZW50CiAgICBmdW5WaWFTdHJpbmcoaC5hc3luYywgbWUpLmFwcGx5KG1lLCBbZnVuY3Rpb24oKSB7CiAgICAgIHJlbmRlckVsZW1lbnQobWUsIGgsIAogICAgICAgICQuYXJnc1RvQXJyYXkoYXJndW1lbnRzKS5jb25jYXQoJC5hcmdzVG9BcnJheShhcmdzKSksIGZhbHNlLCB0cnVlKTsKICAgIH1dLmNvbmNhdCgkLmFyZ3NUb0FycmF5KGFyZ3MpKSk7CiAgfTsKICAKICAKICBmdW5jdGlvbiBydW5RdWVyeShtZSwgaCwgYXJncykgewogICAgLy8gJC5sb2coInJ1blF1ZXJ5OiBhcmdzIiwgYXJncykKICAgIHZhciBhcHAgPSAkJChtZSkuYXBwOwogICAgdmFyIHF1ID0gcnVuSWZGdW4obWUsIGgucXVlcnksIGFyZ3MpOwogICAgdmFyIHFUeXBlID0gcXUudHlwZTsKICAgIHZhciB2aWV3TmFtZSA9IHF1LnZpZXc7CiAgICB2YXIgdXNlclN1Y2Nlc3MgPSBxdS5zdWNjZXNzOwogICAgLy8gJC5sb2coInFUeXBlIiwgcVR5cGUpCiAgICAKICAgIHZhciBxID0ge307CiAgICBmb3JJbihxdSwgZnVuY3Rpb24oaywgdikgewogICAgICBpZiAoWyJ0eXBlIiwgInZpZXciXS5pbmRleE9mKGspID09IC0xKSB7CiAgICAgICAgcVtrXSA9IHY7CiAgICAgIH0KICAgIH0pOwogICAgCiAgICBpZiAocVR5cGUgPT0gIm5ld1Jvd3MiKSB7CiAgICAgIHEuc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgICAvLyAkLmxvZygicnVuUXVlcnkgbmV3Um93cyBzdWNjZXNzIiwgcmVzcC5yb3dzLmxlbmd0aCwgbWUsIHJlc3ApCiAgICAgICAgcmVzcC5yb3dzLnJldmVyc2UoKS5mb3JFYWNoKGZ1bmN0aW9uKHJvdykgewogICAgICAgICAgcmVuZGVyRWxlbWVudChtZSwgaCwgW3Jvd10uY29uY2F0KCQuYXJnc1RvQXJyYXkoYXJncykpLCB0cnVlKQogICAgICAgIH0pOwogICAgICAgIGlmICh1c2VyU3VjY2VzcykgdXNlclN1Y2Nlc3MocmVzcCk7CiAgICAgIH07CiAgICAgIG5ld1Jvd3MobWUsIGFwcCwgdmlld05hbWUsIHEpOwogICAgfSBlbHNlIHsKICAgICAgcS5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgIC8vICQubG9nKCJydW5RdWVyeSBzdWNjZXNzIiwgcmVzcCkKICAgICAgICByZW5kZXJFbGVtZW50KG1lLCBoLCBbcmVzcF0uY29uY2F0KCQuYXJnc1RvQXJyYXkoYXJncykpLCB0cnVlKTsKICAgICAgICB1c2VyU3VjY2VzcyAmJiB1c2VyU3VjY2VzcyhyZXNwKTsKICAgICAgfTsKICAgICAgLy8gJC5sb2coYXBwKQogICAgICBhcHAudmlldyh2aWV3TmFtZSwgcSk7ICAgICAgCiAgICB9CiAgfQogIAogIC8vIHRoaXMgaXMgZm9yIHRoZSBpdGVtcyBoYW5kbGVyCiAgLy8gdmFyIGxhc3RWaWV3SWQsIGhpZ2hLZXksIGluRmxpZ2h0OwogIC8vIHRoaXMgbmVlZHMgdG8ga2V5IHBlciBlbGVtCiAgZnVuY3Rpb24gbmV3Um93cyhlbGVtLCBhcHAsIHZpZXcsIG9wdHMpIHsKICAgIC8vICQubG9nKCJuZXdSb3dzIiwgYXJndW1lbnRzKTsKICAgIC8vIG9uIHN1Y2Nlc3Mgd2UnbGwgc2V0IHRoZSB0b3Aga2V5CiAgICB2YXIgdGhpc1ZpZXdJZCwgc3VjY2Vzc0NhbGxiYWNrID0gb3B0cy5zdWNjZXNzLCBmdWxsID0gZmFsc2U7CiAgICBmdW5jdGlvbiBzdWNjZXNzRnVuKHJlc3ApIHsKICAgICAgLy8gJC5sb2coIm5ld1Jvd3Mgc3VjY2VzcyIsIHJlc3ApCiAgICAgICQkKGVsZW0pLmluRmxpZ2h0ID0gZmFsc2U7CiAgICAgIHZhciBKU09OaGlnaEtleSA9IEpTT04uc3RyaW5naWZ5KCQkKGVsZW0pLmhpZ2hLZXkpOwogICAgICByZXNwLnJvd3MgPSByZXNwLnJvd3MuZmlsdGVyKGZ1bmN0aW9uKHIpIHsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoci5rZXkpICE9IEpTT05oaWdoS2V5OwogICAgICB9KTsKICAgICAgaWYgKHJlc3Aucm93cy5sZW5ndGggPiAwKSB7CiAgICAgICAgaWYgKG9wdHMuZGVzY2VuZGluZykgewogICAgICAgICAgJCQoZWxlbSkuaGlnaEtleSA9IHJlc3Aucm93c1swXS5rZXk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQkKGVsZW0pLmhpZ2hLZXkgPSByZXNwLnJvd3NbcmVzcC5yb3dzLmxlbmd0aCAtMV0ua2V5OwogICAgICAgIH0KICAgICAgfTsKICAgICAgaWYgKHN1Y2Nlc3NDYWxsYmFjaykge3N1Y2Nlc3NDYWxsYmFjayhyZXNwLCBmdWxsKX07CiAgICB9OwogICAgb3B0cy5zdWNjZXNzID0gc3VjY2Vzc0Z1bjsKICAgIAogICAgaWYgKG9wdHMuZGVzY2VuZGluZykgewogICAgICB0aGlzVmlld0lkID0gdmlldyArIChvcHRzLnN0YXJ0a2V5ID8gSlNPTi5zdHJpbmdpZnkob3B0cy5zdGFydGtleSkgOiAiIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzVmlld0lkID0gdmlldyArIChvcHRzLmVuZGtleSA/IEpTT04uc3RyaW5naWZ5KG9wdHMuZW5ka2V5KSA6ICIiKTsKICAgIH0KICAgIC8vICQubG9nKFsidGhpc1ZpZXdJZCIsdGhpc1ZpZXdJZF0pCiAgICAvLyBmb3IgcXVlcnkgd2UnbGwgc2V0IGtleXMKICAgIGlmICh0aGlzVmlld0lkID09ICQkKGVsZW0pLmxhc3RWaWV3SWQpIHsKICAgICAgLy8gd2Ugb25seSB3YW50IHRoZSByb3dzIG5ld2VyIHRoYW4gY2hhbmdlc0tleQogICAgICB2YXIgaGsgPSAkJChlbGVtKS5oaWdoS2V5OwogICAgICBpZiAoaGsgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChvcHRzLmRlc2NlbmRpbmcpIHsKICAgICAgICAgIG9wdHMuZW5ka2V5ID0gaGs7CiAgICAgICAgICAvLyBvcHRzLmluY2x1c2l2ZV9lbmQgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3B0cy5zdGFydGtleSA9IGhrOwogICAgICAgIH0KICAgICAgfQogICAgICAvLyAkLmxvZygiYWRkIHZpZXcgcm93cyIsIG9wdHMpCiAgICAgIGlmICghJCQoZWxlbSkuaW5GbGlnaHQpIHsKICAgICAgICAkJChlbGVtKS5pbkZsaWdodCA9IHRydWU7CiAgICAgICAgYXBwLnZpZXcodmlldywgb3B0cyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIGZ1bGwgcmVmcmVzaAogICAgICAvLyAkLmxvZygibmV3IHZpZXcgc3R1ZmYiKQogICAgICBmdWxsID0gdHJ1ZTsKICAgICAgJCQoZWxlbSkubGFzdFZpZXdJZCA9IHRoaXNWaWV3SWQ7CiAgICAgICQkKGVsZW0pLmhpZ2hLZXkgPSB1bmRlZmluZWQ7CiAgICAgICQkKGVsZW0pLmluRmxpZ2h0ID0gdHJ1ZTsKICAgICAgYXBwLnZpZXcodmlldywgb3B0cyk7CiAgICB9CiAgfTsKICAKICAvLyBvbmx5IHN0YXJ0IG9uZSBjaGFuZ2VzIGxpc3RlbmVyIHBlciBkYgogIGZ1bmN0aW9uIGZvbGxvd0NoYW5nZXMoYXBwKSB7CiAgICB2YXIgZGJOYW1lID0gYXBwLmRiLm5hbWUsIGNoYW5nZUV2ZW50ID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAkKCJib2R5IikudHJpZ2dlcigiZXZlbnRseS1jaGFuZ2VzLSIrZGJOYW1lLCBbcmVzcF0pOwogICAgfTsKICAgIGlmICghJC5ldmVudGx5LmNoYW5nZXNEQnNbZGJOYW1lXSkgewogICAgICBpZiAoYXBwLmRiLmNoYW5nZXMpIHsKICAgICAgICAvLyBuZXcgYXBpIGluIGpxdWVyeS5jb3VjaC5qcyAxLjAKICAgICAgICBhcHAuZGIuY2hhbmdlcyhudWxsLCAkLmV2ZW50bHkuY2hhbmdlc09wdHMpLm9uQ2hhbmdlKGNoYW5nZUV2ZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBpbiBjYXNlIHlvdSBhcmUgc3RpbGwgb24gQ291Y2hEQiAwLjExIDspIGRlcHJlY2F0ZWQuCiAgICAgICAgY29ubmVjdFRvQ2hhbmdlcyhhcHAsIGNoYW5nZUV2ZW50KTsKICAgICAgfQogICAgICAkLmV2ZW50bHkuY2hhbmdlc0RCc1tkYk5hbWVdID0gdHJ1ZTsKICAgIH0KICB9CiAgJC5ldmVudGx5LmZvbGxvd0NoYW5nZXMgPSBmb2xsb3dDaGFuZ2VzOwogIC8vIGRlcHJlY2F0ZWQuIHVzZSBkYi5jaGFuZ2VzKCkgZnJvbSBqcXVlcnkuY291Y2guanMKICAvLyB0aGlzIGRvZXMgbm90IGhhdmUgYW4gYXBpIGZvciBjbG9zaW5nIGNoYW5nZXMgcmVxdWVzdC4KICBmdW5jdGlvbiBjb25uZWN0VG9DaGFuZ2VzKGFwcCwgZnVuLCB1cGRhdGVfc2VxKSB7CiAgICBmdW5jdGlvbiBjaGFuZ2VzUmVxKHNlcSkgewogICAgICB2YXIgdXJsID0gYXBwLmRiLnVyaSsiX2NoYW5nZXM/aGVhcnRiZWF0PTEwMDAwJmZlZWQ9bG9uZ3BvbGwmc2luY2U9IitzZXE7CiAgICAgIGlmICgkLmV2ZW50bHkuY2hhbmdlc09wdHMuaW5jbHVkZV9kb2NzKSB7CiAgICAgICAgdXJsID0gdXJsICsgIiZpbmNsdWRlX2RvY3M9dHJ1ZSI7CiAgICAgIH0KICAgICAgJC5hamF4KHsKICAgICAgICB1cmw6IHVybCwKICAgICAgICBjb250ZW50VHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKHJlcSkgewogICAgICAgICAgdmFyIHJlc3AgPSAkLmh0dHBEYXRhKHJlcSwgImpzb24iKTsKICAgICAgICAgIGZ1bihyZXNwKTsKICAgICAgICAgIGNvbm5lY3RUb0NoYW5nZXMoYXBwLCBmdW4sIHJlc3AubGFzdF9zZXEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogICAgaWYgKHVwZGF0ZV9zZXEpIHsKICAgICAgY2hhbmdlc1JlcSh1cGRhdGVfc2VxKTsKICAgIH0gZWxzZSB7CiAgICAgIGFwcC5kYi5pbmZvKHtzdWNjZXNzOiBmdW5jdGlvbihkYl9pbmZvKSB7CiAgICAgICAgY2hhbmdlc1JlcShkYl9pbmZvLnVwZGF0ZV9zZXEpOwogICAgICB9fSk7CiAgICB9CiAgfTsKICAKfSkoalF1ZXJ5KTsK","content_type":"application/javascript","revpos":1},"phonegap.0.9.5.1.js":{"data":"LyoKICogUGhvbmVHYXAgaXMgYXZhaWxhYmxlIHVuZGVyICplaXRoZXIqIHRoZSB0ZXJtcyBvZiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UgKm9yKiB0aGUKICogTUlUIExpY2Vuc2UgKDIwMDgpLiBTZWUgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL2FscGhhYmV0aWNhbCBmb3IgZnVsbCB0ZXh0LgogKiAKICogQ29weXJpZ2h0IChjKSAyMDA1LTIwMTAsIE5pdG9iaSBTb2Z0d2FyZSBJbmMuCiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDExLCBJQk0gQ29ycG9yYXRpb24KICogQ29weXJpZ2h0IChjKSAyMDExLCBDb2RldmlzZSBTb2x1dGlvbnMgTHRkLgogKiBDb3B5cmlnaHQgKGMpIDIwMTEsIFByb3llY3RvcyBFcXVpcyBLYSwgUy5MLgogKiAKICovCgovKiBIZWxwZXIgY29kZSB0byByZXNvbHZlIGFub255bW91cyBjYWxsYmFjayBmdW5jdGlvbnMsCgpJZiB0aGUgZnVuY3Rpb24gY2FsbGJhY2sgY2FuIGJlIHJlc29sdmVkIGJ5IG5hbWUgaXQgaXMgcmV0dXJuZWQgdW5hbHRlcmVkLgpJZiB0aGUgZnVuY3Rpb24gaXMgZGVmaW5lZCBpbiBhbiB1bmtub3duIHNjb3BlIGFuZCBjYW4ndCBiZSByZXNvbHZlZCwgYW4gaW50ZXJuYWwgcmVmZXJlbmNlIHRvIHRoZSBmdW5jdGlvbiBpcyBhZGRlZCB0byB0aGUgaW50ZXJuYWwgbWFwLgoKQ2FsbGJhY2tzIGFkZGVkIHRvIHRoZSBtYXAgYXJlIG9uZSB0aW1lIHVzZSBvbmx5LCB0aGV5IHdpbGwgYmUgZGVsZXRlZCBvbmNlIGNhbGxlZC4gIAoKZXhhbXBsZSAxOgoKZnVuY3Rpb24gbXlDYWxsYmFjaygpe307CgpmU3RyaW5nID0gR2V0RnVuY3Rpb25OYW1lKG15Q2FsbGJhY2spOwoKLSByZXN1bHQsIHRoZSBmdW5jdGlvbiBpcyBkZWZpbmVkIGluIHRoZSBnbG9iYWwgc2NvcGUsIGFuZCB3aWxsIGJlIHJldHVybmVkIGFzIGlzIGJlY2F1c2UgaXQgY2FuIGJlIHJlc29sdmVkIGJ5IG5hbWUuCgpleGFtcGxlIDI6CgpmU3RyaW5nID0gR2V0RnVuY3Rpb25OYW1lKGZ1bmN0aW9uKCl7fTspOwoKLSByZXN1bHQsIHRoZSBmdW5jdGlvbiBpcyBkZWZpbmVkIGluIHBsYWNlLCBzbyBpdCB3aWxsIGJlIHJldHVybmVkIHVuY2hhbmdlZC4KCmV4YW1wbGUgMzoKCmZ1bmN0aW9uIG15TWV0aG9kKCkKewogICAgdmFyIGZ1bmsgPSBmdW5jdGlvbigpe307CiAgICBmU3RyaW5nID0gR2V0RnVuY3Rpb25OYW1lKGZ1bmspOwp9CgotIHJlc3VsdCwgdGhlIGZ1bmN0aW9uIENBTk5PVCBiZSByZXNvbHZlZCBieSBuYW1lLCBzbyBhbiBpbnRlcm5hbCByZWZlcmVuY2Ugd3JhcHBlciBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KCgoqLwoKCnZhciBfYW5vbUZ1bmtNYXAgPSB7fTsKdmFyIF9hbm9tRnVua01hcE5leHRJZCA9IDA7IAoKZnVuY3Rpb24gYW5vbVRvTmFtZUZ1bmsoZnVuKQp7Cgl2YXIgZnVua0lkID0gImYiICsgX2Fub21GdW5rTWFwTmV4dElkKys7Cgl2YXIgZnVuayA9IGZ1bmN0aW9uKCkKCXsKCQlmdW4uYXBwbHkodGhpcyxhcmd1bWVudHMpOwoJCV9hbm9tRnVua01hcFtmdW5rSWRdID0gbnVsbDsKCQlkZWxldGUgX2Fub21GdW5rTWFwW2Z1bmtJZF07CQoJfQoJX2Fub21GdW5rTWFwW2Z1bmtJZF0gPSBmdW5rOwoKCXJldHVybiAiX2Fub21GdW5rTWFwLiIgKyBmdW5rSWQ7Cn0KCmZ1bmN0aW9uIEdldEZ1bmN0aW9uTmFtZShmbikKewogIGlmICh0eXBlb2YgZm4gPT09ICJmdW5jdGlvbiIpIHsKICAgIHZhciBuYW1lPSBmbi5uYW1lOwkKCWlmICghbmFtZSkgewogICAgICB2YXIgbSA9IGZuLnRvU3RyaW5nKCkubWF0Y2goL15ccypmdW5jdGlvblxzKyhbXlxzXChdKykvKTsKICAgICAgbmFtZT0gbSAmJiBtWzFdOwkKCX0KCWlmIChuYW1lICYmICh3aW5kb3dbbmFtZV0gPT09IGZuKSkgewoJCXJldHVybiBuYW1lOwoJfSBlbHNlIHsKCQlyZXR1cm4gYW5vbVRvTmFtZUZ1bmsoZm4pOwoJfSAKICB9ZWxzZSB7CiAgCXJldHVybiBudWxsOwogIH0KfQppZiAodHlwZW9mIFBob25lR2FwID09PSAidW5kZWZpbmVkIikgewoKaWYgKHR5cGVvZihEZXZpY2VJbmZvKSAhPT0gJ29iamVjdCcpewogICAgRGV2aWNlSW5mbyA9IHt9Owp9Ci8qKgogKiBUaGlzIHJlcHJlc2VudHMgdGhlIFBob25lR2FwIEFQSSBpdHNlbGYsIGFuZCBwcm92aWRlcyBhIGdsb2JhbCBuYW1lc3BhY2UgZm9yIGFjY2Vzc2luZwogKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3RhdGUgb2YgUGhvbmVHYXAuCiAqIEBjbGFzcwogKi8KUGhvbmVHYXAgPSB7CiAgICBxdWV1ZTogewogICAgICAgIHJlYWR5OiB0cnVlLAogICAgICAgIGNvbW1hbmRzOiBbXSwKICAgICAgICB0aW1lcjogbnVsbAogICAgfSwKICAgIF9jb25zdHJ1Y3RvcnM6IFtdCn07CgovKioKICogTGlzdCBvZiByZXNvdXJjZSBmaWxlcyBsb2FkZWQgYnkgUGhvbmVHYXAuCiAqIFRoaXMgaXMgdXNlZCB0byBlbnN1cmUgSlMgYW5kIG90aGVyIGZpbGVzIGFyZSBsb2FkZWQgb25seSBvbmNlLgogKi8KUGhvbmVHYXAucmVzb3VyY2VzID0ge2Jhc2U6IHRydWV9OwoKLyoqCiAqIERldGVybWluZSBpZiByZXNvdXJjZSBoYXMgYmVlbiBsb2FkZWQgYnkgUGhvbmVHYXAKICoKICogQHBhcmFtIG5hbWUKICogQHJldHVybgogKi8KUGhvbmVHYXAuaGFzUmVzb3VyY2UgPSBmdW5jdGlvbihuYW1lKSB7CiAgICByZXR1cm4gUGhvbmVHYXAucmVzb3VyY2VzW25hbWVdOwp9OwoKLyoqCiAqIEFkZCBhIHJlc291cmNlIHRvIGxpc3Qgb2YgbG9hZGVkIHJlc291cmNlcyBieSBQaG9uZUdhcAogKgogKiBAcGFyYW0gbmFtZQogKi8KUGhvbmVHYXAuYWRkUmVzb3VyY2UgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBQaG9uZUdhcC5yZXNvdXJjZXNbbmFtZV0gPSB0cnVlOwp9OwoKLyoqCiAqIEJvb2xlYW4gZmxhZyBpbmRpY2F0aW5nIGlmIHRoZSBQaG9uZUdhcCBBUEkgaXMgYXZhaWxhYmxlIGFuZCBpbml0aWFsaXplZC4KICovIC8vIFRPRE86IFJlbW92ZSB0aGlzLCBpdCBpcyB1bnVzZWQgaGVyZSAuLi4gLWptClBob25lR2FwLmF2YWlsYWJsZSA9IERldmljZUluZm8udXVpZCAhPSB1bmRlZmluZWQ7CgovKioKICogQWRkIGFuIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uIHRvIGEgcXVldWUgdGhhdCBlbnN1cmVzIGl0IHdpbGwgcnVuIGFuZCBpbml0aWFsaXplCiAqIGFwcGxpY2F0aW9uIGNvbnN0cnVjdG9ycyBvbmx5IG9uY2UgUGhvbmVHYXAgaGFzIGJlZW4gaW5pdGlhbGl6ZWQuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIGNhbGxiYWNrIHlvdSB3YW50IHJ1biBvbmNlIFBob25lR2FwIGlzIGluaXRpYWxpemVkCiAqLwpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHZhciBzdGF0ZSA9IGRvY3VtZW50LnJlYWR5U3RhdGU7CiAgICBpZiAoICggc3RhdGUgPT0gJ2xvYWRlZCcgfHwgc3RhdGUgPT0gJ2NvbXBsZXRlJyApICYmIERldmljZUluZm8udXVpZCAhPSBudWxsICkKCXsKCQlmdW5jKCk7Cgl9CiAgICBlbHNlCgl7CiAgICAgICAgUGhvbmVHYXAuX2NvbnN0cnVjdG9ycy5wdXNoKGZ1bmMpOwoJfQp9OwoKKGZ1bmN0aW9uKCkgCiB7CiAgICB2YXIgdGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpCgl7CgkJCQkJCQkKCQl2YXIgc3RhdGUgPSBkb2N1bWVudC5yZWFkeVN0YXRlOwoJCQkJCQkJCiAgICAgICAgaWYgKCAoIHN0YXRlID09ICdsb2FkZWQnIHx8IHN0YXRlID09ICdjb21wbGV0ZScgKSAmJiBEZXZpY2VJbmZvLnV1aWQgIT0gbnVsbCApCgkJewoJCQljbGVhckludGVydmFsKHRpbWVyKTsgLy8gc3RvcCBsb29raW5nCgkJCS8vIHJ1biBvdXIgY29uc3RydWN0b3JzIGxpc3QKCQkJd2hpbGUgKFBob25lR2FwLl9jb25zdHJ1Y3RvcnMubGVuZ3RoID4gMCkgCgkJCXsKCQkJCXZhciBjb25zdHJ1Y3RvciA9IFBob25lR2FwLl9jb25zdHJ1Y3RvcnMuc2hpZnQoKTsKCQkJCXRyeSAKCQkJCXsKCQkJCQljb25zdHJ1Y3RvcigpOwoJCQkJfSAKCQkJCWNhdGNoKGUpIAoJCQkJewoJCQkJCWlmICh0eXBlb2YoZGVidWdbJ2xvZyddKSA9PSAnZnVuY3Rpb24nKQoJCQkJCXsKCQkJCQkJZGVidWcubG9nKCJGYWlsZWQgdG8gcnVuIGNvbnN0cnVjdG9yOiAiICsgZGVidWcucHJvY2Vzc01lc3NhZ2UoZSkpOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlhbGVydCgiRmFpbGVkIHRvIHJ1biBjb25zdHJ1Y3RvcjogIiArIGUubWVzc2FnZSk7CgkJCQkJfQoJCQkJfQogICAgICAgICAgICB9CgkJCS8vIGFsbCBjb25zdHJ1Y3RvcnMgcnVuLCBub3cgZmlyZSB0aGUgZGV2aWNlcmVhZHkgZXZlbnQKCQkJdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnRzJyk7IAoJCQllLmluaXRFdmVudCgnZGV2aWNlcmVhZHknKTsKCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChlKTsKCQl9CiAgICB9LCAxKTsKfSkoKTsKCgovLyBjZW50cmFsaXplZCBjYWxsYmFja3MKUGhvbmVHYXAuY2FsbGJhY2tJZCA9IDA7ClBob25lR2FwLmNhbGxiYWNrcyA9IHt9OwpQaG9uZUdhcC5jYWxsYmFja1N0YXR1cyA9IHsKICAgIE5PX1JFU1VMVDogMCwKICAgIE9LOiAxLAogICAgQ0xBU1NfTk9UX0ZPVU5EX0VYQ0VQVElPTjogMiwKICAgIElMTEVHQUxfQUNDRVNTX0VYQ0VQVElPTjogMywKICAgIElOU1RBTlRJQVRJT05fRVhDRVBUSU9OOiA0LAogICAgTUFMRk9STUVEX1VSTF9FWENFUFRJT046IDUsCiAgICBJT19FWENFUFRJT046IDYsCiAgICBJTlZBTElEX0FDVElPTjogNywKICAgIEpTT05fRVhDRVBUSU9OOiA4LAogICAgRVJST1I6IDkKICAgIH07CgovKioKICogRXhlY3V0ZSBhIFBob25lR2FwIGNvbW1hbmQgaW4gYSBxdWV1ZWQgZmFzaGlvbiwgdG8gZW5zdXJlIGNvbW1hbmRzIGRvIG5vdAogKiBleGVjdXRlIHdpdGggYW55IHJhY2UgY29uZGl0aW9ucywgYW5kIG9ubHkgcnVuIHdoZW4gUGhvbmVHYXAgaXMgcmVhZHkgdG8KICogcmVjZWl2ZSB0aGVtLgogKgogKi8KUGhvbmVHYXAuZXhlYyA9IGZ1bmN0aW9uKCkgeyAKCQogICAgUGhvbmVHYXAucXVldWUuY29tbWFuZHMucHVzaChhcmd1bWVudHMpOwogICAgaWYgKFBob25lR2FwLnF1ZXVlLnRpbWVyID09IG51bGwpCiAgICAgICAgUGhvbmVHYXAucXVldWUudGltZXIgPSBzZXRJbnRlcnZhbChQaG9uZUdhcC5ydW5fY29tbWFuZCwgMTApOwp9OwoKLyoqCiAqIEludGVybmFsIGZ1bmN0aW9uIHVzZWQgdG8gZGlzcGF0Y2ggdGhlIHJlcXVlc3QgdG8gUGhvbmVHYXAuICBJdCBwcm9jZXNzZXMgdGhlCiAqIGNvbW1hbmQgcXVldWUgYW5kIGV4ZWN1dGVzIHRoZSBuZXh0IGNvbW1hbmQgb24gdGhlIGxpc3QuICBTaW1wbGUgcGFyYW1ldGVycyBhcmUgcGFzc2VkCiAqIGFzIGFyZ3VtZW50cyBvbiB0aGUgdXJsLiAgSmF2YVNjcmlwdCBvYmplY3RzIGNvbnZlcnRlZCBpbnRvIGEgSlNPTiBzdHJpbmcgYW5kIHBhc3NlZCBhcyBhCiAqIHF1ZXJ5IHN0cmluZyBhcmd1bWVudCBvZiB0aGUgdXJsLgogKiBBcmd1bWVudHMgbWF5IGJlIGluIG9uZSBvZiB0d28gZm9ybWF0czoKICogICBGT1JNQVQgT05FIChwcmVmZXJhYmxlKQogKiBUaGUgbmF0aXZlIHNpZGUgd2lsbCBjYWxsIFBob25lR2FwLmNhbGxiYWNrU3VjY2VzcyBvciBQaG9uZUdhcC5jYWxsYmFja0Vycm9yLAogKiBkZXBlbmRpbmcgdXBvbiB0aGUgcmVzdWx0IG9mIHRoZSBhY3Rpb24uCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3MgICAgVGhlIHN1Y2Nlc3MgY2FsbGJhY2sKICogQHBhcmFtIHtGdW5jdGlvbn0gZmFpbCAgICAgICBUaGUgZmFpbCBjYWxsYmFjawogKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZSAgICAgIFRoZSBuYW1lIG9mIHRoZSBzZXJ2aWNlIHRvIHVzZQogKiBAcGFyYW0ge1N0cmluZ30gYWN0aW9uCQlUaGUgbmFtZSBvZiB0aGUgYWN0aW9uIHRvIHVzZQogKiBAcGFyYW0ge1N0cmluZ1tdfSBbYXJnc10gICAgIFplcm8gb3IgbW9yZSBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgbWV0aG9kCiAqICAJCiAqIEZPUk1BVCBUV08KICogQHBhcmFtIHtTdHJpbmd9IGNvbW1hbmQgQ29tbWFuZCB0byBiZSBydW4gaW4gUGhvbmVHYXAsIGUuZy4gIkNsYXNzTmFtZS5tZXRob2QiCiAqIEBwYXJhbSB7U3RyaW5nW119IFthcmdzXSBaZXJvIG9yIG1vcmUgYXJndW1lbnRzIHRvIHBhc3MgdG8gdGhlIG1ldGhvZAogKiBvYmplY3QgcGFyYW1ldGVycyBhcmUgcGFzc2VkIGFzIGFuIGFycmF5IG9iamVjdCBbb2JqZWN0MSwgb2JqZWN0Ml0gZWFjaCBvYmplY3Qgd2lsbCBiZSBwYXNzZWQgYXMgSlNPTiBzdHJpbmdzIAogKiBAcHJpdmF0ZQogKi8KUGhvbmVHYXAucnVuX2NvbW1hbmQgPSBmdW5jdGlvbigpIHsKICAgIGlmICghUGhvbmVHYXAuYXZhaWxhYmxlIHx8ICFQaG9uZUdhcC5xdWV1ZS5yZWFkeSkKICAgICAgICByZXR1cm47CgogICAgUGhvbmVHYXAucXVldWUucmVhZHkgPSBmYWxzZTsKCiAgICBpZighdGhpcy5nYXBCcmlkZ2UpewogICAgICAgIHRoaXMuZ2FwQnJpZGdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiSUZSQU1FIik7Cgl0aGlzLmdhcEJyaWRnZS5zZXRBdHRyaWJ1dGUoImhlaWdodCIsIjBweCIpOwoJdGhpcy5nYXBCcmlkZ2Uuc2V0QXR0cmlidXRlKCJ3aWR0aCIsIjBweCIpOwoJdGhpcy5nYXBCcmlkZ2Uuc2V0QXR0cmlidXRlKCJmcmFtZWJvcmRlciIsIjAiKTsKCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmdhcEJyaWRnZSk7CiAgICB9CgogICAgdmFyIGFyZ3MgPSBQaG9uZUdhcC5xdWV1ZS5jb21tYW5kcy5zaGlmdCgpOwogICAgaWYgKFBob25lR2FwLnF1ZXVlLmNvbW1hbmRzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbChQaG9uZUdhcC5xdWV1ZS50aW1lcik7CiAgICAgICAgUGhvbmVHYXAucXVldWUudGltZXIgPSBudWxsOwogICAgfQoJCgl2YXIgc2VydmljZTsKCXZhciBjYWxsYmFja0lkID0gbnVsbDsKCXZhciBzdGFydD0wOwogICAgdHJ5IHsKIAkJaWYgKGFyZ3NbMF0gPT0gbnVsbCB8fCB0eXBlb2YgYXJnc1swXSA9PT0gImZ1bmN0aW9uIikgewogCQkJdmFyIHN1Y2Nlc3MgPSBhcmdzWzBdOwogCQkJdmFyIGZhaWwgPSBhcmdzWzFdOwogCQkJc2VydmljZSA9IGFyZ3NbMl0gKyAiLiIgKyBhcmdzWzNdOwoJCQlhcmdzID0gYXJnc1s0XTsgIC8vYXJyYXkgb2YgYXJndW1lbnRzIHRvIAogCQkJY2FsbGJhY2tJZCA9IHNlcnZpY2UgKyBQaG9uZUdhcC5jYWxsYmFja0lkKys7CiAgICAgICAgCWlmIChzdWNjZXNzIHx8IGZhaWwpIHsKICAgICAgICAgICAgCVBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXSA9IHtzdWNjZXNzOnN1Y2Nlc3MsIGZhaWw6ZmFpbH07CiAgICAgICAgCX0KIAkJfSBlbHNlIHsgCiAJCQlzZXJ2aWNlID0gYXJnc1swXTsgCiAJCQlzdGFydCA9IDE7CiAJCX0KICAgICAgICAKICAgICAgICB2YXIgdXJpID0gW107CiAgICAJdmFyIGRpY3QgPSBudWxsOwogICAgCiAgICAJZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewogICAgICAgIAl2YXIgYXJnID0gYXJnc1tpXTsKICAgICAgICAJaWYgKGFyZyA9PSB1bmRlZmluZWQgfHwgYXJnID09IG51bGwpCiAgICAgICAgICAgIAljb250aW51ZTsKICAgICAgICAJaWYgKHR5cGVvZihhcmcpID09ICdvYmplY3QnKQogICAgICAgICAgICAJZGljdCA9IGFyZzsKICAgICAgICAJZWxzZQogICAgICAgICAgICAJdXJpLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGFyZykpOwogICAgCX0KICAgIAl2YXIgbmV4dCA9IGNhbGxiYWNrSWQgIT0gbnVsbCAgPyAgKCIvIiArIGNhbGxiYWNrSWQgKyAiLyIpIDogIi8iOwogICAgCXZhciB1cmwgPSAiZ2FwOi8vIiArIHNlcnZpY2UgKyBuZXh0ICsgdXJpLmpvaW4oIi8iKTsKCiAgICAJaWYgKGRpY3QgIT0gbnVsbCkgewogICAgICAgIAl1cmwgKz0gIj8iICsgZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGRpY3QpKTsKICAgIAl9CgogICAgICAgIHRoaXMuZ2FwQnJpZGdlLnNyYyA9IHVybDsKICAgCiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coIlBob25lR2FwRXhlYyBFcnJvcjogIitlKTsKICAgIH0KICAgIAoKfTsKLyoqCiAqIENhbGxlZCBieSBuYXRpdmUgY29kZSB3aGVuIHJldHVybmluZyBzdWNjZXNzZnVsIHJlc3VsdCBmcm9tIGFuIGFjdGlvbi4KICoKICogQHBhcmFtIGNhbGxiYWNrSWQKICogQHBhcmFtIGFyZ3MKICoJCWFyZ3Muc3RhdHVzIC0gUGhvbmVHYXAuY2FsbGJhY2tTdGF0dXMKICoJCWFyZ3MubWVzc2FnZSAtIHJldHVybiB2YWx1ZQogKgkJYXJncy5rZWVwQ2FsbGJhY2sgLSAwIHRvIHJlbW92ZSBjYWxsYmFjaywgMSB0byBrZWVwIGNhbGxiYWNrIGluIFBob25lR2FwLmNhbGxiYWNrc1tdCiAqLwpQaG9uZUdhcC5jYWxsYmFja1N1Y2Nlc3MgPSBmdW5jdGlvbihjYWxsYmFja0lkLCBhcmdzKSB7CiAgICBpZiAoUGhvbmVHYXAuY2FsbGJhY2tzW2NhbGxiYWNrSWRdKSB7CgogICAgICAgIC8vIElmIHJlc3VsdCBpcyB0byBiZSBzZW50IHRvIGNhbGxiYWNrCiAgICAgICAgaWYgKGFyZ3Muc3RhdHVzID09IFBob25lR2FwLmNhbGxiYWNrU3RhdHVzLk9LKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoUGhvbmVHYXAuY2FsbGJhY2tzW2NhbGxiYWNrSWRdLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgCQlQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF0uc3VjY2VzcyhhcmdzLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3IgaW4gc3VjY2VzcyBjYWxsYmFjazogIitjYWxsYmFja0lkKyIgPSAiK2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgCiAgICAgICAgLy8gQ2xlYXIgY2FsbGJhY2sgaWYgbm90IGV4cGVjdGluZyBhbnkgbW9yZSByZXN1bHRzCiAgICAgICAgaWYgKCFhcmdzLmtlZXBDYWxsYmFjaykgewogICAgICAgICAgICBkZWxldGUgUGhvbmVHYXAuY2FsbGJhY2tzW2NhbGxiYWNrSWRdOwogICAgICAgIH0KICAgIH0KfTsKCi8qKgogKiBDYWxsZWQgYnkgbmF0aXZlIGNvZGUgd2hlbiByZXR1cm5pbmcgZXJyb3IgcmVzdWx0IGZyb20gYW4gYWN0aW9uLgogKgogKiBAcGFyYW0gY2FsbGJhY2tJZAogKiBAcGFyYW0gYXJncwogKi8KUGhvbmVHYXAuY2FsbGJhY2tFcnJvciA9IGZ1bmN0aW9uKGNhbGxiYWNrSWQsIGFyZ3MpIHsKICAgIGlmIChQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF0pIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoUGhvbmVHYXAuY2FsbGJhY2tzW2NhbGxiYWNrSWRdLmZhaWwpIHsKICAgICAgICAgICAgICAgIFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXS5mYWlsKGFyZ3MubWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIkVycm9yIGluIGVycm9yIGNhbGxiYWNrOiAiK2NhbGxiYWNrSWQrIiA9ICIrZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIENsZWFyIGNhbGxiYWNrIGlmIG5vdCBleHBlY3RpbmcgYW55IG1vcmUgcmVzdWx0cwogICAgICAgIGlmICghYXJncy5rZWVwQ2FsbGJhY2spIHsKICAgICAgICAgICAgZGVsZXRlIFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXTsKICAgICAgICB9CiAgICB9Cn07CgoKLyoqCiAqIERvZXMgYSBkZWVwIGNsb25lIG9mIHRoZSBvYmplY3QuCiAqCiAqIEBwYXJhbSBvYmoKICogQHJldHVybgogKi8KUGhvbmVHYXAuY2xvbmUgPSBmdW5jdGlvbihvYmopIHsKCWlmKCFvYmopIHsgCgkJcmV0dXJuIG9iajsKCX0KCglpZihvYmogaW5zdGFuY2VvZiBBcnJheSl7CgkJdmFyIHJldFZhbCA9IG5ldyBBcnJheSgpOwoJCWZvcih2YXIgaSA9IDA7IGkgPCBvYmoubGVuZ3RoOyArK2kpewoJCQlyZXRWYWwucHVzaChQaG9uZUdhcC5jbG9uZShvYmpbaV0pKTsKCQl9CgkJcmV0dXJuIHJldFZhbDsKCX0KCglpZiAob2JqIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKCQlyZXR1cm4gb2JqOwoJfQoKCWlmKCEob2JqIGluc3RhbmNlb2YgT2JqZWN0KSl7CgkJcmV0dXJuIG9iajsKCX0KCQoJaWYgKG9iaiBpbnN0YW5jZW9mIERhdGUpIHsKCQlyZXR1cm4gb2JqOwoJfQoKCXJldFZhbCA9IG5ldyBPYmplY3QoKTsKCWZvcihpIGluIG9iail7CgkJaWYoIShpIGluIHJldFZhbCkgfHwgcmV0VmFsW2ldICE9IG9ialtpXSkgewoJCQlyZXRWYWxbaV0gPSBQaG9uZUdhcC5jbG9uZShvYmpbaV0pOwoJCX0KCX0KCXJldHVybiByZXRWYWw7Cn07CgovLyBJbnRlcmNlcHQgY2FsbHMgdG8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciBhbmQgd2F0Y2ggZm9yIHVubG9hZAoKUGhvbmVHYXAubV9kb2N1bWVudF9hZGRFdmVudExpc3RlbmVyID0gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcjsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldnQsIGhhbmRsZXIsIGNhcHR1cmUpIHsKICAgIHZhciBlID0gZXZ0LnRvTG93ZXJDYXNlKCk7CiAgICBpZiAoZSA9PT0gJ3VubG9hZCcpIAoJewogICAgICAgIFBob25lR2FwLm9uVW5sb2FkID0gZnVuY3Rpb24oZSl7IHJldHVybiBoYW5kbGVyKGUpO307CiAgICB9ICAgICAKICAgIGVsc2UgCiAgICB7ICAgICAgICAKICAgICAgICBQaG9uZUdhcC5tX2RvY3VtZW50X2FkZEV2ZW50TGlzdGVuZXIuY2FsbChkb2N1bWVudCwgZXZ0LCBoYW5kbGVyLCBjYXB0dXJlKTsKICAgIH0KfTsKCi8vIEludGVyY2VwdCBjYWxscyB0byBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyIGFuZCB3YXRjaCBmb3IgZXZlbnRzIHRoYXQgCi8vIGFyZSBnZW5lcmF0ZWQgYnkgUGhvbmVHYXAgbmF0aXZlIGNvZGUKClBob25lR2FwLm1fZG9jdW1lbnRfcmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXI7Cgpkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oZXZ0LCBoYW5kbGVyLCBjYXB0dXJlKSAKewogICAgdmFyIGUgPSBldnQudG9Mb3dlckNhc2UoKTsKCiAgICBpZiAoZSA9PT0gJ3VubG9hZCcpIAoJewogICAgICAgIFBob25lR2FwLm9uVW5sb2FkID0gbnVsbDsKICAgIH0gCgogICAgUGhvbmVHYXAubV9kb2N1bWVudF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwoZG9jdW1lbnQsIGV2dCwgaGFuZGxlciwgY2FwdHVyZSk7Cn07CgovKioKICogTWV0aG9kIHRvIGZpcmUgZXZlbnQgZnJvbSBuYXRpdmUgY29kZQogKi8KUGhvbmVHYXAuZmlyZUV2ZW50ID0gZnVuY3Rpb24odHlwZSkgewogICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnRzJyk7CiAgICBlLmluaXRFdmVudCh0eXBlKTsKICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoZSk7Cn07Cgp9O2lmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImRlYnVnY29uc29sZSIpKSB7CglQaG9uZUdhcC5hZGRSZXNvdXJjZSgiZGVidWdjb25zb2xlIik7CgkKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYWNjZXNzIHRvIHRoZSBkZWJ1Z2dpbmcgY29uc29sZS4KICogQGNvbnN0cnVjdG9yCiAqLwpEZWJ1Z0NvbnNvbGUgPSBmdW5jdGlvbihpc0RlcHJlY2F0ZWQpIHsKICAgIHRoaXMubG9nTGV2ZWwgPSBEZWJ1Z0NvbnNvbGUuSU5GT19MRVZFTDsKICAgIHRoaXMuaXNEZXByZWNhdGVkID0gaXNEZXByZWNhdGVkID8gdHJ1ZSA6IGZhbHNlOwp9CgovLyBmcm9tIG1vc3QgdmVyYm9zZSwgdG8gbGVhc3QgdmVyYm9zZQpEZWJ1Z0NvbnNvbGUuQUxMX0xFVkVMICAgID0gMTsgLy8gc2FtZSBhcyBmaXJzdCBsZXZlbApEZWJ1Z0NvbnNvbGUuSU5GT19MRVZFTCAgID0gMTsKRGVidWdDb25zb2xlLldBUk5fTEVWRUwgICA9IDI7CkRlYnVnQ29uc29sZS5FUlJPUl9MRVZFTCAgPSA0OwpEZWJ1Z0NvbnNvbGUuTk9ORV9MRVZFTCAgID0gODsKCQkJCQkJCQkJCQkJCQpEZWJ1Z0NvbnNvbGUucHJvdG90eXBlLnNldExldmVsID0gZnVuY3Rpb24obGV2ZWwpIHsKICAgIHRoaXMubG9nTGV2ZWwgPSBsZXZlbDsKfTsKCi8qKgogKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZW5kZXJpbmcgYW5kIGluZGVudGluZyBzdHJpbmdzLCBvciBzZXJpYWxpemluZwogKiBvYmplY3RzIHRvIGEgc3RyaW5nIGNhcGFibGUgb2YgYmVpbmcgcHJpbnRlZCB0byB0aGUgY29uc29sZS4KICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBtZXNzYWdlIFRoZSBzdHJpbmcgb3Igb2JqZWN0IHRvIGNvbnZlcnQgdG8gYW4gaW5kZW50ZWQgc3RyaW5nCiAqIEBwcml2YXRlCiAqLwpEZWJ1Z0NvbnNvbGUucHJvdG90eXBlLnByb2Nlc3NNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSwgbWF4RGVwdGgpIHsKCWlmIChtYXhEZXB0aCA9PT0gdW5kZWZpbmVkKSBtYXhEZXB0aCA9IDA7CiAgICBpZiAodHlwZW9mKG1lc3NhZ2UpICE9ICdvYmplY3QnKSB7CiAgICAgICAgcmV0dXJuICh0aGlzLmlzRGVwcmVjYXRlZCA/ICJXQVJOSU5HOiBkZWJ1ZyBvYmplY3QgaXMgZGVwcmVjYXRlZCwgcGxlYXNlIHVzZSBjb25zb2xlIG9iamVjdCBcbiIgKyBtZXNzYWdlIDogbWVzc2FnZSk7CiAgICB9IGVsc2UgewogICAgICAgIC8qKgogICAgICAgICAqIEBmdW5jdGlvbgogICAgICAgICAqIEBpZ25vcmUKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBpbmRlbnQoc3RyKSB7CiAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvXi9tZywgIiAgICAiKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQGZ1bmN0aW9uCiAgICAgICAgICogQGlnbm9yZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIG1ha2VTdHJ1Y3R1cmVkKG9iaiwgZGVwdGgpIHsKICAgICAgICAgICAgdmFyIHN0ciA9ICIiOwogICAgICAgICAgICBmb3IgKHZhciBpIGluIG9iaikgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9ialtpXSkgPT0gJ29iamVjdCcgJiYgZGVwdGggPCBtYXhEZXB0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gaSArICI6XG4iICsgaW5kZW50KG1ha2VTdHJ1Y3R1cmVkKG9ialtpXSkpICsgIlxuIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gaSArICIgPSAiICsgaW5kZW50KFN0cmluZyhvYmpbaV0pKS5yZXBsYWNlKC9eICAgIC8sICIiKSArICJcbiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgICAgICAgICAgc3RyICs9IGkgKyAiID0gRVhDRVBUSU9OOiAiICsgZS5tZXNzYWdlICsgIlxuIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc3RyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gKCh0aGlzLmlzRGVwcmVjYXRlZCA/ICJXQVJOSU5HOiBkZWJ1ZyBvYmplY3QgaXMgZGVwcmVjYXRlZCwgcGxlYXNlIHVzZSBjb25zb2xlIG9iamVjdFxuIiA6ICAiIikgKyAiT2JqZWN0OlxuIiArIG1ha2VTdHJ1Y3R1cmVkKG1lc3NhZ2UsIG1heERlcHRoKSk7CiAgICB9Cn07CgovKioKICogUHJpbnQgYSBub3JtYWwgbG9nIG1lc3NhZ2UgdG8gdGhlIGNvbnNvbGUKICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBtZXNzYWdlIE1lc3NhZ2Ugb3Igb2JqZWN0IHRvIHByaW50IHRvIHRoZSBjb25zb2xlCiAqLwpEZWJ1Z0NvbnNvbGUucHJvdG90eXBlLmxvZyA9IGZ1bmN0aW9uKG1lc3NhZ2UsIG1heERlcHRoKSB7CiAgICBpZiAoUGhvbmVHYXAuYXZhaWxhYmxlICYmIHRoaXMubG9nTGV2ZWwgPD0gRGVidWdDb25zb2xlLklORk9fTEVWRUwpCiAgICAgICAgUGhvbmVHYXAuZXhlYygnRGVidWdDb25zb2xlLmxvZycsCiAgICAgICAgICAgIHRoaXMucHJvY2Vzc01lc3NhZ2UobWVzc2FnZSwgbWF4RGVwdGgpLAogICAgICAgICAgICB7IGxvZ0xldmVsOiAnSU5GTycgfQogICAgICAgICk7CiAgICBlbHNlCiAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7Cn07CgovKioKICogUHJpbnQgYSB3YXJuaW5nIG1lc3NhZ2UgdG8gdGhlIGNvbnNvbGUKICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBtZXNzYWdlIE1lc3NhZ2Ugb3Igb2JqZWN0IHRvIHByaW50IHRvIHRoZSBjb25zb2xlCiAqLwpEZWJ1Z0NvbnNvbGUucHJvdG90eXBlLndhcm4gPSBmdW5jdGlvbihtZXNzYWdlLCBtYXhEZXB0aCkgewogICAgaWYgKFBob25lR2FwLmF2YWlsYWJsZSAmJiB0aGlzLmxvZ0xldmVsIDw9IERlYnVnQ29uc29sZS5XQVJOX0xFVkVMKQogICAgICAgIFBob25lR2FwLmV4ZWMoJ0RlYnVnQ29uc29sZS5sb2cnLAogICAgICAgICAgICB0aGlzLnByb2Nlc3NNZXNzYWdlKG1lc3NhZ2UsIG1heERlcHRoKSwKICAgICAgICAgICAgeyBsb2dMZXZlbDogJ1dBUk4nIH0KICAgICAgICApOwogICAgZWxzZQogICAgICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7Cn07CgovKioKICogUHJpbnQgYW4gZXJyb3IgbWVzc2FnZSB0byB0aGUgY29uc29sZQogKiBAcGFyYW0ge09iamVjdHxTdHJpbmd9IG1lc3NhZ2UgTWVzc2FnZSBvciBvYmplY3QgdG8gcHJpbnQgdG8gdGhlIGNvbnNvbGUKICovCkRlYnVnQ29uc29sZS5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlLCBtYXhEZXB0aCkgewogICAgaWYgKFBob25lR2FwLmF2YWlsYWJsZSAmJiB0aGlzLmxvZ0xldmVsIDw9IERlYnVnQ29uc29sZS5FUlJPUl9MRVZFTCkKICAgICAgICBQaG9uZUdhcC5leGVjKCdEZWJ1Z0NvbnNvbGUubG9nJywKICAgICAgICAgICAgdGhpcy5wcm9jZXNzTWVzc2FnZShtZXNzYWdlLCBtYXhEZXB0aCksCiAgICAgICAgICAgIHsgbG9nTGV2ZWw6ICdFUlJPUicgfQogICAgICAgICk7CiAgICBlbHNlCiAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsKfTsKClBob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCkgewogICAgd2luZG93LmNvbnNvbGUgPSBuZXcgRGVidWdDb25zb2xlKCk7CiAgICB3aW5kb3cuZGVidWcgPSBuZXcgRGVidWdDb25zb2xlKHRydWUpOwp9KTsKfTsKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgicG9zaXRpb24iKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoInBvc2l0aW9uIik7CgovKioKICogVGhpcyBjbGFzcyBjb250YWlucyBwb3NpdGlvbiBpbmZvcm1hdGlvbi4KICogQHBhcmFtIHtPYmplY3R9IGxhdAogKiBAcGFyYW0ge09iamVjdH0gbG5nCiAqIEBwYXJhbSB7T2JqZWN0fSBhY2MKICogQHBhcmFtIHtPYmplY3R9IGFsdAogKiBAcGFyYW0ge09iamVjdH0gYWx0QWNjCiAqIEBwYXJhbSB7T2JqZWN0fSBoZWFkCiAqIEBwYXJhbSB7T2JqZWN0fSB2ZWwKICogQGNvbnN0cnVjdG9yCiAqLwpQb3NpdGlvbiA9IGZ1bmN0aW9uKGNvb3JkcywgdGltZXN0YW1wKSB7Cgl0aGlzLmNvb3JkcyA9IENvb3JkaW5hdGVzLmNsb25lRnJvbShjb29yZHMpOwogICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXAgfHwgbmV3IERhdGUoKS5nZXRUaW1lKCk7Cn07CgpQb3NpdGlvbi5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24ob3RoZXIpIHsKICAgIHJldHVybiAodGhpcy5jb29yZHMgJiYgb3RoZXIgJiYgb3RoZXIuY29vcmRzICYmCiAgICAgICAgICAgIHRoaXMuY29vcmRzLmxhdGl0dWRlID09IG90aGVyLmNvb3Jkcy5sYXRpdHVkZSAmJgogICAgICAgICAgICB0aGlzLmNvb3Jkcy5sb25naXR1ZGUgPT0gb3RoZXIuY29vcmRzLmxvbmdpdHVkZSk7Cn07CgpQb3NpdGlvbi5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpCnsKICAgIHJldHVybiBuZXcgUG9zaXRpb24oCiAgICAgICAgdGhpcy5jb29yZHM/IHRoaXMuY29vcmRzLmNsb25lKCkgOiBudWxsLAogICAgICAgIHRoaXMudGltZXN0YW1wPyB0aGlzLnRpbWVzdGFtcCA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICApOwp9CgpDb29yZGluYXRlcyA9IGZ1bmN0aW9uKGxhdCwgbG5nLCBhbHQsIGFjYywgaGVhZCwgdmVsLCBhbHRBY2MpIHsKCS8qKgoJICogVGhlIGxhdGl0dWRlIG9mIHRoZSBwb3NpdGlvbi4KCSAqLwoJdGhpcy5sYXRpdHVkZSA9IGxhdDsKCS8qKgoJICogVGhlIGxvbmdpdHVkZSBvZiB0aGUgcG9zaXRpb24sCgkgKi8KCXRoaXMubG9uZ2l0dWRlID0gbG5nOwoJLyoqCgkgKiBUaGUgYWx0aXR1ZGUgb2YgdGhlIHBvc2l0aW9uLgoJICovCgl0aGlzLmFsdGl0dWRlID0gYWx0OwoJLyoqCgkgKiBUaGUgYWNjdXJhY3kgb2YgdGhlIHBvc2l0aW9uLgoJICovCgl0aGlzLmFjY3VyYWN5ID0gYWNjOwoJLyoqCgkgKiBUaGUgZGlyZWN0aW9uIHRoZSBkZXZpY2UgaXMgbW92aW5nIGF0IHRoZSBwb3NpdGlvbi4KCSAqLwoJdGhpcy5oZWFkaW5nID0gaGVhZDsKCS8qKgoJICogVGhlIHZlbG9jaXR5IHdpdGggd2hpY2ggdGhlIGRldmljZSBpcyBtb3ZpbmcgYXQgdGhlIHBvc2l0aW9uLgoJICovCgl0aGlzLnNwZWVkID0gdmVsOwoJLyoqCgkgKiBUaGUgYWx0aXR1ZGUgYWNjdXJhY3kgb2YgdGhlIHBvc2l0aW9uLgoJICovCgl0aGlzLmFsdGl0dWRlQWNjdXJhY3kgPSAoYWx0QWNjICE9ICd1bmRlZmluZWQnKSA/IGFsdEFjYyA6IG51bGw7IAp9OwoKQ29vcmRpbmF0ZXMucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKQp7CiAgICByZXR1cm4gbmV3IENvb3JkaW5hdGVzKAogICAgICAgIHRoaXMubGF0aXR1ZGUsCiAgICAgICAgdGhpcy5sb25naXR1ZGUsCiAgICAgICAgdGhpcy5hbHRpdHVkZSwKICAgICAgICB0aGlzLmFjY3VyYWN5LAogICAgICAgIHRoaXMuaGVhZGluZywKICAgICAgICB0aGlzLnNwZWVkLAogICAgICAgIHRoaXMuYWx0aXR1ZGVBY2N1cmFjeQogICAgKTsKfTsKCkNvb3JkaW5hdGVzLmNsb25lRnJvbSA9IGZ1bmN0aW9uKG9iaikKewogICAgcmV0dXJuIG5ldyBDb29yZGluYXRlcygKICAgICAgICBvYmoubGF0aXR1ZGUsCiAgICAgICAgb2JqLmxvbmdpdHVkZSwKICAgICAgICBvYmouYWx0aXR1ZGUsCiAgICAgICAgb2JqLmFjY3VyYWN5LAogICAgICAgIG9iai5oZWFkaW5nLAogICAgICAgIG9iai5zcGVlZCwKICAgICAgICBvYmouYWx0aXR1ZGVBY2N1cmFjeQogICAgKTsKfTsKCi8qKgogKiBUaGlzIGNsYXNzIHNwZWNpZmllcyB0aGUgb3B0aW9ucyBmb3IgcmVxdWVzdGluZyBwb3NpdGlvbiBkYXRhLgogKiBAY29uc3RydWN0b3IKICovClBvc2l0aW9uT3B0aW9ucyA9IGZ1bmN0aW9uKGVuYWJsZUhpZ2hBY2N1cmFjeSwgdGltZW91dCwgbWF4aW11bUFnZSkgewoJLyoqCgkgKiBTcGVjaWZpZXMgdGhlIGRlc2lyZWQgcG9zaXRpb24gYWNjdXJhY3kuCgkgKi8KCXRoaXMuZW5hYmxlSGlnaEFjY3VyYWN5ID0gZW5hYmxlSGlnaEFjY3VyYWN5IHx8IGZhbHNlOwoJLyoqCgkgKiBUaGUgdGltZW91dCBhZnRlciB3aGljaCBpZiBwb3NpdGlvbiBkYXRhIGNhbm5vdCBiZSBvYnRhaW5lZCB0aGUgZXJyb3JDYWxsYmFjawoJICogaXMgY2FsbGVkLgoJICovCgl0aGlzLnRpbWVvdXQgPSB0aW1lb3V0IHx8IDEwMDAwOwoJLyoqCiAgICAgKiBUaGUgYWdlIG9mIGEgY2FjaGVkIHBvc2l0aW9uIHdob3NlIGFnZSBpcyBubyBncmVhdGVyIHRoYW4gdGhlIHNwZWNpZmllZCB0aW1lIAogICAgICogaW4gbWlsbGlzZWNvbmRzLiAKICAgICAqLwoJdGhpcy5tYXhpbXVtQWdlID0gbWF4aW11bUFnZSB8fCAwOwp9OwoKLyoqCiAqIFRoaXMgY2xhc3MgY29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgYW55IEdQUyBlcnJvcnMuCiAqIEBjb25zdHJ1Y3RvcgogKi8KUG9zaXRpb25FcnJvciA9IGZ1bmN0aW9uKGNvZGUsIG1lc3NhZ2UpIHsKCXRoaXMuY29kZSA9IGNvZGUgfHwgMDsKCXRoaXMubWVzc2FnZSA9IG1lc3NhZ2UgfHwgIiI7Cn07CgpQb3NpdGlvbkVycm9yLlVOS05PV05fRVJST1IgPSAwOwpQb3NpdGlvbkVycm9yLlBFUk1JU1NJT05fREVOSUVEID0gMTsKUG9zaXRpb25FcnJvci5QT1NJVElPTl9VTkFWQUlMQUJMRSA9IDI7ClBvc2l0aW9uRXJyb3IuVElNRU9VVCA9IDM7Cgp9O2lmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImFjY2VsZXJhdGlvbiIpKSB7CglQaG9uZUdhcC5hZGRSZXNvdXJjZSgiYWNjZWxlcmF0aW9uIik7CiAJCgovKioKICogVGhpcyBjbGFzcyBjb250YWlucyBhY2NlbGVyYXRpb24gaW5mb3JtYXRpb24KICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSB7TnVtYmVyfSB4IFRoZSBmb3JjZSBhcHBsaWVkIGJ5IHRoZSBkZXZpY2UgaW4gdGhlIHgtYXhpcy4KICogQHBhcmFtIHtOdW1iZXJ9IHkgVGhlIGZvcmNlIGFwcGxpZWQgYnkgdGhlIGRldmljZSBpbiB0aGUgeS1heGlzLgogKiBAcGFyYW0ge051bWJlcn0geiBUaGUgZm9yY2UgYXBwbGllZCBieSB0aGUgZGV2aWNlIGluIHRoZSB6LWF4aXMuCiAqLwpBY2NlbGVyYXRpb24gPSBmdW5jdGlvbih4LCB5LCB6KSB7CgkvKioKCSAqIFRoZSBmb3JjZSBhcHBsaWVkIGJ5IHRoZSBkZXZpY2UgaW4gdGhlIHgtYXhpcy4KCSAqLwoJdGhpcy54ID0geDsKCS8qKgoJICogVGhlIGZvcmNlIGFwcGxpZWQgYnkgdGhlIGRldmljZSBpbiB0aGUgeS1heGlzLgoJICovCgl0aGlzLnkgPSB5OwoJLyoqCgkgKiBUaGUgZm9yY2UgYXBwbGllZCBieSB0aGUgZGV2aWNlIGluIHRoZSB6LWF4aXMuCgkgKi8KCXRoaXMueiA9IHo7CgkvKioKCSAqIFRoZSB0aW1lIHRoYXQgdGhlIGFjY2VsZXJhdGlvbiB3YXMgb2J0YWluZWQuCgkgKi8KCXRoaXMudGltZXN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7Cn0KCi8qKgogKiBUaGlzIGNsYXNzIHNwZWNpZmllcyB0aGUgb3B0aW9ucyBmb3IgcmVxdWVzdGluZyBhY2NlbGVyYXRpb24gZGF0YS4KICogQGNvbnN0cnVjdG9yCiAqLwpBY2NlbGVyYXRpb25PcHRpb25zID0gZnVuY3Rpb24oKSB7CgkvKioKCSAqIFRoZSB0aW1lb3V0IGFmdGVyIHdoaWNoIGlmIGFjY2VsZXJhdGlvbiBkYXRhIGNhbm5vdCBiZSBvYnRhaW5lZCB0aGUgZXJyb3JDYWxsYmFjawoJICogaXMgY2FsbGVkLgoJICovCgl0aGlzLnRpbWVvdXQgPSAxMDAwMDsKfQp9O2lmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImFjY2VsZXJvbWV0ZXIiKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoImFjY2VsZXJvbWV0ZXIiKTsKCi8qKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIGFjY2VzcyB0byBkZXZpY2UgYWNjZWxlcm9tZXRlciBkYXRhLgogKiBAY29uc3RydWN0b3IKICovCkFjY2VsZXJvbWV0ZXIgPSBmdW5jdGlvbigpIAp7CgkvKioKCSAqIFRoZSBsYXN0IGtub3duIGFjY2VsZXJhdGlvbi4KCSAqLwoJdGhpcy5sYXN0QWNjZWxlcmF0aW9uID0gbmV3IEFjY2VsZXJhdGlvbigwLDAsMCk7Cn0KCi8qKgogKiBBc3luY2hyb25vdXNseSBhcXVpcmVzIHRoZSBjdXJyZW50IGFjY2VsZXJhdGlvbi4KICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGFjY2VsZXJhdGlvbgogKiBkYXRhIGlzIGF2YWlsYWJsZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgCiAqIGdldHRpbmcgdGhlIGFjY2VsZXJhdGlvbiBkYXRhLgogKiBAcGFyYW0ge0FjY2VsZXJhdGlvbk9wdGlvbnN9IG9wdGlvbnMgVGhlIG9wdGlvbnMgZm9yIGdldHRpbmcgdGhlIGFjY2VsZXJvbWV0ZXIgZGF0YQogKiBzdWNoIGFzIHRpbWVvdXQuCiAqLwpBY2NlbGVyb21ldGVyLnByb3RvdHlwZS5nZXRDdXJyZW50QWNjZWxlcmF0aW9uID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CgkvLyBJZiB0aGUgYWNjZWxlcmF0aW9uIGlzIGF2YWlsYWJsZSB0aGVuIGNhbGwgc3VjY2VzcwoJLy8gSWYgdGhlIGFjY2VsZXJhdGlvbiBpcyBub3QgYXZhaWxhYmxlIHRoZW4gY2FsbCBlcnJvcgoJCgkvLyBDcmVhdGVkIGZvciBpUGhvbmUsIElwaG9uZSBwYXNzZXMgYmFjayBfYWNjZWwgb2JqIGxpdHRlcmFsCglpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayA9PSAiZnVuY3Rpb24iKSB7CgkJc3VjY2Vzc0NhbGxiYWNrKHRoaXMubGFzdEFjY2VsZXJhdGlvbik7Cgl9Cn07CgovLyBwcml2YXRlIGNhbGxiYWNrIGNhbGxlZCBmcm9tIE9iai1DIGJ5IG5hbWUKQWNjZWxlcm9tZXRlci5wcm90b3R5cGUuX29uQWNjZWxVcGRhdGUgPSBmdW5jdGlvbih4LHkseikKewogICB0aGlzLmxhc3RBY2NlbGVyYXRpb24gPSBuZXcgQWNjZWxlcmF0aW9uKHgseSx6KTsKfTsKCi8qKgogKiBBc3luY2hyb25vdXNseSBhcXVpcmVzIHRoZSBhY2NlbGVyYXRpb24gcmVwZWF0ZWRseSBhdCBhIGdpdmVuIGludGVydmFsLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZWFjaCB0aW1lIHRoZSBhY2NlbGVyYXRpb24KICogZGF0YSBpcyBhdmFpbGFibGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIAogKiBnZXR0aW5nIHRoZSBhY2NlbGVyYXRpb24gZGF0YS4KICogQHBhcmFtIHtBY2NlbGVyYXRpb25PcHRpb25zfSBvcHRpb25zIFRoZSBvcHRpb25zIGZvciBnZXR0aW5nIHRoZSBhY2NlbGVyb21ldGVyIGRhdGEKICogc3VjaCBhcyB0aW1lb3V0LgogKi8KCkFjY2VsZXJvbWV0ZXIucHJvdG90eXBlLndhdGNoQWNjZWxlcmF0aW9uID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CgkvL3RoaXMuZ2V0Q3VycmVudEFjY2VsZXJhdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpOwoJLy8gVE9ETzogYWRkIHRoZSBpbnRlcnZhbCBpZCB0byBhIGxpc3Qgc28gd2UgY2FuIGNsZWFyIGFsbCB3YXRjaGVzCiAJdmFyIGZyZXF1ZW5jeSA9IChvcHRpb25zICE9IHVuZGVmaW5lZCAmJiBvcHRpb25zLmZyZXF1ZW5jeSAhPSB1bmRlZmluZWQpID8gb3B0aW9ucy5mcmVxdWVuY3kgOiAxMDAwMDsKCXZhciB1cGRhdGVkT3B0aW9ucyA9IHsKCQlkZXNpcmVkRnJlcXVlbmN5OmZyZXF1ZW5jeSAKCX0KCVBob25lR2FwLmV4ZWMoIkFjY2VsZXJvbWV0ZXIuc3RhcnQiLG9wdGlvbnMpOwoKCXJldHVybiBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKCQluYXZpZ2F0b3IuYWNjZWxlcm9tZXRlci5nZXRDdXJyZW50QWNjZWxlcmF0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucyk7Cgl9LCBmcmVxdWVuY3kpOwp9OwoKLyoqCiAqIENsZWFycyB0aGUgc3BlY2lmaWVkIGFjY2VsZXJvbWV0ZXIgd2F0Y2guCiAqIEBwYXJhbSB7U3RyaW5nfSB3YXRjaElkIFRoZSBJRCBvZiB0aGUgd2F0Y2ggcmV0dXJuZWQgZnJvbSAjd2F0Y2hBY2NlbGVyYXRpb24uCiAqLwpBY2NlbGVyb21ldGVyLnByb3RvdHlwZS5jbGVhcldhdGNoID0gZnVuY3Rpb24od2F0Y2hJZCkgewoJUGhvbmVHYXAuZXhlYygiQWNjZWxlcm9tZXRlci5zdG9wIik7CgljbGVhckludGVydmFsKHdhdGNoSWQpOwp9OwoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mIG5hdmlnYXRvci5hY2NlbGVyb21ldGVyID09ICJ1bmRlZmluZWQiKSBuYXZpZ2F0b3IuYWNjZWxlcm9tZXRlciA9IG5ldyBBY2NlbGVyb21ldGVyKCk7Cn0pOwp9O2lmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImNhbWVyYSIpKSB7CglQaG9uZUdhcC5hZGRSZXNvdXJjZSgiY2FtZXJhIik7CgkKLy8gYWRkaW5nIGluIHByZXBhcmF0aW9uIHRvIHN3aXRjaCB0byBNZWRpYSBjYXB0dXJlIEFQSQpDYXB0dXJlRXJyb3IgPSBmdW5jdGlvbigpIHsKICAgdGhpcy5jb2RlID0gbnVsbDsKfQoKLy8gY2FwdHVyZSBlcnJvciBjb2RlcwpDYXB0dXJlRXJyb3IuQ0FQVFVSRV9JTlRFUk5BTF9FUlIgPSAwOwpDYXB0dXJlRXJyb3IuQ0FQVFVSRV9BUFBMSUNBVElPTl9CVVNZID0gMTsKQ2FwdHVyZUVycm9yLkNBUFRVUkVfSU5WQUxJRF9BUkdVTUVOVCA9IDI7CkNhcHR1cmVFcnJvci5DQVBUVVJFX05PX01FRElBX0ZJTEVTID0gMzsKCi8qKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIGFjY2VzcyB0byB0aGUgZGV2aWNlIGNhbWVyYS4KICogQGNvbnN0cnVjdG9yCiAqLwpDYW1lcmEgPSBmdW5jdGlvbigpIHsKCQp9CgovKioKICogRm9ybWF0IG9mIGltYWdlIHRoYXQgcmV0dXJuZWQgZnJvbSBnZXRQaWN0dXJlLgogKgogKiBFeGFtcGxlOiBuYXZpZ2F0b3IuY2FtZXJhLmdldFBpY3R1cmUoc3VjY2VzcywgZmFpbCwKICogICAgICAgICAgICAgIHsgcXVhbGl0eTogODAsCiAqICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uVHlwZTogQ2FtZXJhLkRlc3RpbmF0aW9uVHlwZS5EQVRBX1VSTCwKICogICAgICAgICAgICAgICAgc291cmNlVHlwZTogQ2FtZXJhLlBpY3R1cmVTb3VyY2VUeXBlLlBIT1RPTElCUkFSWX0pCiAqLwpDYW1lcmEuRGVzdGluYXRpb25UeXBlID0gewogICAgREFUQV9VUkw6IDAsICAgICAgICAgICAgICAgIC8vIFJldHVybiBiYXNlNjQgZW5jb2RlZCBzdHJpbmcKICAgIEZJTEVfVVJJOiAxICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZmlsZSB1cmkgKGNvbnRlbnQ6Ly9tZWRpYS9leHRlcm5hbC9pbWFnZXMvbWVkaWEvMiBmb3IgQW5kcm9pZCkKfTsKQ2FtZXJhLnByb3RvdHlwZS5EZXN0aW5hdGlvblR5cGUgPSBDYW1lcmEuRGVzdGluYXRpb25UeXBlOwoKLyoqCiAqIFNvdXJjZSB0byBnZXRQaWN0dXJlIGZyb20uCiAqCiAqIEV4YW1wbGU6IG5hdmlnYXRvci5jYW1lcmEuZ2V0UGljdHVyZShzdWNjZXNzLCBmYWlsLAogKiAgICAgICAgICAgICAgeyBxdWFsaXR5OiA4MCwKICogICAgICAgICAgICAgICAgZGVzdGluYXRpb25UeXBlOiBDYW1lcmEuRGVzdGluYXRpb25UeXBlLkRBVEFfVVJMLAogKiAgICAgICAgICAgICAgICBzb3VyY2VUeXBlOiBDYW1lcmEuUGljdHVyZVNvdXJjZVR5cGUuUEhPVE9MSUJSQVJZfSkKICovCkNhbWVyYS5QaWN0dXJlU291cmNlVHlwZSA9IHsKICAgIFBIT1RPTElCUkFSWSA6IDAsICAgICAgICAgICAvLyBDaG9vc2UgaW1hZ2UgZnJvbSBwaWN0dXJlIGxpYnJhcnkgCiAgICBDQU1FUkEgOiAxLCAgICAgICAgICAgICAgICAgLy8gVGFrZSBwaWN0dXJlIGZyb20gY2FtZXJhCiAgICBTQVZFRFBIT1RPQUxCVU0gOiAyICAgICAgICAgLy8gQ2hvb3NlIGltYWdlIGZyb20gcGljdHVyZSBsaWJyYXJ5IAp9OwpDYW1lcmEucHJvdG90eXBlLlBpY3R1cmVTb3VyY2VUeXBlID0gQ2FtZXJhLlBpY3R1cmVTb3VyY2VUeXBlOwoKLyoqCiAqIEdldHMgYSBwaWN0dXJlIGZyb20gc291cmNlIGRlZmluZWQgYnkgIm9wdGlvbnMuc291cmNlVHlwZSIsIGFuZCByZXR1cm5zIHRoZQogKiBpbWFnZSBhcyBkZWZpbmVkIGJ5IHRoZSAib3B0aW9ucy5kZXN0aW5hdGlvblR5cGUiIG9wdGlvbi4KCiAqIFRoZSBkZWZhdWx0cyBhcmUgc291cmNlVHlwZT1DQU1FUkEgYW5kIGRlc3RpbmF0aW9uVHlwZT1EQVRBX1VSTC4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICovCkNhbWVyYS5wcm90b3R5cGUuZ2V0UGljdHVyZSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucykgewoJLy8gc3VjY2Vzc0NhbGxiYWNrIHJlcXVpcmVkCglpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPSAiZnVuY3Rpb24iKSB7CiAgICAgICAgY29uc29sZS5sb2coIkNhbWVyYSBFcnJvcjogc3VjY2Vzc0NhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIGVycm9yQ2FsbGJhY2sgb3B0aW9uYWwKICAgIGlmIChlcnJvckNhbGxiYWNrICYmICh0eXBlb2YgZXJyb3JDYWxsYmFjayAhPSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJDYW1lcmEgRXJyb3I6IGVycm9yQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgkKCVBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiQ2FtZXJhIiwiZ2V0UGljdHVyZSIsW29wdGlvbnNdKTsKfTsKCgoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mIG5hdmlnYXRvci5jYW1lcmEgPT0gInVuZGVmaW5lZCIpIG5hdmlnYXRvci5jYW1lcmEgPSBuZXcgQ2FtZXJhKCk7Cn0pOwp9OwppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJjb250YWN0IikpIHsKCVBob25lR2FwLmFkZFJlc291cmNlKCJjb250YWN0Iik7CgoKLyoqCiogQ29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgYSBzaW5nbGUgY29udGFjdC4KKiBAcGFyYW0ge0RPTVN0cmluZ30gaWQgdW5pcXVlIGlkZW50aWZpZXIKKiBAcGFyYW0ge0RPTVN0cmluZ30gZGlzcGxheU5hbWUKKiBAcGFyYW0ge0NvbnRhY3ROYW1lfSBuYW1lCiogQHBhcmFtIHtET01TdHJpbmd9IG5pY2tuYW1lCiogQHBhcmFtIHtDb250YWN0RmllbGRbXX0gcGhvbmVOdW1iZXJzIGFycmF5IG9mIHBob25lIG51bWJlcnMKKiBAcGFyYW0ge0NvbnRhY3RGaWVsZFtdfSBlbWFpbHMgYXJyYXkgb2YgZW1haWwgYWRkcmVzc2VzCiogQHBhcmFtIHtDb250YWN0QWRkcmVzc1tdfSBhZGRyZXNzZXMgYXJyYXkgb2YgYWRkcmVzc2VzCiogQHBhcmFtIHtDb250YWN0RmllbGRbXX0gaW1zIGluc3RhbnQgbWVzc2FnaW5nIHVzZXIgaWRzCiogQHBhcmFtIHtDb250YWN0T3JnYW5pemF0aW9uW119IG9yZ2FuaXphdGlvbnMKKiBAcGFyYW0ge0RPTVN0cmluZ30gcmV2aXNpb24gZGF0ZSBjb250YWN0IHdhcyBsYXN0IHVwZGF0ZWQKKiBAcGFyYW0ge0RPTVN0cmluZ30gYmlydGhkYXkgY29udGFjdCdzIGJpcnRoZGF5CiogQHBhcmFtIHtET01TdHJpbmd9IGdlbmRlciBjb250YWN0J3MgZ2VuZGVyCiogQHBhcmFtIHtET01TdHJpbmd9IG5vdGUgdXNlciBub3RlcyBhYm91dCBjb250YWN0CiogQHBhcmFtIHtDb250YWN0RmllbGRbXX0gcGhvdG9zCiogQHBhcmFtIHtDb250YWN0RmllbGRbXX0gdXJscyBjb250YWN0J3Mgd2ViIHNpdGVzCiogQHBhcmFtIHtET01TdHJpbmd9IHRpbWV6b25lIFVUQyB0aW1lIHpvbmUgb2Zmc2V0CiovCnZhciBDb250YWN0ID0gZnVuY3Rpb24oaWQsIGRpc3BsYXlOYW1lLCBuYW1lLCBuaWNrbmFtZSwgcGhvbmVOdW1iZXJzLCBlbWFpbHMsIGFkZHJlc3NlcywKICAgIGltcywgb3JnYW5pemF0aW9ucywgcmV2aXNpb24sIGJpcnRoZGF5LCBnZW5kZXIsIG5vdGUsIHBob3RvcywgY2F0ZWdvcmllcywgdXJscywgdGltZXpvbmUpIHsKICAgIHRoaXMuaWQgPSBpZCB8fCBudWxsOwogICAgdGhpcy5kaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lIHx8IG51bGw7CiAgICB0aGlzLm5hbWUgPSBuYW1lIHx8IG51bGw7IC8vIENvbnRhY3ROYW1lCiAgICB0aGlzLm5pY2tuYW1lID0gbmlja25hbWUgfHwgbnVsbDsKICAgIHRoaXMucGhvbmVOdW1iZXJzID0gcGhvbmVOdW1iZXJzIHx8IG51bGw7IC8vIENvbnRhY3RGaWVsZFtdCiAgICB0aGlzLmVtYWlscyA9IGVtYWlscyB8fCBudWxsOyAvLyBDb250YWN0RmllbGRbXQogICAgdGhpcy5hZGRyZXNzZXMgPSBhZGRyZXNzZXMgfHwgbnVsbDsgLy8gQ29udGFjdEFkZHJlc3NbXQogICAgdGhpcy5pbXMgPSBpbXMgfHwgbnVsbDsgLy8gQ29udGFjdEZpZWxkW10KICAgIHRoaXMub3JnYW5pemF0aW9ucyA9IG9yZ2FuaXphdGlvbnMgfHwgbnVsbDsgLy8gQ29udGFjdE9yZ2FuaXphdGlvbltdCiAgICB0aGlzLnJldmlzaW9uID0gcmV2aXNpb24gfHwgbnVsbDsgLy8gSlMgRGF0ZQogICAgdGhpcy5iaXJ0aGRheSA9IGJpcnRoZGF5IHx8IG51bGw7IC8vIEpTIERhdGUKICAgIHRoaXMuZ2VuZGVyID0gZ2VuZGVyIHx8IG51bGw7CiAgICB0aGlzLm5vdGUgPSBub3RlIHx8IG51bGw7CiAgICB0aGlzLnBob3RvcyA9IHBob3RvcyB8fCBudWxsOyAvLyBDb250YWN0RmllbGRbXQogICAgdGhpcy5jYXRlZ29yaWVzID0gY2F0ZWdvcmllcyB8fCBudWxsOyAKICAgIHRoaXMudXJscyA9IHVybHMgfHwgbnVsbDsgLy8gQ29udGFjdEZpZWxkW10KICAgIHRoaXMudGltZXpvbmUgPSB0aW1lem9uZSB8fCBudWxsOwp9OwoKLyoqCiogQ29udmVydHMgRGF0ZXMgdG8gbWlsbGlzZWNvbmRzIGJlZm9yZSBzZW5kaW5nIHRvIGlPUwoqLwpDb250YWN0LnByb3RvdHlwZS5jb252ZXJ0RGF0ZXNPdXQgPSBmdW5jdGlvbigpCnsKCXZhciBkYXRlcyA9IG5ldyBBcnJheSgicmV2aXNpb24iLCAiYmlydGhkYXkiKTsKCWZvciAodmFyIGk9MDsgaTxkYXRlcy5sZW5ndGg7IGkrKyl7CgkJdmFyIHZhbHVlID0gdGhpc1tkYXRlc1tpXV07CgkJaWYgKHZhbHVlKXsKCQkJaWYgKCF2YWx1ZSBpbnN0YW5jZW9mIERhdGUpewoJCQkJdHJ5IHsKCQkJCQl2YWx1ZSA9IG5ldyBEYXRlKHZhbHVlKTsKCQkJCX0gY2F0Y2goZXhjZXB0aW9uKXsKCQkJCQl2YWx1ZSA9IG51bGw7CgkJCQl9CgkJCX0KCQkJaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSl7CgkJCQl2YWx1ZSA9IHZhbHVlLnZhbHVlT2YoKTsKCQkJfQoJCQl0aGlzW2RhdGVzW2ldXSA9IHZhbHVlOwoJCX0KCX0KCQp9OwovKioKKiBDb252ZXJ0cyBtaWxsaXNlY29uZHMgdG8gSlMgRGF0ZSB3aGVuIHJldHVybmluZyBmcm9tIGlPUwoqLwpDb250YWN0LnByb3RvdHlwZS5jb252ZXJ0RGF0ZXNJbiA9IGZ1bmN0aW9uKCkKewoJdmFyIGRhdGVzID0gbmV3IEFycmF5KCJyZXZpc2lvbiIsICJiaXJ0aGRheSIpOwoJZm9yICh2YXIgaT0wOyBpPGRhdGVzLmxlbmd0aDsgaSsrKXsKCQl2YXIgdmFsdWUgPSB0aGlzW2RhdGVzW2ldXTsKCQlpZiAodmFsdWUpewoJCQl0cnkgewoJCQkJdGhpc1tkYXRlc1tpXV0gPSBuZXcgRGF0ZShwYXJzZUZsb2F0KHZhbHVlKSk7CgkJCX0gY2F0Y2ggKGV4Y2VwdGlvbil7CgkJCQljb25zb2xlLmxvZygiZXhjZXB0aW9uIGNyZWF0aW5nIGRhdGUiKTsKCQkJfQoJCX0KCX0KfTsKLyoqCiogUmVtb3ZlcyBjb250YWN0IGZyb20gZGV2aWNlIHN0b3JhZ2UuCiogQHBhcmFtIHN1Y2Nlc3NDQiBzdWNjZXNzIGNhbGxiYWNrCiogQHBhcmFtIGVycm9yQ0IgZXJyb3IgY2FsbGJhY2sgKG9wdGlvbmFsKQoqLwpDb250YWN0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihzdWNjZXNzQ0IsIGVycm9yQ0IpIHsKCWlmICh0aGlzLmlkID09IG51bGwpIHsKICAgICAgICB2YXIgZXJyb3JPYmogPSBuZXcgQ29udGFjdEVycm9yKCk7CiAgICAgICAgZXJyb3JPYmouY29kZSA9IENvbnRhY3RFcnJvci5OT1RfRk9VTkRfRVJST1I7CiAgICAgICAgZXJyb3JDQihlcnJvck9iaik7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDQiwgZXJyb3JDQiwgIkNvbnRhY3RzIiwgInJlbW92ZSIsIFt7ICJjb250YWN0IjogdGhpc31dKTsKICAgIH0KfTsKLyoqCiogaU9TIE9OTFkKKiBkaXNwbGF5cyBjb250YWN0IHZpYSBpT1MgVUkKKgoqIEBwYXJhbSBlcnJvckNCIGVycm9yIGNhbGxiYWNrCiovCkNvbnRhY3QucHJvdG90eXBlLmRpc3BsYXkgPSBmdW5jdGlvbihzdWNjZXNzQ0IsIGVycm9yQ0IsIG9wdGlvbnMpIHsgCglpZiAodGhpcy5pZCA9PSBudWxsKSB7CiAgICAgICAgdmFyIGVycm9yT2JqID0gbmV3IENvbnRhY3RFcnJvcigpOwogICAgICAgIGVycm9yT2JqLmNvZGUgPSBDb250YWN0RXJyb3IuTk9UX0ZPVU5EX0VSUk9SOwogICAgICAgIGVycm9yQ0IoZXJyb3JPYmopOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ0IsIGVycm9yQ0IsICJDb250YWN0cyIsImRpc3BsYXlDb250YWN0IiwgW3RoaXMuaWQsIG9wdGlvbnNdKTsKICAgIH0KfTsKCi8qKgoqIENyZWF0ZXMgYSBkZWVwIGNvcHkgb2YgdGhpcyBDb250YWN0LgoqIFdpdGggdGhlIGNvbnRhY3QgSUQgc2V0IHRvIG51bGwuCiogQHJldHVybiBjb3B5IG9mIHRoaXMgQ29udGFjdAoqLwpDb250YWN0LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGNsb25lZENvbnRhY3QgPSBQaG9uZUdhcC5jbG9uZSh0aGlzKTsKICAgIGNsb25lZENvbnRhY3QuaWQgPSBudWxsOwogICAgLy8gTG9vcCB0aHJvdWdoIGFuZCBjbGVhciBvdXQgYW55IGlkJ3MgaW4gcGhvbmVzLCBlbWFpbHMsIGV0Yy4KICAgIGlmIChjbG9uZWRDb250YWN0LnBob25lTnVtYmVycykgewogICAgCWZvciAoaT0wOyBpPGNsb25lZENvbnRhY3QucGhvbmVOdW1iZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAJCWNsb25lZENvbnRhY3QucGhvbmVOdW1iZXJzW2ldLmlkID0gbnVsbDsKICAgIAl9CiAgICB9CiAgICBpZiAoY2xvbmVkQ29udGFjdC5lbWFpbHMpIHsKICAgIAlmb3IgKGk9MDsgaTxjbG9uZWRDb250YWN0LmVtYWlscy5sZW5ndGg7IGkrKykgewogICAgCQljbG9uZWRDb250YWN0LmVtYWlsc1tpXS5pZCA9IG51bGw7CiAgICAJfQogICAgfQogICAgaWYgKGNsb25lZENvbnRhY3QuYWRkcmVzc2VzKSB7CiAgICAJZm9yIChpPTA7IGk8Y2xvbmVkQ29udGFjdC5hZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgIAkJY2xvbmVkQ29udGFjdC5hZGRyZXNzZXNbaV0uaWQgPSBudWxsOwogICAgCX0KICAgIH0KICAgIGlmIChjbG9uZWRDb250YWN0LmltcykgewogICAgCWZvciAoaT0wOyBpPGNsb25lZENvbnRhY3QuaW1zLmxlbmd0aDsgaSsrKSB7CiAgICAJCWNsb25lZENvbnRhY3QuaW1zW2ldLmlkID0gbnVsbDsKICAgIAl9CiAgICB9CiAgICBpZiAoY2xvbmVkQ29udGFjdC5vcmdhbml6YXRpb25zKSB7CiAgICAJZm9yIChpPTA7IGk8Y2xvbmVkQ29udGFjdC5vcmdhbml6YXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAJCWNsb25lZENvbnRhY3Qub3JnYW5pemF0aW9uc1tpXS5pZCA9IG51bGw7CiAgICAJfQogICAgfQogICAgaWYgKGNsb25lZENvbnRhY3QucGhvdG9zKSB7CiAgICAJZm9yIChpPTA7IGk8Y2xvbmVkQ29udGFjdC5waG90b3MubGVuZ3RoOyBpKyspIHsKICAgIAkJY2xvbmVkQ29udGFjdC5waG90b3NbaV0uaWQgPSBudWxsOwogICAgCX0KICAgIH0KICAgIGlmIChjbG9uZWRDb250YWN0LnVybHMpIHsKICAgIAlmb3IgKGk9MDsgaTxjbG9uZWRDb250YWN0LnVybHMubGVuZ3RoOyBpKyspIHsKICAgIAkJY2xvbmVkQ29udGFjdC51cmxzW2ldLmlkID0gbnVsbDsKICAgIAl9CiAgICB9CiAgICByZXR1cm4gY2xvbmVkQ29udGFjdDsKfTsKCi8qKgoqIFBlcnNpc3RzIGNvbnRhY3QgdG8gZGV2aWNlIHN0b3JhZ2UuCiogQHBhcmFtIHN1Y2Nlc3NDQiBzdWNjZXNzIGNhbGxiYWNrCiogQHBhcmFtIGVycm9yQ0IgZXJyb3IgY2FsbGJhY2sgLSBvcHRpb25hbAoqLwpDb250YWN0LnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24oc3VjY2Vzc0NCLCBlcnJvckNCKSB7CgkvLyBkb24ndCBtb2RpZnkgdGhlIG9yaWdpbmFsIGNvbnRhY3QKCXZhciBjbG9uZWQgPSBQaG9uZUdhcC5jbG9uZSh0aGlzKTsKCWNsb25lZC5jb252ZXJ0RGF0ZXNPdXQoKTsgCglQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDQiwgZXJyb3JDQiwgIkNvbnRhY3RzIiwic2F2ZSIsIFt7ImNvbnRhY3QiOiBjbG9uZWR9XSk7Cn07CgovKioKKiBDb250YWN0IG5hbWUuCiogQHBhcmFtIGZvcm1hdHRlZAoqIEBwYXJhbSBmYW1pbHlOYW1lCiogQHBhcmFtIGdpdmVuTmFtZQoqIEBwYXJhbSBtaWRkbGUKKiBAcGFyYW0gcHJlZml4CiogQHBhcmFtIHN1ZmZpeAoqLwp2YXIgQ29udGFjdE5hbWUgPSBmdW5jdGlvbihmb3JtYXR0ZWQsIGZhbWlseU5hbWUsIGdpdmVuTmFtZSwgbWlkZGxlLCBwcmVmaXgsIHN1ZmZpeCkgewogICAgdGhpcy5mb3JtYXR0ZWQgPSBmb3JtYXR0ZWQgIT0gInVuZGVmaW5lZCIgPyBmb3JtYXR0ZWQgOiBudWxsOwogICAgdGhpcy5mYW1pbHlOYW1lID0gZmFtaWx5TmFtZSAhPSAidW5kZWZpbmVkIiA/IGZhbWlseU5hbWUgOiBudWxsOwogICAgdGhpcy5naXZlbk5hbWUgPSBnaXZlbk5hbWUgIT0gInVuZGVmaW5lZCIgPyBnaXZlbk5hbWUgOiBudWxsOwogICAgdGhpcy5taWRkbGVOYW1lID0gbWlkZGxlICE9ICJ1bmRlZmluZWQiID8gbWlkZGxlIDogbnVsbDsKICAgIHRoaXMuaG9ub3JpZmljUHJlZml4ID0gcHJlZml4ICE9ICJ1bmRlZmluZWQiID8gcHJlZml4IDogbnVsbDsKICAgIHRoaXMuaG9ub3JpZmljU3VmZml4ID0gc3VmZml4ICE9ICJ1bmRlZmluZWQiID8gc3VmZml4IDogbnVsbDsKfTsKCi8qKgoqIEdlbmVyaWMgY29udGFjdCBmaWVsZC4KKiBAcGFyYW0gdHlwZQoqIEBwYXJhbSB2YWx1ZQoqIEBwYXJhbSBwcmltYXJ5CiogQHBhcmFtIGlkCiovCnZhciBDb250YWN0RmllbGQgPSBmdW5jdGlvbih0eXBlLCB2YWx1ZSwgcHJlZiwgaWQpIHsKICAgIHRoaXMudHlwZSA9IHR5cGUgIT0gInVuZGVmaW5lZCIgPyB0eXBlIDogbnVsbDsKICAgIHRoaXMudmFsdWUgPSB2YWx1ZSAhPSAidW5kZWZpbmVkIiA/IHZhbHVlIDogbnVsbDsKICAgIHRoaXMucHJlZiA9IHByZWYgIT0gInVuZGVmaW5lZCIgPyBwcmVmIDogbnVsbDsKICAgIHRoaXMuaWQgPSBpZCAhPSAidW5kZWZpbmVkIiA/IGlkIDogbnVsbDsKfTsKCi8qKgoqIENvbnRhY3QgYWRkcmVzcy4KKiBAcGFyYW0gZm9ybWF0dGVkCiogQHBhcmFtIHN0cmVldEFkZHJlc3MKKiBAcGFyYW0gbG9jYWxpdHkKKiBAcGFyYW0gcmVnaW9uCiogQHBhcmFtIHBvc3RhbENvZGUKKiBAcGFyYW0gY291bnRyeQoqLwp2YXIgQ29udGFjdEFkZHJlc3MgPSBmdW5jdGlvbihmb3JtYXR0ZWQsIHN0cmVldEFkZHJlc3MsIGxvY2FsaXR5LCByZWdpb24sIHBvc3RhbENvZGUsIGNvdW50cnksIGlkKSB7CiAgICB0aGlzLmZvcm1hdHRlZCA9IGZvcm1hdHRlZCAhPSAidW5kZWZpbmVkIiA/IGZvcm1hdHRlZCA6IG51bGw7CiAgICB0aGlzLnN0cmVldEFkZHJlc3MgPSBzdHJlZXRBZGRyZXNzICE9ICJ1bmRlZmluZWQiID8gc3RyZWV0QWRkcmVzcyA6IG51bGw7CiAgICB0aGlzLmxvY2FsaXR5ID0gbG9jYWxpdHkgIT0gInVuZGVmaW5lZCIgPyBsb2NhbGl0eSA6IG51bGw7CiAgICB0aGlzLnJlZ2lvbiA9IHJlZ2lvbiAhPSAidW5kZWZpbmVkIiA/IHJlZ2lvbiA6IG51bGw7CiAgICB0aGlzLnBvc3RhbENvZGUgPSBwb3N0YWxDb2RlICE9ICJ1bmRlZmluZWQiID8gcG9zdGFsQ29kZSA6IG51bGw7CiAgICB0aGlzLmNvdW50cnkgPSBjb3VudHJ5ICE9ICJ1bmRlZmluZWQiID8gY291bnRyeSA6IG51bGw7CiAgICB0aGlzLmlkID0gaWQgIT0gInVuZGVmaW5lZCIgPyBpZCA6IG51bGw7Cn07CgovKioKKiBDb250YWN0IG9yZ2FuaXphdGlvbi4KKiBAcGFyYW0gbmFtZQoqIEBwYXJhbSBkZXB0CiogQHBhcmFtIHRpdGxlCiogQHBhcmFtIHN0YXJ0RGF0ZQoqIEBwYXJhbSBlbmREYXRlCiogQHBhcmFtIGxvY2F0aW9uCiogQHBhcmFtIGRlc2MKKi8KdmFyIENvbnRhY3RPcmdhbml6YXRpb24gPSBmdW5jdGlvbihuYW1lLCBkZXB0LCB0aXRsZSwgc3RhcnREYXRlLCBlbmREYXRlLCBsb2NhdGlvbiwgZGVzYykgewogICAgdGhpcy5uYW1lID0gbmFtZSAhPSAidW5kZWZpbmVkIiA/IG5hbWUgOiBudWxsOwogICAgdGhpcy5kZXBhcnRtZW50ID0gZGVwdCAhPSAidW5kZWZpbmVkIiA/IGRlcHQgOiBudWxsOwogICAgdGhpcy50aXRsZSA9IHRpdGxlICE9ICJ1bmRlZmluZWQiID8gdGl0bGUgOiBudWxsOwogICAgdGhpcy5zdGFydERhdGUgPSBzdGFydERhdGUgIT0gInVuZGVmaW5lZCIgPyBzdGFydERhdGUgOiBudWxsOwogICAgdGhpcy5lbmREYXRlID0gZW5kRGF0ZSAhPSAidW5kZWZpbmVkIiA/IGVuZERhdGUgOiBudWxsOwogICAgdGhpcy5sb2NhdGlvbiA9IGxvY2F0aW9uICE9ICJ1bmRlZmluZWQiID8gbG9jYXRpb24gOiBudWxsOwogICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2MgIT0gInVuZGVmaW5lZCIgPyBkZXNjIDogbnVsbDsKfTsKCi8qKgoqIENvbnRhY3QgYWNjb3VudC4KKiBAcGFyYW0gZG9tYWluCiogQHBhcmFtIHVzZXJuYW1lCiogQHBhcmFtIHVzZXJpZAoqLwp2YXIgQ29udGFjdEFjY291bnQgPSBmdW5jdGlvbihkb21haW4sIHVzZXJuYW1lLCB1c2VyaWQpIHsKICAgIHRoaXMuZG9tYWluID0gZG9tYWluICE9ICJ1bmRlZmluZWQiID8gZG9tYWluIDogbnVsbDsKICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZSAhPSAidW5kZWZpbmVkIiA/IHVzZXJuYW1lIDogbnVsbDsKICAgIHRoaXMudXNlcmlkID0gdXNlcmlkICE9ICJ1bmRlZmluZWQiID8gdXNlcmlkIDogbnVsbDsKfQoKLyoqCiogUmVwcmVzZW50cyBhIGdyb3VwIG9mIENvbnRhY3RzLgoqLwp2YXIgQ29udGFjdHMgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuaW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgdGhpcy5yZWNvcmRzID0gbmV3IEFycmF5KCk7CiAgICB0aGlzLnJlc3VsdHNDYWxsYmFjayA9IG51bGw7CiAgICB0aGlzLmVycm9yQ2FsbGJhY2sgPSBudWxsOwp9OwovKioKKiBSZXR1cm5zIGFuIGFycmF5IG9mIENvbnRhY3RzIG1hdGNoaW5nIHRoZSBzZWFyY2ggY3JpdGVyaWEuCiogQHBhcmFtIGZpZWxkcyB0aGF0IHNob3VsZCBiZSBzZWFyY2hlZAoqIEBwYXJhbSBzdWNjZXNzQ0Igc3VjY2VzcyBjYWxsYmFjawoqIEBwYXJhbSBlcnJvckNCIGVycm9yIGNhbGxiYWNrIChvcHRpb25hbCkKKiBAcGFyYW0ge0NvbnRhY3RGaW5kT3B0aW9uc30gb3B0aW9ucyB0aGF0IGNhbiBiZSBhcHBsaWVkIHRvIGNvbnRhY3Qgc2VhcmNoaW5nCiogQHJldHVybiBhcnJheSBvZiBDb250YWN0cyBtYXRjaGluZyBzZWFyY2ggY3JpdGVyaWEKKi8KQ29udGFjdHMucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbihmaWVsZHMsIHN1Y2Nlc3NDQiwgZXJyb3JDQiwgb3B0aW9ucykgewoJdmFyIHRoZU9wdGlvbnMgPSBvcHRpb25zIHx8IG51bGw7CglpZiAodGhlT3B0aW9ucyAhPSBudWxsKXsKCQkvLyBjb252ZXJ0IHVwZGF0ZWRTaW5jZSB0byBtcwoJCXZhciB2YWx1ZSA9IHRoZU9wdGlvbnMudXBkYXRlZFNpbmNlCgkJaWYgKHZhbHVlICE9ICcnKXsKCQkJaWYgKCF2YWx1ZSBpbnN0YW5jZW9mIERhdGUpewoJCQkJdHJ5IHsKCQkJCQl2YWx1ZSA9IG5ldyBEYXRlKHZhbHVlKTsKCQkJCX0gY2F0Y2goZXhjZXB0aW9uKXsKCQkJCQl2YWx1ZSA9IG51bGw7CgkJCQl9CgkJCX0KCQkJaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSl7CgkJCQl0aGVPcHRpb25zLnVwZGF0ZWRTaW5jZSA9IHZhbHVlLnZhbHVlT2YoKTsKCQkJfQoJCX0KCX0KCglQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDQiwgZXJyb3JDQiwgIkNvbnRhY3RzIiwic2VhcmNoIiwgW3siZmllbGRzIjpmaWVsZHMsICJmaW5kT3B0aW9ucyI6dGhlT3B0aW9uc31dKTsKCQp9OwovKioKKiBuZWVkIHRvIHR1cm4gdGhlIGFycmF5IG9mIEpTT04gc3RyaW5ncyByZXByZXNlbnRpbmcgY29udGFjdCBvYmplY3RzIGludG8gYWN0dWFsIG9iamVjdHMKKiBAcGFyYW0gYXJyYXkgb2YgSlNPTiBzdHJpbmdzIHdpdGggY29udGFjdCBkYXRhCiogQHJldHVybiBjYWxsIHJlc3VsdHMgY2FsbGJhY2sgd2l0aCBhcnJheSBvZiBDb250YWN0IG9iamVjdHMKKiAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgZnJvbSBvYmplY3RpdmUgQyBDb250YWN0cy5zZWFyY2goKSBtZXRob2QuCiovCkNvbnRhY3RzLnByb3RvdHlwZS5fZmluZENhbGxiYWNrID0gZnVuY3Rpb24ocGx1Z2luUmVzdWx0KSB7Cgl2YXIgY29udGFjdHMgPSBuZXcgQXJyYXkoKTsKCXRyeSB7CgkJZm9yICh2YXIgaT0wOyBpPHBsdWdpblJlc3VsdC5tZXNzYWdlLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBuZXdDb250YWN0ID0gbmF2aWdhdG9yLnNlcnZpY2UuY29udGFjdHMuY3JlYXRlKHBsdWdpblJlc3VsdC5tZXNzYWdlW2ldKTsgCgkJCW5ld0NvbnRhY3QuY29udmVydERhdGVzSW4oKTsKCQkJY29udGFjdHMucHVzaChuZXdDb250YWN0KTsKCQl9CgkJcGx1Z2luUmVzdWx0Lm1lc3NhZ2UgPSBjb250YWN0czsKCX0gY2F0Y2goZSl7CgkJCWNvbnNvbGUubG9nKCJFcnJvciBwYXJzaW5nIGNvbnRhY3RzOiAiICtlKTsKCX0KCXJldHVybiBwbHVnaW5SZXN1bHQ7Cn0KCi8qKgoqIG5lZWQgdG8gdHVybiB0aGUgSlNPTiBzdHJpbmcgcmVwcmVzZW50aW5nIGNvbnRhY3Qgb2JqZWN0IGludG8gYWN0dWFsIG9iamVjdAoqIEBwYXJhbSBKU09OIHN0cmluZyB3aXRoIGNvbnRhY3QgZGF0YQoqIENhbGwgc3RvcmVkIHJlc3VsdHMgZnVuY3Rpb24gd2l0aCAgQ29udGFjdCBvYmplY3QKKiAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgZnJvbSBvYmplY3RpdmUgQyBDb250YWN0cyByZW1vdmUgYW5kIHNhdmUgbWV0aG9kcwoqLwpDb250YWN0cy5wcm90b3R5cGUuX2NvbnRhY3RDYWxsYmFjayA9IGZ1bmN0aW9uKHBsdWdpblJlc3VsdCkKewoJdmFyIG5ld0NvbnRhY3QgPSBudWxsOwoJaWYgKHBsdWdpblJlc3VsdC5tZXNzYWdlKXsKCQl0cnkgewoJCQluZXdDb250YWN0ID0gbmF2aWdhdG9yLnNlcnZpY2UuY29udGFjdHMuY3JlYXRlKHBsdWdpblJlc3VsdC5tZXNzYWdlKTsKCQkJbmV3Q29udGFjdC5jb252ZXJ0RGF0ZXNJbigpOwoJCX0gY2F0Y2goZSl7CgkJCWNvbnNvbGUubG9nKCJFcnJvciBwYXJzaW5nIGNvbnRhY3QiKTsKCQl9Cgl9CglwbHVnaW5SZXN1bHQubWVzc2FnZSA9IG5ld0NvbnRhY3Q7CglyZXR1cm4gcGx1Z2luUmVzdWx0OwoJCn07Ci8qKiAKKiBOZWVkIHRvIHJldHVybiBhbiBlcnJvciBvYmplY3QgcmF0aGVyIHRoYW4ganVzdCBhIHNpbmdsZSBlcnJvciBjb2RlCiogQHBhcmFtIGVycm9yIGNvZGUKKiBDYWxsIG9wdGlvbmFsIGVycm9yIGNhbGxiYWNrIGlmIGZvdW5kLgoqIENhbGxlZCBmcm9tIG9iamVjdGl2ZSBjIGZpbmQsIHJlbW92ZSwgYW5kIHNhdmUgbWV0aG9kcyBvbiBlcnJvci4KKi8KQ29udGFjdHMucHJvdG90eXBlLl9lcnJDYWxsYmFjayA9IGZ1bmN0aW9uKHBsdWdpblJlc3VsdCkKewoJdmFyIGVycm9yT2JqID0gbmV3IENvbnRhY3RFcnJvcigpOwogICAJZXJyb3JPYmouY29kZSA9IHBsdWdpblJlc3VsdC5tZXNzYWdlOwoJcGx1Z2luUmVzdWx0Lm1lc3NhZ2UgPSBlcnJvck9iajsKCXJldHVybiBwbHVnaW5SZXN1bHQ7Cn07Ci8vIGlQaG9uZSBvbmx5IGFwaSB0byBjcmVhdGUgYSBuZXcgY29udGFjdCB2aWEgdGhlIEdVSQpDb250YWN0cy5wcm90b3R5cGUubmV3Q29udGFjdFVJID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrKSB7IAogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIG51bGwsICJDb250YWN0cyIsIm5ld0NvbnRhY3QiLCBbXSk7Cn07Ci8vIGlQaG9uZSBvbmx5IGFwaSB0byBzZWxlY3QgYSBjb250YWN0IHZpYSB0aGUgR1VJCkNvbnRhY3RzLnByb3RvdHlwZS5jaG9vc2VDb250YWN0ID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBvcHRpb25zKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgbnVsbCwgIkNvbnRhY3RzIiwiY2hvb3NlQ29udGFjdCIsIG9wdGlvbnMpOwp9OwoKCi8qKgoqIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhIG5ldyBjb250YWN0LCBidXQgaXQgZG9lcyBub3QgcGVyc2lzdCB0aGUgY29udGFjdAoqIHRvIGRldmljZSBzdG9yYWdlLiBUbyBwZXJzaXN0IHRoZSBjb250YWN0IHRvIGRldmljZSBzdG9yYWdlLCBpbnZva2UKKiBjb250YWN0LnNhdmUoKS4KKiBAcGFyYW0gcHJvcGVydGllcyBhbiBvYmplY3Qgd2hvJ3MgcHJvcGVydGllcyB3aWxsIGJlIGV4YW1pbmVkIHRvIGNyZWF0ZSBhIG5ldyBDb250YWN0CiogQHJldHVybnMgbmV3IENvbnRhY3Qgb2JqZWN0CiovCkNvbnRhY3RzLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgICB2YXIgY29udGFjdCA9IG5ldyBDb250YWN0KCk7CiAgICBmb3IgKGkgaW4gcHJvcGVydGllcykgewogICAgICAgIGlmIChjb250YWN0W2ldIT0ndW5kZWZpbmVkJykgewogICAgICAgICAgICBjb250YWN0W2ldPXByb3BlcnRpZXNbaV07CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGNvbnRhY3Q7Cn07CgovKioKICogQ29udGFjdEZpbmRPcHRpb25zLgogKiBAcGFyYW0gZmlsdGVyIHVzZWQgdG8gbWF0Y2ggY29udGFjdHMgYWdhaW5zdAogKiBAcGFyYW0gbXVsdGlwbGUgYm9vbGVhbiB1c2VkIHRvIGRldGVybWluZSBpZiBtb3JlIHRoYW4gb25lIGNvbnRhY3Qgc2hvdWxkIGJlIHJldHVybmVkCiAqIEBwYXJhbSB1cGRhdGVkU2luY2UgcmV0dXJuIG9ubHkgY29udGFjdCByZWNvcmRzIHRoYXQgaGF2ZSBiZWVuIHVwZGF0ZWQgb24gb3IgYWZ0ZXIgdGhlIGdpdmVuIHRpbWUKICovCnZhciBDb250YWN0RmluZE9wdGlvbnMgPSBmdW5jdGlvbihmaWx0ZXIsIG11bHRpcGxlLCB1cGRhdGVkU2luY2UpIHsKICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyIHx8ICcnOwogICAgdGhpcy5tdWx0aXBsZSA9IG11bHRpcGxlIHx8IHRydWU7CiAgICB0aGlzLnVwZGF0ZWRTaW5jZSA9IHVwZGF0ZWRTaW5jZSB8fCAnJzsKfTsKCi8qKgogKiAgQ29udGFjdEVycm9yLgogKiAgQW4gZXJyb3IgY29kZSBhc3NpZ25lZCBieSBhbiBpbXBsZW1lbnRhdGlvbiB3aGVuIGFuIGVycm9yIGhhcyBvY2N1cnJlZAogKi8KdmFyIENvbnRhY3RFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5jb2RlPW51bGw7Cn07CgovKioKICogRXJyb3IgY29kZXMKICovCkNvbnRhY3RFcnJvci5VTktOT1dOX0VSUk9SID0gMDsKQ29udGFjdEVycm9yLklOVkFMSURfQVJHVU1FTlRfRVJST1IgPSAxOwpDb250YWN0RXJyb3IuTk9UX0ZPVU5EX0VSUk9SID0gMjsKQ29udGFjdEVycm9yLlRJTUVPVVRfRVJST1IgPSAzOwpDb250YWN0RXJyb3IuUEVORElOR19PUEVSQVRJT05fRVJST1IgPSA0OwpDb250YWN0RXJyb3IuSU9fRVJST1IgPSA1OwpDb250YWN0RXJyb3IuTk9UX1NVUFBPUlRFRF9FUlJPUiA9IDY7CkNvbnRhY3RFcnJvci5QRVJNSVNTSU9OX0RFTklFRF9FUlJPUiA9IDIwOwoKLyoqCiAqIEFkZCB0aGUgY29udGFjdCBpbnRlcmZhY2UgaW50byB0aGUgYnJvd3Nlci4KICovClBob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCkgeyAKICAgIGlmKHR5cGVvZiBuYXZpZ2F0b3Iuc2VydmljZSA9PSAidW5kZWZpbmVkIikgbmF2aWdhdG9yLnNlcnZpY2UgPSBuZXcgT2JqZWN0KCk7CiAgICBpZih0eXBlb2YgbmF2aWdhdG9yLnNlcnZpY2UuY29udGFjdHMgPT0gInVuZGVmaW5lZCIpIG5hdmlnYXRvci5zZXJ2aWNlLmNvbnRhY3RzID0gbmV3IENvbnRhY3RzKCk7Cn0pOwp9OwppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJkZXZpY2UiKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoImRldmljZSIpOwoKLyoqCiAqIHRoaXMgcmVwcmVzZW50cyB0aGUgbW9iaWxlIGRldmljZSwgYW5kIHByb3ZpZGVzIHByb3BlcnRpZXMgZm9yIGluc3BlY3RpbmcgdGhlIG1vZGVsLCB2ZXJzaW9uLCBVVUlEIG9mIHRoZQogKiBwaG9uZSwgZXRjLgogKiBAY29uc3RydWN0b3IKICovCkRldmljZSA9IGZ1bmN0aW9uKCkgCnsKICAgIHRoaXMucGxhdGZvcm0gPSBudWxsOwogICAgdGhpcy52ZXJzaW9uICA9IG51bGw7CiAgICB0aGlzLm5hbWUgICAgID0gbnVsbDsKICAgIHRoaXMucGhvbmVnYXAgICAgICA9IG51bGw7CiAgICB0aGlzLnV1aWQgICAgID0gbnVsbDsKICAgIHRyeSAKCXsgICAgICAKCQl0aGlzLnBsYXRmb3JtID0gRGV2aWNlSW5mby5wbGF0Zm9ybTsKCQl0aGlzLnZlcnNpb24gID0gRGV2aWNlSW5mby52ZXJzaW9uOwoJCXRoaXMubmFtZSAgICAgPSBEZXZpY2VJbmZvLm5hbWU7CgkJdGhpcy5waG9uZWdhcCA9IERldmljZUluZm8uZ2FwOwoJCXRoaXMudXVpZCAgICAgPSBEZXZpY2VJbmZvLnV1aWQ7CgogICAgfSAKCWNhdGNoKGUpIAoJewogICAgICAgIC8vIFRPRE86IAogICAgfQoJdGhpcy5hdmFpbGFibGUgPSBQaG9uZUdhcC5hdmFpbGFibGUgPSB0aGlzLnV1aWQgIT0gbnVsbDsKfQoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7CiAgICBuYXZpZ2F0b3IuZGV2aWNlID0gd2luZG93LmRldmljZSA9IG5ldyBEZXZpY2UoKTsKfSk7Cn07CmlmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImZpbGUiKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoImZpbGUiKTsKCi8qKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIGdlbmVyaWMgcmVhZCBhbmQgd3JpdGUgYWNjZXNzIHRvIHRoZSBtb2JpbGUgZGV2aWNlIGZpbGUgc3lzdGVtLgogKiBUaGV5IGFyZSBub3QgdXNlZCB0byByZWFkIGZpbGVzIGZyb20gYSBzZXJ2ZXIuCiAqLwoKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgc29tZSB1c2VmdWwgaW5mb3JtYXRpb24gYWJvdXQgYSBmaWxlLgogKiBUaGlzIGlzIHRoZSBmaWVsZHMgcmV0dXJuZWQgd2hlbiBuYXZpZ2F0b3IuZmlsZU1nci5nZXRGaWxlUHJvcGVydGllcygpIAogKiBpcyBjYWxsZWQuCiAqLwpGaWxlUHJvcGVydGllcyA9IGZ1bmN0aW9uKGZpbGVQYXRoKSB7CiAgICB0aGlzLmZpbGVQYXRoID0gZmlsZVBhdGg7CiAgICB0aGlzLnNpemUgPSAwOwogICAgdGhpcy5sYXN0TW9kaWZpZWREYXRlID0gbnVsbDsKfQovKioKICogUmVwcmVzZW50cyBhIHNpbmdsZSBmaWxlLgogKiAKICogbmFtZSB7RE9NU3RyaW5nfSBuYW1lIG9mIHRoZSBmaWxlLCB3aXRob3V0IHBhdGggaW5mb3JtYXRpb24KICogZnVsbFBhdGgge0RPTVN0cmluZ30gdGhlIGZ1bGwgcGF0aCBvZiB0aGUgZmlsZSwgaW5jbHVkaW5nIHRoZSBuYW1lCiAqIHR5cGUge0RPTVN0cmluZ30gbWltZSB0eXBlCiAqIGxhc3RNb2RpZmllZERhdGUge0RhdGV9IGxhc3QgbW9kaWZpZWQgZGF0ZQogKiBzaXplIHtOdW1iZXJ9IHNpemUgb2YgdGhlIGZpbGUgaW4gYnl0ZXMKICovCkZpbGUgPSBmdW5jdGlvbihuYW1lLCBmdWxsUGF0aCwgdHlwZSwgbGFzdE1vZGlmaWVkRGF0ZSwgc2l6ZSkgewoJdGhpcy5uYW1lID0gbmFtZSB8fCBudWxsOwogICAgdGhpcy5mdWxsUGF0aCA9IGZ1bGxQYXRoIHx8IG51bGw7Cgl0aGlzLnR5cGUgPSB0eXBlIHx8IG51bGw7CiAgICB0aGlzLmxhc3RNb2RpZmllZERhdGUgPSBsYXN0TW9kaWZpZWREYXRlIHx8IG51bGw7CiAgICB0aGlzLnNpemUgPSBzaXplIHx8IDA7Cn0KLyoqCiAqIENyZWF0ZSBhbiBldmVudCBvYmplY3Qgc2luY2Ugd2UgY2FuJ3Qgc2V0IHRhcmdldCBvbiBET00gZXZlbnQuCiAqCiAqIEBwYXJhbSB0eXBlCiAqIEBwYXJhbSB0YXJnZXQKICoKICovCkZpbGUuX2NyZWF0ZUV2ZW50ID0gZnVuY3Rpb24odHlwZSwgdGFyZ2V0KSB7CiAgICAvLyBDYW4ndCBjcmVhdGUgZXZlbnQgb2JqZWN0LCBzaW5jZSB3ZSBjYW4ndCBzZXQgdGFyZ2V0IChpdHMgcmVhZG9ubHkpCiAgICAvL3ZhciBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnRzJyk7CiAgICAvL2V2dC5pbml0RXZlbnQoIm9ubG9hZCIsIGZhbHNlLCBmYWxzZSk7CiAgICB2YXIgZXZ0ID0geyJ0eXBlIjogdHlwZX07CiAgICBldnQudGFyZ2V0ID0gdGFyZ2V0OwogICAgcmV0dXJuIGV2dDsKfTsKCkZpbGVFcnJvciA9IGZ1bmN0aW9uKCkgewogICB0aGlzLmNvZGUgPSBudWxsOwp9CgovLyBGaWxlIGVycm9yIGNvZGVzCi8vIEZvdW5kIGluIERPTUV4Y2VwdGlvbgpGaWxlRXJyb3IuTk9UX0ZPVU5EX0VSUiA9IDE7CkZpbGVFcnJvci5TRUNVUklUWV9FUlIgPSAyOwpGaWxlRXJyb3IuQUJPUlRfRVJSID0gMzsKCi8vIEFkZGVkIGJ5IHRoaXMgc3BlY2lmaWNhdGlvbgpGaWxlRXJyb3IuTk9UX1JFQURBQkxFX0VSUiA9IDQ7CkZpbGVFcnJvci5FTkNPRElOR19FUlIgPSA1OwpGaWxlRXJyb3IuTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSID0gNjsKRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSID0gNzsKRmlsZUVycm9yLlNZTlRBWF9FUlIgPSA4OwpGaWxlRXJyb3IuSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSID0gOTsKRmlsZUVycm9yLlFVT1RBX0VYQ0VFREVEX0VSUiA9IDEwOwpGaWxlRXJyb3IuVFlQRV9NSVNNQVRDSF9FUlIgPSAxMTsKRmlsZUVycm9yLlBBVEhfRVhJU1RTX0VSUiA9IDEyOwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBGaWxlIG1hbmFnZXIKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKRmlsZU1nciA9IGZ1bmN0aW9uKCkgewp9CgpGaWxlTWdyLnByb3RvdHlwZS50ZXN0RmlsZUV4aXN0cyA9IGZ1bmN0aW9uKGZpbGVOYW1lLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJ0ZXN0RmlsZUV4aXN0cyIsIFtmaWxlTmFtZV0pOwp9OwoKRmlsZU1nci5wcm90b3R5cGUudGVzdERpcmVjdG9yeUV4aXN0cyA9IGZ1bmN0aW9uKGRpck5hbWUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgInRlc3REaXJlY3RvcnlFeGlzdHMiLCBbZGlyTmFtZV0pOwp9OwoKRmlsZU1nci5wcm90b3R5cGUuZ2V0RnJlZURpc2tTcGFjZSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgImdldEZyZWVEaXNrU3BhY2UiLCBbXSk7Cn07CgpGaWxlTWdyLnByb3RvdHlwZS53cml0ZUFzVGV4dCA9IGZ1bmN0aW9uKGZpbGVOYW1lLCBkYXRhLCBiQXBwZW5kLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJ3cml0ZSIsIFtmaWxlTmFtZSwgZGF0YSwgYkFwcGVuZCA/IDEgOiAwXSk7Cn07CgpGaWxlTWdyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKGZpbGVOYW1lLCBkYXRhLCBwb3NpdGlvbiwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAid3JpdGUiLCBbZmlsZU5hbWUsIGRhdGEsIHBvc2l0aW9uXSk7Cn07CgpGaWxlTWdyLnByb3RvdHlwZS50cnVuY2F0ZSA9IGZ1bmN0aW9uKGZpbGVOYW1lLCBzaXplLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJ0cnVuY2F0ZUZpbGUiLCBbZmlsZU5hbWUsIHNpemVdKTsKfTsKCkZpbGVNZ3IucHJvdG90eXBlLnJlYWRBc1RleHQgPSBmdW5jdGlvbihmaWxlTmFtZSwgZW5jb2RpbmcsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgInJlYWRGaWxlIiwgW2ZpbGVOYW1lLCBlbmNvZGluZ10pOwp9OwoKRmlsZU1nci5wcm90b3R5cGUucmVhZEFzRGF0YVVSTCA9IGZ1bmN0aW9uKGZpbGVOYW1lLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKCVBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZWFkQXNEYXRhVVJMIiwgW2ZpbGVOYW1lXSk7Cn07CgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLmZpbGVNZ3IgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgbmF2aWdhdG9yLmZpbGVNZ3IgPSBuZXcgRmlsZU1ncigpOwogICAgfQp9KTsKCgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEZpbGUgUmVhZGVyCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8qKgogKiBUaGlzIGNsYXNzIHJlYWRzIHRoZSBtb2JpbGUgZGV2aWNlIGZpbGUgc3lzdGVtLgogKgogKi8KRmlsZVJlYWRlciA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5maWxlTmFtZSA9ICIiOwoKICAgIHRoaXMucmVhZHlTdGF0ZSA9IDA7CgogICAgLy8gRmlsZSBkYXRhCiAgICB0aGlzLnJlc3VsdCA9IG51bGw7CgogICAgLy8gRXJyb3IKICAgIHRoaXMuZXJyb3IgPSBudWxsOwoKICAgIC8vIEV2ZW50IGhhbmRsZXJzCiAgICB0aGlzLm9ubG9hZHN0YXJ0ID0gbnVsbDsgICAgLy8gV2hlbiB0aGUgcmVhZCBzdGFydHMuCiAgICB0aGlzLm9ucHJvZ3Jlc3MgPSBudWxsOyAgICAgLy8gV2hpbGUgcmVhZGluZyAoYW5kIGRlY29kaW5nKSBmaWxlIG9yIGZpbGVCbG9iIGRhdGEsIGFuZCByZXBvcnRpbmcgcGFydGlhbCBmaWxlIGRhdGEgKHByb2dlc3MubG9hZGVkL3Byb2dyZXNzLnRvdGFsKQogICAgdGhpcy5vbmxvYWQgPSBudWxsOyAgICAgICAgIC8vIFdoZW4gdGhlIHJlYWQgaGFzIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQuCiAgICB0aGlzLm9uZXJyb3IgPSBudWxsOyAgICAgICAgLy8gV2hlbiB0aGUgcmVhZCBoYXMgZmFpbGVkIChzZWUgZXJyb3JzKS4KICAgIHRoaXMub25sb2FkZW5kID0gbnVsbDsgICAgICAvLyBXaGVuIHRoZSByZXF1ZXN0IGhhcyBjb21wbGV0ZWQgKGVpdGhlciBpbiBzdWNjZXNzIG9yIGZhaWx1cmUpLgogICAgdGhpcy5vbmFib3J0ID0gbnVsbDsgICAgICAgIC8vIFdoZW4gdGhlIHJlYWQgaGFzIGJlZW4gYWJvcnRlZC4gRm9yIGluc3RhbmNlLCBieSBpbnZva2luZyB0aGUgYWJvcnQoKSBtZXRob2QuCn0KCi8vIFN0YXRlcwpGaWxlUmVhZGVyLkVNUFRZID0gMDsKRmlsZVJlYWRlci5MT0FESU5HID0gMTsKRmlsZVJlYWRlci5ET05FID0gMjsKCi8qKgogKiBBYm9ydCByZWFkaW5nIGZpbGUuCiAqLwpGaWxlUmVhZGVyLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGV2dDsKICAgIHRoaXMucmVhZHlTdGF0ZSA9IEZpbGVSZWFkZXIuRE9ORTsKICAgIHRoaXMucmVzdWx0ID0gbnVsbDsKCiAgICAvLyBzZXQgZXJyb3IKICAgIHZhciBlcnJvciA9IG5ldyBGaWxlRXJyb3IoKTsKICAgIGVycm9yLmNvZGUgPSBlcnJvci5BQk9SVF9FUlI7CiAgICB0aGlzLmVycm9yID0gZXJyb3I7CiAgIAogICAgLy8gSWYgZXJyb3IgY2FsbGJhY2sKICAgIGlmICh0eXBlb2YgdGhpcy5vbmVycm9yID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoImVycm9yIiwgdGhpcyk7CiAgICAgICAgdGhpcy5vbmVycm9yKGV2dCk7CiAgICB9CiAgICAvLyBJZiBhYm9ydCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiB0aGlzLm9uYWJvcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBldnQgPSBGaWxlLl9jcmVhdGVFdmVudCgiYWJvcnQiLCB0aGlzKTsKICAgICAgICB0aGlzLm9uYWJvcnQoZXZ0KTsKICAgIH0KICAgIC8vIElmIGxvYWQgZW5kIGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25sb2FkZW5kID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoImxvYWRlbmQiLCB0aGlzKTsKICAgICAgICB0aGlzLm9ubG9hZGVuZChldnQpOwogICAgfQp9OwoKLyoqCiAqIFJlYWQgdGV4dCBmaWxlLgogKgogKiBAcGFyYW0gZmlsZSAgICAgICAgICBUaGUgbmFtZSBvZiB0aGUgZmlsZQogKiBAcGFyYW0gZW5jb2RpbmcgICAgICBbT3B0aW9uYWxdIChzZWUgaHR0cDovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9jaGFyYWN0ZXItc2V0cykKICovCkZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc1RleHQgPSBmdW5jdGlvbihmaWxlLCBlbmNvZGluZykgewogICAgdGhpcy5maWxlTmFtZSA9ICIiOwoJaWYgKHR5cGVvZiBmaWxlLmZ1bGxQYXRoID09PSAidW5kZWZpbmVkIikgewoJCXRoaXMuZmlsZU5hbWUgPSBmaWxlOwoJfSBlbHNlIHsKCQl0aGlzLmZpbGVOYW1lID0gZmlsZS5mdWxsUGF0aDsKCX0KCiAgICAvLyBMT0FESU5HIHN0YXRlCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkxPQURJTkc7CgogICAgLy8gSWYgbG9hZHN0YXJ0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25sb2Fkc3RhcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB2YXIgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoImxvYWRzdGFydCIsIHRoaXMpOwogICAgICAgIHRoaXMub25sb2Fkc3RhcnQoZXZ0KTsKICAgIH0KCiAgICAvLyBEZWZhdWx0IGVuY29kaW5nIGlzIFVURi04CiAgICB2YXIgZW5jID0gZW5jb2RpbmcgPyBlbmNvZGluZyA6ICJVVEYtOCI7CgogICAgdmFyIG1lID0gdGhpczsKCiAgICAvLyBSZWFkIGZpbGUKICAgIG5hdmlnYXRvci5maWxlTWdyLnJlYWRBc1RleHQodGhpcy5maWxlTmFtZSwgZW5jLAoKICAgICAgICAvLyBTdWNjZXNzIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24ocikgewogICAgICAgICAgICB2YXIgZXZ0OwoKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVJlYWRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgcmVzdWx0CiAgICAgICAgICAgIG1lLnJlc3VsdCA9IGRlY29kZVVSSUNvbXBvbmVudChyKTsKCiAgICAgICAgICAgIC8vIElmIG9ubG9hZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ubG9hZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoImxvYWQiLCBtZSk7CiAgICAgICAgICAgICAgICBtZS5vbmxvYWQoZXZ0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVJlYWRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb25sb2FkZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25sb2FkZW5kID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBldnQgPSBGaWxlLl9jcmVhdGVFdmVudCgibG9hZGVuZCIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZGVuZChldnQpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLy8gRXJyb3IgY2FsbGJhY2sKICAgICAgICBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBldnQ7CiAgICAgICAgICAgIC8vIElmIERPTkUgKGNhbmNlbGxlZCksIHRoZW4gZG9uJ3QgZG8gYW55dGhpbmcKICAgICAgICAgICAgaWYgKG1lLnJlYWR5U3RhdGUgPT09IEZpbGVSZWFkZXIuRE9ORSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTYXZlIGVycm9yCiAgICAgICAgICAgIG1lLmVycm9yID0gZTsKCiAgICAgICAgICAgIC8vIElmIG9uZXJyb3IgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbmVycm9yID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBldnQgPSBGaWxlLl9jcmVhdGVFdmVudCgiZXJyb3IiLCBtZSk7CiAgICAgICAgICAgICAgICBtZS5vbmVycm9yKGV2dCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERPTkUgc3RhdGUKICAgICAgICAgICAgbWUucmVhZHlTdGF0ZSA9IEZpbGVSZWFkZXIuRE9ORTsKCiAgICAgICAgICAgIC8vIElmIG9ubG9hZGVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ubG9hZGVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoImxvYWRlbmQiLCBtZSk7CiAgICAgICAgICAgICAgICBtZS5vbmxvYWRlbmQoZXZ0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICApOwp9OwoKCi8qKgogKiBSZWFkIGZpbGUgYW5kIHJldHVybiBkYXRhIGFzIGEgYmFzZTY0IGVuY29kZWQgZGF0YSB1cmwuCiAqIEEgZGF0YSB1cmwgaXMgb2YgdGhlIGZvcm06CiAqICAgICAgZGF0YTpbPG1lZGlhdHlwZT5dWztiYXNlNjRdLDxkYXRhPgogKgogKiBAcGFyYW0gZmlsZSAgICAgICAgICB7RmlsZX0gRmlsZSBvYmplY3QgY29udGFpbmluZyBmaWxlIHByb3BlcnRpZXMKICovCkZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0RhdGFVUkwgPSBmdW5jdGlvbihmaWxlKSB7CiAgICB0aGlzLmZpbGVOYW1lID0gIiI7CiAgICAKICAgIGlmICh0eXBlb2YgZmlsZS5mdWxsUGF0aCA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICB0aGlzLmZpbGVOYW1lID0gZmlsZTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maWxlTmFtZSA9IGZpbGUuZnVsbFBhdGg7CiAgICB9CgogICAgLy8gTE9BRElORyBzdGF0ZQogICAgdGhpcy5yZWFkeVN0YXRlID0gRmlsZVJlYWRlci5MT0FESU5HOwoKICAgIC8vIElmIGxvYWRzdGFydCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiB0aGlzLm9ubG9hZHN0YXJ0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgdmFyIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJsb2Fkc3RhcnQiLCB0aGlzKTsKICAgICAgICB0aGlzLm9ubG9hZHN0YXJ0KGV2dCk7CiAgICB9CgogICAgdmFyIG1lID0gdGhpczsKCiAgICAvLyBSZWFkIGZpbGUKICAgIG5hdmlnYXRvci5maWxlTWdyLnJlYWRBc0RhdGFVUkwodGhpcy5maWxlTmFtZSwKCiAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgdmFyIGV2dDsKCiAgICAgICAgICAgIC8vIElmIERPTkUgKGNhbmNlbGxlZCksIHRoZW4gZG9uJ3QgZG8gYW55dGhpbmcKICAgICAgICAgICAgaWYgKG1lLnJlYWR5U3RhdGUgPT09IEZpbGVSZWFkZXIuRE9ORSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTYXZlIHJlc3VsdAogICAgICAgICAgICBtZS5yZXN1bHQgPSByOwoKICAgICAgICAgICAgLy8gSWYgb25sb2FkIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25sb2FkID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBldnQgPSBGaWxlLl9jcmVhdGVFdmVudCgibG9hZCIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZChldnQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBET05FIHN0YXRlCiAgICAgICAgICAgIG1lLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkRPTkU7CgogICAgICAgICAgICAvLyBJZiBvbmxvYWRlbmQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbmxvYWRlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJsb2FkZW5kIiwgbWUpOwogICAgICAgICAgICAgICAgbWUub25sb2FkZW5kKGV2dCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvLyBFcnJvciBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIGV2dDsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVJlYWRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgZXJyb3IKICAgICAgICAgICAgbWUuZXJyb3IgPSBlOwoKICAgICAgICAgICAgLy8gSWYgb25lcnJvciBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9uZXJyb3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJlcnJvciIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9uZXJyb3IoZXZ0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVJlYWRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb25sb2FkZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25sb2FkZW5kID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBldnQgPSBGaWxlLl9jcmVhdGVFdmVudCgibG9hZGVuZCIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZGVuZChldnQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICk7Cn07CgovKioKICogUmVhZCBmaWxlIGFuZCByZXR1cm4gZGF0YSBhcyBhIGJpbmFyeSBkYXRhLgogKgogKiBAcGFyYW0gZmlsZSAgICAgICAgICBUaGUgbmFtZSBvZiB0aGUgZmlsZQogKi8KRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzQmluYXJ5U3RyaW5nID0gZnVuY3Rpb24oZmlsZSkgewogICAgLy8gVE9ETyAtIENhbid0IHJldHVybiBiaW5hcnkgZGF0YSB0byBicm93c2VyLgogICAgdGhpcy5maWxlTmFtZSA9IGZpbGU7Cn07CgovKioKICogUmVhZCBmaWxlIGFuZCByZXR1cm4gZGF0YSBhcyBhIGJpbmFyeSBkYXRhLgogKgogKiBAcGFyYW0gZmlsZSAgICAgICAgICBUaGUgbmFtZSBvZiB0aGUgZmlsZQogKi8KRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzQXJyYXlCdWZmZXIgPSBmdW5jdGlvbihmaWxlKSB7CiAgICAvLyBUT0RPIC0gQ2FuJ3QgcmV0dXJuIGJpbmFyeSBkYXRhIHRvIGJyb3dzZXIuCiAgICB0aGlzLmZpbGVOYW1lID0gZmlsZTsKfTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRmlsZSBXcml0ZXIKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLyoqCiAqIFRoaXMgY2xhc3Mgd3JpdGVzIHRvIHRoZSBtb2JpbGUgZGV2aWNlIGZpbGUgc3lzdGVtLgogKgogIEBwYXJhbSBmaWxlIHtGaWxlfSBhIEZpbGUgb2JqZWN0IHJlcHJlc2VudGluZyBhIGZpbGUgb24gdGhlIGZpbGUgc3lzdGVtCiovCkZpbGVXcml0ZXIgPSBmdW5jdGlvbihmaWxlKSB7CiAgICB0aGlzLmZpbGVOYW1lID0gIiI7CiAgICB0aGlzLmxlbmd0aCA9IDA7CglpZiAoZmlsZSkgewoJICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlLmZ1bGxQYXRoIHx8IGZpbGU7CgkgICAgdGhpcy5sZW5ndGggPSBmaWxlLnNpemUgfHwgMDsKCX0KCQoJLy8gZGVmYXVsdCBpcyB0byB3cml0ZSBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBmaWxlCiAgICB0aGlzLnBvc2l0aW9uID0gMDsKICAgIAogICAgdGhpcy5yZWFkeVN0YXRlID0gMDsgLy8gRU1QVFkKCiAgICB0aGlzLnJlc3VsdCA9IG51bGw7CgogICAgLy8gRXJyb3IKICAgIHRoaXMuZXJyb3IgPSBudWxsOwoKICAgIC8vIEV2ZW50IGhhbmRsZXJzCiAgICB0aGlzLm9ud3JpdGVzdGFydCA9IG51bGw7CS8vIFdoZW4gd3JpdGluZyBzdGFydHMKICAgIHRoaXMub25wcm9ncmVzcyA9IG51bGw7CQkvLyBXaGlsZSB3cml0aW5nIHRoZSBmaWxlLCBhbmQgcmVwb3J0aW5nIHBhcnRpYWwgZmlsZSBkYXRhCiAgICB0aGlzLm9ud3JpdGUgPSBudWxsOwkJLy8gV2hlbiB0aGUgd3JpdGUgaGFzIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQuCiAgICB0aGlzLm9ud3JpdGVlbmQgPSBudWxsOwkJLy8gV2hlbiB0aGUgcmVxdWVzdCBoYXMgY29tcGxldGVkIChlaXRoZXIgaW4gc3VjY2VzcyBvciBmYWlsdXJlKS4KICAgIHRoaXMub25hYm9ydCA9IG51bGw7CQkvLyBXaGVuIHRoZSB3cml0ZSBoYXMgYmVlbiBhYm9ydGVkLiBGb3IgaW5zdGFuY2UsIGJ5IGludm9raW5nIHRoZSBhYm9ydCgpIG1ldGhvZC4KICAgIHRoaXMub25lcnJvciA9IG51bGw7CQkvLyBXaGVuIHRoZSB3cml0ZSBoYXMgZmFpbGVkIChzZWUgZXJyb3JzKS4KfQoKLy8gU3RhdGVzCkZpbGVXcml0ZXIuSU5JVCA9IDA7CkZpbGVXcml0ZXIuV1JJVElORyA9IDE7CkZpbGVXcml0ZXIuRE9ORSA9IDI7CgovKioKICogQWJvcnQgd3JpdGluZyBmaWxlLgogKi8KRmlsZVdyaXRlci5wcm90b3R5cGUuYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgIC8vIGNoZWNrIGZvciBpbnZhbGlkIHN0YXRlCglpZiAodGhpcy5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLkRPTkUgfHwgdGhpcy5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLklOSVQpIHsKCQl0aHJvdyBGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlI7Cgl9IAoKICAgIC8vIHNldCBlcnJvcgogICAgdmFyIGVycm9yID0gbmV3IEZpbGVFcnJvcigpLCBldnQ7CiAgICBlcnJvci5jb2RlID0gZXJyb3IuQUJPUlRfRVJSOwogICAgdGhpcy5lcnJvciA9IGVycm9yOwogICAgCiAgICAvLyBJZiBlcnJvciBjYWxsYmFjawogICAgaWYgKHR5cGVvZiB0aGlzLm9uZXJyb3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBldnQgPSBGaWxlLl9jcmVhdGVFdmVudCgiZXJyb3IiLCB0aGlzKTsKICAgICAgICB0aGlzLm9uZXJyb3IoZXZ0KTsKICAgIH0KICAgIC8vIElmIGFib3J0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25hYm9ydCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJhYm9ydCIsIHRoaXMpOwogICAgICAgIHRoaXMub25hYm9ydChldnQpOwogICAgfQogICAgCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlV3JpdGVyLkRPTkU7CgogICAgLy8gSWYgd3JpdGUgZW5kIGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub253cml0ZWVuZCA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlZW5kIiwgdGhpcyk7CiAgICAgICAgdGhpcy5vbndyaXRlZW5kKGV2dCk7CiAgICB9Cn07CgovKioKICogQERlcHJlY2F0ZWQ6IHVzZSB3cml0ZSBpbnN0ZWFkCiAqIAogKiBAcGFyYW0gZmlsZSB0byB3cml0ZSB0aGUgZGF0YSB0bwogKiBAcGFyYW0gdGV4dCB0byBiZSB3cml0dGVuCiAqIEBwYXJhbSBiQXBwZW5kIGlmIHRydWUgd3JpdGUgdG8gZW5kIG9mIGZpbGUsIG90aGVyd2lzZSBvdmVyd3JpdGUgdGhlIGZpbGUKICovCkZpbGVXcml0ZXIucHJvdG90eXBlLndyaXRlQXNUZXh0ID0gZnVuY3Rpb24oZmlsZSwgdGV4dCwgYkFwcGVuZCkgewoJLy8gVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHdlIGFyZSBhbHJlYWR5IHdyaXRpbmcgYSBmaWxlCglpZiAodGhpcy5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLldSSVRJTkcpIHsKCQl0aHJvdyBGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlI7Cgl9CgoJaWYgKGJBcHBlbmQgIT09IHRydWUpIHsKICAgICAgICBiQXBwZW5kID0gZmFsc2U7IC8vIGZvciBudWxsIHZhbHVlcwogICAgfQoKICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlOwoKICAgIC8vIFdSSVRJTkcgc3RhdGUKICAgIHRoaXMucmVhZHlTdGF0ZSA9IEZpbGVXcml0ZXIuV1JJVElORzsKCiAgICB2YXIgbWUgPSB0aGlzOwoKICAgIC8vIElmIG9ud3JpdGVzdGFydCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiBtZS5vbndyaXRlc3RhcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB2YXIgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlc3RhcnQiLCBtZSk7CiAgICAgICAgbWUub253cml0ZXN0YXJ0KGV2dCk7CiAgICB9CgkKCQogICAgLy8gV3JpdGUgZmlsZSAKCW5hdmlnYXRvci5maWxlTWdyLndyaXRlQXNUZXh0KGZpbGUsIHRleHQsIGJBcHBlbmQsCiAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgdmFyIGV2dDsKCiAgICAgICAgICAgIC8vIElmIERPTkUgKGNhbmNlbGxlZCksIHRoZW4gZG9uJ3QgZG8gYW55dGhpbmcKICAgICAgICAgICAgaWYgKG1lLnJlYWR5U3RhdGUgPT09IEZpbGVXcml0ZXIuRE9ORSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTYXZlIHJlc3VsdAogICAgICAgICAgICBtZS5yZXN1bHQgPSByOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZSBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZSIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGUoZXZ0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZWVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGVlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGVlbmQoZXZ0KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8vIEVycm9yIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgZXZ0OwoKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgZXJyb3IKICAgICAgICAgICAgbWUuZXJyb3IgPSBlOwoKICAgICAgICAgICAgLy8gSWYgb25lcnJvciBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9uZXJyb3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJlcnJvciIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9uZXJyb3IoZXZ0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZWVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGVlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGVlbmQoZXZ0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICk7Cn07CgovKioKICogV3JpdGVzIGRhdGEgdG8gdGhlIGZpbGUKICogIAogKiBAcGFyYW0gdGV4dCB0byBiZSB3cml0dGVuCiAqLwpGaWxlV3JpdGVyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKHRleHQpIHsKCS8vIFRocm93IGFuIGV4Y2VwdGlvbiBpZiB3ZSBhcmUgYWxyZWFkeSB3cml0aW5nIGEgZmlsZQoJaWYgKHRoaXMucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5XUklUSU5HKSB7CgkJdGhyb3cgRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSOwoJfQoKICAgIC8vIFdSSVRJTkcgc3RhdGUKICAgIHRoaXMucmVhZHlTdGF0ZSA9IEZpbGVXcml0ZXIuV1JJVElORzsKCiAgICB2YXIgbWUgPSB0aGlzOwoKICAgIC8vIElmIG9ud3JpdGVzdGFydCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiBtZS5vbndyaXRlc3RhcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB2YXIgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlc3RhcnQiLCBtZSk7CiAgICAgICAgbWUub253cml0ZXN0YXJ0KGV2dCk7CiAgICB9CgogICAgLy8gV3JpdGUgZmlsZQogICAgbmF2aWdhdG9yLmZpbGVNZ3Iud3JpdGUodGhpcy5maWxlTmFtZSwgdGV4dCwgdGhpcy5wb3NpdGlvbiwKCiAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgdmFyIGV2dDsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBwb3NpdGlvbiBhbHdheXMgaW5jcmVhc2VzIGJ5IGJ5dGVzIHdyaXR0ZW4gYmVjYXVzZSBmaWxlIHdvdWxkIGJlIGV4dGVuZGVkCiAgICAgICAgICAgIG1lLnBvc2l0aW9uICs9IHI7CgkJCS8vIFRoZSBsZW5ndGggb2YgdGhlIGZpbGUgaXMgbm93IHdoZXJlIHdlIGFyZSBkb25lIHdyaXRpbmcuCgkJCW1lLmxlbmd0aCA9IG1lLnBvc2l0aW9uOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSWYgb253cml0ZSBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZSIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGUoZXZ0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZWVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGVlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGVlbmQoZXZ0KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8vIEVycm9yIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgZXZ0OwoKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgZXJyb3IKICAgICAgICAgICAgbWUuZXJyb3IgPSBlOwoKICAgICAgICAgICAgLy8gSWYgb25lcnJvciBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9uZXJyb3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJlcnJvciIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9uZXJyb3IoZXZ0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZWVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGVlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGVlbmQoZXZ0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICApOwoKfTsKCi8qKiAKICogTW92ZXMgdGhlIGZpbGUgcG9pbnRlciB0byB0aGUgbG9jYXRpb24gc3BlY2lmaWVkLgogKiAKICogSWYgdGhlIG9mZnNldCBpcyBhIG5lZ2F0aXZlIG51bWJlciB0aGUgcG9zaXRpb24gb2YgdGhlIGZpbGUgCiAqIHBvaW50ZXIgaXMgcmV3b3VuZC4gIElmIHRoZSBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIHRoZSBmaWxlIAogKiBzaXplIHRoZSBwb3NpdGlvbiBpcyBzZXQgdG8gdGhlIGVuZCBvZiB0aGUgZmlsZS4gIAogKiAKICogQHBhcmFtIG9mZnNldCBpcyB0aGUgbG9jYXRpb24gdG8gbW92ZSB0aGUgZmlsZSBwb2ludGVyIHRvLgogKi8KRmlsZVdyaXRlci5wcm90b3R5cGUuc2VlayA9IGZ1bmN0aW9uKG9mZnNldCkgewogICAgLy8gVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHdlIGFyZSBhbHJlYWR5IHdyaXRpbmcgYSBmaWxlCiAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLldSSVRJTkcpIHsKICAgICAgICB0aHJvdyBGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlI7CiAgICB9CgogICAgaWYgKCFvZmZzZXQpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIFNlZSBiYWNrIGZyb20gZW5kIG9mIGZpbGUuCiAgICBpZiAob2Zmc2V0IDwgMCkgewoJCXRoaXMucG9zaXRpb24gPSBNYXRoLm1heChvZmZzZXQgKyB0aGlzLmxlbmd0aCwgMCk7Cgl9CiAgICAvLyBPZmZzZXQgaXMgYmlnZ2VyIHRoZW4gZmlsZSBzaXplIHNvIHNldCBwb3NpdGlvbiAKICAgIC8vIHRvIHRoZSBlbmQgb2YgdGhlIGZpbGUuCgllbHNlIGlmIChvZmZzZXQgPiB0aGlzLmxlbmd0aCkgewoJCXRoaXMucG9zaXRpb24gPSB0aGlzLmxlbmd0aDsKCX0KICAgIC8vIE9mZnNldCBpcyBiZXR3ZWVuIDAgYW5kIGZpbGUgc2l6ZSBzbyBzZXQgdGhlIHBvc2l0aW9uCiAgICAvLyB0byBzdGFydCB3cml0aW5nLgoJZWxzZSB7CgkJdGhpcy5wb3NpdGlvbiA9IG9mZnNldDsKCX0JCn07CgovKiogCiAqIFRydW5jYXRlcyB0aGUgZmlsZSB0byB0aGUgc2l6ZSBzcGVjaWZpZWQuCiAqIAogKiBAcGFyYW0gc2l6ZSB0byBjaG9wIHRoZSBmaWxlIGF0LgogKi8KRmlsZVdyaXRlci5wcm90b3R5cGUudHJ1bmNhdGUgPSBmdW5jdGlvbihzaXplKSB7CgkvLyBUaHJvdyBhbiBleGNlcHRpb24gaWYgd2UgYXJlIGFscmVhZHkgd3JpdGluZyBhIGZpbGUKCWlmICh0aGlzLnJlYWR5U3RhdGUgPT09IEZpbGVXcml0ZXIuV1JJVElORykgewoJCXRocm93IEZpbGVFcnJvci5JTlZBTElEX1NUQVRFX0VSUjsKCX0KCS8vIHdoYXQgaWYgbm8gc2l6ZSBzcGVjaWZpZWQ/IAoKICAgIC8vIFdSSVRJTkcgc3RhdGUKICAgIHRoaXMucmVhZHlTdGF0ZSA9IEZpbGVXcml0ZXIuV1JJVElORzsKCiAgICB2YXIgbWUgPSB0aGlzOwoKICAgIC8vIElmIG9ud3JpdGVzdGFydCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiBtZS5vbndyaXRlc3RhcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB2YXIgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlc3RhcnQiLCBtZSk7CiAgICAgICAgbWUub253cml0ZXN0YXJ0KGV2dCk7CiAgICB9CgogICAgLy8gV3JpdGUgZmlsZQogICAgbmF2aWdhdG9yLmZpbGVNZ3IudHJ1bmNhdGUodGhpcy5maWxlTmFtZSwgc2l6ZSwKCiAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgdmFyIGV2dDsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbGVuZ3RoIG9mIHRoZSBmaWxlCiAgICAgICAgICAgIG1lLmxlbmd0aCA9IHI7CiAgICAgICAgICAgIG1lLnBvc2l0aW9uID0gTWF0aC5taW4obWUucG9zaXRpb24sIHIpOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZSBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZSIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGUoZXZ0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZWVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGVlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGV2dCA9IEZpbGUuX2NyZWF0ZUV2ZW50KCJ3cml0ZWVuZCIsIG1lKTsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGVlbmQoZXZ0KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8vIEVycm9yIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgZXZ0OwogICAgICAgICAgICAvLyBJZiBET05FIChjYW5jZWxsZWQpLCB0aGVuIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgIGlmIChtZS5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLkRPTkUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2F2ZSBlcnJvcgogICAgICAgICAgICBtZS5lcnJvciA9IGU7CgogICAgICAgICAgICAvLyBJZiBvbmVycm9yIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoImVycm9yIiwgbWUpOwogICAgICAgICAgICAgICAgbWUub25lcnJvcihldnQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBET05FIHN0YXRlCiAgICAgICAgICAgIG1lLnJlYWR5U3RhdGUgPSBGaWxlV3JpdGVyLkRPTkU7CgogICAgICAgICAgICAvLyBJZiBvbndyaXRlZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub253cml0ZWVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgZXZ0ID0gRmlsZS5fY3JlYXRlRXZlbnQoIndyaXRlZW5kIiwgbWUpOwogICAgICAgICAgICAgICAgbWUub253cml0ZWVuZChldnQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgKTsKfTsKCkxvY2FsRmlsZVN5c3RlbSA9IGZ1bmN0aW9uKCkgewp9OwoKLy8gRmlsZSBlcnJvciBjb2RlcwpMb2NhbEZpbGVTeXN0ZW0uVEVNUE9SQVJZID0gMDsKTG9jYWxGaWxlU3lzdGVtLlBFUlNJU1RFTlQgPSAxOwpMb2NhbEZpbGVTeXN0ZW0uUkVTT1VSQ0UgPSAyOwpMb2NhbEZpbGVTeXN0ZW0uQVBQTElDQVRJT04gPSAzOwoKLyoqCiAqIFJlcXVlc3RzIGEgZmlsZXN5c3RlbSBpbiB3aGljaCB0byBzdG9yZSBhcHBsaWNhdGlvbiBkYXRhLgogKiAKICogQHBhcmFtIHtpbnR9IHR5cGUgb2YgZmlsZSBzeXN0ZW0gYmVpbmcgcmVxdWVzdGVkCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCB0aGUgbmV3IEZpbGVTeXN0ZW0KICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KTG9jYWxGaWxlU3lzdGVtLnByb3RvdHlwZS5yZXF1ZXN0RmlsZVN5c3RlbSA9IGZ1bmN0aW9uKHR5cGUsIHNpemUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewoJaWYgKHR5cGUgPCAwIHx8IHR5cGUgPiAzKSB7CgkJaWYgKHR5cGVvZiBlcnJvckNhbGxiYWNrID09ICJmdW5jdGlvbiIpIHsKCQkJZXJyb3JDYWxsYmFjayh7CgkJCQkiY29kZSI6IEZpbGVFcnJvci5TWU5UQVhfRVJSCgkJCX0pOwoJCX0KCX0KCWVsc2UgewoJCVBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZXF1ZXN0RmlsZVN5c3RlbSIsIFt0eXBlLCBzaXplXSk7Cgl9Cn07CgovKioKICogCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSB1cmkgcmVmZXJyaW5nIHRvIGEgbG9jYWwgZmlsZSBpbiBhIGZpbGVzeXN0ZW0KICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KTG9jYWxGaWxlU3lzdGVtLnByb3RvdHlwZS5yZXNvbHZlTG9jYWxGaWxlU3lzdGVtVVJJID0gZnVuY3Rpb24odXJpLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZXNvbHZlTG9jYWxGaWxlU3lzdGVtVVJJIiwgW3VyaV0pOwp9OwoKLyoqCiogVGhpcyBmdW5jdGlvbiAgaXMgcmVxdWlyZWQgYXMgd2UgbmVlZCB0byBjb252ZXJ0IHJhdyAKKiBKU09OIG9iamVjdHMgaW50byBjb25jcmV0ZSBGaWxlIGFuZCBEaXJlY3Rvcnkgb2JqZWN0cy4gIAoqIAoqIEBwYXJhbSBhIEpTT04gT2JqZWN0cyB0aGF0IG5lZWQgdG8gYmUgY29udmVydGVkIHRvIERpcmVjdG9yeUVudHJ5IG9yIEZpbGVFbnRyeSBvYmplY3RzLgoqIEByZXR1cm5zIGFuIGVudHJ5IAoqLwpMb2NhbEZpbGVTeXN0ZW0ucHJvdG90eXBlLl9jYXN0RlMgPSBmdW5jdGlvbihwbHVnaW5SZXN1bHQpIHsKICAgIHZhciBlbnRyeSA9IG51bGw7CiAgICBlbnRyeSA9IG5ldyBEaXJlY3RvcnlFbnRyeSgpOwogICAgZW50cnkuaXNEaXJlY3RvcnkgPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5yb290LmlzRGlyZWN0b3J5OwogICAgZW50cnkuaXNGaWxlID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2Uucm9vdC5pc0ZpbGU7CiAgICBlbnRyeS5uYW1lID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2Uucm9vdC5uYW1lOwogICAgZW50cnkuZnVsbFBhdGggPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5yb290LmZ1bGxQYXRoOwogICAgcGx1Z2luUmVzdWx0Lm1lc3NhZ2Uucm9vdCA9IGVudHJ5OwogICAgcmV0dXJuIHBsdWdpblJlc3VsdDsgICAgCn0KCkxvY2FsRmlsZVN5c3RlbS5wcm90b3R5cGUuX2Nhc3RFbnRyeSA9IGZ1bmN0aW9uKHBsdWdpblJlc3VsdCkgewogICAgdmFyIGVudHJ5ID0gbnVsbDsKICAgIGlmIChwbHVnaW5SZXN1bHQubWVzc2FnZS5pc0RpcmVjdG9yeSkgewogICAgICAgIGVudHJ5ID0gbmV3IERpcmVjdG9yeUVudHJ5KCk7CiAgICB9CiAgICBlbHNlIGlmIChwbHVnaW5SZXN1bHQubWVzc2FnZS5pc0ZpbGUpIHsKCQllbnRyeSA9IG5ldyBGaWxlRW50cnkoKTsKICAgIH0KICAgIGVudHJ5LmlzRGlyZWN0b3J5ID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2UuaXNEaXJlY3Rvcnk7CiAgICBlbnRyeS5pc0ZpbGUgPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5pc0ZpbGU7CiAgICBlbnRyeS5uYW1lID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2UubmFtZTsKICAgIGVudHJ5LmZ1bGxQYXRoID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2UuZnVsbFBhdGg7CiAgICBwbHVnaW5SZXN1bHQubWVzc2FnZSA9IGVudHJ5OwogICAgcmV0dXJuIHBsdWdpblJlc3VsdDsgICAgCn0KCkxvY2FsRmlsZVN5c3RlbS5wcm90b3R5cGUuX2Nhc3RFbnRyaWVzID0gZnVuY3Rpb24ocGx1Z2luUmVzdWx0KSB7CiAgICB2YXIgZW50cmllcyA9IHBsdWdpblJlc3VsdC5tZXNzYWdlOwoJdmFyIHJldFZhbCA9IFtdOyAKCWZvciAoaT0wOyBpPGVudHJpZXMubGVuZ3RoOyBpKyspIHsKCQlyZXRWYWwucHVzaCh3aW5kb3cubG9jYWxGaWxlU3lzdGVtLl9jcmVhdGVFbnRyeShlbnRyaWVzW2ldKSk7Cgl9CiAgICBwbHVnaW5SZXN1bHQubWVzc2FnZSA9IHJldFZhbDsKICAgIHJldHVybiBwbHVnaW5SZXN1bHQ7ICAgIAp9CgpMb2NhbEZpbGVTeXN0ZW0ucHJvdG90eXBlLl9jcmVhdGVFbnRyeSA9IGZ1bmN0aW9uKGNhc3RNZSkgewoJdmFyIGVudHJ5ID0gbnVsbDsKICAgIGlmIChjYXN0TWUuaXNEaXJlY3RvcnkpIHsKICAgICAgICBlbnRyeSA9IG5ldyBEaXJlY3RvcnlFbnRyeSgpOwogICAgfQogICAgZWxzZSBpZiAoY2FzdE1lLmlzRmlsZSkgewogICAgICAgIGVudHJ5ID0gbmV3IEZpbGVFbnRyeSgpOwogICAgfQogICAgZW50cnkuaXNEaXJlY3RvcnkgPSBjYXN0TWUuaXNEaXJlY3Rvcnk7CiAgICBlbnRyeS5pc0ZpbGUgPSBjYXN0TWUuaXNGaWxlOwogICAgZW50cnkubmFtZSA9IGNhc3RNZS5uYW1lOwogICAgZW50cnkuZnVsbFBhdGggPSBjYXN0TWUuZnVsbFBhdGg7CiAgICByZXR1cm4gZW50cnk7ICAgIAoKfQoKTG9jYWxGaWxlU3lzdGVtLnByb3RvdHlwZS5fY2FzdERhdGUgPSBmdW5jdGlvbihwbHVnaW5SZXN1bHQpIHsKCWlmIChwbHVnaW5SZXN1bHQubWVzc2FnZS5tb2RpZmljYXRpb25UaW1lKSB7CgkJdmFyIG1ldGFkYXRhT2JqID0gbmV3IE1ldGFkYXRhKCk7CgkJCgkgICAgbWV0YWRhdGFPYmoubW9kaWZpY2F0aW9uVGltZSA9IG5ldyBEYXRlKHBsdWdpblJlc3VsdC5tZXNzYWdlLm1vZGlmaWNhdGlvblRpbWUpOwoJICAgIHBsdWdpblJlc3VsdC5tZXNzYWdlID0gbWV0YWRhdGFPYmo7Cgl9CgllbHNlIGlmIChwbHVnaW5SZXN1bHQubWVzc2FnZS5sYXN0TW9kaWZpZWREYXRlKSB7CgkJdmFyIGZpbGUgPSBuZXcgRmlsZSgpOwogICAgICAgIGZpbGUuc2l6ZSA9IHBsdWdpblJlc3VsdC5tZXNzYWdlLnNpemU7CiAgICAgICAgZmlsZS50eXBlID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2UudHlwZTsKICAgICAgICBmaWxlLm5hbWUgPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5uYW1lOwogICAgICAgIGZpbGUuZnVsbFBhdGggPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5mdWxsUGF0aDsKCQlmaWxlLmxhc3RNb2RpZmVkRGF0ZSA9IG5ldyBEYXRlKHBsdWdpblJlc3VsdC5tZXNzYWdlLmxhc3RNb2RpZmllZERhdGUpOwoJICAgIHBsdWdpblJlc3VsdC5tZXNzYWdlID0gZmlsZTsJCQoJfQoKICAgIHJldHVybiBwbHVnaW5SZXN1bHQ7CQp9CkxvY2FsRmlsZVN5c3RlbS5wcm90b3R5cGUuX2Nhc3RFcnJvciA9IGZ1bmN0aW9uKHBsdWdpblJlc3VsdCkgewoJdmFyIGZpbGVFcnJvciA9IG5ldyBGaWxlRXJyb3IoKTsKCWZpbGVFcnJvci5jb2RlID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2U7CglwbHVnaW5SZXN1bHQubWVzc2FnZSA9IGZpbGVFcnJvcjsKCXJldHVybiBwbHVnaW5SZXN1bHQ7Cn0KCi8qKgogKiBJbmZvcm1hdGlvbiBhYm91dCB0aGUgc3RhdGUgb2YgdGhlIGZpbGUgb3IgZGlyZWN0b3J5CiAqIAogKiB7RGF0ZX0gbW9kaWZpY2F0aW9uVGltZSAocmVhZG9ubHkpCiAqLwpNZXRhZGF0YSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5tb2RpZmljYXRpb25UaW1lPW51bGw7Cn07CgovKioKICogU3VwcGxpZXMgYXJndW1lbnRzIHRvIG1ldGhvZHMgdGhhdCBsb29rdXAgb3IgY3JlYXRlIGZpbGVzIGFuZCBkaXJlY3RvcmllcwogKiAKICogQHBhcmFtIHtib29sZWFufSBjcmVhdGUgZmlsZSBvciBkaXJlY3RvcnkgaWYgaXQgZG9lc24ndCBleGlzdCAKICogQHBhcmFtIHtib29sZWFufSBleGNsdXNpdmUgaWYgdHJ1ZSB0aGUgY29tbWFuZCB3aWxsIGZhaWwgaWYgdGhlIGZpbGUgb3IgZGlyZWN0b3J5IGV4aXN0cwogKi8KRmxhZ3MgPSBmdW5jdGlvbihjcmVhdGUsIGV4Y2x1c2l2ZSkgewogICAgdGhpcy5jcmVhdGUgPSBjcmVhdGUgfHwgZmFsc2U7CiAgICB0aGlzLmV4Y2x1c2l2ZSA9IGV4Y2x1c2l2ZSB8fCBmYWxzZTsKfTsKCi8qKgogKiBBbiBpbnRlcmZhY2UgcmVwcmVzZW50aW5nIGEgZmlsZSBzeXN0ZW0KICogCiAqIHtET01TdHJpbmd9IG5hbWUgdGhlIHVuaXF1ZSBuYW1lIG9mIHRoZSBmaWxlIHN5c3RlbSAocmVhZG9ubHkpCiAqIHtEaXJlY3RvcnlFbnRyeX0gcm9vdCBkaXJlY3Rvcnkgb2YgdGhlIGZpbGUgc3lzdGVtIChyZWFkb25seSkKICovCkZpbGVTeXN0ZW0gPSBmdW5jdGlvbigpIHsKICAgIHRoaXMubmFtZSA9IG51bGw7CiAgICB0aGlzLnJvb3QgPSBudWxsOwp9OwoKLyoqCiAqIEFuIGludGVyZmFjZSByZXByZXNlbnRpbmcgYSBkaXJlY3Rvcnkgb24gdGhlIGZpbGUgc3lzdGVtLgogKiAKICoge2Jvb2xlYW59IGlzRmlsZSBhbHdheXMgZmFsc2UgKHJlYWRvbmx5KQogKiB7Ym9vbGVhbn0gaXNEaXJlY3RvcnkgYWx3YXlzIHRydWUgKHJlYWRvbmx5KQogKiB7RE9NU3RyaW5nfSBuYW1lIG9mIHRoZSBkaXJlY3RvcnksIGV4Y2x1ZGluZyB0aGUgcGF0aCBsZWFkaW5nIHRvIGl0IChyZWFkb25seSkKICoge0RPTVN0cmluZ30gZnVsbFBhdGggdGhlIGFic29sdXRlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IChyZWFkb25seSkKICoge0ZpbGVTeXN0ZW19IGZpbGVzeXN0ZW0gb24gd2hpY2ggdGhlIGRpcmVjdG9yeSByZXNpZGVzIChyZWFkb25seSkKICovCkRpcmVjdG9yeUVudHJ5ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmlzRmlsZSA9IGZhbHNlOwogICAgdGhpcy5pc0RpcmVjdG9yeSA9IHRydWU7CiAgICB0aGlzLm5hbWUgPSBudWxsOwogICAgdGhpcy5mdWxsUGF0aCA9IG51bGw7CiAgICB0aGlzLmZpbGVzeXN0ZW0gPSBudWxsOwp9OwoKLyoqCiAqIENvcGllcyBhIGRpcmVjdG9yeSB0byBhIG5ldyBsb2NhdGlvbgogKiAKICogQHBhcmFtIHtEaXJlY3RvcnlFbnRyeX0gcGFyZW50IHRoZSBkaXJlY3RvcnkgdG8gd2hpY2ggdG8gY29weSB0aGUgZW50cnkKICogQHBhcmFtIHtET01TdHJpbmd9IG5ld05hbWUgdGhlIG5ldyBuYW1lIG9mIHRoZSBlbnRyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgbmFtZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBlbnRyeQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUuY29weVRvID0gZnVuY3Rpb24ocGFyZW50LCBuZXdOYW1lLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJjb3B5VG8iLCBbdGhpcy5mdWxsUGF0aCwgcGFyZW50LCBuZXdOYW1lXSk7Cn07CgovKioKICogTG9va3MgdXAgdGhlIG1ldGFkYXRhIG9mIHRoZSBlbnRyeQogKiAKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgTWV0YWRhdGEgb2JqZWN0CiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkRpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5nZXRNZXRhZGF0YSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgImdldE1ldGFkYXRhIiwgW3RoaXMuZnVsbFBhdGhdKTsKfTsKCi8qKgogKiBHZXRzIHRoZSBwYXJlbnQgb2YgdGhlIGVudHJ5CiAqIAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBwYXJlbnQgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLmdldFBhcmVudCA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgImdldFBhcmVudCIsIFt0aGlzLmZ1bGxQYXRoXSk7Cn07CgovKioKICogTW92ZXMgYSBkaXJlY3RvcnkgdG8gYSBuZXcgbG9jYXRpb24KICogCiAqIEBwYXJhbSB7RGlyZWN0b3J5RW50cnl9IHBhcmVudCB0aGUgZGlyZWN0b3J5IHRvIHdoaWNoIHRvIG1vdmUgdGhlIGVudHJ5CiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBuZXdOYW1lIHRoZSBuZXcgbmFtZSBvZiB0aGUgZW50cnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IG5hbWUKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLm1vdmVUbyA9IGZ1bmN0aW9uKHBhcmVudCwgbmV3TmFtZSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAibW92ZVRvIiwgW3RoaXMuZnVsbFBhdGgsIHBhcmVudCwgbmV3TmFtZV0pOwp9OwoKLyoqCiAqIFJlbW92ZXMgdGhlIGVudHJ5CiAqIAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggbm8gcGFyYW1ldGVycwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAicmVtb3ZlIiwgW3RoaXMuZnVsbFBhdGhdKTsKfTsKCi8qKgogKiBSZXR1cm5zIGEgVVJJIHRoYXQgY2FuIGJlIHVzZWQgdG8gaWRlbnRpZnkgdGhpcyBlbnRyeS4KICogCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBtaW1lVHlwZSBmb3IgYSBGaWxlRW50cnksIHRoZSBtaW1lIHR5cGUgdG8gYmUgdXNlZCB0byBpbnRlcnByZXQgdGhlIGZpbGUsIHdoZW4gbG9hZGVkIHRocm91Z2ggdGhpcyBVUkkuCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCB0aGUgbmV3IGVudHJ5CiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkRpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS50b1VSSSA9IGZ1bmN0aW9uKG1pbWVUeXBlLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIHJldHVybiAiZmlsZTovL2xvY2FsaG9zdCIgKyB0aGlzLmZ1bGxQYXRoOwogICAgLy9QaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAidG9VUkkiLCBbdGhpcy5mdWxsUGF0aCwgbWltZVR5cGVdKTsKfTsKCi8qKgogKiBDcmVhdGVzIGEgbmV3IERpcmVjdG9yeVJlYWRlciB0byByZWFkIGVudHJpZXMgZnJvbSB0aGlzIGRpcmVjdG9yeQogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLmNyZWF0ZVJlYWRlciA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgcmV0dXJuIG5ldyBEaXJlY3RvcnlSZWFkZXIodGhpcy5mdWxsUGF0aCk7Cn07CgovKioKICogQ3JlYXRlcyBvciBsb29rcyB1cCBhIGRpcmVjdG9yeQogKiAKICogQHBhcmFtIHtET01TdHJpbmd9IHBhdGggZWl0aGVyIGEgcmVsYXRpdmUgb3IgYWJzb2x1dGUgcGF0aCBmcm9tIHRoaXMgZGlyZWN0b3J5IGluIHdoaWNoIHRvIGxvb2sgdXAgb3IgY3JlYXRlIGEgZGlyZWN0b3J5CiAqIEBwYXJhbSB7RmxhZ3N9IG9wdGlvbnMgdG8gY3JlYXRlIG9yIGV4Y2x1aXZlbHkgY3JlYXRlIHRoZSBkaXJlY3RvcnkKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLmdldERpcmVjdG9yeSA9IGZ1bmN0aW9uKHBhdGgsIG9wdGlvbnMsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgImdldERpcmVjdG9yeSIsIFt0aGlzLmZ1bGxQYXRoLCBwYXRoLCBvcHRpb25zXSk7Cn07CgovKioKICogQ3JlYXRlcyBvciBsb29rcyB1cCBhIGZpbGUKICogCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBwYXRoIGVpdGhlciBhIHJlbGF0aXZlIG9yIGFic29sdXRlIHBhdGggZnJvbSB0aGlzIGRpcmVjdG9yeSBpbiB3aGljaCB0byBsb29rIHVwIG9yIGNyZWF0ZSBhIGZpbGUKICogQHBhcmFtIHtGbGFnc30gb3B0aW9ucyB0byBjcmVhdGUgb3IgZXhjbHVpdmVseSBjcmVhdGUgdGhlIGZpbGUKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLmdldEZpbGUgPSBmdW5jdGlvbihwYXRoLCBvcHRpb25zLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJnZXRGaWxlIiwgW3RoaXMuZnVsbFBhdGgsIHBhdGgsIG9wdGlvbnNdKTsKfTsKCi8qKgogKiBEZWxldGVzIGEgZGlyZWN0b3J5IGFuZCBhbGwgb2YgaXQncyBjb250ZW50cwogKiAKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIG5vIHBhcmFtZXRlcnMKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLnJlbW92ZVJlY3Vyc2l2ZWx5ID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAicmVtb3ZlUmVjdXJzaXZlbHkiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIEFuIGludGVyZmFjZSB0aGF0IGxpc3RzIHRoZSBmaWxlcyBhbmQgZGlyZWN0b3JpZXMgaW4gYSBkaXJlY3RvcnkuCiAqLwpEaXJlY3RvcnlSZWFkZXIgPSBmdW5jdGlvbihmdWxsUGF0aCl7Cgl0aGlzLmZ1bGxQYXRoID0gZnVsbFBhdGggfHwgbnVsbDsgICAgCn07CgovKioKICogUmV0dXJucyBhIGxpc3Qgb2YgZW50cmllcyBmcm9tIGEgZGlyZWN0b3J5LgogKiAKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgbGlzdCBvZiBlbnRyaWVzCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkRpcmVjdG9yeVJlYWRlci5wcm90b3R5cGUucmVhZEVudHJpZXMgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZWFkRW50cmllcyIsIFt0aGlzLmZ1bGxQYXRoXSk7Cn0KIAovKioKICogQW4gaW50ZXJmYWNlIHJlcHJlc2VudGluZyBhIGRpcmVjdG9yeSBvbiB0aGUgZmlsZSBzeXN0ZW0uCiAqIAogKiB7Ym9vbGVhbn0gaXNGaWxlIGFsd2F5cyB0cnVlIChyZWFkb25seSkKICoge2Jvb2xlYW59IGlzRGlyZWN0b3J5IGFsd2F5cyBmYWxzZSAocmVhZG9ubHkpCiAqIHtET01TdHJpbmd9IG5hbWUgb2YgdGhlIGZpbGUsIGV4Y2x1ZGluZyB0aGUgcGF0aCBsZWFkaW5nIHRvIGl0IChyZWFkb25seSkKICoge0RPTVN0cmluZ30gZnVsbFBhdGggdGhlIGFic29sdXRlIGZ1bGwgcGF0aCB0byB0aGUgZmlsZSAocmVhZG9ubHkpCiAqIHtGaWxlU3lzdGVtfSBmaWxlc3lzdGVtIG9uIHdoaWNoIHRoZSBkaXJlY3RvcnkgcmVzaWRlcyAocmVhZG9ubHkpCiAqLwpGaWxlRW50cnkgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuaXNGaWxlID0gdHJ1ZTsKICAgIHRoaXMuaXNEaXJlY3RvcnkgPSBmYWxzZTsKICAgIHRoaXMubmFtZSA9IG51bGw7CiAgICB0aGlzLmZ1bGxQYXRoID0gbnVsbDsKICAgIHRoaXMuZmlsZXN5c3RlbSA9IG51bGw7Cn07CgovKioKICogQ29waWVzIGEgZmlsZSB0byBhIG5ldyBsb2NhdGlvbgogKiAKICogQHBhcmFtIHtEaXJlY3RvcnlFbnRyeX0gcGFyZW50IHRoZSBkaXJlY3RvcnkgdG8gd2hpY2ggdG8gY29weSB0aGUgZW50cnkKICogQHBhcmFtIHtET01TdHJpbmd9IG5ld05hbWUgdGhlIG5ldyBuYW1lIG9mIHRoZSBlbnRyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgbmFtZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBlbnRyeQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpGaWxlRW50cnkucHJvdG90eXBlLmNvcHlUbyA9IGZ1bmN0aW9uKHBhcmVudCwgbmV3TmFtZSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAiY29weVRvIiwgW3RoaXMuZnVsbFBhdGgsIHBhcmVudCwgbmV3TmFtZV0pOwp9OwoKLyoqCiAqIExvb2tzIHVwIHRoZSBtZXRhZGF0YSBvZiB0aGUgZW50cnkKICogCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIE1ldGFkYXRhIG9iamVjdAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpGaWxlRW50cnkucHJvdG90eXBlLmdldE1ldGFkYXRhID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAiZ2V0TWV0YWRhdGEiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIEdldHMgdGhlIHBhcmVudCBvZiB0aGUgZW50cnkKICogCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIHBhcmVudCBlbnRyeQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpGaWxlRW50cnkucHJvdG90eXBlLmdldFBhcmVudCA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgImdldFBhcmVudCIsIFt0aGlzLmZ1bGxQYXRoXSk7Cn07CgovKioKICogTW92ZXMgYSBkaXJlY3RvcnkgdG8gYSBuZXcgbG9jYXRpb24KICogCiAqIEBwYXJhbSB7RGlyZWN0b3J5RW50cnl9IHBhcmVudCB0aGUgZGlyZWN0b3J5IHRvIHdoaWNoIHRvIG1vdmUgdGhlIGVudHJ5CiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBuZXdOYW1lIHRoZSBuZXcgbmFtZSBvZiB0aGUgZW50cnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IG5hbWUKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRmlsZUVudHJ5LnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbihwYXJlbnQsIG5ld05hbWUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgIm1vdmVUbyIsIFt0aGlzLmZ1bGxQYXRoLCBwYXJlbnQsIG5ld05hbWVdKTsKfTsKCi8qKgogKiBSZW1vdmVzIHRoZSBlbnRyeQogKiAKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIG5vIHBhcmFtZXRlcnMKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRmlsZUVudHJ5LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZW1vdmUiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIFJldHVybnMgYSBVUkkgdGhhdCBjYW4gYmUgdXNlZCB0byBpZGVudGlmeSB0aGlzIGVudHJ5LgogKiAKICogQHBhcmFtIHtET01TdHJpbmd9IG1pbWVUeXBlIGZvciBhIEZpbGVFbnRyeSwgdGhlIG1pbWUgdHlwZSB0byBiZSB1c2VkIHRvIGludGVycHJldCB0aGUgZmlsZSwgd2hlbiBsb2FkZWQgdGhyb3VnaCB0aGlzIFVSSS4KICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRmlsZUVudHJ5LnByb3RvdHlwZS50b1VSSSA9IGZ1bmN0aW9uKG1pbWVUeXBlLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIHJldHVybiAiZmlsZTovL2xvY2FsaG9zdCIgKyB0aGlzLmZ1bGxQYXRoOwogICAgLy9QaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAidG9VUkkiLCBbdGhpcy5mdWxsUGF0aCwgbWltZVR5cGVdKTsKfTsKCi8qKgogKiBDcmVhdGVzIGEgbmV3IEZpbGVXcml0ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBmaWxlIHRoYXQgdGhpcyBGaWxlRW50cnkgcmVwcmVzZW50cy4KICogCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCB0aGUgbmV3IEZpbGVXcml0ZXIKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRmlsZUVudHJ5LnByb3RvdHlwZS5jcmVhdGVXcml0ZXIgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKCXRoaXMuZmlsZShmdW5jdGlvbihmaWxlUG9pbnRlcikgewkKCQl2YXIgd3JpdGVyID0gbmV3IEZpbGVXcml0ZXIoZmlsZVBvaW50ZXIpOwoJCWlmICh3cml0ZXIuZmlsZU5hbWUgPT0gbnVsbCB8fCB3cml0ZXIuZmlsZU5hbWUgPT0gIiIpIHsKCQkJaWYgKHR5cGVvZiBlcnJvckNhbGxiYWNrID09ICJmdW5jdGlvbiIpIHsKCQkJCWVycm9yQ2FsbGJhY2soewoJCQkJCSJjb2RlIjogRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSCgkJCQl9KTsKCQl9CgkJfQoJCWlmICh0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrID09ICJmdW5jdGlvbiIpIHsKCQkJc3VjY2Vzc0NhbGxiYWNrKHdyaXRlcik7CgkJfSAgICAgICAKCX0sIGVycm9yQ2FsbGJhY2spOwp9OwoKLyoqCiAqIFJldHVybnMgYSBGaWxlIHRoYXQgcmVwcmVzZW50cyB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgZmlsZSB0aGF0IHRoaXMgRmlsZUVudHJ5IHJlcHJlc2VudHMuCiAqIAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBGaWxlIG9iamVjdAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpGaWxlRW50cnkucHJvdG90eXBlLmZpbGUgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJnZXRGaWxlTWV0YWRhdGEiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIEFkZCB0aGUgRmlsZVN5c3RlbSBpbnRlcmZhY2UgaW50byB0aGUgYnJvd3Nlci4KICovClBob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCkgewoJdmFyIHBnTG9jYWxGaWxlU3lzdGVtID0gbmV3IExvY2FsRmlsZVN5c3RlbSgpOwoJLy8gTmVlZGVkIGZvciBjYXN0IG1ldGhvZHMKICAgIGlmKHR5cGVvZiB3aW5kb3cubG9jYWxGaWxlU3lzdGVtID09ICJ1bmRlZmluZWQiKSB3aW5kb3cubG9jYWxGaWxlU3lzdGVtICA9IHBnTG9jYWxGaWxlU3lzdGVtOwogICAgaWYodHlwZW9mIHdpbmRvdy5yZXF1ZXN0RmlsZVN5c3RlbSA9PSAidW5kZWZpbmVkIikgd2luZG93LnJlcXVlc3RGaWxlU3lzdGVtICA9IHBnTG9jYWxGaWxlU3lzdGVtLnJlcXVlc3RGaWxlU3lzdGVtOwogICAgaWYodHlwZW9mIHdpbmRvdy5yZXNvbHZlTG9jYWxGaWxlU3lzdGVtVVJJID09ICJ1bmRlZmluZWQiKSB3aW5kb3cucmVzb2x2ZUxvY2FsRmlsZVN5c3RlbVVSSSA9IHBnTG9jYWxGaWxlU3lzdGVtLnJlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkk7Cn0pOwp9OwoKCgoKLyoKICogUGhvbmVHYXAgaXMgYXZhaWxhYmxlIHVuZGVyICplaXRoZXIqIHRoZSB0ZXJtcyBvZiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UgKm9yKiB0aGUKICogTUlUIExpY2Vuc2UgKDIwMDgpLiBTZWUgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL2FscGhhYmV0aWNhbCBmb3IgZnVsbCB0ZXh0LgogKiAgCiAqIENvcHlyaWdodCAoYykgMjAwNS0yMDExLCBOaXRvYmkgU29mdHdhcmUgSW5jLgogKiBDb3B5cmlnaHQgKGMpIDIwMTEsIE1hdHQgS2FuZQogKi8KCmlmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImZpbGV0cmFuc2ZlciIpKSB7CglQaG9uZUdhcC5hZGRSZXNvdXJjZSgiZmlsZXRyYW5zZmVyIik7CgovKioKICogRmlsZVRyYW5zZmVyIHVwbG9hZHMgYSBmaWxlIHRvIGEgcmVtb3RlIHNlcnZlci4KICovCkZpbGVUcmFuc2ZlciA9IGZ1bmN0aW9uKCkge30KCi8qKgogKiBGaWxlVXBsb2FkUmVzdWx0CiAqLwpGaWxlVXBsb2FkUmVzdWx0ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmJ5dGVzU2VudCA9IDA7CiAgICB0aGlzLnJlc3BvbnNlQ29kZSA9IG51bGw7CiAgICB0aGlzLnJlc3BvbnNlID0gbnVsbDsKfQoKLyoqCiAqIEZpbGVUcmFuc2ZlckVycm9yCiAqLwpGaWxlVHJhbnNmZXJFcnJvciA9IGZ1bmN0aW9uKGVycm9yQ29kZSkgewogICAgdGhpcy5jb2RlID0gZXJyb3JDb2RlIHx8IG51bGw7Cn0KCkZpbGVUcmFuc2ZlckVycm9yLkZJTEVfTk9UX0ZPVU5EX0VSUiA9IDE7CkZpbGVUcmFuc2ZlckVycm9yLklOVkFMSURfVVJMX0VSUiA9IDI7CkZpbGVUcmFuc2ZlckVycm9yLkNPTk5FQ1RJT05fRVJSID0gMzsKCi8qKgoqIEdpdmVuIGFuIGFic29sdXRlIGZpbGUgcGF0aCwgdXBsb2FkcyBhIGZpbGUgb24gdGhlIGRldmljZSB0byBhIHJlbW90ZSBzZXJ2ZXIgCiogdXNpbmcgYSBtdWx0aXBhcnQgSFRUUCByZXF1ZXN0LgoqIEBwYXJhbSBmaWxlUGF0aCB7U3RyaW5nfSAgICAgICAgICAgRnVsbCBwYXRoIG9mIHRoZSBmaWxlIG9uIHRoZSBkZXZpY2UKKiBAcGFyYW0gc2VydmVyIHtTdHJpbmd9ICAgICAgICAgICAgIFVSTCBvZiB0aGUgc2VydmVyIHRvIHJlY2VpdmUgdGhlIGZpbGUKKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrIChGdW5jdGlvbn0gIENhbGxiYWNrIHRvIGJlIGludm9rZWQgd2hlbiB1cGxvYWQgaGFzIGNvbXBsZXRlZAoqIEBwYXJhbSBlcnJvckNhbGxiYWNrIHtGdW5jdGlvbn0gICAgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCB1cG9uIGVycm9yCiogQHBhcmFtIG9wdGlvbnMge0ZpbGVVcGxvYWRPcHRpb25zfSBPcHRpb25hbCBwYXJhbWV0ZXJzIHN1Y2ggYXMgZmlsZSBuYW1lIGFuZCBtaW1ldHlwZSAgICAgICAgICAgCiovCkZpbGVUcmFuc2Zlci5wcm90b3R5cGUudXBsb2FkID0gZnVuY3Rpb24oZmlsZVBhdGgsIHNlcnZlciwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CglpZighb3B0aW9ucy5wYXJhbXMpIHsKCQlvcHRpb25zLnBhcmFtcyA9IHt9OwoJfQoJb3B0aW9ucy5maWxlUGF0aCA9IGZpbGVQYXRoOwoJb3B0aW9ucy5zZXJ2ZXIgPSBzZXJ2ZXI7CglpZighb3B0aW9ucy5maWxlS2V5KSB7CgkJb3B0aW9ucy5maWxlS2V5ID0gJ2ZpbGUnOwoJfQoJaWYoIW9wdGlvbnMuZmlsZU5hbWUpIHsKCQlvcHRpb25zLmZpbGVOYW1lID0gJ2ltYWdlLmpwZyc7Cgl9CglpZighb3B0aW9ucy5taW1lVHlwZSkgewoJCW9wdGlvbnMubWltZVR5cGUgPSAnaW1hZ2UvanBlZyc7Cgl9CgkKCS8vIHN1Y2Nlc3NDYWxsYmFjayByZXF1aXJlZAoJaWYgKHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT0gImZ1bmN0aW9uIikgewogICAgICAgIGNvbnNvbGUubG9nKCJGaWxlVHJhbnNmZXIgRXJyb3I6IHN1Y2Nlc3NDYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybjsKICAgIH0KCgogICAgLy8gZXJyb3JDYWxsYmFjayBvcHRpb25hbAogICAgaWYgKGVycm9yQ2FsbGJhY2sgJiYgKHR5cGVvZiBlcnJvckNhbGxiYWNrICE9ICJmdW5jdGlvbiIpKSB7CiAgICAgICAgY29uc29sZS5sb2coIkZpbGVUcmFuc2ZlciBFcnJvcjogZXJyb3JDYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybjsKICAgIH0KCQogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICdGaWxlVHJhbnNmZXInLCAndXBsb2FkJywgW29wdGlvbnNdKTsKfTsKCkZpbGVUcmFuc2Zlci5wcm90b3R5cGUuX2Nhc3RUcmFuc2ZlckVycm9yID0gZnVuY3Rpb24ocGx1Z2luUmVzdWx0KSB7Cgl2YXIgZmlsZUVycm9yID0gbmV3IEZpbGVUcmFuc2ZlckVycm9yKHBsdWdpblJlc3VsdC5tZXNzYWdlKTsKCS8vZmlsZUVycm9yLmNvZGUgPSBwbHVnaW5SZXN1bHQubWVzc2FnZTsKCXBsdWdpblJlc3VsdC5tZXNzYWdlID0gZmlsZUVycm9yOwoJcmV0dXJuIHBsdWdpblJlc3VsdDsKfQoKRmlsZVRyYW5zZmVyLnByb3RvdHlwZS5fY2FzdFVwbG9hZFJlc3VsdCA9IGZ1bmN0aW9uKHBsdWdpblJlc3VsdCkgewoJdmFyIHJlc3VsdCA9IG5ldyBGaWxlVXBsb2FkUmVzdWx0KCk7CglyZXN1bHQuYnl0ZXNTZW50ID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2UuYnl0ZXNTZW50OwoJcmVzdWx0LnJlc3BvbnNlQ29kZSA9IHBsdWdpblJlc3VsdC5tZXNzYWdlLnJlc3BvbnNlQ29kZTsKCXJlc3VsdC5yZXNwb25zZSA9IGRlY29kZVVSSUNvbXBvbmVudChwbHVnaW5SZXN1bHQubWVzc2FnZS5yZXNwb25zZSk7CglwbHVnaW5SZXN1bHQubWVzc2FnZSA9IHJlc3VsdDsKCXJldHVybiBwbHVnaW5SZXN1bHQ7Cn0KCi8qKgogKiBPcHRpb25zIHRvIGN1c3RvbWl6ZSB0aGUgSFRUUCByZXF1ZXN0IHVzZWQgdG8gdXBsb2FkIGZpbGVzLgogKiBAcGFyYW0gZmlsZUtleSB7U3RyaW5nfSAgIE5hbWUgb2YgZmlsZSByZXF1ZXN0IHBhcmFtZXRlci4KICogQHBhcmFtIGZpbGVOYW1lIHtTdHJpbmd9ICBGaWxlbmFtZSB0byBiZSB1c2VkIGJ5IHRoZSBzZXJ2ZXIuIERlZmF1bHRzIHRvIGltYWdlLmpwZy4KICogQHBhcmFtIG1pbWVUeXBlIHtTdHJpbmd9ICBNaW1ldHlwZSBvZiB0aGUgdXBsb2FkZWQgZmlsZS4gRGVmYXVsdHMgdG8gaW1hZ2UvanBlZy4KICogQHBhcmFtIHBhcmFtcyB7T2JqZWN0fSAgICBPYmplY3Qgd2l0aCBrZXk6IHZhbHVlIHBhcmFtcyB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIuCiAqLwpGaWxlVXBsb2FkT3B0aW9ucyA9IGZ1bmN0aW9uKGZpbGVLZXksIGZpbGVOYW1lLCBtaW1lVHlwZSwgcGFyYW1zKSB7CiAgICB0aGlzLmZpbGVLZXkgPSBmaWxlS2V5IHx8IG51bGw7CiAgICB0aGlzLmZpbGVOYW1lID0gZmlsZU5hbWUgfHwgbnVsbDsKICAgIHRoaXMubWltZVR5cGUgPSBtaW1lVHlwZSB8fCBudWxsOwogICAgdGhpcy5wYXJhbXMgPSBwYXJhbXMgfHwgbnVsbDsKfQoKClBob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCkgewogICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IuZmlsZVRyYW5zZmVyID09ICJ1bmRlZmluZWQiKSBuYXZpZ2F0b3IuZmlsZVRyYW5zZmVyID0gbmV3IEZpbGVUcmFuc2ZlcigpOwp9KTsKfTsKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiZ2VvbG9jYXRpb24iKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoImdlb2xvY2F0aW9uIik7CgovKioKICogVGhpcyBjbGFzcyBwcm92aWRlcyBhY2Nlc3MgdG8gZGV2aWNlIEdQUyBkYXRhLgogKiBAY29uc3RydWN0b3IKICovCkdlb2xvY2F0aW9uID0gZnVuY3Rpb24oKSB7CiAgICAvLyBUaGUgbGFzdCBrbm93biBHUFMgcG9zaXRpb24uCiAgICB0aGlzLmxhc3RQb3NpdGlvbiA9IG51bGw7CiAgICB0aGlzLmxpc3RlbmVyID0gbnVsbDsKICAgIHRoaXMudGltZW91dFRpbWVySWQgPSAwOwoKfTsKCgovKioKICogQXN5bmNocm9ub3VzbHkgYXF1aXJlcyB0aGUgY3VycmVudCBwb3NpdGlvbi4KICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIHBvc2l0aW9uCiAqIGRhdGEgaXMgYXZhaWxhYmxlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciAKICogZ2V0dGluZyB0aGUgcG9zaXRpb24gZGF0YS4KICogQHBhcmFtIHtQb3NpdGlvbk9wdGlvbnN9IG9wdGlvbnMgVGhlIG9wdGlvbnMgZm9yIGdldHRpbmcgdGhlIHBvc2l0aW9uIGRhdGEKICogc3VjaCBhcyB0aW1lb3V0LgogKiBQb3NpdGlvbk9wdGlvbnMuZm9yY2VQcm9tcHQ6Qm9vbCBkZWZhdWx0IGZhbHNlLCAKICogLSB0ZWxscyBpUGhvbmUgdG8gcHJvbXB0IHRoZSB1c2VyIHRvIHR1cm4gb24gbG9jYXRpb24gc2VydmljZXMuCiAqIC0gbWF5IGNhdXNlIHlvdXIgYXBwIHRvIGV4aXQgd2hpbGUgdGhlIHVzZXIgaXMgc2VudCB0byB0aGUgU2V0dGluZ3MgYXBwCiAqIFBvc2l0aW9uT3B0aW9ucy5kaXN0YW5jZUZpbHRlcjpkb3VibGUgYWthIE51bWJlcgogKiAtIHVzZWQgdG8gcmVwcmVzZW50IGEgZGlzdGFuY2UgaW4gbWV0ZXJzLgpQb3NpdGlvbk9wdGlvbnMKewogICBkZXNpcmVkQWNjdXJhY3k6TnVtYmVyCiAgIC0gYSBkaXN0YW5jZSBpbiBtZXRlcnMgCgkJPCAxMCAgID0gYmVzdCBhY2N1cmFjeSAgKCBEZWZhdWx0IHZhbHVlICkKCQk8IDEwMCAgPSBOZWFyZXN0IFRlbiBNZXRlcnMKCQk8IDEwMDAgPSBOZWFyZXN0IEh1bmRyZWQgTWV0ZXJzCgkJPCAzMDAwID0gQWNjdXJhY3kgS2lsb21ldGVycwoJCTMwMDArICA9IEFjY3VyYWN5IDMgS2lsb21ldGVycwoJCQoJZm9yY2VQcm9tcHQ6Qm9vbGVhbiBkZWZhdWx0IGZhbHNlICggaVBob25lIE9ubHkhICkKICAgIC0gdGVsbHMgaVBob25lIHRvIHByb21wdCB0aGUgdXNlciB0byB0dXJuIG9uIGxvY2F0aW9uIHNlcnZpY2VzLgoJLSBtYXkgY2F1c2UgeW91ciBhcHAgdG8gZXhpdCB3aGlsZSB0aGUgdXNlciBpcyBzZW50IHRvIHRoZSBTZXR0aW5ncyBhcHAKCQoJZGlzdGFuY2VGaWx0ZXI6TnVtYmVyCgktIFRoZSBtaW5pbXVtIGRpc3RhbmNlIChtZWFzdXJlZCBpbiBtZXRlcnMpIGEgZGV2aWNlIG11c3QgbW92ZSBsYXRlcmFsbHkgYmVmb3JlIGFuIHVwZGF0ZSBldmVudCBpcyBnZW5lcmF0ZWQuCgktIG1lYXN1cmVkIHJlbGF0aXZlIHRvIHRoZSBwcmV2aW91c2x5IGRlbGl2ZXJlZCBsb2NhdGlvbgoJLSBkZWZhdWx0IHZhbHVlOiBudWxsICggYWxsIG1vdmVtZW50cyB3aWxsIGJlIHJlcG9ydGVkICkKCQp9CgogKi8KIApHZW9sb2NhdGlvbi5wcm90b3R5cGUuZ2V0Q3VycmVudFBvc2l0aW9uID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSAKewogICAgLy8gaWYgKHRoaXMubGlzdGVuZXIgIT0gbnVsbCkgCiAgICAvLyB7CiAgICAvLyAgICAgY29uc29sZS5sb2coIkdlb2xvY2F0aW9uIEVycm9yOiBTdGlsbCB3YWl0aW5nIGZvciBwcmV2aW91cyBnZXRDdXJyZW50UG9zaXRpb24oKSByZXF1ZXN0LiIpOwogICAgLy8gICAgIGlmIChlcnJvckNhbGxiYWNrICYmIHR5cGVvZihlcnJvckNhbGxiYWNrKSA9PSAnZnVuY3Rpb24nKQogICAgLy8gICAgIHsKICAgIC8vICAgICAgICAgZXJyb3JDYWxsYmFjayhuZXcgUG9zaXRpb25FcnJvcihQb3NpdGlvbkVycm9yLlRJTUVPVVQsICJHZW9sb2NhdGlvbiBFcnJvcjogU3RpbGwgd2FpdGluZyBmb3IgcHJldmlvdXMgZ2V0Q3VycmVudFBvc2l0aW9uKCkgcmVxdWVzdC4iKSk7CiAgICAvLyAgICAgfSAKICAgIC8vICAgICByZXR1cm4gUG9zaXRpb25FcnJvci5USU1FT1VUOwogICAgLy8gfQogICAgCiAgICAvLyBjcmVhdGUgYW4gYWx3YXlzIHZhbGlkIGxvY2FsIHN1Y2Nlc3MgY2FsbGJhY2sKICAgIHZhciB3aW4gPSBzdWNjZXNzQ2FsbGJhY2s7CiAgICBpZiAoIXdpbiB8fCB0eXBlb2Yod2luKSAhPSAnZnVuY3Rpb24nKQogICAgewogICAgICAgIHdpbiA9IGZ1bmN0aW9uKHBvc2l0aW9uKSB7fTsKICAgIH0KICAgIAogICAgLy8gY3JlYXRlIGFuIGFsd2F5cyB2YWxpZCBsb2NhbCBlcnJvciBjYWxsYmFjawogICAgdmFyIGZhaWwgPSBlcnJvckNhbGxiYWNrOwogICAgaWYgKCFmYWlsIHx8IHR5cGVvZihmYWlsKSAhPSAnZnVuY3Rpb24nKQogICAgewogICAgICAgIGZhaWwgPSBmdW5jdGlvbihwb3NpdGlvbkVycm9yKSB7fTsKICAgIH0JCgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHRvdGFsVGltZSA9IDA7Cgl2YXIgdGltZW91dFRpbWVySWQ7CgkKCS8vIHNldCBwYXJhbXMgdG8gb3VyIGRlZmF1bHQgdmFsdWVzCgl2YXIgcGFyYW1zID0gbmV3IFBvc2l0aW9uT3B0aW9ucygpOwoJCiAgICBpZiAob3B0aW9ucykgCiAgICB7CiAgICAgICAgaWYgKG9wdGlvbnMubWF4aW11bUFnZSkgCiAgICAgICAgewogICAgICAgICAgICAvLyBzcGVjaWFsIGNhc2UgaGVyZSBpZiB3ZSBoYXZlIGEgY2FjaGVkIHZhbHVlIHRoYXQgaXMgeW91bmdlciB0aGFuIG1heGltdW1BZ2UKICAgICAgICAgICAgaWYodGhpcy5sYXN0UG9zaXRpb24pCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgIGlmKG5vdyAtIHRoaXMubGFzdFBvc2l0aW9uLnRpbWVzdGFtcCA8IG9wdGlvbnMubWF4aW11bUFnZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB3aW4odGhpcy5sYXN0UG9zaXRpb24pOyAvLyBzZW5kIGNhY2hlZCBwb3NpdGlvbiBpbW1lZGlhdGVseSAKICAgICAgICAgICAgICAgICAgICByZXR1cm47ICAgICAgICAgICAgICAgICAvLyBOb3RlLCBleGVjdXRpb24gc3RvcHMgaGVyZSAtam0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBwYXJhbXMubWF4aW11bUFnZSA9IG9wdGlvbnMubWF4aW11bUFnZTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuZW5hYmxlSGlnaEFjY3VyYWN5KSAKICAgICAgICB7CiAgICAgICAgICAgIHBhcmFtcy5lbmFibGVIaWdoQWNjdXJhY3kgPSAob3B0aW9ucy5lbmFibGVIaWdoQWNjdXJhY3kgPT0gdHJ1ZSk7IC8vIG1ha2Ugc3VyZSBpdCdzIHRydXRoeQogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0KSAKICAgICAgICB7CiAgICAgICAgICAgIHBhcmFtcy50aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0OwogICAgICAgIH0KICAgIH0KICAgIAogICAgdGhpcy5saXN0ZW5lciA9IHsic3VjY2VzcyI6d2luLCJmYWlsIjpmYWlsfTsKICAgIHRoaXMuc3RhcnQocGFyYW1zKTsKCQoJdmFyIG9uVGltZW91dCA9IGZ1bmN0aW9uKCkKCXsKCSAgICBzZWxmLnNldEVycm9yKG5ldyBQb3NpdGlvbkVycm9yKFBvc2l0aW9uRXJyb3IuVElNRU9VVCwiR2VvbG9jYXRpb24gRXJyb3I6IFRpbWVvdXQuIikpOwoJfTsKCSAKICAgIHRoaXMudGltZW91dFRpbWVySWQgPSBzZXRUaW1lb3V0KG9uVGltZW91dCwgcGFyYW1zLnRpbWVvdXQpOyAKfTsKCi8qKgogKiBBc3luY2hyb25vdXNseSBhcXVpcmVzIHRoZSBwb3NpdGlvbiByZXBlYXRlZGx5IGF0IGEgZ2l2ZW4gaW50ZXJ2YWwuCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCBlYWNoIHRpbWUgdGhlIHBvc2l0aW9uCiAqIGRhdGEgaXMgYXZhaWxhYmxlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciAKICogZ2V0dGluZyB0aGUgcG9zaXRpb24gZGF0YS4KICogQHBhcmFtIHtQb3NpdGlvbk9wdGlvbnN9IG9wdGlvbnMgVGhlIG9wdGlvbnMgZm9yIGdldHRpbmcgdGhlIHBvc2l0aW9uIGRhdGEKICogc3VjaCBhcyB0aW1lb3V0IGFuZCB0aGUgZnJlcXVlbmN5IG9mIHRoZSB3YXRjaC4KICovCkdlb2xvY2F0aW9uLnByb3RvdHlwZS53YXRjaFBvc2l0aW9uID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CgkvLyBJbnZva2UgdGhlIGFwcHJvcHJpYXRlIGNhbGxiYWNrIHdpdGggYSBuZXcgUG9zaXRpb24gb2JqZWN0IGV2ZXJ5IHRpbWUgdGhlIGltcGxlbWVudGF0aW9uIAoJLy8gZGV0ZXJtaW5lcyB0aGF0IHRoZSBwb3NpdGlvbiBvZiB0aGUgaG9zdGluZyBkZXZpY2UgaGFzIGNoYW5nZWQuIAoKCXZhciBzZWxmID0gdGhpczsgLy8gdGhvc2UgPT0gdGhpcyAmIHRoYXQKCQoJdmFyIHBhcmFtcyA9IG5ldyBQb3NpdGlvbk9wdGlvbnMoKTsKCiAgICBpZihvcHRpb25zKQogICAgewogICAgICAgIGlmIChvcHRpb25zLm1heGltdW1BZ2UpIHsKICAgICAgICAgICAgcGFyYW1zLm1heGltdW1BZ2UgPSBvcHRpb25zLm1heGltdW1BZ2U7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLmVuYWJsZUhpZ2hBY2N1cmFjeSkgewogICAgICAgICAgICBwYXJhbXMuZW5hYmxlSGlnaEFjY3VyYWN5ID0gb3B0aW9ucy5lbmFibGVIaWdoQWNjdXJhY3k7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLnRpbWVvdXQpIHsKICAgICAgICAgICAgcGFyYW1zLnRpbWVvdXQgPSBvcHRpb25zLnRpbWVvdXQ7CiAgICAgICAgfQogICAgfQoKCXZhciB0aGF0ID0gdGhpczsKICAgIHZhciBsYXN0UG9zID0gdGhhdC5sYXN0UG9zaXRpb24/IHRoYXQubGFzdFBvc2l0aW9uLmNsb25lKCkgOiBudWxsOwogICAgCglyZXR1cm4gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSAKCXsKICAgICAgICB2YXIgZmlsdGVyRnVuID0gZnVuY3Rpb24ocG9zaXRpb24pIHsKICAgICAgICAgICAgaWYgKGxhc3RQb3MgPT0gbnVsbCB8fCAhcG9zaXRpb24uZXF1YWxzKGxhc3RQb3MpKSB7CiAgICAgICAgICAgICAgICAvLyBvbmx5IGNhbGwgdGhlIHN1Y2Nlc3MgY2FsbGJhY2sgd2hlbiB0aGVyZSBpcyBhIGNoYW5nZSBpbiBwb3NpdGlvbiwgcGVyIFczQwogICAgICAgICAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKHBvc2l0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gY2xvbmUgdGhlIG5ldyBwb3NpdGlvbiwgc2F2ZSBpdCBhcyBvdXIgbGFzdCBwb3NpdGlvbiAoaW50ZXJuYWwgdmFyKQogICAgICAgICAgICBsYXN0UG9zID0gcG9zaXRpb24uY2xvbmUoKTsKICAgICAgICB9OwoJCXRoYXQuZ2V0Q3VycmVudFBvc2l0aW9uKGZpbHRlckZ1biwgZXJyb3JDYWxsYmFjaywgcGFyYW1zKTsKCX0sIHBhcmFtcy50aW1lb3V0KTsKfTsKCgovKioKICogQ2xlYXJzIHRoZSBzcGVjaWZpZWQgcG9zaXRpb24gd2F0Y2guCiAqIEBwYXJhbSB7U3RyaW5nfSB3YXRjaElkIFRoZSBJRCBvZiB0aGUgd2F0Y2ggcmV0dXJuZWQgZnJvbSAjd2F0Y2hQb3NpdGlvbi4KICovCkdlb2xvY2F0aW9uLnByb3RvdHlwZS5jbGVhcldhdGNoID0gZnVuY3Rpb24od2F0Y2hJZCkgewoJY2xlYXJJbnRlcnZhbCh3YXRjaElkKTsKfTsKCi8qKgogKiBDYWxsZWQgYnkgdGhlIGdlb2xvY2F0aW9uIGZyYW1ld29yayB3aGVuIHRoZSBjdXJyZW50IGxvY2F0aW9uIGlzIGZvdW5kLgogKiBAcGFyYW0ge1Bvc2l0aW9uT3B0aW9uc30gcG9zaXRpb24gVGhlIGN1cnJlbnQgcG9zaXRpb24uCiAqLwpHZW9sb2NhdGlvbi5wcm90b3R5cGUuc2V0TG9jYXRpb24gPSBmdW5jdGlvbihwb3NpdGlvbikgCnsKICAgIHZhciBfcG9zaXRpb24gPSBuZXcgUG9zaXRpb24ocG9zaXRpb24uY29vcmRzLCBwb3NpdGlvbi50aW1lc3RhbXApOwoKICAgIGlmKHRoaXMudGltZW91dFRpbWVySWQpCiAgICB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dFRpbWVySWQpOwogICAgICAgIHRoaXMudGltZW91dFRpbWVySWQgPSAwOwogICAgfQogICAgCgl0aGlzLmxhc3RFcnJvciA9IG51bGw7CiAgICB0aGlzLmxhc3RQb3NpdGlvbiA9IF9wb3NpdGlvbjsKICAgIAogICAgaWYodGhpcy5saXN0ZW5lciAmJiB0eXBlb2YodGhpcy5saXN0ZW5lci5zdWNjZXNzKSA9PSAnZnVuY3Rpb24nKQogICAgewogICAgICAgIHRoaXMubGlzdGVuZXIuc3VjY2VzcyhfcG9zaXRpb24pOwogICAgfQogICAgCiAgICB0aGlzLmxpc3RlbmVyID0gbnVsbDsKfTsKCi8qKgogKiBDYWxsZWQgYnkgdGhlIGdlb2xvY2F0aW9uIGZyYW1ld29yayB3aGVuIGFuIGVycm9yIG9jY3VycyB3aGlsZSBsb29raW5nIHVwIHRoZSBjdXJyZW50IHBvc2l0aW9uLgogKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBUaGUgdGV4dCBvZiB0aGUgZXJyb3IgbWVzc2FnZS4KICovCkdlb2xvY2F0aW9uLnByb3RvdHlwZS5zZXRFcnJvciA9IGZ1bmN0aW9uKGVycm9yKSAKewoJdmFyIF9lcnJvciA9IG5ldyBQb3NpdGlvbkVycm9yKGVycm9yLmNvZGUsIGVycm9yLm1lc3NhZ2UpOwoJCiAgICBpZih0aGlzLnRpbWVvdXRUaW1lcklkKQogICAgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXRUaW1lcklkKTsKICAgICAgICB0aGlzLnRpbWVvdXRUaW1lcklkID0gMDsKICAgIH0KICAgIAogICAgdGhpcy5sYXN0RXJyb3IgPSBfZXJyb3I7CiAgICAvLyBjYWxsIGVycm9yIGhhbmRsZXJzIGRpcmVjdGx5CiAgICBpZih0aGlzLmxpc3RlbmVyICYmIHR5cGVvZih0aGlzLmxpc3RlbmVyLmZhaWwpID09ICdmdW5jdGlvbicpCiAgICB7CiAgICAgICAgdGhpcy5saXN0ZW5lci5mYWlsKF9lcnJvcik7CiAgICB9CiAgICB0aGlzLmxpc3RlbmVyID0gbnVsbDsKCn07CgpHZW9sb2NhdGlvbi5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbihhcmdzKSAKewogICAgUGhvbmVHYXAuZXhlYygiTG9jYXRpb24uc3RhcnRMb2NhdGlvbiIsIGFyZ3MpOwp9OwoKR2VvbG9jYXRpb24ucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIAp7CiAgICBQaG9uZUdhcC5leGVjKCJMb2NhdGlvbi5zdG9wTG9jYXRpb24iKTsKfTsKCgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIAp7CiAgICBpZiAodHlwZW9mIG5hdmlnYXRvci5fZ2VvID09ICJ1bmRlZmluZWQiKSAKICAgIHsKICAgICAgICAvLyByZXBsYWNlIG9yaWdPYmoncyBmdW5jdGlvbnMgKCBsaXN0ZWQgaW4gZnVua0xpc3QgKSB3aXRoIHRoZSBzYW1lIG1ldGhvZCBuYW1lIG9uIHByb3h5T2JqCiAgICAgICAgLy8gdGhpcyBpcyBhIHdvcmthcm91bmQgdG8gcHJldmVudCBVSVdlYlZpZXcvTW9iaWxlU2FmYXJpIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgR2VvTG9jYXRpb24KICAgICAgICAvLyBiZWNhdXNlIGl0IGluY2x1ZGVzIHRoZSBmdWxsIHBhZ2UgcGF0aCBhcyB0aGUgdGl0bGUgb2YgdGhlIGFsZXJ0IHByb21wdAogICAgICAgIHZhciBfX3Byb3h5T2JqID0gZnVuY3Rpb24gKG9yaWdPYmoscHJveHlPYmosZnVua0xpc3QpCiAgICAgICAgewogICAgICAgICAgICB2YXIgcmVwbGFjZUZ1bmsgPSBmdW5jdGlvbihvcmcscHJveHksZk5hbWUpCiAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICBvcmdbZk5hbWVdID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm94eVtmTmFtZV0uYXBwbHkocHJveHksYXJndW1lbnRzKTsgCiAgICAgICAgICAgICAgICB9OyAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGZvcih2YXIgdiBpbiBmdW5rTGlzdCkgeyByZXBsYWNlRnVuayhvcmlnT2JqLHByb3h5T2JqLGZ1bmtMaXN0W3ZdKTt9CiAgICAgICAgfQogICAgICAgIG5hdmlnYXRvci5fZ2VvID0gbmV3IEdlb2xvY2F0aW9uKCk7CiAgICAgICAgX19wcm94eU9iaihuYXZpZ2F0b3IuZ2VvbG9jYXRpb24sIG5hdmlnYXRvci5fZ2VvLAogICAgICAgICAgICAgICAgIFsic2V0TG9jYXRpb24iLCJnZXRDdXJyZW50UG9zaXRpb24iLCJ3YXRjaFBvc2l0aW9uIiwKICAgICAgICAgICAgICAgICAgImNsZWFyV2F0Y2giLCJzZXRFcnJvciIsInN0YXJ0Iiwic3RvcCJdKTsKCiAgICB9Cgp9KTsKfTsKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiY29tcGFzcyIpKSB7CglQaG9uZUdhcC5hZGRSZXNvdXJjZSgiY29tcGFzcyIpOwoJCi8qKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIGFjY2VzcyB0byBkZXZpY2UgQ29tcGFzcyBkYXRhLgogKiBAY29uc3RydWN0b3IKICovCkNvbXBhc3MgPSBmdW5jdGlvbigpIHsKICAgIC8qKgogICAgICogVGhlIGxhc3Qga25vd24gQ29tcGFzcyBwb3NpdGlvbi4KICAgICAqLwogICAgLy8gbGFzdEhlYWRpbmcgYWN0dWFsbHkgY29udGFpbnMgYSBiaXQgbW9yZSBpbmZvIHRoYW4gd2hhdCB3ZSByZXR1cm4gdG8gb3VyIGNhbGxiYWNrcyAKICAgIC8vIHRpbWVzdGFtcCwgbWFnbmV0aWNIZWFkaW5nLCB0cnVlSGVhZGluZywgaGVhZGluZ0FjY3VyYWN5LCB4LCB5LCB6CiAgICAvLyBkb2NzIHNwZWNpZnkgdGhhdCB0aGUgcmV0dXJuIHZhbHVlIGlzIGEgc2ltcGxlICdoZWFkaW5nJwogICAgLy8gaWYgcG9zc2libGUgd2Ugd2lsbCB1c2UgdHJ1ZUhlYWRpbmcsIG90aGVyd2lzZSBtYWduZXRpY0hlYWRpbmcgaXMgcmV0dXJuZWQKICAgIC8vIHRydWVIZWFkaW5nIGlzIG9ubHkgYXZhaWxhYmxlIGlmIGxvY2F0aW9uIHNlcnZpY2VzIGlzIE9OCgl0aGlzLmxhc3RIZWFkaW5nID0gbnVsbDsKICAgIHRoaXMubGFzdEVycm9yID0gbnVsbDsKCXRoaXMuY2FsbGJhY2tzID0gewoJCW9uSGVhZGluZ0NoYW5nZWQ6IFtdLAogICAgICAgIG9uRXJyb3I6ICAgICAgICAgICBbXQogICAgfTsKfTsKCi8qKgogKiBBc3luY2hyb25vdXNseSBhcXVpcmVzIHRoZSBjdXJyZW50IGhlYWRpbmcuCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSBoZWFkaW5nCiAqIGRhdGEgaXMgYXZhaWxhYmxlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciAKICogZ2V0dGluZyB0aGUgaGVhZGluZyBkYXRhLgogKiBAcGFyYW0ge1Bvc2l0aW9uT3B0aW9uc30gb3B0aW9ucyBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgaGVhZGluZyBkYXRhCiAqIHN1Y2ggYXMgdGltZW91dC4KICovCkNvbXBhc3MucHJvdG90eXBlLmdldEN1cnJlbnRIZWFkaW5nID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CglpZiAodGhpcy5sYXN0SGVhZGluZyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25IZWFkaW5nQ2hhbmdlZC5wdXNoKHN1Y2Nlc3NDYWxsYmFjayk7CiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25FcnJvci5wdXNoKGVycm9yQ2FsbGJhY2spOwoJCXRoaXMuc3RhcnQob3B0aW9ucyk7Cgl9CgllbHNlCgl7CgkgICAgaWYob3B0aW9ucy5tYXhpbXVtQWdlKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICBpZihub3cgLSB0aGlzLmxhc3RIZWFkaW5nLnRpbWVzdGFtcCA+IG9wdGlvbnMubWF4aW11bUFnZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3Mub25IZWFkaW5nQ2hhbmdlZC5wdXNoKHN1Y2Nlc3NDYWxsYmFjayk7CiAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vbkVycm9yLnB1c2goZXJyb3JDYWxsYmFjayk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQob3B0aW9ucyk7IC8vIHdlIGhhdmUgYSBjYWNoZWQgdmFsdWUgdGhhdCBpcyBvbGQgLi4uCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9IAoKICAgICAgICAvLyB3ZSBoYXZlIGEgbGFzdCBoZWFkaW5nICsgaXQgaXMgTk9UIG9sZGVyIHRoYW4gbWF4aW11bUFnZSwgb3IgbWF4aW11bUFnZSBpcyBub3Qgc3BlY2lmaWVkCiAgICAgICAgaWYgKHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgPT0gImZ1bmN0aW9uIikgCiAgICAJewogICAgCSAgICB2YXIgcmV0dXJuSGVhZGluZyA9IC0xOwogICAgCSAgICBpZih0aGlzLmxhc3RIZWFkaW5nLnRydWVIZWFkaW5nID4gLTEpCiAgICAJICAgIHsKICAgIAkgICAgICAgIHJldHVybkhlYWRpbmcgPSB0aGlzLmxhc3RIZWFkaW5nLnRydWVIZWFkaW5nOwogICAgCSAgICB9CiAgICAJICAgIGVsc2UgaWYoIHRoaXMubGFzdEhlYWRpbmcubWFnbmV0aWNIZWFkaW5nICkKICAgIAkgICAgewogICAgCSAgICAgICAgcmV0dXJuSGVhZGluZyA9IHRoaXMubGFzdEhlYWRpbmcubWFnbmV0aWNIZWFkaW5nOwogICAgCSAgICB9CiAgICAJCXN1Y2Nlc3NDYWxsYmFjayhyZXR1cm5IZWFkaW5nKTsKICAgIAl9Cgl9CgkKfTsKCi8qKgogKiBBc3luY2hyb25vdXNseSBhcXVpcmVzIHRoZSBoZWFkaW5nIHJlcGVhdGVkbHkgYXQgYSBnaXZlbiBpbnRlcnZhbC4KICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIGVhY2ggdGltZSB0aGUgaGVhZGluZwogKiBkYXRhIGlzIGF2YWlsYWJsZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgCiAqIGdldHRpbmcgdGhlIGhlYWRpbmcgZGF0YS4KICogQHBhcmFtIHtIZWFkaW5nT3B0aW9uc30gb3B0aW9ucyBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgaGVhZGluZyBkYXRhCiAqIHN1Y2ggYXMgdGltZW91dCBhbmQgdGhlIGZyZXF1ZW5jeSBvZiB0aGUgd2F0Y2guCiAqLwpDb21wYXNzLnByb3RvdHlwZS53YXRjaEhlYWRpbmc9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucykgCnsKCS8vIEludm9rZSB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2sgd2l0aCBhIG5ldyBQb3NpdGlvbiBvYmplY3QgZXZlcnkgdGltZSB0aGUgaW1wbGVtZW50YXRpb24gCgkvLyBkZXRlcm1pbmVzIHRoYXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBob3N0aW5nIGRldmljZSBoYXMgY2hhbmdlZC4gCgkKCXZhciBmcmVxdWVuY3kgPSAob3B0aW9ucyAmJiBvcHRpb25zLmZyZXF1ZW5jeSkgPyBvcHRpb25zLmZyZXF1ZW5jeSA6IDEwMDA7Cgl2YXIgc2VsZiA9IHRoaXM7Cgl2YXIgZnVuayA9IGZ1bmN0aW9uKCkgCgl7CgkJc2VsZi5nZXRDdXJyZW50SGVhZGluZyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpOwoJfTsKCWZ1bmsoKTsKCXJldHVybiBzZXRJbnRlcnZhbChmdW5rLCBmcmVxdWVuY3kpOwp9OwoKCi8qKgogKiBDbGVhcnMgdGhlIHNwZWNpZmllZCBoZWFkaW5nIHdhdGNoLgogKiBAcGFyYW0ge1N0cmluZ30gd2F0Y2hJZCBUaGUgSUQgb2YgdGhlIHdhdGNoIHJldHVybmVkIGZyb20gI3dhdGNoSGVhZGluZy4KICovCkNvbXBhc3MucHJvdG90eXBlLmNsZWFyV2F0Y2ggPSBmdW5jdGlvbih3YXRjaElkKSAKewoJY2xlYXJJbnRlcnZhbCh3YXRjaElkKTsKfTsKCgovKioKICogQ2FsbGVkIGJ5IHRoZSBnZW9sb2NhdGlvbiBmcmFtZXdvcmsgd2hlbiB0aGUgY3VycmVudCBoZWFkaW5nIGlzIGZvdW5kLgogKiBAcGFyYW0ge2hlYWRpbmd9IGhlYWRpbmcgVGhlIGN1cnJlbnQgaGVhZGluZy4KICovCkNvbXBhc3MucHJvdG90eXBlLnNldEhlYWRpbmcgPSBmdW5jdGlvbihoZWFkaW5nKSAKewogICAgdGhpcy5sYXN0SGVhZGluZyA9IGhlYWRpbmc7CiAgICAvLyB0aGUgbGFzdCBoZWFkaW5nIHdlIGFyZSBzdG9yaW5nIGhhcyBsb3RzIG1vcmUgaW5mbywgYnV0IHRoZSBjdXJyZW50IEFQSSBkb2NzIG9ubHkgc3RhdGUgdGhhdCAKICAgIC8vIHRoZSBkaXJlY3Rpb24gdmFsdWUgaXMgcmV0dXJuZWQuCiAgICB2YXIgcmV0dXJuSGVhZGluZyA9IC0xOwogICAgaWYodGhpcy5sYXN0SGVhZGluZy50cnVlSGVhZGluZyA+IC0xKQogICAgewogICAgICAgIHJldHVybkhlYWRpbmcgPSB0aGlzLmxhc3RIZWFkaW5nLnRydWVIZWFkaW5nOwogICAgfQogICAgZWxzZSBpZiggdGhpcy5sYXN0SGVhZGluZy5tYWduZXRpY0hlYWRpbmcgKQogICAgewogICAgICAgIHJldHVybkhlYWRpbmcgPSB0aGlzLmxhc3RIZWFkaW5nLm1hZ25ldGljSGVhZGluZzsKICAgIH0KICAgIAogICAgdmFyIGFyciA9IHRoaXMuY2FsbGJhY2tzLm9uSGVhZGluZ0NoYW5nZWQ7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSAKICAgIHsKICAgICAgICBhcnJbaV0ocmV0dXJuSGVhZGluZyk7CiAgICB9CiAgICAvLyBjYWxsYmFja3MgYXJlIG9ubHkgdXNlZCBvbmNlLCBzbyBjbGVhbnVwCiAgICB0aGlzLmNhbGxiYWNrcy5vbkhlYWRpbmdDaGFuZ2VkID0gW107CiAgICB0aGlzLmNhbGxiYWNrcy5vbkVycm9yID0gW107Cn07CgovKioKICogQ2FsbGVkIGJ5IHRoZSBnZW9sb2NhdGlvbiBmcmFtZXdvcmsgd2hlbiBhbiBlcnJvciBvY2N1cnMgd2hpbGUgbG9va2luZyB1cCB0aGUgY3VycmVudCBwb3NpdGlvbi4KICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgVGhlIHRleHQgb2YgdGhlIGVycm9yIG1lc3NhZ2UuCiAqLwpDb21wYXNzLnByb3RvdHlwZS5zZXRFcnJvciA9IGZ1bmN0aW9uKG1lc3NhZ2UpIAp7CiAgICB0aGlzLmxhc3RFcnJvciA9IG1lc3NhZ2U7CiAgICB2YXIgYXJyID0gdGhpcy5jYWxsYmFja3Mub25FcnJvcjsKICAgIGZvciAodmFyIGkgPSAwLGxlbiA9IGFyci5sZW5ndGg7IGkgPCBsZW47IGkrKykgCiAgICB7CiAgICAgICAgYXJyW2ldKG1lc3NhZ2UpOwogICAgfQogICAgLy8gY2FsbGJhY2tzIGFyZSBvbmx5IHVzZWQgb25jZSwgc28gY2xlYW51cAogICAgdGhpcy5jYWxsYmFja3Mub25IZWFkaW5nQ2hhbmdlZCA9IFtdOwogICAgdGhpcy5jYWxsYmFja3Mub25FcnJvciA9IFtdOwogICAgdGhpcy5zdG9wKCk7Cn07CgpDb21wYXNzLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKGFyZ3MpIAp7CiAgICBQaG9uZUdhcC5leGVjKCJMb2NhdGlvbi5zdGFydEhlYWRpbmciLCBhcmdzKTsKfTsKCkNvbXBhc3MucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIAp7CiAgICBQaG9uZUdhcC5leGVjKCJMb2NhdGlvbi5zdG9wSGVhZGluZyIpOwp9OwoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSAKewogICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IuY29tcGFzcyA9PSAidW5kZWZpbmVkIikgCiAgICB7CiAgICAgICAgbmF2aWdhdG9yLmNvbXBhc3MgPSBuZXcgQ29tcGFzcygpOwogICAgfQp9KTsKfTsKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgibWVkaWEiKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoIm1lZGlhIik7CgovKioKICogTWVkaWEvQXVkaW8gb3ZlcnJpZGUuCiAqCiAqLwogCk1lZGlhID0gZnVuY3Rpb24oc3JjLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIGRvd25sb2FkQ29tcGxldGVDYWxsYmFjaykgewoJCglpZiAoIXNyYykgewoJCXNyYyA9ICJkb2N1bWVudHM6Ly8iICsgU3RyaW5nKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkpLnJlcGxhY2UoL1xEL2dpLCcnKTsgLy8gcmFuZG9tCgl9Cgl0aGlzLnNyYyA9IHNyYzsKCXZhciBzdWNjZXNzQ0IgPSAoc3VjY2Vzc0NhbGxiYWNrID09IHVuZGVmaW5lZCB8fCBzdWNjZXNzQ2FsbGJhY2sgPT0gbnVsbCkgPyBudWxsIDogR2V0RnVuY3Rpb25OYW1lKHN1Y2Nlc3NDYWxsYmFjayk7Cgl2YXIgZXJyb3JDQiA9IChlcnJvckNhbGxiYWNrID09IHVuZGVmaW5lZCB8fCBlcnJvckNhbGxiYWNrID09IG51bGwpID8gbnVsbCA6IEdldEZ1bmN0aW9uTmFtZShlcnJvckNhbGxiYWNrKTsKCXZhciBkb3dubG9hZENCID0gKGRvd25sb2FkQ29tcGxldGVDYWxsYmFjayA9PSB1bmRlZmluZWQgfHwgZG93bmxvYWRDb21wbGV0ZUNhbGxiYWNrID09IG51bGwpID8gbnVsbCA6IEdldEZ1bmN0aW9uTmFtZShkb3dubG9hZENvbXBsZXRlQ2FsbGJhY2spOwoJCgl0aGlzLnN1Y2Nlc3NDYWxsYmFjayA9IHN1Y2Nlc3NDYWxsYmFjayB8fCBudWxsOwoJdGhpcy5lcnJvckNhbGxiYWNrID0gZXJyb3JDYWxsYmFjayB8fCBudWxsOwkKCXRoaXMuZG93bmxvYWRDb21wbGV0ZUNhbGxiYWNrID0gZG93bmxvYWRDb21wbGV0ZUNhbGxiYWNrIHx8IG51bGw7CiAgICAKCWlmICh0aGlzLnNyYyAhPSBudWxsKSB7CgkJUGhvbmVHYXAuZXhlYygiU291bmQucHJlcGFyZSIsIHRoaXMuc3JjLCBzdWNjZXNzQ0IsIGVycm9yQ0IsIGRvd25sb2FkQ0IpOwoJfQp9CiAKTWVkaWEucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbihvcHRpb25zKSB7CglpZiAodGhpcy5zcmMgIT0gbnVsbCkgewoJCVBob25lR2FwLmV4ZWMoIlNvdW5kLnBsYXkiLCB0aGlzLnNyYywgb3B0aW9ucyk7Cgl9Cn07CgpNZWRpYS5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsKCWlmICh0aGlzLnNyYyAhPSBudWxsKSB7CgkJUGhvbmVHYXAuZXhlYygiU291bmQucGF1c2UiLCB0aGlzLnNyYyk7Cgl9Cn07CgpNZWRpYS5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKCkgewoJaWYgKHRoaXMuc3JjICE9IG51bGwpIHsKCQlQaG9uZUdhcC5leGVjKCJTb3VuZC5zdG9wIiwgdGhpcy5zcmMpOwoJfQp9OwoKTWVkaWEucHJvdG90eXBlLnN0YXJ0QXVkaW9SZWNvcmQgPSBmdW5jdGlvbihvcHRpb25zKSB7CglpZiAodGhpcy5zcmMgIT0gbnVsbCkgewoJCVBob25lR2FwLmV4ZWMoIlNvdW5kLnN0YXJ0QXVkaW9SZWNvcmQiLCB0aGlzLnNyYywgb3B0aW9ucyk7Cgl9Cn07CgpNZWRpYS5wcm90b3R5cGUuc3RvcEF1ZGlvUmVjb3JkID0gZnVuY3Rpb24oKSB7CglpZiAodGhpcy5zcmMgIT0gbnVsbCkgewoJCVBob25lR2FwLmV4ZWMoIlNvdW5kLnN0b3BBdWRpb1JlY29yZCIsIHRoaXMuc3JjKTsKCX0KfTsKCi8qKgogKiBUaGlzIGNsYXNzIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IGFueSBNZWRpYSBlcnJvcnMuCiAqIEBjb25zdHJ1Y3RvcgogKi8KTWVkaWFFcnJvciA9IGZ1bmN0aW9uKCkgewoJdGhpcy5jb2RlID0gbnVsbCwKCXRoaXMubWVzc2FnZSA9ICIiOwp9CgpNZWRpYUVycm9yLk1FRElBX0VSUl9BQk9SVEVEIAkJPSAxOwpNZWRpYUVycm9yLk1FRElBX0VSUl9ORVRXT1JLIAkJPSAyOwpNZWRpYUVycm9yLk1FRElBX0VSUl9ERUNPREUgCQk9IDM7Ck1lZGlhRXJyb3IuTUVESUFfRVJSX05PTkVfU1VQUE9SVEVEID0gNDsKCgovL2lmICh0eXBlb2YgbmF2aWdhdG9yLmF1ZGlvID09ICJ1bmRlZmluZWQiKSBuYXZpZ2F0b3IuYXVkaW8gPSBuZXcgTWVkaWEoc3JjKTsKfTtpZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJub3RpZmljYXRpb24iKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoIm5vdGlmaWNhdGlvbiIpOwoKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYWNjZXNzIHRvIG5vdGlmaWNhdGlvbnMgb24gdGhlIGRldmljZS4KICovCk5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uKCkgewp9OwoKLyoqCiAqIE9wZW4gYSBuYXRpdmUgYWxlcnQgZGlhbG9nLCB3aXRoIGEgY3VzdG9taXphYmxlIHRpdGxlIGFuZCBidXR0b24gdGV4dC4KICoKICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgICAgICAgICAgICAgIE1lc3NhZ2UgdG8gcHJpbnQgaW4gdGhlIGJvZHkgb2YgdGhlIGFsZXJ0CiAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbXBsZXRlQ2FsbGJhY2sgICBUaGUgY2FsbGJhY2sgdGhhdCBpcyBjYWxsZWQgd2hlbiB1c2VyIGNsaWNrcyBvbiBhIGJ1dHRvbi4KICogQHBhcmFtIHtTdHJpbmd9IHRpdGxlICAgICAgICAgICAgICAgIFRpdGxlIG9mIHRoZSBhbGVydCBkaWFsb2cgKGRlZmF1bHQ6IEFsZXJ0KQogKiBAcGFyYW0ge1N0cmluZ30gYnV0dG9uTGFiZWwgICAgICAgICAgTGFiZWwgb2YgdGhlIGNsb3NlIGJ1dHRvbiAoZGVmYXVsdDogT0spCiAqLwpOb3RpZmljYXRpb24ucHJvdG90eXBlLmFsZXJ0ID0gZnVuY3Rpb24obWVzc2FnZSwgY29tcGxldGVDYWxsYmFjaywgdGl0bGUsIGJ1dHRvbkxhYmVsKSB7CiAgICB2YXIgX3RpdGxlID0gKHRpdGxlIHx8ICJBbGVydCIpOwogICAgdmFyIF9idXR0b25MYWJlbCA9IChidXR0b25MYWJlbCB8fCAiT0siKTsKICAgIFBob25lR2FwLmV4ZWMoY29tcGxldGVDYWxsYmFjaywgbnVsbCwgIk5vdGlmaWNhdGlvbiIsICJhbGVydCIsIFttZXNzYWdlLHsgInRpdGxlIjogX3RpdGxlLCAiYnV0dG9uTGFiZWwiOiBfYnV0dG9uTGFiZWx9XSk7Cn07CgovKioKICogT3BlbiBhIG5hdGl2ZSBjb25maXJtIGRpYWxvZywgd2l0aCBhIGN1c3RvbWl6YWJsZSB0aXRsZSBhbmQgYnV0dG9uIHRleHQuCiAqIFRoZSByZXN1bHQgdGhhdCB0aGUgdXNlciBzZWxlY3RzIGlzIHJldHVybmVkIHRvIHRoZSByZXN1bHQgY2FsbGJhY2suCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlICAgICAgICAgICAgICBNZXNzYWdlIHRvIHByaW50IGluIHRoZSBib2R5IG9mIHRoZSBhbGVydAogKiBAcGFyYW0ge0Z1bmN0aW9ufSByZXN1bHRDYWxsYmFjayAgICAgVGhlIGNhbGxiYWNrIHRoYXQgaXMgY2FsbGVkIHdoZW4gdXNlciBjbGlja3Mgb24gYSBidXR0b24uCiAqIEBwYXJhbSB7U3RyaW5nfSB0aXRsZSAgICAgICAgICAgICAgICBUaXRsZSBvZiB0aGUgYWxlcnQgZGlhbG9nIChkZWZhdWx0OiBDb25maXJtKQogKiBAcGFyYW0ge1N0cmluZ30gYnV0dG9uTGFiZWxzICAgICAgICAgQ29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgdGhlIGxhYmVscyBvZiB0aGUgYnV0dG9ucyAoZGVmYXVsdDogJ09LLENhbmNlbCcpCiAqLwpOb3RpZmljYXRpb24ucHJvdG90eXBlLmNvbmZpcm0gPSBmdW5jdGlvbihtZXNzYWdlLCByZXN1bHRDYWxsYmFjaywgdGl0bGUsIGJ1dHRvbkxhYmVscykgewogICAgdmFyIF90aXRsZSA9ICh0aXRsZSB8fCAiQ29uZmlybSIpOwogICAgdmFyIF9idXR0b25MYWJlbHMgPSAoYnV0dG9uTGFiZWxzIHx8ICJPSyxDYW5jZWwiKTsKICAgIHRoaXMuYWxlcnQobWVzc2FnZSwgcmVzdWx0Q2FsbGJhY2ssIF90aXRsZSwgX2J1dHRvbkxhYmVscyk7Cn07Ci8qKgogKiBTdGFydCBzcGlubmluZyB0aGUgYWN0aXZpdHkgaW5kaWNhdG9yIG9uIHRoZSBzdGF0dXNiYXIKICovCk5vdGlmaWNhdGlvbi5wcm90b3R5cGUuYWN0aXZpdHlTdGFydCA9IGZ1bmN0aW9uKCkgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTm90aWZpY2F0aW9uIiwgImFjdGl2aXR5U3RhcnQiLCBbXSk7Cn07CgovKioKICogU3RvcCBzcGlubmluZyB0aGUgYWN0aXZpdHkgaW5kaWNhdG9yIG9uIHRoZSBzdGF0dXNiYXIsIGlmIGl0J3MgY3VycmVudGx5IHNwaW5uaW5nCiAqLwpOb3RpZmljYXRpb24ucHJvdG90eXBlLmFjdGl2aXR5U3RvcCA9IGZ1bmN0aW9uKCkgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTm90aWZpY2F0aW9uIiwgImFjdGl2aXR5U3RvcCIsIFtdKTsKfTsKCi8vIGlQaG9uZSBvbmx5Ck5vdGlmaWNhdGlvbi5wcm90b3R5cGUubG9hZGluZ1N0YXJ0ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTm90aWZpY2F0aW9uIiwibG9hZGluZ1N0YXJ0IiwgW29wdGlvbnNdKTsKfTsKLy8gaVBob25lIG9ubHkKTm90aWZpY2F0aW9uLnByb3RvdHlwZS5sb2FkaW5nU3RvcCA9IGZ1bmN0aW9uKCkgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTm90aWZpY2F0aW9uIiwibG9hZGluZ1N0b3AiLCBbXSk7Cn07Ci8qKgogKiBDYXVzZXMgdGhlIGRldmljZSB0byBibGluayBhIHN0YXR1cyBMRUQuCiAqIEBwYXJhbSB7SW50ZWdlcn0gY291bnQgVGhlIG51bWJlciBvZiBibGlua3MuCiAqIEBwYXJhbSB7U3RyaW5nfSBjb2xvdXIgVGhlIGNvbG91ciBvZiB0aGUgbGlnaHQuCiAqLwpOb3RpZmljYXRpb24ucHJvdG90eXBlLmJsaW5rID0gZnVuY3Rpb24oY291bnQsIGNvbG91cikgewovLyBOT1QgSU1QTEVNRU5URUQJCn07CgpOb3RpZmljYXRpb24ucHJvdG90eXBlLnZpYnJhdGUgPSBmdW5jdGlvbihtaWxscykgewoJUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTm90aWZpY2F0aW9uIiwgInZpYnJhdGUiLCBbXSk7Cn07CgpOb3RpZmljYXRpb24ucHJvdG90eXBlLmJlZXAgPSBmdW5jdGlvbihjb3VudCwgdm9sdW1lKSB7CgkvLyBObyBWb2x1bWUgeWV0IGZvciB0aGUgaXBob25lIGludGVyZmFjZQoJLy8gV2UgY2FuIHVzZSBhIGNhbm5lZCBiZWVwIHNvdW5kIGFuZCBjYWxsIHRoYXQKCW5ldyBNZWRpYSgnYmVlcC53YXYnKS5wbGF5KCk7Cn07CgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLm5vdGlmaWNhdGlvbiA9PSAidW5kZWZpbmVkIikgbmF2aWdhdG9yLm5vdGlmaWNhdGlvbiA9IG5ldyBOb3RpZmljYXRpb24oKTsKfSk7Cn07CmlmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoIm9yaWVudGF0aW9uIikpIHsKCVBob25lR2FwLmFkZFJlc291cmNlKCJvcmllbnRhdGlvbiIpOwoKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYWNjZXNzIHRvIHRoZSBkZXZpY2Ugb3JpZW50YXRpb24uCiAqIEBjb25zdHJ1Y3RvcgogKi8KT3JpZW50YXRpb24gID0gZnVuY3Rpb24oKSB7CgkvKioKCSAqIFRoZSBjdXJyZW50IG9yaWVudGF0aW9uLCBvciBudWxsIGlmIHRoZSBvcmllbnRhdGlvbiBoYXNuJ3QgY2hhbmdlZCB5ZXQuCgkgKi8KCXRoaXMuY3VycmVudE9yaWVudGF0aW9uID0gbnVsbDsKfQoKLyoqCiAqIFNldCB0aGUgY3VycmVudCBvcmllbnRhdGlvbiBvZiB0aGUgcGhvbmUuICBUaGlzIGlzIGNhbGxlZCBmcm9tIHRoZSBkZXZpY2UgYXV0b21hdGljYWxseS4KICogCiAqIFdoZW4gdGhlIG9yaWVudGF0aW9uIGlzIGNoYW5nZWQsIHRoZSBET01FdmVudCBcYyBvcmllbnRhdGlvbkNoYW5nZWQgaXMgZGlzcGF0Y2hlZCBhZ2FpbnN0CiAqIHRoZSBkb2N1bWVudCBlbGVtZW50LiAgVGhlIGV2ZW50IGhhcyB0aGUgcHJvcGVydHkgXGMgb3JpZW50YXRpb24gd2hpY2ggY2FuIGJlIHVzZWQgdG8gcmV0cmlldmUKICogdGhlIGRldmljZSdzIGN1cnJlbnQgb3JpZW50YXRpb24sIGluIGFkZGl0aW9uIHRvIHRoZSBcYyBPcmllbnRhdGlvbi5jdXJyZW50T3JpZW50YXRpb24gY2xhc3MgcHJvcGVydHkuCiAqCiAqIEBwYXJhbSB7TnVtYmVyfSBvcmllbnRhdGlvbiBUaGUgb3JpZW50YXRpb24gdG8gYmUgc2V0CiAqLwpPcmllbnRhdGlvbi5wcm90b3R5cGUuc2V0T3JpZW50YXRpb24gPSBmdW5jdGlvbihvcmllbnRhdGlvbikgewogICAgT3JpZW50YXRpb24uY3VycmVudE9yaWVudGF0aW9uID0gb3JpZW50YXRpb247CiAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudHMnKTsKICAgIGUuaW5pdEV2ZW50KCdvcmllbnRhdGlvbkNoYW5nZWQnLCAnZmFsc2UnLCAnZmFsc2UnKTsKICAgIGUub3JpZW50YXRpb24gPSBvcmllbnRhdGlvbjsKICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoZSk7Cn07CgovKioKICogQXN5bmNocm9ub3VzbHkgYXF1aXJlcyB0aGUgY3VycmVudCBvcmllbnRhdGlvbi4KICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIG9yaWVudGF0aW9uCiAqIGlzIGtub3duLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgCiAqIGdldHRpbmcgdGhlIG9yaWVudGF0aW9uLgogKi8KT3JpZW50YXRpb24ucHJvdG90eXBlLmdldEN1cnJlbnRPcmllbnRhdGlvbiA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewoJLy8gSWYgdGhlIHBvc2l0aW9uIGlzIGF2YWlsYWJsZSB0aGVuIGNhbGwgc3VjY2VzcwoJLy8gSWYgdGhlIHBvc2l0aW9uIGlzIG5vdCBhdmFpbGFibGUgdGhlbiBjYWxsIGVycm9yCn07CgovKioKICogQXN5bmNocm9ub3VzbHkgYXF1aXJlcyB0aGUgb3JpZW50YXRpb24gcmVwZWF0ZWRseSBhdCBhIGdpdmVuIGludGVydmFsLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZWFjaCB0aW1lIHRoZSBvcmllbnRhdGlvbgogKiBkYXRhIGlzIGF2YWlsYWJsZS4KICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIAogKiBnZXR0aW5nIHRoZSBvcmllbnRhdGlvbiBkYXRhLgogKi8KT3JpZW50YXRpb24ucHJvdG90eXBlLndhdGNoT3JpZW50YXRpb24gPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKCS8vIEludm9rZSB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2sgd2l0aCBhIG5ldyBQb3NpdGlvbiBvYmplY3QgZXZlcnkgdGltZSB0aGUgaW1wbGVtZW50YXRpb24gCgkvLyBkZXRlcm1pbmVzIHRoYXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBob3N0aW5nIGRldmljZSBoYXMgY2hhbmdlZC4gCgl0aGlzLmdldEN1cnJlbnRQb3NpdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spOwoJcmV0dXJuIHNldEludGVydmFsKGZ1bmN0aW9uKCkgewoJCW5hdmlnYXRvci5vcmllbnRhdGlvbi5nZXRDdXJyZW50T3JpZW50YXRpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKTsKCX0sIDEwMDAwKTsKfTsKCi8qKgogKiBDbGVhcnMgdGhlIHNwZWNpZmllZCBvcmllbnRhdGlvbiB3YXRjaC4KICogQHBhcmFtIHtTdHJpbmd9IHdhdGNoSWQgVGhlIElEIG9mIHRoZSB3YXRjaCByZXR1cm5lZCBmcm9tICN3YXRjaE9yaWVudGF0aW9uLgogKi8KT3JpZW50YXRpb24ucHJvdG90eXBlLmNsZWFyV2F0Y2ggPSBmdW5jdGlvbih3YXRjaElkKSB7CgljbGVhckludGVydmFsKHdhdGNoSWQpOwp9OwoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mIG5hdmlnYXRvci5vcmllbnRhdGlvbiA9PSAidW5kZWZpbmVkIikgbmF2aWdhdG9yLm9yaWVudGF0aW9uID0gbmV3IE9yaWVudGF0aW9uKCk7Cn0pOwp9OwppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJzbXMiKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoInNtcyIpOwoKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYWNjZXNzIHRvIHRoZSBkZXZpY2UgU01TIGZ1bmN0aW9uYWxpdHkuCiAqIEBjb25zdHJ1Y3RvcgogKi8KU21zID0gZnVuY3Rpb24oKSB7Cgp9CgovKioKICogU2VuZHMgYW4gU01TIG1lc3NhZ2UuCiAqIEBwYXJhbSB7SW50ZWdlcn0gbnVtYmVyIFRoZSBwaG9uZSBudW1iZXIgdG8gc2VuZCB0aGUgbWVzc2FnZSB0by4KICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgVGhlIGNvbnRlbnRzIG9mIHRoZSBTTVMgbWVzc2FnZSB0byBzZW5kLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGUgU01TIG1lc3NhZ2UgaXMgc2VudC4KICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIHNlbmRpbmcgdGhlIFNNUyBtZXNzYWdlLgogKiBAcGFyYW0ge1Bvc2l0aW9uT3B0aW9uc30gb3B0aW9ucyBUaGUgb3B0aW9ucyBmb3IgYWNjZXNzaW5nIHRoZSBHUFMgbG9jYXRpb24gc3VjaCBhcyB0aW1lb3V0IGFuZCBhY2N1cmFjeS4KICovClNtcy5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKG51bWJlciwgbWVzc2FnZSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CgkvLyBub3Qgc3VyZSB3aHkgdGhpcyBpcyBoZXJlIHdoZW4gaXQgZG9lcyBub3RoaW5nPz8/Pwp9OwoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mIG5hdmlnYXRvci5zbXMgPT0gInVuZGVmaW5lZCIpIG5hdmlnYXRvci5zbXMgPSBuZXcgU21zKCk7Cn0pOwp9OwppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJ0ZWxlcGhvbnkiKSkgewoJUGhvbmVHYXAuYWRkUmVzb3VyY2UoInRlbGVwaG9ueSIpOwoKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYWNjZXNzIHRvIHRoZSB0ZWxlcGhvbnkgZmVhdHVyZXMgb2YgdGhlIGRldmljZS4KICogQGNvbnN0cnVjdG9yCiAqLwpUZWxlcGhvbnkgPSBmdW5jdGlvbigpIHsKCQp9CgovKioKICogQ2FsbHMgdGhlIHNwZWNpZmVkIG51bWJlci4KICogQHBhcmFtIHtJbnRlZ2VyfSBudW1iZXIgVGhlIG51bWJlciB0byBiZSBjYWxsZWQuCiAqLwpUZWxlcGhvbnkucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbihudW1iZXIpIHsKCS8vIG5vdCBzdXJlIHdoeSB0aGlzIGlzIGhlcmUgd2hlbiBpdCBkb2VzIG5vdGhpbmc/Pz8/Cn07CgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLnRlbGVwaG9ueSA9PSAidW5kZWZpbmVkIikgbmF2aWdhdG9yLnRlbGVwaG9ueSA9IG5ldyBUZWxlcGhvbnkoKTsKfSk7Cn07aWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgibmV0d29yayIpKSB7CglQaG9uZUdhcC5hZGRSZXNvdXJjZSgibmV0d29yayIpOwoJCi8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJCkNvbm5lY3Rpb24gPSBmdW5jdGlvbih0eXBlLCBob21lTlcsIGN1cnJlbnROVykgewoJLyoKCSAqIE9uZSBvZiB0aGUgY29ubmVjdGlvbiBjb25zdGFudHMgYmVsb3cuCgkgKi8KCXRoaXMudHlwZSA9IHR5cGUgfHwgMDsKCS8qCgkgKiBUaGUgaG9tZSBuZXR3b3JrIHByb3ZpZGVyLCBvbmx5IHZhbGlkIGlmIGNlbGx1bGFyIGJhc2VkLgoJICovCgl0aGlzLmhvbWVOVyA9IGhvbWVOVyB8fCBudWxsOwoJLyoKCSAqIFRoZSBjdXJyZW50IG5ldHdvcmsgcHJvdmlkZXIsIG9ubHkgdmFsaWQgaWYgY2VsbHVsYXIgYmFzZWQuCiAgICAgKi8KCXRoaXMuY3VycmVudE5XID0gY3VycmVudE5XIHx8IG51bGw7Cn07CgpDb25uZWN0aW9uLlVOS05PV04gPSAwOyAvLyBVbmtub3duIGNvbm5lY3Rpb24gdHlwZQpDb25uZWN0aW9uLkVUSEVSTkVUID0gMTsKQ29ubmVjdGlvbi5XSUZJID0gMjsKQ29ubmVjdGlvbi5DRUxMXzJHID0gMzsKQ29ubmVjdGlvbi5DRUxMXzNHID0gNDsKQ29ubmVjdGlvbi5DRUxMXzRHID0gNTsKQ29ubmVjdGlvbi5OT05FID0gMjA7IC8vIE5PIGNvbm5lY3Rpdml0eQoKLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgovKioKICogVGhpcyBjbGFzcyBjb250YWlucyBpbmZvcm1hdGlvbiBhYm91dCBhbnkgTmV0d29ya1N0YXR1cy4KICogQGNvbnN0cnVjdG9yCiAqLwpOZXR3b3JrU3RhdHVzID0gZnVuY3Rpb24oKSB7Cgl0aGlzLmNvZGUgPSBudWxsOwoJdGhpcy5tZXNzYWdlID0gIiI7Cn0KCk5ldHdvcmtTdGF0dXMuTk9UX1JFQUNIQUJMRSA9IDA7Ck5ldHdvcmtTdGF0dXMuUkVBQ0hBQkxFX1ZJQV9DQVJSSUVSX0RBVEFfTkVUV09SSyA9IDE7Ck5ldHdvcmtTdGF0dXMuUkVBQ0hBQkxFX1ZJQV9XSUZJX05FVFdPUksgPSAyOwoKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYWNjZXNzIHRvIGRldmljZSBOZXR3b3JrIGRhdGEgKHJlYWNoYWJpbGl0eSkuCiAqIEBjb25zdHJ1Y3RvcgogKi8KTmV0d29yayA9IGZ1bmN0aW9uKCkgewp9OwoKLyoqCiAqIAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjawogKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogKi8KTmV0d29yay5wcm90b3R5cGUuaXNSZWFjaGFibGUgPSBmdW5jdGlvbihob3N0TmFtZSwgc3VjY2Vzc0NhbGxiYWNrLCBvcHRpb25zKSB7CglQaG9uZUdhcC5leGVjKCJOZXR3b3JrLmlzUmVhY2hhYmxlIiwgaG9zdE5hbWUsIEdldEZ1bmN0aW9uTmFtZShzdWNjZXNzQ2FsbGJhY2spLCBvcHRpb25zKTsKfTsKCgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLm5ldHdvcmsgPT0gInVuZGVmaW5lZCIpIG5hdmlnYXRvci5uZXR3b3JrID0gbmV3IE5ldHdvcmsoKTsKICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLmNvbm5lY3Rpb24gPT0gInVuZGVmaW5lZCIpIG5hdmlnYXRvci5jb25uZWN0aW9uID0gbmV3IENvbm5lY3Rpb24oKTsKfSk7Cn07","content_type":"application/javascript","revpos":1},"vendor/couchapp/jquery.mustache.js":{"data":"LyoKU2hhbWVsZXNzIHBvcnQgb2YgYSBzaGFtZWxlc3MgcG9ydApAZGVmdW5rdCA9PiBAamFubCA9PiBAYXEKIApTZWUgaHR0cDovL2dpdGh1Yi5jb20vZGVmdW5rdC9tdXN0YWNoZSBmb3IgbW9yZSBpbmZvLgoqLwogCjsoZnVuY3Rpb24oJCkgewoKLyoKICBtdXN0YWNoZS5qcyDigJQgTG9naWMtbGVzcyB0ZW1wbGF0ZXMgaW4gSmF2YVNjcmlwdAoKICBTZWUgaHR0cDovL211c3RhY2hlLmdpdGh1Yi5jb20vIGZvciBtb3JlIGluZm8uCiovCgp2YXIgTXVzdGFjaGUgPSBmdW5jdGlvbigpIHsKICB2YXIgUmVuZGVyZXIgPSBmdW5jdGlvbigpIHt9OwoKICBSZW5kZXJlci5wcm90b3R5cGUgPSB7CiAgICBvdGFnOiAie3siLAogICAgY3RhZzogIn19IiwKICAgIHByYWdtYXM6IHt9LAogICAgYnVmZmVyOiBbXSwKICAgIHByYWdtYXNfaW1wbGVtZW50ZWQ6IHsKICAgICAgIklNUExJQ0lULUlURVJBVE9SIjogdHJ1ZQogICAgfSwKICAgIGNvbnRleHQ6IHt9LAoKICAgIHJlbmRlcjogZnVuY3Rpb24odGVtcGxhdGUsIGNvbnRleHQsIHBhcnRpYWxzLCBpbl9yZWN1cnNpb24pIHsKICAgICAgLy8gcmVzZXQgYnVmZmVyICYgc2V0IGNvbnRleHQKICAgICAgaWYoIWluX3JlY3Vyc2lvbikgewogICAgICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgICAgICAgdGhpcy5idWZmZXIgPSBbXTsgLy8gVE9ETzogbWFrZSB0aGlzIG5vbi1sYXp5CiAgICAgIH0KCiAgICAgIC8vIGZhaWwgZmFzdAogICAgICBpZighdGhpcy5pbmNsdWRlcygiIiwgdGVtcGxhdGUpKSB7CiAgICAgICAgaWYoaW5fcmVjdXJzaW9uKSB7CiAgICAgICAgICByZXR1cm4gdGVtcGxhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2VuZCh0ZW1wbGF0ZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CgogICAgICB0ZW1wbGF0ZSA9IHRoaXMucmVuZGVyX3ByYWdtYXModGVtcGxhdGUpOwogICAgICB2YXIgaHRtbCA9IHRoaXMucmVuZGVyX3NlY3Rpb24odGVtcGxhdGUsIGNvbnRleHQsIHBhcnRpYWxzKTsKICAgICAgaWYoaW5fcmVjdXJzaW9uKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyX3RhZ3MoaHRtbCwgY29udGV4dCwgcGFydGlhbHMsIGluX3JlY3Vyc2lvbik7CiAgICAgIH0KCiAgICAgIHRoaXMucmVuZGVyX3RhZ3MoaHRtbCwgY29udGV4dCwgcGFydGlhbHMsIGluX3JlY3Vyc2lvbik7CiAgICB9LAoKICAgIC8qCiAgICAgIFNlbmRzIHBhcnNlZCBsaW5lcwogICAgKi8KICAgIHNlbmQ6IGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgaWYobGluZSAhPSAiIikgewogICAgICAgIHRoaXMuYnVmZmVyLnB1c2gobGluZSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoKICAgICAgTG9va3MgZm9yICVQUkFHTUFTCiAgICAqLwogICAgcmVuZGVyX3ByYWdtYXM6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7CiAgICAgIC8vIG5vIHByYWdtYXMKICAgICAgaWYoIXRoaXMuaW5jbHVkZXMoIiUiLCB0ZW1wbGF0ZSkpIHsKICAgICAgICByZXR1cm4gdGVtcGxhdGU7CiAgICAgIH0KCiAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCh0aGlzLm90YWcgKyAiJShbXFx3LV0rKSA/KFtcXHddKz1bXFx3XSspPyIgKwogICAgICAgICAgICB0aGlzLmN0YWcpOwogICAgICByZXR1cm4gdGVtcGxhdGUucmVwbGFjZShyZWdleCwgZnVuY3Rpb24obWF0Y2gsIHByYWdtYSwgb3B0aW9ucykgewogICAgICAgIGlmKCF0aGF0LnByYWdtYXNfaW1wbGVtZW50ZWRbcHJhZ21hXSkgewogICAgICAgICAgdGhyb3coe21lc3NhZ2U6IAogICAgICAgICAgICAiVGhpcyBpbXBsZW1lbnRhdGlvbiBvZiBtdXN0YWNoZSBkb2Vzbid0IHVuZGVyc3RhbmQgdGhlICciICsKICAgICAgICAgICAgcHJhZ21hICsgIicgcHJhZ21hIn0pOwogICAgICAgIH0KICAgICAgICB0aGF0LnByYWdtYXNbcHJhZ21hXSA9IHt9OwogICAgICAgIGlmKG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBvcHRzID0gb3B0aW9ucy5zcGxpdCgiPSIpOwogICAgICAgICAgdGhhdC5wcmFnbWFzW3ByYWdtYV1bb3B0c1swXV0gPSBvcHRzWzFdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgLy8gaWdub3JlIHVua25vd24gcHJhZ21hcyBzaWxlbnRseQogICAgICB9KTsKICAgIH0sCgogICAgLyoKICAgICAgVHJpZXMgdG8gZmluZCBhIHBhcnRpYWwgaW4gdGhlIGN1cmVudCBzY29wZSBhbmQgcmVuZGVyIGl0CiAgICAqLwogICAgcmVuZGVyX3BhcnRpYWw6IGZ1bmN0aW9uKG5hbWUsIGNvbnRleHQsIHBhcnRpYWxzKSB7CiAgICAgIG5hbWUgPSB0aGlzLnRyaW0obmFtZSk7CiAgICAgIGlmKCFwYXJ0aWFscyB8fCBwYXJ0aWFsc1tuYW1lXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhyb3coe21lc3NhZ2U6ICJ1bmtub3duX3BhcnRpYWwgJyIgKyBuYW1lICsgIicifSk7CiAgICAgIH0KICAgICAgaWYodHlwZW9mKGNvbnRleHRbbmFtZV0pICE9ICJvYmplY3QiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyKHBhcnRpYWxzW25hbWVdLCBjb250ZXh0LCBwYXJ0aWFscywgdHJ1ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMucmVuZGVyKHBhcnRpYWxzW25hbWVdLCBjb250ZXh0W25hbWVdLCBwYXJ0aWFscywgdHJ1ZSk7CiAgICB9LAoKICAgIC8qCiAgICAgIFJlbmRlcnMgaW52ZXJ0ZWQgKF4pIGFuZCBub3JtYWwgKCMpIHNlY3Rpb25zCiAgICAqLwogICAgcmVuZGVyX3NlY3Rpb246IGZ1bmN0aW9uKHRlbXBsYXRlLCBjb250ZXh0LCBwYXJ0aWFscykgewogICAgICBpZighdGhpcy5pbmNsdWRlcygiIyIsIHRlbXBsYXRlKSAmJiAhdGhpcy5pbmNsdWRlcygiXiIsIHRlbXBsYXRlKSkgewogICAgICAgIHJldHVybiB0ZW1wbGF0ZTsKICAgICAgfQoKICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAvLyBDU1cgLSBBZGRlZCAiKz8iIHNvIGl0IGZpbmRzIHRoZSB0aWdoZXN0IGJvdW5kLCBub3QgdGhlIHdpZGVzdAogICAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKHRoaXMub3RhZyArICIoXFxefFxcIylcXHMqKC4rKVxccyoiICsgdGhpcy5jdGFnICsKICAgICAgICAgICAgICAiXG4qKFtcXHNcXFNdKz8pIiArIHRoaXMub3RhZyArICJcXC9cXHMqXFwyXFxzKiIgKyB0aGlzLmN0YWcgKwogICAgICAgICAgICAgICJcXHMqIiwgIm1nIik7CgogICAgICAvLyBmb3IgZWFjaCB7eyNmb299fXt7L2Zvb319IHNlY3Rpb24gZG8uLi4KICAgICAgcmV0dXJuIHRlbXBsYXRlLnJlcGxhY2UocmVnZXgsIGZ1bmN0aW9uKG1hdGNoLCB0eXBlLCBuYW1lLCBjb250ZW50KSB7CiAgICAgICAgdmFyIHZhbHVlID0gdGhhdC5maW5kKG5hbWUsIGNvbnRleHQpOwogICAgICAgIGlmKHR5cGUgPT0gIl4iKSB7IC8vIGludmVydGVkIHNlY3Rpb24KICAgICAgICAgIGlmKCF2YWx1ZSB8fCB0aGF0LmlzX2FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgLy8gZmFsc2Ugb3IgZW1wdHkgbGlzdCwgcmVuZGVyIGl0CiAgICAgICAgICAgIHJldHVybiB0aGF0LnJlbmRlcihjb250ZW50LCBjb250ZXh0LCBwYXJ0aWFscywgdHJ1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmKHR5cGUgPT0gIiMiKSB7IC8vIG5vcm1hbCBzZWN0aW9uCiAgICAgICAgICBpZih0aGF0LmlzX2FycmF5KHZhbHVlKSkgeyAvLyBFbnVtZXJhYmxlLCBMZXQncyBsb29wIQogICAgICAgICAgICByZXR1cm4gdGhhdC5tYXAodmFsdWUsIGZ1bmN0aW9uKHJvdykgewogICAgICAgICAgICAgIHJldHVybiB0aGF0LnJlbmRlcihjb250ZW50LCB0aGF0LmNyZWF0ZV9jb250ZXh0KHJvdyksCiAgICAgICAgICAgICAgICBwYXJ0aWFscywgdHJ1ZSk7CiAgICAgICAgICAgIH0pLmpvaW4oIiIpOwogICAgICAgICAgfSBlbHNlIGlmKHRoYXQuaXNfb2JqZWN0KHZhbHVlKSkgeyAvLyBPYmplY3QsIFVzZSBpdCBhcyBzdWJjb250ZXh0IQogICAgICAgICAgICByZXR1cm4gdGhhdC5yZW5kZXIoY29udGVudCwgdGhhdC5jcmVhdGVfY29udGV4dCh2YWx1ZSksCiAgICAgICAgICAgICAgcGFydGlhbHMsIHRydWUpOwogICAgICAgICAgfSBlbHNlIGlmKHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAvLyBoaWdoZXIgb3JkZXIgc2VjdGlvbgogICAgICAgICAgICByZXR1cm4gdmFsdWUuY2FsbChjb250ZXh0LCBjb250ZW50LCBmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoYXQucmVuZGVyKHRleHQsIGNvbnRleHQsIHBhcnRpYWxzLCB0cnVlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYodmFsdWUpIHsgLy8gYm9vbGVhbiBzZWN0aW9uCiAgICAgICAgICAgIHJldHVybiB0aGF0LnJlbmRlcihjb250ZW50LCBjb250ZXh0LCBwYXJ0aWFscywgdHJ1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLyoKICAgICAgUmVwbGFjZSB7e2Zvb319IGFuZCBmcmllbmRzIHdpdGggdmFsdWVzIGZyb20gb3VyIHZpZXcKICAgICovCiAgICByZW5kZXJfdGFnczogZnVuY3Rpb24odGVtcGxhdGUsIGNvbnRleHQsIHBhcnRpYWxzLCBpbl9yZWN1cnNpb24pIHsKICAgICAgLy8gdGl0IGZvciB0YXQKICAgICAgdmFyIHRoYXQgPSB0aGlzOwoKICAgICAgdmFyIG5ld19yZWdleCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgUmVnRXhwKHRoYXQub3RhZyArICIoPXwhfD58XFx7fCUpPyhbXlxcLyNcXF5dKz8pXFwxPyIgKwogICAgICAgICAgdGhhdC5jdGFnICsgIisiLCAiZyIpOwogICAgICB9OwoKICAgICAgdmFyIHJlZ2V4ID0gbmV3X3JlZ2V4KCk7CiAgICAgIHZhciB0YWdfcmVwbGFjZV9jYWxsYmFjayA9IGZ1bmN0aW9uKG1hdGNoLCBvcGVyYXRvciwgbmFtZSkgewogICAgICAgIHN3aXRjaChvcGVyYXRvcikgewogICAgICAgIGNhc2UgIiEiOiAvLyBpZ25vcmUgY29tbWVudHMKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICBjYXNlICI9IjogLy8gc2V0IG5ldyBkZWxpbWl0ZXJzLCByZWJ1aWxkIHRoZSByZXBsYWNlIHJlZ2V4cAogICAgICAgICAgdGhhdC5zZXRfZGVsaW1pdGVycyhuYW1lKTsKICAgICAgICAgIHJlZ2V4ID0gbmV3X3JlZ2V4KCk7CiAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgY2FzZSAiPiI6IC8vIHJlbmRlciBwYXJ0aWFsCiAgICAgICAgICByZXR1cm4gdGhhdC5yZW5kZXJfcGFydGlhbChuYW1lLCBjb250ZXh0LCBwYXJ0aWFscyk7CiAgICAgICAgY2FzZSAieyI6IC8vIHRoZSB0cmlwbGUgbXVzdGFjaGUgaXMgdW5lc2NhcGVkCiAgICAgICAgICByZXR1cm4gdGhhdC5maW5kKG5hbWUsIGNvbnRleHQpOwogICAgICAgIGRlZmF1bHQ6IC8vIGVzY2FwZSB0aGUgdmFsdWUKICAgICAgICAgIHJldHVybiB0aGF0LmVzY2FwZSh0aGF0LmZpbmQobmFtZSwgY29udGV4dCkpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIGxpbmVzID0gdGVtcGxhdGUuc3BsaXQoIlxuIik7CiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykgewogICAgICAgIGxpbmVzW2ldID0gbGluZXNbaV0ucmVwbGFjZShyZWdleCwgdGFnX3JlcGxhY2VfY2FsbGJhY2ssIHRoaXMpOwogICAgICAgIGlmKCFpbl9yZWN1cnNpb24pIHsKICAgICAgICAgIHRoaXMuc2VuZChsaW5lc1tpXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZihpbl9yZWN1cnNpb24pIHsKICAgICAgICByZXR1cm4gbGluZXMuam9pbigiXG4iKTsKICAgICAgfQogICAgfSwKCiAgICBzZXRfZGVsaW1pdGVyczogZnVuY3Rpb24oZGVsaW1pdGVycykgewogICAgICB2YXIgZGVscyA9IGRlbGltaXRlcnMuc3BsaXQoIiAiKTsKICAgICAgdGhpcy5vdGFnID0gdGhpcy5lc2NhcGVfcmVnZXgoZGVsc1swXSk7CiAgICAgIHRoaXMuY3RhZyA9IHRoaXMuZXNjYXBlX3JlZ2V4KGRlbHNbMV0pOwogICAgfSwKCiAgICBlc2NhcGVfcmVnZXg6IGZ1bmN0aW9uKHRleHQpIHsKICAgICAgLy8gdGhhbmsgeW91IFNpbW9uIFdpbGxpc29uCiAgICAgIGlmKCFhcmd1bWVudHMuY2FsbGVlLnNSRSkgewogICAgICAgIHZhciBzcGVjaWFscyA9IFsKICAgICAgICAgICcvJywgJy4nLCAnKicsICcrJywgJz8nLCAnfCcsCiAgICAgICAgICAnKCcsICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFwnCiAgICAgICAgXTsKICAgICAgICBhcmd1bWVudHMuY2FsbGVlLnNSRSA9IG5ldyBSZWdFeHAoCiAgICAgICAgICAnKFxcJyArIHNwZWNpYWxzLmpvaW4oJ3xcXCcpICsgJyknLCAnZycKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoYXJndW1lbnRzLmNhbGxlZS5zUkUsICdcXCQxJyk7CiAgICB9LAoKICAgIC8qCiAgICAgIGZpbmQgYG5hbWVgIGluIGN1cnJlbnQgYGNvbnRleHRgLiBUaGF0IGlzIGZpbmQgbWUgYSB2YWx1ZQogICAgICBmcm9tIHRoZSB2aWV3IG9iamVjdAogICAgKi8KICAgIGZpbmQ6IGZ1bmN0aW9uKG5hbWUsIGNvbnRleHQpIHsKICAgICAgbmFtZSA9IHRoaXMudHJpbShuYW1lKTsKCiAgICAgIC8vIENoZWNrcyB3aGV0aGVyIGEgdmFsdWUgaXMgdGhydXRoeSBvciBmYWxzZSBvciAwCiAgICAgIGZ1bmN0aW9uIGlzX2tpbmRhX3RydXRoeShib29sKSB7CiAgICAgICAgcmV0dXJuIGJvb2wgPT09IGZhbHNlIHx8IGJvb2wgPT09IDAgfHwgYm9vbDsKICAgICAgfQoKICAgICAgdmFyIHZhbHVlOwogICAgICBpZihpc19raW5kYV90cnV0aHkoY29udGV4dFtuYW1lXSkpIHsKICAgICAgICB2YWx1ZSA9IGNvbnRleHRbbmFtZV07CiAgICAgIH0gZWxzZSBpZihpc19raW5kYV90cnV0aHkodGhpcy5jb250ZXh0W25hbWVdKSkgewogICAgICAgIHZhbHVlID0gdGhpcy5jb250ZXh0W25hbWVdOwogICAgICB9CgogICAgICBpZih0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICByZXR1cm4gdmFsdWUuYXBwbHkoY29udGV4dCk7CiAgICAgIH0KICAgICAgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgICAvLyBzaWxlbnRseSBpZ25vcmUgdW5rb3duIHZhcmlhYmxlcwogICAgICByZXR1cm4gIiI7CiAgICB9LAoKICAgIC8vIFV0aWxpdHkgbWV0aG9kcwoKICAgIC8qIGluY2x1ZGVzIHRhZyAqLwogICAgaW5jbHVkZXM6IGZ1bmN0aW9uKG5lZWRsZSwgaGF5c3RhY2spIHsKICAgICAgcmV0dXJuIGhheXN0YWNrLmluZGV4T2YodGhpcy5vdGFnICsgbmVlZGxlKSAhPSAtMTsKICAgIH0sCgogICAgLyoKICAgICAgRG9lcyBhd2F5IHdpdGggbmFzdHkgY2hhcmFjdGVycwogICAgKi8KICAgIGVzY2FwZTogZnVuY3Rpb24ocykgewogICAgICBzID0gU3RyaW5nKHMgPT09IG51bGwgPyAiIiA6IHMpOwogICAgICByZXR1cm4gcy5yZXBsYWNlKC8mKD8hXHcrOyl8WyI8PlxcXS9nLCBmdW5jdGlvbihzKSB7CiAgICAgICAgc3dpdGNoKHMpIHsKICAgICAgICBjYXNlICImIjogcmV0dXJuICImYW1wOyI7CiAgICAgICAgY2FzZSAiXFwiOiByZXR1cm4gIlxcXFwiOwogICAgICAgIGNhc2UgJyInOiByZXR1cm4gJ1wiJzsKICAgICAgICBjYXNlICI8IjogcmV0dXJuICImbHQ7IjsKICAgICAgICBjYXNlICI+IjogcmV0dXJuICImZ3Q7IjsKICAgICAgICBkZWZhdWx0OiByZXR1cm4gczsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBieSBAbGFuZ2FsZXgsIHN1cHBvcnQgZm9yIGFycmF5cyBvZiBzdHJpbmdzCiAgICBjcmVhdGVfY29udGV4dDogZnVuY3Rpb24oX2NvbnRleHQpIHsKICAgICAgaWYodGhpcy5pc19vYmplY3QoX2NvbnRleHQpKSB7CiAgICAgICAgcmV0dXJuIF9jb250ZXh0OwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBpdGVyYXRvciA9ICIuIjsKICAgICAgICBpZih0aGlzLnByYWdtYXNbIklNUExJQ0lULUlURVJBVE9SIl0pIHsKICAgICAgICAgIGl0ZXJhdG9yID0gdGhpcy5wcmFnbWFzWyJJTVBMSUNJVC1JVEVSQVRPUiJdLml0ZXJhdG9yOwogICAgICAgIH0KICAgICAgICB2YXIgY3R4ID0ge307CiAgICAgICAgY3R4W2l0ZXJhdG9yXSA9IF9jb250ZXh0OwogICAgICAgIHJldHVybiBjdHg7CiAgICAgIH0KICAgIH0sCgogICAgaXNfb2JqZWN0OiBmdW5jdGlvbihhKSB7CiAgICAgIHJldHVybiBhICYmIHR5cGVvZiBhID09ICJvYmplY3QiOwogICAgfSwKCiAgICBpc19hcnJheTogZnVuY3Rpb24oYSkgewogICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpID09PSAnW29iamVjdCBBcnJheV0nOwogICAgfSwKCiAgICAvKgogICAgICBHZXRzIHJpZCBvZiBsZWFkaW5nIGFuZCB0cmFpbGluZyB3aGl0ZXNwYWNlCiAgICAqLwogICAgdHJpbTogZnVuY3Rpb24ocykgewogICAgICByZXR1cm4gcy5yZXBsYWNlKC9eXHMqfFxzKiQvZywgIiIpOwogICAgfSwKCiAgICAvKgogICAgICBXaHksIHdoeSwgd2h5PyBCZWNhdXNlIElFLiBDcnksIGNyeSBjcnkuCiAgICAqLwogICAgbWFwOiBmdW5jdGlvbihhcnJheSwgZm4pIHsKICAgICAgaWYgKHR5cGVvZiBhcnJheS5tYXAgPT0gImZ1bmN0aW9uIikgewogICAgICAgIHJldHVybiBhcnJheS5tYXAoZm4pOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciByID0gW107CiAgICAgICAgdmFyIGwgPSBhcnJheS5sZW5ndGg7CiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGw7IGkrKykgewogICAgICAgICAgci5wdXNoKGZuKGFycmF5W2ldKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgICB9CiAgICB9CiAgfTsKCiAgcmV0dXJuKHsKICAgIG5hbWU6ICJtdXN0YWNoZS5qcyIsCiAgICB2ZXJzaW9uOiAiMC4zLjEtZGV2IiwKCiAgICAvKgogICAgICBUdXJucyBhIHRlbXBsYXRlIGFuZCB2aWV3IGludG8gSFRNTAogICAgKi8KICAgIHRvX2h0bWw6IGZ1bmN0aW9uKHRlbXBsYXRlLCB2aWV3LCBwYXJ0aWFscywgc2VuZF9mdW4pIHsKICAgICAgdmFyIHJlbmRlcmVyID0gbmV3IFJlbmRlcmVyKCk7CiAgICAgIGlmKHNlbmRfZnVuKSB7CiAgICAgICAgcmVuZGVyZXIuc2VuZCA9IHNlbmRfZnVuOwogICAgICB9CiAgICAgIHJlbmRlcmVyLnJlbmRlcih0ZW1wbGF0ZSwgdmlldywgcGFydGlhbHMpOwogICAgICBpZighc2VuZF9mdW4pIHsKICAgICAgICByZXR1cm4gcmVuZGVyZXIuYnVmZmVyLmpvaW4oIlxuIik7CiAgICAgIH0KICAgIH0sCiAgICBlc2NhcGUgOiBmdW5jdGlvbih0ZXh0KSB7CiAgICAgIHJldHVybiBuZXcgUmVuZGVyZXIoKS5lc2NhcGUodGV4dCk7CiAgICB9CiAgfSk7Cn0oKTsKCiAgJC5tdXN0YWNoZSA9IGZ1bmN0aW9uKHRlbXBsYXRlLCB2aWV3LCBwYXJ0aWFscykgewogICAgcmV0dXJuIE11c3RhY2hlLnRvX2h0bWwodGVtcGxhdGUsIHZpZXcsIHBhcnRpYWxzKTsKICB9OwoKICAkLm11c3RhY2hlLmVzY2FwZSA9IGZ1bmN0aW9uKHRleHQpIHsKICAgIHJldHVybiBNdXN0YWNoZS5lc2NhcGUodGV4dCk7CiAgfTsKCn0pKGpRdWVyeSk7Cg==","content_type":"application/javascript","revpos":1},"vendor/couchapp/jquery.couch.app.js":{"data":"Ly8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90Ci8vIHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weQovLyBvZiB0aGUgTGljZW5zZSBhdAovLwovLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAovLwovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQKLy8gV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZQovLyBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlcgovLyB0aGUgTGljZW5zZS4KCi8vIFVzYWdlOiBUaGUgcGFzc2VkIGluIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHRoZSBwYWdlIGlzIHJlYWR5LgovLyBDb3VjaEFwcCBwYXNzZXMgaW4gdGhlIGFwcCBvYmplY3QsIHdoaWNoIHRha2VzIGNhcmUgb2YgbGlua2luZyB0byAKLy8gdGhlIHByb3BlciBkYXRhYmFzZSwgYW5kIHByb3ZpZGVzIGFjY2VzcyB0byB0aGUgQ291Y2hBcHAgaGVscGVycy4KLy8gJC5jb3VjaC5hcHAoZnVuY3Rpb24oYXBwKSB7Ci8vICAgIGFwcC5kYi52aWV3KC4uLikKLy8gICAgLi4uCi8vIH0pOwoKKGZ1bmN0aW9uKCQpIHsKCiAgZnVuY3Rpb24gRGVzaWduKGRiLCBuYW1lLCBjb2RlKSB7CiAgICB0aGlzLmRvY19pZCA9ICJfZGVzaWduLyIrbmFtZTsKICAgIGlmIChjb2RlKSB7CiAgICAgIHRoaXMuY29kZV9wYXRoID0gdGhpcy5kb2NfaWQgKyAiLyIgKyBjb2RlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jb2RlX3BhdGggPSB0aGlzLmRvY19pZDsKICAgIH0KICAgIHRoaXMudmlldyA9IGZ1bmN0aW9uKHZpZXcsIG9wdHMpIHsKICAgICAgaWYgKHZpZXcuaW5kZXhPZignLycpID09PSAtMSkgewogICAgICAgIGRiLnZpZXcobmFtZSsnLycrdmlldywgb3B0cyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGIudmlldyh2aWV3LCBvcHRzKTsKICAgICAgfQogICAgfTsKICAgIHRoaXMubGlzdCA9IGZ1bmN0aW9uKGxpc3QsIHZpZXcsIG9wdHMpIHsKICAgICAgZGIubGlzdChuYW1lKycvJytsaXN0LCB2aWV3LCBvcHRzKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBkb2NGb3JtKCkgeyBhbGVydCgiZG9jRm9ybSBoYXMgYmVlbiBtb3ZlZCB0byB2ZW5kb3IvY291Y2hhcHAvbGliL2RvY0Zvcm0uanMsIHVzZSBhcHAucmVxdWlyZSB0byBsb2FkIikgfTsKCiAgZnVuY3Rpb24gcmVzb2x2ZU1vZHVsZShwYXRoLCBuYW1lcywgcGFyZW50cywgY3VycmVudCkgewogICAgcGFyZW50cyA9IHBhcmVudHMgfHwgW107CiAgICBpZiAobmFtZXMubGVuZ3RoID09PSAwKSB7CiAgICAgIGlmICh0eXBlb2YgY3VycmVudCAhPSAic3RyaW5nIikgewogICAgICAgIHRocm93IFsiZXJyb3IiLCJpbnZhbGlkX3JlcXVpcmVfcGF0aCIsCiAgICAgICAgICAnTXVzdCByZXF1aXJlIGEgSmF2YVNjcmlwdCBzdHJpbmcsIG5vdDogJysodHlwZW9mIGN1cnJlbnQpXTsKICAgICAgfQogICAgICByZXR1cm4gW2N1cnJlbnQsIHBhcmVudHNdOwogICAgfQogICAgdmFyIG4gPSBuYW1lcy5zaGlmdCgpOwogICAgaWYgKG4gPT0gJy4uJykgewogICAgICBwYXJlbnRzLnBvcCgpOwogICAgICB2YXIgcHAgPSBwYXJlbnRzLnBvcCgpOwogICAgICBpZiAoIXBwKSB7CiAgICAgICAgdGhyb3cgWyJlcnJvciIsICJpbnZhbGlkX3JlcXVpcmVfcGF0aCIsIHBhdGhdOwogICAgICB9CiAgICAgIHJldHVybiByZXNvbHZlTW9kdWxlKHBhdGgsIG5hbWVzLCBwYXJlbnRzLCBwcCk7CiAgICB9IGVsc2UgaWYgKG4gPT0gJy4nKSB7CiAgICAgIHZhciBwID0gcGFyZW50cy5wb3AoKTsKICAgICAgaWYgKCFwKSB7CiAgICAgICAgdGhyb3cgWyJlcnJvciIsICJpbnZhbGlkX3JlcXVpcmVfcGF0aCIsIHBhdGhdOwogICAgICB9CiAgICAgIHJldHVybiByZXNvbHZlTW9kdWxlKHBhdGgsIG5hbWVzLCBwYXJlbnRzLCBwKTsKICAgIH0gZWxzZSB7CiAgICAgIHBhcmVudHMgPSBbXTsKICAgIH0KICAgIGlmICghY3VycmVudFtuXSkgewogICAgICB0aHJvdyBbImVycm9yIiwgImludmFsaWRfcmVxdWlyZV9wYXRoIiwgcGF0aF07CiAgICB9CiAgICBwYXJlbnRzLnB1c2goY3VycmVudCk7CiAgICByZXR1cm4gcmVzb2x2ZU1vZHVsZShwYXRoLCBuYW1lcywgcGFyZW50cywgY3VycmVudFtuXSk7CiAgfQoKICBmdW5jdGlvbiBtYWtlUmVxdWlyZShkZG9jKSB7CiAgICB2YXIgbW9kdWxlQ2FjaGUgPSBbXTsKICAgIGZ1bmN0aW9uIGdldENhY2hlZE1vZHVsZShuYW1lLCBwYXJlbnRzKSB7CiAgICAgIHZhciBrZXksIGksIGxlbiA9IG1vZHVsZUNhY2hlLmxlbmd0aDsKICAgICAgZm9yIChpPTA7aTxsZW47KytpKSB7CiAgICAgICAga2V5ID0gbW9kdWxlQ2FjaGVbaV0ua2V5OwogICAgICAgIGlmIChrZXlbMF0gPT09IG5hbWUgJiYga2V5WzFdID09PSBwYXJlbnRzKSB7CiAgICAgICAgICByZXR1cm4gbW9kdWxlQ2FjaGVbaV0ubW9kdWxlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGZ1bmN0aW9uIHNldENhY2hlZE1vZHVsZShuYW1lLCBwYXJlbnRzLCBtb2R1bGUpIHsKICAgICAgbW9kdWxlQ2FjaGUucHVzaCh7IGtleTogW25hbWUsIHBhcmVudHNdLCBtb2R1bGU6IG1vZHVsZSB9KTsKICAgIH0KICAgIHZhciByZXF1aXJlID0gZnVuY3Rpb24gKG5hbWUsIHBhcmVudHMpIHsKICAgICAgdmFyIGNhY2hlZE1vZHVsZSA9IGdldENhY2hlZE1vZHVsZShuYW1lLCBwYXJlbnRzKTsKICAgICAgaWYgKGNhY2hlZE1vZHVsZSAhPT0gbnVsbCkgewogICAgICAgIHJldHVybiBjYWNoZWRNb2R1bGU7CiAgICAgIH0KICAgICAgdmFyIGV4cG9ydHMgPSB7fTsKICAgICAgdmFyIHJlc29sdmVkID0gcmVzb2x2ZU1vZHVsZShuYW1lLCBuYW1lLnNwbGl0KCcvJyksIHBhcmVudHMsIGRkb2MpOwogICAgICB2YXIgc291cmNlID0gcmVzb2x2ZWRbMF07IAogICAgICBwYXJlbnRzID0gcmVzb2x2ZWRbMV07CiAgICAgIHZhciBzID0gInZhciBmdW5jID0gZnVuY3Rpb24gKGV4cG9ydHMsIHJlcXVpcmUpIHsgIiArIHNvdXJjZSArICIgfTsiOwogICAgICB0cnkgewogICAgICAgIGV2YWwocyk7CiAgICAgICAgZnVuYy5hcHBseShkZG9jLCBbZXhwb3J0cywgZnVuY3Rpb24obmFtZSkge3JldHVybiByZXF1aXJlKG5hbWUsIHBhcmVudHMpfV0pOwogICAgICB9IGNhdGNoKGUpIHsgCiAgICAgICAgdGhyb3cgWyJlcnJvciIsImNvbXBpbGF0aW9uX2Vycm9yIiwiTW9kdWxlIHJlcXVpcmUoJyIrbmFtZSsiJykgcmFpc2VkIGVycm9yICIrZS50b1NvdXJjZSgpXTsgCiAgICAgIH0KICAgICAgc2V0Q2FjaGVkTW9kdWxlKG5hbWUsIHBhcmVudHMsIGV4cG9ydHMpOwogICAgICByZXR1cm4gZXhwb3J0czsKICAgIH0KICAgIHJldHVybiByZXF1aXJlOwogIH07CgogIGZ1bmN0aW9uIG1vY2tSZXEoKSB7CiAgICB2YXIgcCA9IGRvY3VtZW50LmxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJyksCiAgICAgIHFzID0gZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoLnJlcGxhY2UoL15cPy8sJycpLnNwbGl0KCcmJyksCiAgICAgIHEgPSB7fTsKICAgIHFzLmZvckVhY2goZnVuY3Rpb24ocGFyYW0pIHsKICAgICAgdmFyIHBzID0gcGFyYW0uc3BsaXQoJz0nKSwKICAgICAgICBrID0gZGVjb2RlVVJJQ29tcG9uZW50KHBzWzBdKSwKICAgICAgICB2ID0gZGVjb2RlVVJJQ29tcG9uZW50KHBzWzFdKTsKICAgICAgaWYgKFsic3RhcnRrZXkiLCAiZW5ka2V5IiwgImtleSJdLmluZGV4T2YoaykgIT0gLTEpIHsKICAgICAgICBxW2tdID0gSlNPTi5wYXJzZSh2KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBxW2tdID0gdjsKICAgICAgfQogICAgfSk7CiAgICBwLnNoaWZ0KCk7CiAgICByZXR1cm4gewogICAgICBwYXRoIDogcCwKICAgICAgcXVlcnkgOiBxCiAgICB9OwogIH07CgogICQuY291Y2guYXBwID0gJC5jb3VjaC5hcHAgfHwgZnVuY3Rpb24oYXBwRnVuLCBvcHRzKSB7CiAgICBvcHRzID0gb3B0cyB8fCB7fTsKICAgIHZhciB1cmxQcmVmaXggPSAob3B0cy51cmxQcmVmaXggfHwgIiIpLAogICAgICBpbmRleCA9IHVybFByZWZpeC5zcGxpdCgnLycpLmxlbmd0aCwKICAgICAgZnJhZ21lbnRzID0gdW5lc2NhcGUoZG9jdW1lbnQubG9jYXRpb24uaHJlZikuc3BsaXQoJy8nKSwKICAgICAgZGJuYW1lID0gb3B0cy5kYiB8fCBmcmFnbWVudHNbaW5kZXggKyAyXSwKICAgICAgZG5hbWUgPSBvcHRzLmRlc2lnbiB8fCBmcmFnbWVudHNbaW5kZXggKyA0XTsKICAgICQuY291Y2gudXJsUHJlZml4ID0gdXJsUHJlZml4OwogICAgdmFyIGRiID0gJC5jb3VjaC5kYihkYm5hbWUpLAogICAgICBkZXNpZ24gPSBuZXcgRGVzaWduKGRiLCBkbmFtZSwgb3B0cy5sb2FkX3BhdGgpOwogICAgdmFyIGFwcEV4cG9ydHMgPSAkLmV4dGVuZCh7CiAgICAgIGRiIDogZGIsCiAgICAgIGRlc2lnbiA6IGRlc2lnbiwKICAgICAgdmlldyA6IGRlc2lnbi52aWV3LAogICAgICBsaXN0IDogZGVzaWduLmxpc3QsCiAgICAgIGRvY0Zvcm0gOiBkb2NGb3JtLCAvLyBkZXByZWNhdGVkCiAgICAgIHJlcSA6IG1vY2tSZXEoKQogICAgfSwgJC5jb3VjaC5hcHAuYXBwKTsKICAgIGZ1bmN0aW9uIGhhbmRsZUREb2MoZGRvYykgeyAgICAgICAgCiAgICAgIGlmIChkZG9jKSB7CiAgICAgICAgYXBwRXhwb3J0cy5kZG9jID0gZGRvYzsKICAgICAgICBhcHBFeHBvcnRzLnJlcXVpcmUgPSBtYWtlUmVxdWlyZShkZG9jKTsKICAgICAgfQogICAgICBhcHBGdW4uYXBwbHkoYXBwRXhwb3J0cywgW2FwcEV4cG9ydHNdKTsKICAgIH0KICAgIGlmIChvcHRzLmRkb2MpIHsKICAgICAgLy8gYWxsb3cgdGhlIGRkb2MgdG8gYmUgZW1iZWRkZWQgaW4gdGhlIGh0bWwKICAgICAgLy8gdG8gYXZvaWQgYSBzZWNvbmQgaHR0cCByZXF1ZXN0CiAgICAgICQuY291Y2guYXBwLmRkb2NzW2Rlc2lnbi5kb2NfaWRdID0gb3B0cy5kZG9jOwogICAgfQogICAgaWYgKCQuY291Y2guYXBwLmRkb2NzW2Rlc2lnbi5kb2NfaWRdKSB7CiAgICAgICQoZnVuY3Rpb24oKSB7aGFuZGxlRERvYygkLmNvdWNoLmFwcC5kZG9jc1tkZXNpZ24uZG9jX2lkXSl9KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIG9ubHkgb3BlbiAxIGNvbm5lY3Rpb24gZm9yIHRoaXMgZGRvYyAKICAgICAgaWYgKCQuY291Y2guYXBwLmRkb2NfaGFuZGxlcnNbZGVzaWduLmRvY19pZF0pIHsKICAgICAgICAvLyB3ZSBhcmUgYWxyZWFkeSBmZXRjaGluZywganVzdCB3YWl0CiAgICAgICAgJC5jb3VjaC5hcHAuZGRvY19oYW5kbGVyc1tkZXNpZ24uZG9jX2lkXS5wdXNoKGhhbmRsZUREb2MpOwogICAgICB9IGVsc2UgewogICAgICAgICQuY291Y2guYXBwLmRkb2NfaGFuZGxlcnNbZGVzaWduLmRvY19pZF0gPSBbaGFuZGxlRERvY107CiAgICAgICAgLy8gdXNlIGdldERiUHJvcGVydHkgdG8gYnlwYXNzICUyRiBlbmNvZGluZyBvbiBfc2hvdy9hcHAKICAgICAgICBkYi5nZXREYlByb3BlcnR5KGRlc2lnbi5jb2RlX3BhdGgsIHsKICAgICAgICAgIHN1Y2Nlc3MgOiBmdW5jdGlvbihkb2MpIHsKICAgICAgICAgICAgJC5jb3VjaC5hcHAuZGRvY3NbZGVzaWduLmRvY19pZF0gPSBkb2M7CiAgICAgICAgICAgICQuY291Y2guYXBwLmRkb2NfaGFuZGxlcnNbZGVzaWduLmRvY19pZF0uZm9yRWFjaChmdW5jdGlvbihoKSB7CiAgICAgICAgICAgICAgJChmdW5jdGlvbigpIHtoKGRvYyl9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQuY291Y2guYXBwLmRkb2NfaGFuZGxlcnNbZGVzaWduLmRvY19pZF0gPSBudWxsOwogICAgICAgICAgfSwKICAgICAgICAgIGVycm9yIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICQuY291Y2guYXBwLmRkb2NfaGFuZGxlcnNbZGVzaWduLmRvY19pZF0uZm9yRWFjaChmdW5jdGlvbihoKSB7CiAgICAgICAgICAgICAgJChmdW5jdGlvbigpIHtoKCl9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQuY291Y2guYXBwLmRkb2NfaGFuZGxlcnNbZGVzaWduLmRvY19pZF0gPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfTsKICAkLmNvdWNoLmFwcC5kZG9jcyA9IHt9OwogICQuY291Y2guYXBwLmRkb2NfaGFuZGxlcnMgPSB7fTsKICAvLyBsZWdhY3kgc3VwcG9ydC4gJC5Db3VjaEFwcCBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlICQuY291Y2guYXBwCiAgJC5Db3VjaEFwcCA9ICQuY291Y2guYXBwOwp9KShqUXVlcnkpOwoKLy8gSmF2YVNjcmlwdCAxLjYgY29tcGF0aWJpbGl0eSBmdW5jdGlvbnMgdGhhdCBhcmUgbWlzc2luZyBmcm9tIElFNy9JRTgKCmlmICghQXJyYXkucHJvdG90eXBlLmZvckVhY2gpCnsKICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24oZnVuIC8qLCB0aGlzcCovKQogICAgewogICAgICAgIHZhciBsZW4gPSB0aGlzLmxlbmd0aCA+Pj4gMDsKICAgICAgICBpZiAodHlwZW9mIGZ1biAhPSAiZnVuY3Rpb24iKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CgogICAgICAgIHZhciB0aGlzcCA9IGFyZ3VtZW50c1sxXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGkgaW4gdGhpcykKICAgICAgICAgICAgICAgIGZ1bi5jYWxsKHRoaXNwLCB0aGlzW2ldLCBpLCB0aGlzKTsKICAgICAgICB9CiAgICB9Owp9CgppZiAoIUFycmF5LnByb3RvdHlwZS5pbmRleE9mKQp7CiAgICBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uKGVsdCkKICAgIHsKICAgICAgICB2YXIgbGVuID0gdGhpcy5sZW5ndGggPj4+IDA7CgogICAgICAgIHZhciBmcm9tID0gTnVtYmVyKGFyZ3VtZW50c1sxXSkgfHwgMDsKICAgICAgICBmcm9tID0gKGZyb20gPCAwKQogICAgICAgICAgICAgICAgPyBNYXRoLmNlaWwoZnJvbSkKICAgICAgICAgICAgICAgIDogTWF0aC5mbG9vcihmcm9tKTsKICAgICAgICBpZiAoZnJvbSA8IDApCiAgICAgICAgICAgIGZyb20gKz0gbGVuOwoKICAgICAgICBmb3IgKDsgZnJvbSA8IGxlbjsgZnJvbSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGZyb20gaW4gdGhpcyAmJgogICAgICAgICAgICAgICAgdGhpc1tmcm9tXSA9PT0gZWx0KQogICAgICAgICAgICAgICAgcmV0dXJuIGZyb207CiAgICAgICAgfQogICAgICAgIHJldHVybiAtMTsKICAgIH07Cn0K","content_type":"application/javascript","revpos":1},"vendor/couchapp/jquery.couch.app.util.js":{"data":"JC5sb2cgPSBmdW5jdGlvbihtKSB7CiAgaWYgKHdpbmRvdyAmJiB3aW5kb3cuY29uc29sZSAmJiB3aW5kb3cuY29uc29sZS5sb2cpIHsKICAgIHdpbmRvdy5jb25zb2xlLmxvZyhhcmd1bWVudHMubGVuZ3RoID09IDEgPyBtIDogYXJndW1lbnRzKTsKICB9Cn07CgovLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExODQ2MjQvc2VyaWFsaXplLWZvcm0tdG8tanNvbi13aXRoLWpxdWVyeS8xMTg2MzA5IzExODYzMDkKJC5mbi5zZXJpYWxpemVPYmplY3QgPSBmdW5jdGlvbigpIHsKICAgIHZhciBvID0ge307CiAgICB2YXIgYSA9IHRoaXMuc2VyaWFsaXplQXJyYXkoKTsKICAgICQuZWFjaChhLCBmdW5jdGlvbigpIHsKICAgICAgICBpZiAob1t0aGlzLm5hbWVdKSB7CiAgICAgICAgICAgIGlmICghb1t0aGlzLm5hbWVdLnB1c2gpIHsKICAgICAgICAgICAgICAgIG9bdGhpcy5uYW1lXSA9IFtvW3RoaXMubmFtZV1dOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9bdGhpcy5uYW1lXS5wdXNoKHRoaXMudmFsdWUgfHwgJycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG9bdGhpcy5uYW1lXSA9IHRoaXMudmFsdWUgfHwgJyc7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbzsKfTsKCi8vIHRvZG8gcmVtb3ZlIHRoaXMgY3JhcApmdW5jdGlvbiBlc2NhcGVIVE1MKHN0KSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgcmV0dXJuKCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBzdCAmJiBzdC5yZXBsYWNlKC8mL2csJyZhbXA7JykuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgcmVwbGFjZSgvPi9nLCcmZ3Q7JykuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICByZXBsYWNlKC88L2csJyZsdDsnKS4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgIHJlcGxhY2UoLyIvZywnJnF1b3Q7JykgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCn07CgpmdW5jdGlvbiBzYWZlSFRNTChzdCwgbGVuKSB7CiAgcmV0dXJuIHN0ID8gZXNjYXBlSFRNTChzdC5zdWJzdHJpbmcoMCxsZW4pKSA6ICcnOwp9CgovLyB0b2RvIHRoaXMgc2hvdWxkIHRha2UgYSByZXBsYWNlbWVudCB0ZW1wbGF0ZQokLmxpbmtpZnkgPSBmdW5jdGlvbihib2R5KSB7CiAgcmV0dXJuIGJvZHkucmVwbGFjZSgvKChmdHB8aHR0cHxodHRwcyk6XC9cLyhcdys6ezAsMX1cdypAKT8oXFMrKSg6WzAtOV0rKT8oXC98XC8oW1x3IyE6Lj8rPSYlQCFcLVwvXSkpPykvZ2ksZnVuY3Rpb24oYSkgewogICAgcmV0dXJuICc8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJythKyciPicrYSsnPC9hPic7CiAgfSkucmVwbGFjZSgvXEAoW1x3XC1dKykvZyxmdW5jdGlvbih1c2VyLG5hbWUpIHsKICAgIHJldHVybiAnPGEgaHJlZj0iIy9tZW50aW9ucy8nK2VuY29kZVVSSUNvbXBvbmVudChuYW1lLnRvTG93ZXJDYXNlKCkpKyciPicrdXNlcisnPC9hPic7CiAgfSkucmVwbGFjZSgvXCMoW1x3XC1cLl0rKS9nLGZ1bmN0aW9uKHdvcmQsdGFnKSB7CiAgICByZXR1cm4gJzxhIGhyZWY9IiMvdGFncy8nK2VuY29kZVVSSUNvbXBvbmVudCh0YWcudG9Mb3dlckNhc2UoKSkrJyI+Jyt3b3JkKyc8L2E+JzsKICB9KTsKfTsKCiQuZm4ucHJldHR5RGF0ZSA9IGZ1bmN0aW9uKCkgewogICQodGhpcykuZWFjaChmdW5jdGlvbigpIHsKICAgIHZhciBzdHJpbmcsIHRpdGxlID0gJCh0aGlzKS5hdHRyKCJ0aXRsZSIpOwogICAgaWYgKHRpdGxlKSB7CiAgICAgIHN0cmluZyA9ICQucHJldHR5RGF0ZSh0aXRsZSk7CiAgICB9IGVsc2UgewogICAgICBzdHJpbmcgPSAkLnByZXR0eURhdGUoJCh0aGlzKS50ZXh0KCkpOwogICAgfQogICAgJCh0aGlzKS50ZXh0KHN0cmluZyk7CiAgfSk7Cn07CgokLnByZXR0eURhdGUgPSBmdW5jdGlvbih0aW1lKXsKICAKCXZhciBkYXRlID0gbmV3IERhdGUodGltZS5yZXBsYWNlKC8tL2csIi8iKS5yZXBsYWNlKCJUIiwgIiAiKS5yZXBsYWNlKCJaIiwgIiArMDAwMCIpLnJlcGxhY2UoLyhcZCpcOlxkKjpcZCopXC5cZCovZywiJDEiKSksCgkJZGlmZiA9ICgoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIGRhdGUuZ2V0VGltZSgpKSAvIDEwMDApLAoJCWRheV9kaWZmID0gTWF0aC5mbG9vcihkaWZmIC8gODY0MDApOwoKICBpZiAoaXNOYU4oZGF5X2RpZmYpKSByZXR1cm4gdGltZTsKCglyZXR1cm4gZGF5X2RpZmYgPCAxICYmICgKCQkJZGlmZiA8IDYwICYmICJqdXN0IG5vdyIgfHwKCQkJZGlmZiA8IDEyMCAmJiAiMSBtaW51dGUgYWdvIiB8fAoJCQlkaWZmIDwgMzYwMCAmJiBNYXRoLmZsb29yKCBkaWZmIC8gNjAgKSArICIgbWludXRlcyBhZ28iIHx8CgkJCWRpZmYgPCA3MjAwICYmICIxIGhvdXIgYWdvIiB8fAoJCQlkaWZmIDwgODY0MDAgJiYgTWF0aC5mbG9vciggZGlmZiAvIDM2MDAgKSArICIgaG91cnMgYWdvIikgfHwKCQlkYXlfZGlmZiA9PSAxICYmICJ5ZXN0ZXJkYXkiIHx8CgkJZGF5X2RpZmYgPCAyMSAmJiBkYXlfZGlmZiArICIgZGF5cyBhZ28iIHx8CgkJZGF5X2RpZmYgPCA0NSAmJiBNYXRoLmNlaWwoIGRheV9kaWZmIC8gNyApICsgIiB3ZWVrcyBhZ28iIHx8CiAgICB0aW1lOwogICAgLy8gZGF5X2RpZmYgPCA3MzAgJiYgTWF0aC5jZWlsKCBkYXlfZGlmZiAvIDMxICkgKyAiIG1vbnRocyBhZ28iIHx8CiAgICAvLyBNYXRoLmNlaWwoIGRheV9kaWZmIC8gMzY1ICkgKyAiIHllYXJzIGFnbyI7Cn07CgokLmFyZ3NUb0FycmF5ID0gZnVuY3Rpb24oYXJncykgewogIGlmICghYXJncy5jYWxsZWUpIHJldHVybiBhcmdzOwogIHZhciBhcnJheSA9IFtdOwogIGZvciAodmFyIGk9MDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHsKICAgIGFycmF5LnB1c2goYXJnc1tpXSk7CiAgfTsKICByZXR1cm4gYXJyYXk7Cn0K","content_type":"application/javascript","revpos":1},"vendor/couchapp/loader.js":{"data":"CmZ1bmN0aW9uIGNvdWNoYXBwX2xvYWQoc2NyaXB0cykgewogIGZvciAodmFyIGk9MDsgaSA8IHNjcmlwdHMubGVuZ3RoOyBpKyspIHsKICAgIGRvY3VtZW50LndyaXRlKCc8c2NyaXB0IHNyYz0iJytzY3JpcHRzW2ldKyciPjxcL3NjcmlwdD4nKQogIH07Cn07Cgpjb3VjaGFwcF9sb2FkKFsKICAiL191dGlscy9zY3JpcHQvc2hhMS5qcyIsCiAgIi9fdXRpbHMvc2NyaXB0L2pzb24yLmpzIiwKICAiL191dGlscy9zY3JpcHQvanF1ZXJ5LmpzIiwKICAiL191dGlscy9zY3JpcHQvanF1ZXJ5LmNvdWNoLmpzIiwKICAidmVuZG9yL2NvdWNoYXBwL2pxdWVyeS5jb3VjaC5hcHAuanMiLAogICJ2ZW5kb3IvY291Y2hhcHAvanF1ZXJ5LmNvdWNoLmFwcC51dGlsLmpzIiwKICAidmVuZG9yL2NvdWNoYXBwL2pxdWVyeS5tdXN0YWNoZS5qcyIsCiAgInZlbmRvci9jb3VjaGFwcC9qcXVlcnkuZXZlbnRseS5qcyIKXSk7Cg==","content_type":"application/javascript","revpos":1},"vendor/couchapp/jquery.pathbinder.js":{"data":"KGZ1bmN0aW9uKCQpIHsKICAvLyBmdW5jdGlvbnMgZm9yIGhhbmRsaW5nIHRoZSBwYXRoCiAgLy8gdGhhbmtzIHNhbW15LmpzCiAgdmFyIFBBVEhfUkVQTEFDRVIgPSAiKFteXC9dKykiLAogICAgICBQQVRIX05BTUVfTUFUQ0hFUiA9IC86KFtcd1xkXSspL2csCiAgICAgIFFVRVJZX1NUUklOR19NQVRDSEVSID0gL1w/KFteI10qKSQvLAogICAgICBTUExBVF9NQVRDSEVSID0gLyhcKikvLAogICAgICBTUExBVF9SRVBMQUNFUiA9ICIoLispIiwKICAgICAgX2N1cnJlbnRQYXRoLAogICAgICBfbGFzdFBhdGgsCiAgICAgIF9wYXRoSW50ZXJ2YWw7CgogIGZ1bmN0aW9uIGhhc2hDaGFuZ2VkKCkgewogICAgX2N1cnJlbnRQYXRoID0gZ2V0UGF0aCgpOwogICAgLy8gaWYgcGF0aCBpcyBhY3R1YWxseSBjaGFuZ2VkIGZyb20gd2hhdCB3ZSB0aG91Z2h0IGl0IHdhcywgdGhlbiByZWFjdAogICAgaWYgKF9sYXN0UGF0aCAhPSBfY3VycmVudFBhdGgpIHsKICAgICAgX2xhc3RQYXRoID0gX2N1cnJlbnRQYXRoOwogICAgICByZXR1cm4gdHJpZ2dlck9uUGF0aChfY3VycmVudFBhdGgpOwogICAgfQogIH0KICAKICAkLnBhdGhiaW5kZXIgPSB7CiAgICBjaGFuZ2VGdW5zIDogW10sCiAgICBwYXRocyA6IFtdLAogICAgYmVnaW4gOiBmdW5jdGlvbihkZWZhdWx0UGF0aCkgewogICAgICAvLyB0aGlzIHNob3VsZCB0cmlnZ2VyIHRoZSBkZWZhdWx0UGF0aCBpZiB0aGVyZSdzIG5vdCBhIHBhdGggaW4gdGhlIFVSTAogICAgICAvLyBvdGhlcndpc2UgaXQgc2hvdWxkIHRyaWdnZXIgdGhlIFVSTCdzIHBhdGgKICAgICAgJChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbG9hZFBhdGggPSBnZXRQYXRoKCk7CiAgICAgICAgaWYgKGxvYWRQYXRoKSB7CiAgICAgICAgICB0cmlnZ2VyT25QYXRoKGxvYWRQYXRoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZ29QYXRoKGRlZmF1bHRQYXRoKTsgICAgICAgICAgCiAgICAgICAgICB0cmlnZ2VyT25QYXRoKGRlZmF1bHRQYXRoKTsKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgZ28gOiBmdW5jdGlvbihwYXRoKSB7CiAgICAgIGdvUGF0aChwYXRoKTsKICAgICAgdHJpZ2dlck9uUGF0aChwYXRoKTsKICAgIH0sCiAgICBjdXJyZW50UGF0aCA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZ2V0UGF0aCgpOwogICAgfSwKICAgIG9uQ2hhbmdlIDogZnVuY3Rpb24gKGZ1bikgewogICAgICAkLnBhdGhiaW5kZXIuY2hhbmdlRnVucy5wdXNoKGZ1bik7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gcG9sbFBhdGgoZXZlcnkpIHsKICAgIGZ1bmN0aW9uIGhhc2hDaGVjaygpIHsgICAgICAgIAogICAgICBfY3VycmVudFBhdGggPSBnZXRQYXRoKCk7CiAgICAgIC8vIHBhdGggY2hhbmdlZCBpZiBfY3VycmVudFBhdGggIT0gX2xhc3RQYXRoCiAgICAgIGlmIChfbGFzdFBhdGggIT0gX2N1cnJlbnRQYXRoKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICQod2luZG93KS50cmlnZ2VyKCdoYXNoY2hhbmdlJyk7CiAgICAgICAgfSwgMSk7CiAgICAgIH0KICAgIH07CiAgICBoYXNoQ2hlY2soKTsKICAgIF9wYXRoSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChoYXNoQ2hlY2ssIGV2ZXJ5KTsKICAgICQod2luZG93KS5iaW5kKCd1bmxvYWQnLCBmdW5jdGlvbigpIHsKICAgICAgY2xlYXJJbnRlcnZhbChfcGF0aEludGVydmFsKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gdHJpZ2dlck9uUGF0aChwYXRoKSB7CiAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9eIy8sJycpOwogICAgJC5wYXRoYmluZGVyLmNoYW5nZUZ1bnMuZm9yRWFjaChmdW5jdGlvbihmdW4pIHtmdW4ocGF0aCl9KTsKICAgIHZhciBwYXRoU3BlYywgcGF0aF9wYXJhbXMsIHBhcmFtcyA9IHt9LCBwYXJhbV9uYW1lLCBwYXJhbTsKICAgIGZvciAodmFyIGk9MDsgaSA8ICQucGF0aGJpbmRlci5wYXRocy5sZW5ndGg7IGkrKykgewogICAgICBwYXRoU3BlYyA9ICQucGF0aGJpbmRlci5wYXRoc1tpXTsKICAgICAgLy8gJC5sb2coInBhdGhTcGVjIiwgcGF0aFNwZWMpOwogICAgICBpZiAoKHBhdGhfcGFyYW1zID0gcGF0aFNwZWMubWF0Y2hlci5leGVjKHBhdGgpKSAhPT0gbnVsbCkgewogICAgICAgIC8vICQubG9nKCJwYXRoX3BhcmFtcyIsIHBhdGhfcGFyYW1zKTsKICAgICAgICBwYXRoX3BhcmFtcy5zaGlmdCgpOwogICAgICAgIGZvciAodmFyIGo9MDsgaiA8IHBhdGhfcGFyYW1zLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBwYXJhbV9uYW1lID0gcGF0aFNwZWMucGFyYW1fbmFtZXNbal07CiAgICAgICAgICBwYXJhbSA9IGRlY29kZVVSSUNvbXBvbmVudChwYXRoX3BhcmFtc1tqXSk7CiAgICAgICAgICBpZiAocGFyYW1fbmFtZSkgewogICAgICAgICAgICBwYXJhbXNbcGFyYW1fbmFtZV0gPSBwYXJhbTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICghcGFyYW1zLnNwbGF0KSBwYXJhbXMuc3BsYXQgPSBbXTsKICAgICAgICAgICAgcGFyYW1zLnNwbGF0LnB1c2gocGFyYW0pOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcGF0aFNwZWMuY2FsbGJhY2socGFyYW1zKTsKICAgICAgICAvLyByZXR1cm4gdHJ1ZTsgLy8gcmVtb3ZlZCB0aGlzIHRvIGFsbG93IGZvciBtdWx0aSBtYXRjaAogICAgICB9CiAgICB9OwogIH07CgogIC8vIGJpbmQgdGhlIGV2ZW50CiAgJChmdW5jdGlvbigpIHsKICAgIGlmICgnb25oYXNoY2hhbmdlJyBpbiB3aW5kb3cpIHsKICAgICAgLy8gd2UgaGF2ZSBhIG5hdGl2ZSBldmVudAogICAgfSBlbHNlIHsKICAgICAgcG9sbFBhdGgoMTApOwogICAgfQogICAgLy8gc2V0VGltZW91dChoYXNoQ2hhbmdlZCw1MCk7CiAgICAkKHdpbmRvdykuYmluZCgnaGFzaGNoYW5nZScsIGhhc2hDaGFuZ2VkKTsKICB9KTsKCiAgZnVuY3Rpb24gcmVnaXN0ZXJQYXRoKHBhdGhTcGVjKSB7CiAgICAkLnBhdGhiaW5kZXIucGF0aHMucHVzaChwYXRoU3BlYyk7CiAgfTsKCiAgZnVuY3Rpb24gc2V0UGF0aChwYXRoU3BlYywgcGFyYW1zKSB7CiAgICB2YXIgbmV3UGF0aCA9ICQubXVzdGFjaGUocGF0aFNwZWMudGVtcGxhdGUsIHBhcmFtcyk7CiAgICBnb1BhdGgobmV3UGF0aCk7CiAgfTsKICAKICBmdW5jdGlvbiBnb1BhdGgobmV3UGF0aCkgewogICAgaWYgKG5ld1BhdGgpIHsKICAgICAgLy8gJC5sb2coImdvUGF0aCIsIG5ld1BhdGgpCiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcjJytuZXdQYXRoOwogICAgfQogICAgX2xhc3RQYXRoID0gZ2V0UGF0aCgpOwogIH07CiAgCiAgZnVuY3Rpb24gZ2V0UGF0aCgpIHsKICAgIHZhciBtYXRjaGVzID0gd2luZG93LmxvY2F0aW9uLnRvU3RyaW5nKCkubWF0Y2goL15bXiNdKigjLispJC8pOwogICAgcmV0dXJuIG1hdGNoZXMgPyBtYXRjaGVzWzFdIDogJyc7CiAgfTsKCiAgZnVuY3Rpb24gbWFrZVBhdGhTcGVjKHBhdGgsIGNhbGxiYWNrKSB7CiAgICB2YXIgcGFyYW1fbmFtZXMgPSBbXTsKICAgIHZhciB0ZW1wbGF0ZSA9ICIiOwogICAgCiAgICBQQVRIX05BTUVfTUFUQ0hFUi5sYXN0SW5kZXggPSAwOwogICAgCiAgICB3aGlsZSAoKHBhdGhfbWF0Y2ggPSBQQVRIX05BTUVfTUFUQ0hFUi5leGVjKHBhdGgpKSAhPT0gbnVsbCkgewogICAgICBwYXJhbV9uYW1lcy5wdXNoKHBhdGhfbWF0Y2hbMV0pOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHBhcmFtX25hbWVzIDogcGFyYW1fbmFtZXMsCiAgICAgIG1hdGNoZXIgOiBuZXcgUmVnRXhwKCJeIiArIHBhdGgucmVwbGFjZSgKICAgICAgICBQQVRIX05BTUVfTUFUQ0hFUiwgUEFUSF9SRVBMQUNFUikucmVwbGFjZSgKICAgICAgICBTUExBVF9NQVRDSEVSLCBTUExBVF9SRVBMQUNFUikgKyAiLz8kIiksCiAgICAgIHRlbXBsYXRlIDogcGF0aC5yZXBsYWNlKFBBVEhfTkFNRV9NQVRDSEVSLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuICd7eycrYisnfX0nOwogICAgICB9KS5yZXBsYWNlKFNQTEFUX01BVENIRVIsICd7e3NwbGF0fX0nKSwKICAgICAgY2FsbGJhY2sgOiBjYWxsYmFjawogICAgfTsKICB9OwoKICAkLmZuLnBhdGhiaW5kZXIgPSBmdW5jdGlvbihuYW1lLCBwYXRocywgb3B0aW9ucykgewogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICB2YXIgc2VsZiA9ICQodGhpcyksIHBhdGhMaXN0ID0gcGF0aHMuc3BsaXQoL1xuLyk7CiAgICAkLmVhY2gocGF0aExpc3QsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgcGF0aCA9IHRoaXM7CiAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgLy8gJC5sb2coImJpbmQgcGF0aCIsIHBhdGgpOwogICAgICAgIHZhciBwYXRoU3BlYyA9IG1ha2VQYXRoU3BlYyhwYXRoLCBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgIC8vICQubG9nKCJwYXRoIGNiIiwgbmFtZSwgcGF0aCwgc2VsZikKICAgICAgICAgIC8vICQubG9nKCJ0cmlnZ2VyIHBhdGg6ICIrcGF0aCsiIHBhcmFtczogIiwgcGFyYW1zKTsKICAgICAgICAgIHNlbGYudHJpZ2dlcihuYW1lLCBbcGFyYW1zXSk7CiAgICAgICAgfSk7CiAgICAgICAgLy8gc2V0IHRoZSBwYXRoIHdoZW4gdGhlIGV2ZW50IHRyaWdnZXJlZCB0aHJvdWdoIG90aGVyIG1lYW5zCiAgICAgICAgaWYgKG9wdGlvbnMuYmluZFBhdGgpIHsKICAgICAgICAgIHNlbGYuYmluZChuYW1lLCBmdW5jdGlvbihldiwgcGFyYW1zKSB7CiAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7fTsKICAgICAgICAgICAgLy8gJC5sb2coInNldCBwYXRoIiwgbmFtZSwgcGF0aFNwZWMpCiAgICAgICAgICAgIHNldFBhdGgocGF0aFNwZWMsIHBhcmFtcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgLy8gdHJpZ2dlciB3aGVuIHRoZSBwYXRoIG1hdGNoZXMKICAgICAgICByZWdpc3RlclBhdGgocGF0aFNwZWMpOwogICAgICB9CiAgICB9KTsKICB9Owp9KShqUXVlcnkpOwogIA==","content_type":"application/javascript","revpos":1},".DS_Store":{"data":"AAAAAUJ1ZDEAABAAAAAIAAAAEAAAAAAlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAgLAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAACAAAAABAAAAQAAAAAEAAACAAAAAAQAAAQAAAAABAAACAAAAAAEAAAQAAAAAAAAAAAEAABAAAAAAAQAAIAAAAAABAABAAAAAAAEAAIAAAAAAAQABAAAAAAABAAIAAAAAAAEABAAAAAAAAQAIAAAAAAABABAAAAAAAAEAIAAAAAAAAQBAAAAAAAABAIAAAAAAAAEBAAAAAAAAAQIAAAAAAAABBAAAAAAAAAEIAAAAAAAAARAAAAAAAAABIAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAEAsAAABFAAAAJQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBERTREIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAYAAAAAAAAAABAAAAgAAAAAEAAAEAAAAAAQAAAgAAAAABAAAEAAAAAAIAAAgAAAAYAAAAAAAAAAABAAAgAAAAAAEAAEAAAAAAAQAAgAAAAAABAAEAAAAAAAEAAgAAAAAAAQAEAAAAAAABAAgAAAAAAAEAEAAAAAAAAQAgAAAAAAABAEAAAAAAAAEAgAAAAAAAAQEAAAAAAAABAgAAAAAAAAEEAAAAAAAAAQgAAAAAAAABEAAAAAAAAAEgAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==","content_type":"","revpos":1},"index.html":{"data":"PCFET0NUWVBFIEhUTUwgUFVCTElDICItLy9XM0MvL0RURCBIVE1MIDQuMDEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvVFIvaHRtbDQvc3RyaWN0LmR0ZCI+CjxodG1sPgogIDxoZWFkPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIG1heGltdW0tc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vOyIgLz4KCiAgICA8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LXR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCI+CgoJPCEtLSBpUGFkL2lQaG9uZSBzcGVjaWZpYyBjc3MgYmVsb3csIGFkZCBhZnRlciB5b3VyIG1haW4gY3NzID4KCTxsaW5rIHJlbD0ic3R5bGVzaGVldCIgbWVkaWE9Im9ubHkgc2NyZWVuIGFuZCAobWF4LWRldmljZS13aWR0aDogMTAyNHB4KSIgaHJlZj0iaXBhZC5jc3MiIHR5cGU9InRleHQvY3NzIiAvPgkJCgk8bGluayByZWw9InN0eWxlc2hlZXQiIG1lZGlhPSJvbmx5IHNjcmVlbiBhbmQgKG1heC1kZXZpY2Utd2lkdGg6IDQ4MHB4KSIgaHJlZj0iaXBob25lLmNzcyIgdHlwZT0idGV4dC9jc3MiIC8+CQkKCS0tPgoJPCEtLSBJZiB5b3UgYXBwbGljYXRpb24gaXMgdGFyZ2V0aW5nIGlPUyBCRUZPUkUgNC4wIHlvdSBNVVNUIHB1dCBqc29uMi5qcyBmcm9tIGh0dHA6Ly93d3cuSlNPTi5vcmcvanNvbjIuanMgaW50byB5b3VyIHd3dyBkaXJlY3RvcnkgYW5kIGluY2x1ZGUgaXQgaGVyZSAtLT4KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBjaGFyc2V0PSJ1dGYtOCIgc3JjPSJwaG9uZWdhcC4wLjkuNS4xLm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgY2hhcnNldD0idXRmLTgiPgoKCgkvLyBJZiB5b3Ugd2FudCB0byBwcmV2ZW50IGRyYWdnaW5nLCB1bmNvbW1lbnQgdGhpcyBzZWN0aW9uCgkvKgoJZnVuY3Rpb24gcHJldmVudEJlaGF2aW9yKGUpIAoJeyAKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOyAKICAgIH07Cglkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCBwcmV2ZW50QmVoYXZpb3IsIGZhbHNlKTsKCSovCgkKCS8qIElmIHlvdSBhcmUgc3VwcG9ydGluZyB5b3VyIG93biBwcm90b2NvbCwgdGhlIHZhciBpbnZva2VTdHJpbmcgd2lsbCBjb250YWluIGFueSBhcmd1bWVudHMgdG8gdGhlIGFwcCBsYXVuY2guCglzZWUgaHR0cDovL2lwaG9uZWRldmVsb3BlcnRpcHMuY29tL2NvY29hL2xhdW5jaGluZy15b3VyLW93bi1hcHBsaWNhdGlvbi12aWEtYS1jdXN0b20tdXJsLXNjaGVtZS5odG1sCglmb3IgbW9yZSBkZXRhaWxzIC1qbSAqLwoJLyoKCWZ1bmN0aW9uIGhhbmRsZU9wZW5VUkwodXJsKQoJewoJCS8vIFRPRE86IGRvIHNvbWV0aGluZyB3aXRoIHRoZSB1cmwgcGFzc2VkIGluLgoJfQoJKi8KCQoJZnVuY3Rpb24gb25Cb2R5TG9hZCgpCgl7CQkKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJkZXZpY2VyZWFkeSIsb25EZXZpY2VSZWFkeSxmYWxzZSk7Cgl9CgkKCS8qIFdoZW4gdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQsIFBob25lR2FwIGhhcyBiZWVuIGluaXRpYWxpemVkIGFuZCBpcyByZWFkeSB0byByb2xsICovCgkvKiBJZiB5b3UgYXJlIHN1cHBvcnRpbmcgeW91ciBvd24gcHJvdG9jb2wsIHRoZSB2YXIgaW52b2tlU3RyaW5nIHdpbGwgY29udGFpbiBhbnkgYXJndW1lbnRzIHRvIHRoZSBhcHAgbGF1bmNoLgoJc2VlIGh0dHA6Ly9pcGhvbmVkZXZlbG9wZXJ0aXBzLmNvbS9jb2NvYS9sYXVuY2hpbmcteW91ci1vd24tYXBwbGljYXRpb24tdmlhLWEtY3VzdG9tLXVybC1zY2hlbWUuaHRtbAoJZm9yIG1vcmUgZGV0YWlscyAtam0gKi8KCWZ1bmN0aW9uIG9uRGV2aWNlUmVhZHkoKQoJewoJfQogICAgCiAgICA8L3NjcmlwdD4KICA8L2hlYWQ+CiAgPGJvZHkgb25sb2FkPSJvbkJvZHlMb2FkKCkiPgogIAkgIDxoMT5Db3VjaEFwcCBpcyBMb2FkZWQhITwvaDE+CiAgPC9ib2R5Pgo8L2h0bWw+Cg==","content_type":"text/html","revpos":4}},"couchapp":{"name":"Name of your CouchApp","manifest":["couchapp.json","evently/","evently/items/","evently/items/_changes/","evently/items/_changes/data.js","evently/items/_changes/mustache.html","evently/items/_changes/query.json","evently/profile/","evently/profile/profileReady/","evently/profile/profileReady/mustache.html","evently/profile/profileReady/selectors/","evently/profile/profileReady/selectors/form/","evently/profile/profileReady/selectors/form/submit.js","language","lists/","README.md","shows/","updates/","vendor/","vendor/couchapp/","vendor/couchapp/evently/","vendor/couchapp/evently/account/","vendor/couchapp/evently/account/_init.js","vendor/couchapp/evently/account/adminParty/","vendor/couchapp/evently/account/adminParty/mustache.html","vendor/couchapp/evently/account/doLogin.js","vendor/couchapp/evently/account/doLogout.js","vendor/couchapp/evently/account/doSignup.js","vendor/couchapp/evently/account/loggedIn/","vendor/couchapp/evently/account/loggedIn/after.js","vendor/couchapp/evently/account/loggedIn/data.js","vendor/couchapp/evently/account/loggedIn/mustache.html","vendor/couchapp/evently/account/loggedIn/selectors.json","vendor/couchapp/evently/account/loggedOut/","vendor/couchapp/evently/account/loggedOut/mustache.html","vendor/couchapp/evently/account/loggedOut/selectors.json","vendor/couchapp/evently/account/loginForm/","vendor/couchapp/evently/account/loginForm/after.js","vendor/couchapp/evently/account/loginForm/mustache.html","vendor/couchapp/evently/account/loginForm/selectors/","vendor/couchapp/evently/account/loginForm/selectors/form/","vendor/couchapp/evently/account/loginForm/selectors/form/submit.js","vendor/couchapp/evently/account/signupForm/","vendor/couchapp/evently/account/signupForm/after.js","vendor/couchapp/evently/account/signupForm/mustache.html","vendor/couchapp/evently/account/signupForm/selectors/","vendor/couchapp/evently/account/signupForm/selectors/form/","vendor/couchapp/evently/account/signupForm/selectors/form/submit.js","vendor/couchapp/evently/profile/","vendor/couchapp/evently/profile/loggedIn.js","vendor/couchapp/evently/profile/loggedOut/","vendor/couchapp/evently/profile/loggedOut/after.js","vendor/couchapp/evently/profile/loggedOut/mustache.html","vendor/couchapp/evently/profile/noProfile/","vendor/couchapp/evently/profile/noProfile/data.js","vendor/couchapp/evently/profile/noProfile/mustache.html","vendor/couchapp/evently/profile/noProfile/selectors/","vendor/couchapp/evently/profile/noProfile/selectors/form/","vendor/couchapp/evently/profile/noProfile/selectors/form/submit.js","vendor/couchapp/evently/profile/profileReady/","vendor/couchapp/evently/profile/profileReady/after.js","vendor/couchapp/evently/profile/profileReady/data.js","vendor/couchapp/evently/profile/profileReady/mustache.html","vendor/couchapp/evently/README.md","vendor/couchapp/lib/","vendor/couchapp/lib/atom.js","vendor/couchapp/lib/cache.js","vendor/couchapp/lib/code.js","vendor/couchapp/lib/docform.js","vendor/couchapp/lib/linkup.js","vendor/couchapp/lib/list.js","vendor/couchapp/lib/markdown.js","vendor/couchapp/lib/md5.js","vendor/couchapp/lib/mustache.js","vendor/couchapp/lib/path.js","vendor/couchapp/lib/redirect.js","vendor/couchapp/lib/utils.js","vendor/couchapp/lib/validate.js","vendor/couchapp/metadata.json","views/","views/recent-items/","views/recent-items/map.js"],"signatures":{"phonegap.0.9.5.1.min.js":"0b99b867a5c3538a3dedca20741d2823","vendor/couchapp/jquery.evently.js":"fa350155fc1ec03a6a2b4bffee808869","phonegap.0.9.5.1.js":"80d27df20d713ccf1d06133e9164cbcc","vendor/couchapp/jquery.mustache.js":"0bfbc929b6d5500aacfa860c783550d8","vendor/couchapp/jquery.couch.app.js":"b8624bffe128d1453c7c4d01e8b1b5b0","vendor/couchapp/jquery.couch.app.util.js":"9fc84685dfa7b35237239916ae406583","vendor/couchapp/loader.js":"5c771689c7faebedd7be76f2e1638c6f","vendor/couchapp/jquery.pathbinder.js":"65ecfa230f539d62f36938aaebed4ac1",".DS_Store":"194577a7e20bdcc7afbb718f502c134c","index.html":"b93eaf4f5f4219292139c4b6623ecdc6"},"description":"CouchApp","objects":{}}}